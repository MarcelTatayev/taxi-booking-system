<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Marcel's Taxi - Drivers & Vehicles</title>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta name="version" content="2.1-fixed-meet-greet">
    
    <style>
        .table-header {
            padding: 12px 8px;
            text-align: left;
            font-weight: 600;
            color: #495057;
            border-bottom: 2px solid #dee2e6;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .table-cell {
            padding: 10px 8px;
            border-bottom: 1px solid #f0f0f0;
            vertical-align: top;
            overflow: hidden;
        }
        
        .font-medium {
            font-weight: 500;
            color: #333;
        }
        
        .small-text {
            font-size: 11px;
            color: #666;
            margin-top: 2px;
        }
        
        .status-badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 12px;
            font-weight: 500;
            text-transform: uppercase;
            font-size: 10px;
        }
        
        .status-badge.confirmed {
            background-color: #d4edda;
            color: #155724;
        }
        
        .status-badge.cancelled {
            background-color: #f8d7da;
            color: #721c24;
        }
        
        .status-badge {
            background-color: #fff3cd;
            color: #856404;
        }
        
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #6c757d;
        }
        
        .empty-state h3 {
            margin: 0 0 10px 0;
            color: #495057;
        }
        
        .empty-state p {
            margin: 0;
            font-size: 14px;
        }
    </style>
    
    
    <script>
        // CRITICAL DRIVER FUNCTIONS - DEFINED IMMEDIATELY
        
        function closeDriverModal() {
            const modal = document.getElementById('addDriverModal');
            if (modal) {
                modal.style.display = 'none';
                console.log('‚úÖ Modal closed');
            }
        }
        
        
        // üî• MARCEL CENTRAL PRICE FUNCTION - ALWAYS USE THIS
        function getCorrectTripPrice(booking) {
            // If booking has individual tripPrice, use it (this should be correctly calculated)
            if (booking.tripPrice !== undefined) {
                console.log('‚úÖ Using individual tripPrice:', booking.tripPrice);
                return parseFloat(booking.tripPrice);
            }
            
            console.log('‚ö†Ô∏è Fallback to 50 euro');
            return 50; // Fallback
        }

        // üåç COUNTRY DETECTION FUNCTION
        function detectCountryFromAddress(address) {
            if (!address) return 'BE'; // Default to Belgium
            const addressLower = address.toLowerCase();
            
            // Belgium
            if (addressLower.includes('brussel') || addressLower.includes('bruxelles') || 
                addressLower.includes('antwerpen') || addressLower.includes('gent') || 
                addressLower.includes('brugge') || addressLower.includes('leuven') ||
                addressLower.includes('mechelen') || addressLower.includes('belgi√´') ||
                addressLower.includes('belgique') || addressLower.includes('belgium') ||
                addressLower.includes('zaventem') || addressLower.includes('charleroi')) {
                return 'BE';
            }
            
            // Netherlands  
            if (addressLower.includes('amsterdam') || addressLower.includes('rotterdam') ||
                addressLower.includes('den haag') || addressLower.includes('utrecht') ||
                addressLower.includes('eindhoven') || addressLower.includes('tilburg') ||
                addressLower.includes('nederland') || addressLower.includes('netherlands') ||
                addressLower.includes('holland') || addressLower.includes('schiphol')) {
                return 'NL';
            }
            
            // Germany
            if (addressLower.includes('berlin') || addressLower.includes('m√ºnchen') ||
                addressLower.includes('hamburg') || addressLower.includes('k√∂ln') ||
                addressLower.includes('frankfurt') || addressLower.includes('stuttgart') ||
                addressLower.includes('deutschland') || addressLower.includes('germany') ||
                addressLower.includes('d√ºsseldorf') || addressLower.includes('dortmund')) {
                return 'DE';
            }
            
            // Spain
            if (addressLower.includes('madrid') || addressLower.includes('barcelona') ||
                addressLower.includes('valencia') || addressLower.includes('sevilla') ||
                addressLower.includes('bilbao') || addressLower.includes('espa√±a') ||
                addressLower.includes('spain') || addressLower.includes('malaga')) {
                return 'ES';
            }
            
            // France
            if (addressLower.includes('paris') || addressLower.includes('lyon') ||
                addressLower.includes('marseille') || addressLower.includes('toulouse') ||
                addressLower.includes('nice') || addressLower.includes('nantes') ||
                addressLower.includes('france') || addressLower.includes('frankrijk')) {
                return 'FR';
            }
            
            return 'BE'; // Default
        }

        // üåç GET COUNTRY FLAG AND NAME
        function getCountryInfo(countryCode) {
            switch (countryCode) {
                case 'BE': return { flag: 'üáßüá™', name: 'BE', color: '#000000' };
                case 'NL': return { flag: 'üá≥üá±', name: 'NL', color: '#FF8C00' };
                case 'DE': return { flag: 'üá©üá™', name: 'DE', color: '#FF0000' };
                case 'ES': return { flag: 'üá™üá∏', name: 'ES', color: '#C60B1E' };
                case 'FR': return { flag: 'üá´üá∑', name: 'FR', color: '#0055A4' };
                default: return { flag: 'üáßüá™', name: 'BE', color: '#000000' };
            }
        }

        // üö® DISPATCH ACTIONS
        function dispatchAssignDriver(bookingId) {
            alert(`Assign driver functionality for booking ${bookingId} - Coming soon!`);
        }

        function dispatchBroadcastRide(bookingId) {
            alert(`Broadcast ride functionality for booking ${bookingId} - Coming soon!`);
        }

        function dispatchAutoAssign(bookingId) {
            alert(`Auto-assign functionality for booking ${bookingId} - Coming soon!`);
        }

        //  GET DRIVER OPTIONS HTML
        function getDriverOptionsHTML(selectedDriver) {
            const drivers = JSON.parse(localStorage.getItem('taxiDrivers') || '[]');
            let html = '';
            
            drivers.forEach(driver => {
                if (driver.status === 'online') {
                    html += `<option value="${driver.id}" ${selectedDriver === driver.id ? 'selected' : ''}>${driver.name}</option>`;
                }
            });
            
            return html || '<option value="">No drivers available</option>';
        }

        //  ASSIGN DRIVER TO BOOKING
        function assignDriverToBooking(bookingId, driverValue) {
            console.log(`Assigning driver ${driverValue} to booking ${bookingId}`);
            
            // Get confirmed bookings
            let confirmedBookings = JSON.parse(localStorage.getItem('confirmedBookings') || '[]');
            
            // Find and update booking
            const bookingIndex = confirmedBookings.findIndex(b => b.bookingId === bookingId);
            if (bookingIndex !== -1) {
                confirmedBookings[bookingIndex].driver = driverValue;
                localStorage.setItem('confirmedBookings', JSON.stringify(confirmedBookings));
                
                // Handle automatic assignments with email
                if (driverValue.startsWith('auto-')) {
                    const autoType = {
                        'auto-all': 'üì¢ Broadcasting to all drivers',
                        'auto-nearby': 'üìç Notifying nearby drivers',
                        'auto-lastminute': '‚è∞ Auto-assigning for last-minute transfer'
                    };
                    
                    // Determine email template based on auto type
                    let templateType = 'normal';
                    if (driverValue === 'auto-lastminute') {
                        templateType = 'lastminute';
                    } else if (driverValue === 'auto-all') {
                        // Check if urgent based on time
                        const booking = confirmedBookings[bookingIndex];
                        const tripDateTime = new Date(`${booking.trip.travelDate.split('/').reverse().join('-')}T${booking.trip.travelHour}:${booking.trip.travelMinute}`);
                        const now = new Date();
                        const hoursUntil = Math.ceil((tripDateTime - now) / (1000 * 60 * 60));
                        
                        if (hoursUntil <= 2) {
                            templateType = 'urgent';
                        } else if (hoursUntil <= 4) {
                            templateType = 'lastminute';
                        }
                    }
                    
                    showNotification(autoType[driverValue] || 'Driver assignment updated', 'success');
                    
                    // Auto-send email for broadcast options
                    setTimeout(() => {
                        if (confirm(`Wil je nu automatisch een email versturen naar de chauffeurs?`)) {
                            sendEmail(bookingId, templateType);
                        }
                    }, 1000);
                    
                } else if (driverValue) {
                    // Specific driver assignment
                    const drivers = JSON.parse(localStorage.getItem('taxiDrivers') || '[]');
                    const driver = drivers.find(d => d.id === driverValue);
                    showNotification(`‚úÖ Assigned to ${driver ? driver.name : 'driver'}`, 'success');
                    
                    // Option to send confirmation email to specific driver
                    if (driver) {
                        setTimeout(() => {
                            if (confirm(`Wil je een bevestigings email sturen naar ${driver.name}?`)) {
                                sendEmail(bookingId, 'normal');
                            }
                        }, 1000);
                    }
                }
            }
        }

        // üì± QUICK ACTIONS
        function sendSMS(bookingId) {
            alert(`SMS functionality for booking ${bookingId} - Coming soon!`);
        }

        // üìß EMAIL TEMPLATES
        const emailTemplates = {
            normal: {
                subject: "Nieuwe Taxirit Beschikbaar - {datetime}",
                body: `Beste chauffeur,

Er is een nieuwe taxirit beschikbaar:

üóìÔ∏è Datum & Tijd: {datetime}
üìç Ophalen: {pickup}
üìç Bestemming: {destination}
üë§ Klant: {customer} - {phone}
 Voertuig: {vehicle}
üí∞ Prijs: ‚Ç¨{price}
üìã Opmerkingen: {notes}

Reageer zo snel mogelijk als je deze rit kunt uitvoeren.

Met vriendelijke groet,
Taxi Dispatch Team`
            },
            urgent: {
                subject: "üö® URGENTE Taxirit - Binnen {timeLeft} uur!",
                body: `üö® URGENT - Directe chauffeur nodig!

BELANGRIJKE RIT DETAILS:
üóìÔ∏è Datum & Tijd: {datetime} (VANDAAG!)
üìç Ophalen: {pickup}
üìç Bestemming: {destination}
üë§ Klant: {customer} - {phone}
 Voertuig: {vehicle}
üí∞ Prijs: ‚Ç¨{price}
üìã Opmerkingen: {notes}

‚ö†Ô∏è Deze rit moet binnen {timeLeft} uur beginnen!
Reageer ONMIDDELLIJK als je beschikbaar bent.

Dringende groet,
Taxi Dispatch Team`
            },
            lastminute: {
                subject: "‚è∞ LAST-MINUTE Transfer - {datetime}",
                body: `‚è∞ LAST-MINUTE VERZOEK

Een klant heeft dringend een taxi nodig:

üóìÔ∏è Datum & Tijd: {datetime}
üìç Ophalen: {pickup}
üìç Bestemming: {destination}
üë§ Klant: {customer} - {phone}
 Voertuig: {vehicle}
üí∞ Prijs: ‚Ç¨{price}
üìã Opmerkingen: {notes}

Dit is een last-minute boeking. Eerste reactie krijgt de rit!

Met spoed,
Taxi Dispatch Team`
            }
        };

        function sendEmail(bookingId, templateType = 'normal') {
            // Get booking details
            let booking = null;
            
            // Search in all booking arrays
            const confirmedBookings = JSON.parse(localStorage.getItem('confirmedBookings') || '[]');
            const unconfirmedBookings = JSON.parse(localStorage.getItem('unconfirmedBookings') || '[]');
            
            booking = confirmedBookings.find(b => b.bookingId === bookingId) || 
                     unconfirmedBookings.find(b => b.bookingId === bookingId);
            
            if (!booking) {
                alert('Boeking niet gevonden!');
                return;
            }
            
            showEmailModal(booking, templateType);
        }

        function showEmailModal(booking, templateType = 'normal') {
            // Calculate time until trip
            const tripDateTime = new Date(`${booking.trip.travelDate.split('/').reverse().join('-')}T${booking.trip.travelHour}:${booking.trip.travelMinute}`);
            const now = new Date();
            const hoursUntil = Math.ceil((tripDateTime - now) / (1000 * 60 * 60));
            
            // Auto-select template based on urgency
            if (hoursUntil <= 2) {
                templateType = 'urgent';
            } else if (hoursUntil <= 4) {
                templateType = 'lastminute';
            }
            
            const template = emailTemplates[templateType];
            const vehicleName = booking.vehicle?.vehicle?.name || 'Saloon';
            const price = booking.finalPrice || booking.totalPrice || '50.00';
            
            // Replace template variables
            const subject = template.subject
                .replace('{datetime}', `${booking.trip.travelDate} om ${booking.trip.travelHour}:${booking.trip.travelMinute}`)
                .replace('{timeLeft}', hoursUntil.toString());
                
            const body = template.body
                .replace('{datetime}', `${booking.trip.travelDate} om ${booking.trip.travelHour}:${booking.trip.travelMinute}`)
                .replace('{pickup}', booking.trip.fromLocation)
                .replace('{destination}', booking.trip.toLocation)
                .replace('{customer}', `${booking.customer.firstName} ${booking.customer.lastName}`)
                .replace('{phone}', booking.customer.phone)
                .replace('{vehicle}', vehicleName)
                .replace('{price}', price)
                .replace('{notes}', booking.specialInstructions || 'Geen bijzondere verzoeken')
                .replace(/{timeLeft}/g, hoursUntil.toString());
            
            // Show modal with email preview
            const modal = document.createElement('div');
            modal.id = 'emailModal';
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                background: rgba(0,0,0,0.5); display: flex; align-items: center; 
                justify-content: center; z-index: 1000;
            `;
            
            modal.innerHTML = `
                <div style="background: white; padding: 30px; border-radius: 12px; width: 90%; max-width: 700px; max-height: 80vh; overflow-y: auto;">
                    <h3 style="margin: 0 0 20px 0; color: #333;">üìß Email naar Chauffeurs</h3>
                    
                    <div style="margin-bottom: 20px;">
                        <label style="font-weight: 600; display: block; margin-bottom: 5px;">Template Type:</label>
                        <select id="templateSelect" style="padding: 8px; border: 1px solid #ddd; border-radius: 6px; width: 200px;" onchange="switchEmailTemplate('${booking.bookingId}', this.value)">
                            <option value="normal" ${templateType === 'normal' ? 'selected' : ''}>üìß Normale Email</option>
                            <option value="urgent" ${templateType === 'urgent' ? 'selected' : ''}>üö® Urgent</option>
                            <option value="lastminute" ${templateType === 'lastminute' ? 'selected' : ''}>‚è∞ Last-Minute</option>
                        </select>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <label style="font-weight: 600; display: block; margin-bottom: 5px;">Onderwerp:</label>
                        <input type="text" id="emailSubject" value="${subject}" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px;">
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <label style="font-weight: 600; display: block; margin-bottom: 5px;">Email Inhoud:</label>
                        <textarea id="emailBody" rows="12" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-family: monospace; font-size: 14px;">${body}</textarea>
                    </div>
                    
                    <div style="margin-bottom: 20px; padding: 15px; background: #f8f9fa; border-radius: 6px;">
                        <h4 style="margin: 0 0 10px 0; color: #666;">Versturen naar:</h4>
                        <div id="recipientOptions">
                            <label style="display: block; margin-bottom: 8px;">
                                <input type="radio" name="recipients" value="all" checked> 
                                üìß Alle Chauffeurs (${getDrierCount()} chauffeurs)
                            </label>
                            <label style="display: block; margin-bottom: 8px;">
                                <input type="radio" name="recipients" value="country"> 
                                üåç Alleen Chauffeurs in ${getCountryName(booking.trip.fromLocation)}
                            </label>
                            <label style="display: block;">
                                <input type="radio" name="recipients" value="online"> 
                                üü¢ Alleen Online Chauffeurs
                            </label>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 10px; justify-content: flex-end;">
                        <button onclick="closeEmailModal()" style="background: #6c757d; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer;">
                            Annuleren
                        </button>
                        <button onclick="sendEmailToDrivers('${booking.bookingId}')" style="background: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-weight: 600;">
                            üìß Email Versturen
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        function switchEmailTemplate(bookingId, templateType) {
            closeEmailModal();
            
            // Find booking and show modal with new template
            const confirmedBookings = JSON.parse(localStorage.getItem('confirmedBookings') || '[]');
            const unconfirmedBookings = JSON.parse(localStorage.getItem('unconfirmedBookings') || '[]');
            
            const booking = confirmedBookings.find(b => b.bookingId === bookingId) || 
                           unconfirmedBookings.find(b => b.bookingId === bookingId);
            
            if (booking) {
                showEmailModal(booking, templateType);
            }
        }

        function getDrierCount() {
            const drivers = JSON.parse(localStorage.getItem('taxiDrivers') || '[]');
            return drivers.length;
        }

        function getCountryName(address) {
            const country = detectCountryFromAddress(address);
            const countryNames = {
                'BE': 'Belgi√´',
                'NL': 'Nederland', 
                'DE': 'Duitsland',
                'ES': 'Spanje',
                'FR': 'Frankrijk'
            };
            return countryNames[country] || 'Belgi√´';
        }

        function sendEmailToDrivers(bookingId) {
            const subject = document.getElementById('emailSubject').value;
            const body = document.getElementById('emailBody').value;
            const recipients = document.querySelector('input[name="recipients"]:checked').value;
            
            // Get driver count based on selection
            const drivers = JSON.parse(localStorage.getItem('taxiDrivers') || '[]');
            let recipientCount = 0;
            
            switch(recipients) {
                case 'all':
                    recipientCount = drivers.length;
                    break;
                case 'country':
                    recipientCount = drivers.filter(d => d.country === detectCountryFromAddress(document.querySelector('#emailBody').value)).length || Math.floor(drivers.length * 0.7);
                    break;
                case 'online':
                    recipientCount = drivers.filter(d => d.status === 'online').length;
                    break;
            }
            
            // Simulate email sending
            closeEmailModal();
            
            // Show success notification
            showNotification(`‚úÖ Email verzonden naar ${recipientCount} chauffeurs`, 'success');
            
            // Log the action
            console.log('üìß Email sent:', {
                bookingId,
                subject,
                recipients,
                recipientCount,
                timestamp: new Date().toISOString()
            });
            
            // Update booking with email sent status
            updateBookingEmailStatus(bookingId, recipients, recipientCount);
        }

        function updateBookingEmailStatus(bookingId, recipients, count) {
            const now = new Date().toLocaleString('nl-BE');
            
            // Update in confirmed bookings
            let confirmedBookings = JSON.parse(localStorage.getItem('confirmedBookings') || '[]');
            const confirmedIndex = confirmedBookings.findIndex(b => b.bookingId === bookingId);
            if (confirmedIndex !== -1) {
                if (!confirmedBookings[confirmedIndex].emailHistory) {
                    confirmedBookings[confirmedIndex].emailHistory = [];
                }
                confirmedBookings[confirmedIndex].emailHistory.push({
                    timestamp: now,
                    recipients: recipients,
                    count: count
                });
                confirmedBookings[confirmedIndex].lastEmailSent = now;
                localStorage.setItem('confirmedBookings', JSON.stringify(confirmedBookings));
            }
            
            // Update in unconfirmed bookings  
            let unconfirmedBookings = JSON.parse(localStorage.getItem('unconfirmedBookings') || '[]');
            const unconfirmedIndex = unconfirmedBookings.findIndex(b => b.bookingId === bookingId);
            if (unconfirmedIndex !== -1) {
                if (!unconfirmedBookings[unconfirmedIndex].emailHistory) {
                    unconfirmedBookings[unconfirmedIndex].emailHistory = [];
                }
                unconfirmedBookings[unconfirmedIndex].emailHistory.push({
                    timestamp: now,
                    recipients: recipients,
                    count: count
                });
                unconfirmedBookings[unconfirmedIndex].lastEmailSent = now;
                localStorage.setItem('unconfirmedBookings', JSON.stringify(unconfirmedBookings));
            }
        }

        function closeEmailModal() {
            const modal = document.getElementById('emailModal');
            if (modal) {
                modal.remove();
            }
        }

        function printBooking(bookingId) {
            alert(`Print functionality for booking ${bookingId} - Coming soon!`);
        }

        

        // WORKING DRIVER FUNCTIONS - LOADED FIRST
        let drivers = [];
        
        // üöÄ SAFE FUNCTION WRAPPER - PREVENT "NOT DEFINED" ERRORS
        window.safeCall = function(functionName, ...args) {
            if (typeof window[functionName] === 'function') {
                return window[functionName](...args);
            } else {
                console.warn(`Function ${functionName} not yet defined, retrying in 100ms...`);
                setTimeout(() => {
                    if (typeof window[functionName] === 'function') {
                        window[functionName](...args);
                    } else {
                        console.error(`Function ${functionName} still not defined after retry`);
                    }
                }, 100);
            }
        };
        
        // Placeholder functions that will be replaced when real functions load
        window.refreshUnconfirmedBookings = function() {
            console.log('üîÑ refreshUnconfirmedBookings placeholder - waiting for real function...');
        };

        // üß™ TEST DATA FUNCTION - Add sample confirmed bookings for Next 24 Hours

        
        // üöÄ CRITICAL UI FUNCTIONS - DEFINE IMMEDIATELY
        window.toggleMenu = function(menuName) {
            
            const menu = document.getElementById(menuName + '-menu');
            if (!menu) {
                console.error('‚ùå Menu not found:', menuName + '-menu');
                return;
            }
            
            
            // Close other menus
            const allMenus = document.querySelectorAll('.nav-submenu');
            allMenus.forEach(m => {
                if (m.id !== menuName + '-menu') {
                    m.style.display = 'none';
                }
            });
            
            // Toggle current menu
            if (menu.style.display === 'none' || menu.style.display === '') {
                menu.style.display = 'block';
                console.log('‚úÖ Menu opened:', menuName);
            } else {
                menu.style.display = 'none';
                console.log('‚úÖ Menu closed:', menuName);
            }
        };

        // üöÄ SHOWSECTION FUNCTION - DEFINE IMMEDIATELY
        window.showSection = function(sectionName) {
            
            // Hide all sections
            const sections = document.querySelectorAll('.content-section');
            sections.forEach(section => {
                section.classList.remove('active');
            });
            
            // Show target section
            const targetSection = document.getElementById(sectionName + '-section');
            if (targetSection) {
                targetSection.classList.add('active');
                const pageTitle = document.getElementById('pageTitle');
                if (pageTitle) {
                    // Betere titels voor verschillende secties
                    const titleMap = {
                        'unconfirmed': 'üìã Unconfirmed Bookings',
                        'next-24h': 'üìã Next 24 Hours',
                        'latest': 'üìã Latest Bookings',
                        'completed': '‚úÖ Completed Bookings',
                        'cancelled': '‚ùå Cancelled Bookings',
                        'all-bookings': 'üìã All Bookings',
                        'trash': 'üóëÔ∏è Trash',
                        'distance-time': 'üí∞ Distance & Time Pricing',
                        'dispatch': 'üö® Dispatch Center',
                        'drivers': ' TEST - Driver Management',
                        'vehicle-manager': ' Vehicle Manager',
                        'general': '‚öôÔ∏è General Settings',
                        'mail': 'üìß Email Settings',
                        'item-surcharge': 'üí∞ Item Surcharge',
                        'location-surcharge': 'üìç Location Surcharge',
                        'payment-methods': 'üí≥ Payment Methods'
                    };
                    
                    pageTitle.textContent = titleMap[sectionName] || sectionName.charAt(0).toUpperCase() + sectionName.slice(1);
                    
                    // Set subtitle
                    const pageSubtitle = document.getElementById('pageSubtitle');
                    const subtitleMap = {
                        'next-24h': 'Confirmed bookings for the next 24 hours',
                        'unconfirmed': 'New bookings awaiting confirmation',
                        'latest': 'Most recent booking requests',
                        'completed': 'Successfully completed trips and services',
                        'cancelled': 'Cancelled and deleted bookings',
                        'all-bookings': 'Complete history of all bookings from customer and dispatch systems',
                        'trash': 'Deleted bookings (can be restored or permanently deleted)',
                        'distance-time': 'Configure pricing for each vehicle type - prices will be used in the booking system',
                        'dispatch': 'Manual taxi booking and dispatch system'
                    };
                    
                    if (pageSubtitle) {
                        pageSubtitle.textContent = subtitleMap[sectionName] || '';
                    }
                }
                
                // Special section loading with safe function calls
                if (sectionName === 'distance-time') {
                    setTimeout(() => {
                        if (typeof loadVehiclePricing === 'function') loadVehiclePricing();
                    }, 200);
                }
                if (sectionName === 'unconfirmed') {
                    setTimeout(() => {
                        if (typeof loadUnconfirmedBookingsV2 === 'function') loadUnconfirmedBookingsV2();
                    }, 200);
                }
                if (sectionName === 'next-24h') {
                    setTimeout(() => {
                        if (typeof loadNext24hBookings === 'function') loadNext24hBookings();
                    }, 200);
                }
                if (sectionName === 'drivers') {
                    setTimeout(() => {
                        if (typeof loadDriversList === 'function') loadDriversList();
                    }, 200);
                }
                if (sectionName === 'dispatch') {
                    console.log('üö® Dispatch section loading...');
                    setTimeout(() => {
                        console.log('üîÑ Loading dispatch components...');
                        
                        // Initialize dispatch datetime
                        if (typeof initDispatchDateTime === 'function') {
                            console.log('üìÖ Initializing dispatch date/time...');
                            initDispatchDateTime();
                        } else {
                            console.log('‚ùå initDispatchDateTime function not found');
                        }
                        
                        // Test if dispatch return calendar exists
                        const returnDateInput = document.getElementById('dispatchReturnDate');
                        const returnCalendar = document.getElementById('dispatchReturnCalendar');
                        console.log('üîç Return date input exists:', !!returnDateInput);
                        console.log('üîç Return calendar exists:', !!returnCalendar);
                        
                        // Test and fix onclick handler
                        if (returnDateInput) {
                            console.log('üîç Return date input onclick:', returnDateInput.onclick);
                            console.log('üîç Return date input getAttribute onclick:', returnDateInput.getAttribute('onclick'));
                            
                            // Add direct event listener as backup
                            returnDateInput.addEventListener('click', function() {
                                console.log('üî• Direct event listener triggered!');
                                if (typeof toggleDispatchReturnCalendar === 'function') {
                                    console.log('‚úÖ Calling toggleDispatchReturnCalendar...');
                                    toggleDispatchReturnCalendar();
                                } else {
                                    console.error('‚ùå toggleDispatchReturnCalendar function not found');
                                }
                            });
                            console.log('‚úÖ Added direct event listener to return date input');
                        }
                        
                        // Also test main dispatch date input
                        const mainDateInput = document.getElementById('dispatchDate');
                        if (mainDateInput) {
                            console.log('üîç Main date input exists');
                            mainDateInput.addEventListener('click', function() {
                                console.log('üî• Main date clicked!');
                                if (typeof toggleDispatchCalendar === 'function') {
                                    toggleDispatchCalendar();
                                }
                            });
                        }
                        
                        // Fix return journey button
                        const retourBtn = document.getElementById('dispatchRetourBtn');
                        if (retourBtn) {
                            console.log('üîç Retour button found');
                            retourBtn.addEventListener('click', function() {
                                console.log('üîÑ Retour button clicked!');
                                if (typeof toggleDispatchRetour === 'function') {
                                    toggleDispatchRetour();
                                } else {
                                    // Inline toggle logic
                                    dispatchRetourActive = !dispatchRetourActive;
                                    const details = document.getElementById('dispatchRetourDetails');
                                    const status = document.getElementById('dispatchRetourStatus');
                                    
                                    if (details && status) {
                                        if (dispatchRetourActive) {
                                            details.style.display = 'block';
                                            status.textContent = 'Activated ‚úÖ';
                                            status.style.color = '#28a745';
                                        } else {
                                            details.style.display = 'none';
                                            status.textContent = 'Not activated';
                                            status.style.color = '#666';
                                        }
                                    }
                                    console.log('‚úÖ Retour toggled:', dispatchRetourActive);
                                }
                            });
                        }
                        
                        // Initialize dispatch vehicles
                        console.log('üöó Loading dispatch vehicles...');
                        const vehicleSelect = document.getElementById('dispatchVehicleSelect');
                        if (vehicleSelect) {
                            console.log('‚úÖ Vehicle dropdown found, loading vehicles...');
                                
                                // Clear existing options
                                vehicleSelect.innerHTML = '';
                                
                                // Get vehicles from localStorage or create defaults
                                let taxiVehicles = JSON.parse(localStorage.getItem('taxiVehicles') || '[]');
                                
                                // Default vehicles if none exist
                                if (taxiVehicles.length === 0) {
                                    taxiVehicles = [
                                        { id: 'saloon', name: 'Saloon', passengers: 4 },
                                        { id: 'estate', name: 'Estate', passengers: 4 },
                                        { id: 'minivan', name: 'Minivan', passengers: 6 },
                                        { id: 'minibus', name: 'Minibus', passengers: 8 }
                                    ];
                                    localStorage.setItem('taxiVehicles', JSON.stringify(taxiVehicles));
                                    console.log('‚ö†Ô∏è Created default vehicles');
                                }
                                
                                // Add Unassigned option first
                                const unassignedOption = document.createElement('option');
                                unassignedOption.value = '';
                                unassignedOption.textContent = ' Unassigned';
                                vehicleSelect.appendChild(unassignedOption);
                                
                                // Add all vehicles
                                taxiVehicles.forEach(vehicle => {
                                    const option = document.createElement('option');
                                    option.value = vehicle.id;
                                    option.textContent = ` ${vehicle.name} (${vehicle.passengers} seats)`;
                                    vehicleSelect.appendChild(option);
                                    console.log(`‚ûï Added: ${vehicle.name}`);
                                });
                                
                                console.log(`‚úÖ Loaded ${taxiVehicles.length} vehicles into dropdown`);
                            } else {
                                console.error('‚ùå Vehicle dropdown element not found!');
                            }
                        }, 500);
                    }, 200);
                }
                if (sectionName === 'vehicle-manager') {
                    console.log(' Vehicle Manager section loading...');
                    
                    // Test if section exists and is visible
                    const vmSection = document.getElementById('vehicle-manager-section');
                    if (vmSection) {
                        console.log('‚úÖ Vehicle Manager section found');
                        console.log('üìê Section display style:', window.getComputedStyle(vmSection).display);
                        console.log('üëÅÔ∏è Section visibility:', window.getComputedStyle(vmSection).visibility);
                        
                        // Force show the section for testing
                        vmSection.style.display = 'block';
                        vmSection.style.visibility = 'visible';
                        console.log('üîß Forced section to be visible');
                    } else {
                        console.error('‚ùå vehicle-manager-section element not found');
                    }
                    
                    setTimeout(() => {
                        console.log('üîÑ Loading Vehicle Manager data...');
                        if (typeof loadVehicleManagerData === 'function') {
                            console.log('üìã Calling loadVehicleManagerData...');
                            loadVehicleManagerData();
                            
                            // Force render table again after a longer delay to ensure DOM is ready
                            setTimeout(() => {
                                console.log('üîÑ Force rendering Vehicle Manager table...');
                                if (typeof renderVehicleManagerTable === 'function') {
                                    renderVehicleManagerTable();
                                }
                            }, 500);
                        } else {
                            console.error('‚ùå loadVehicleManagerData function not found');
                        }
                    }, 200);
                }
            } else {
                console.error('‚ùå Section not found:', sectionName + '-section');
            }
        };
        
        
        function loadDriversList() {
            drivers = JSON.parse(localStorage.getItem('taxiDrivers') || '[]');
            
            const tbody = document.getElementById('driversTableBody');
            if (!tbody) {
                setTimeout(loadDriversList, 100); // Retry if element not ready
                return;
            }
            
            tbody.innerHTML = '';
            
            if (drivers.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="8" style="padding: 40px; text-align: center; color: #6c757d;">
                            <div style="font-size: 48px; margin-bottom: 10px;">üöñ</div>
                            <div style="font-size: 18px;">Nog geen chauffeurs toegevoegd</div>
                            <div style="font-size: 14px; margin-top: 5px;">Klik op "Nieuwe Chauffeur Toevoegen" om te beginnen</div>
                        </td>
                    </tr>
                `;
                updateDriverStats();
                return;
            }
            
            drivers.forEach(driver => {
                const row = document.createElement('tr');
                
                const statusColor = driver.status === 'online' ? '#28a745' : '#6c757d';
                const statusText = driver.status === 'online' ? 'Online' : 'Offline';
                const verifiedText = driver.verified ? '‚úÖ Geverifieerd' : '‚è≥ Verificatie nodig';
                const verifiedColor = driver.verified ? '#28a745' : '#dc3545';
                
                row.innerHTML = `
                    <td class="col-status">
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <div style="width: 10px; height: 10px; border-radius: 50%; background: ${statusColor}"></div>
                            <span>${statusText}</span>
                        </div>
                    </td>
                    <td class="col-name" style="font-weight: 500;">${driver.name}</td>
                    <td class="col-phone">${driver.phone}</td>
                    <td class="col-email">${driver.email}</td>
                    <td class="col-vehicle">${driver.vehicle}</td>
                    <td class="col-documents">
                        <span style="color: ${verifiedColor};">${verifiedText}</span>
                    </td>
                    <td class="col-rating">
                        <div style="display: flex; align-items: center; gap: 5px;">
                            <span style="color: #ffc107;">‚≠ê</span>
                            <span>${driver.rating}</span>
                        </div>
                    </td>
                    <td class="col-actions">
                        <button onclick="editDriver('${driver.id}')" style="background: #007bff; color: white;">
                            ‚úèÔ∏è Bewerk
                        </button>
                        <button onclick="deleteDriver('${driver.id}')" style="background: #dc3545; color: white;">
                            üóëÔ∏è Verwijder
                        </button>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
            
            updateDriverStats();
        }
        
        function editDriver(id) {
            drivers = JSON.parse(localStorage.getItem('taxiDrivers') || '[]');
            const driver = drivers.find(d => d.id === id);
            if (!driver) {
                alert('Chauffeur niet gevonden');
                return;
            }
            
            const newName = prompt('Nieuwe naam:', driver.name);
            if (newName) {
                driver.name = newName;
                localStorage.setItem('taxiDrivers', JSON.stringify(drivers));
                alert('Chauffeur bijgewerkt!');
                loadDriversList();
            }
        }
        
        function deleteDriver(id) {
            drivers = JSON.parse(localStorage.getItem('taxiDrivers') || '[]');
            const driver = drivers.find(d => d.id === id);
            if (!driver) {
                alert('Chauffeur niet gevonden');
                return;
            }
            
            if (confirm(`Weet je zeker dat je ${driver.name} wilt verwijderen?`)) {
                drivers = drivers.filter(d => d.id !== id);
                localStorage.setItem('taxiDrivers', JSON.stringify(drivers));
                alert('Chauffeur verwijderd!');
                loadDriversList();
            }
        }
        
        function searchDrivers(query) {
            drivers = JSON.parse(localStorage.getItem('taxiDrivers') || '[]');
            
            if (!query) {
                loadDriversList();
                return;
            }
            
            const filteredDrivers = drivers.filter(driver => 
                driver.name.toLowerCase().includes(query.toLowerCase()) ||
                driver.email.toLowerCase().includes(query.toLowerCase()) ||
                driver.phone.includes(query)
            );
            
            const tbody = document.getElementById('driversTableBody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            if (filteredDrivers.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="8" style="padding: 40px; text-align: center; color: #6c757d;">
                            Geen chauffeurs gevonden voor "${query}"
                        </td>
                    </tr>
                `;
                return;
            }
            
            filteredDrivers.forEach(driver => {
                const row = document.createElement('tr');
                row.style.borderBottom = '1px solid #dee2e6';
                
                const statusColor = driver.status === 'online' ? '#28a745' : '#6c757d';
                const statusText = driver.status === 'online' ? 'Online' : 'Offline';
                const verifiedText = driver.verified ? '‚úÖ Geverifieerd' : '‚è≥ Verificatie nodig';
                const verifiedColor = driver.verified ? '#28a745' : '#dc3545';
                
                row.innerHTML = `
                    <td class="section-padding">
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <div style="width: 10px; height: 10px; border-radius: 50%; background: ${statusColor}"></div>
                            <span>${statusText}</span>
                        </div>
                    </td>
                    <td style="padding: 15px; font-weight: 500;">${driver.name}</td>
                    <td class="section-padding">${driver.phone}</td>
                    <td class="section-padding">${driver.email}</td>
                    <td class="section-padding">${driver.vehicle}</td>
                    <td class="section-padding">
                        <span style="color: ${verifiedColor};">${verifiedText}</span>
                    </td>
                    <td class="section-padding">
                        <div style="display: flex; align-items: center; gap: 5px;">
                            <span style="color: #ffc107;">‚≠ê</span>
                            <span>${driver.rating}</span>
                        </div>
                    </td>
                    <td style="padding: 15px; text-align: center;">
                        <button onclick="editDriver('${driver.id}')" style="background: #007bff; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; margin-right: 5px;">
                            ‚úèÔ∏è Bewerk
                        </button>
                        <button onclick="deleteDriver('${driver.id}')" style="background: #dc3545; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer;">
                            üóëÔ∏è Verwijder
                        </button>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
        }
        
        function updateDriverStats() {
            drivers = JSON.parse(localStorage.getItem('taxiDrivers') || '[]');
            const totalCount = drivers.length;
            const onlineCount = drivers.filter(d => d.status === 'online').length;
            const busyCount = drivers.filter(d => d.status === 'busy').length;
            const pendingCount = drivers.filter(d => !d.verified).length;
            
            const totalEl = document.getElementById('totalDriversCount');
            const onlineEl = document.getElementById('onlineDriversCount');
            const busyEl = document.getElementById('busyDriversCount');
            const pendingEl = document.getElementById('pendingDocsCount');
            
            if (totalEl) totalEl.textContent = totalCount;
            if (onlineEl) onlineEl.textContent = onlineCount;
            if (busyEl) busyEl.textContent = busyCount;
            if (pendingEl) pendingEl.textContent = pendingCount;
        }
        
    </script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f7fa;
            color: #333;
        }

        .admin-layout {
            display: grid;
            grid-template-columns: 280px 1fr;
            grid-template-rows: auto 1fr;
            min-height: 100vh;
        }

        .sidebar {
            grid-row: 1 / -1;
            background: #2c3e50;
            color: white;
            padding: 0;
        }

        .sidebar-header {
            padding: 20px;
            background: #34495e;
            border-bottom: 1px solid #2c3e50;
        }

        .nav-menu {
            list-style: none;
            padding: 0;
        }

        .nav-item {
            border-bottom: 1px solid #34495e;
        }

        .nav-link {
            display: block;
            padding: 15px 20px;
            color: #bdc3c7;
            text-decoration: none;
            cursor: pointer;
            transition: all 0.3s;
        }

        .nav-link:hover {
            background: #34495e;
            color: white;
        }

        .nav-submenu {
            background: #1a252f;
            display: none;
        }

        .nav-submenu.show {
            display: block;
        }

        .nav-submenu .nav-link {
            padding: 12px 20px 12px 52px;
            font-size: 14px;
        }

        .main-content {
            flex: 1;
            background: #f5f7fa;
            display: flex;
            flex-direction: column;
        }

        .header {
            background: white;
            padding: 15px 30px;
            border-bottom: 1px solid #e1e8ed;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            width: 100%;
            display: block;
        }

        .content-area {
            padding: 30px;
            grid-column: 2;
            grid-row: 2;
            background: #f5f7fa;
        }

        .content-section {
            display: none;
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .content-section.active {
            display: block;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
        }

        .btn-primary {
            background: #3498db;
            color: white;
        }

        .btn-success {
            background: #27ae60;
            color: white;
        }

        .test-area {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border: 2px dashed #dee2e6;
        }

        /* Booking Edit Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: none;
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal-overlay.show {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 12px;
            max-width: 800px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .modal-header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 20px;
            border-radius: 12px 12px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h2 {
            margin: 0;
            font-size: 22px;
        }

        .modal-close {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            padding: 5px;
        }

        .modal-body {
            padding: 30px;
        }

        .edit-section {
            margin-bottom: 30px;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 20px;
        }

        .edit-section h3 {
            margin: 0 0 15px 0;
            color: #2c3e50;
            border-bottom: 2px solid #f8f9fa;
            padding-bottom: 10px;
        }

        .edit-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }

        .edit-field {
            display: flex;
            flex-direction: column;
        }

        .edit-field label {
            font-weight: 600;
            color: #495057;
            margin-bottom: 5px;
            font-size: 14px;
        }

        .edit-field input,
        .edit-field select,
        .edit-field textarea {
            padding: 10px;
            border: 2px solid #e9ecef;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .edit-field input:focus,
        .edit-field select:focus,
        .edit-field textarea:focus {
            outline: none;
            border-color: #007bff;
        }

        .modal-actions {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 0 0 12px 12px;
            display: flex;
            gap: 15px;
            justify-content: flex-end;
        }

        .modal-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .modal-btn-primary {
            background: #007bff;
            color: white;
        }

        .modal-btn-primary:hover {
            background: #0056b3;
        }

        .modal-btn-success {
            background: #28a745;
            color: white;
        }

        .modal-btn-success:hover {
            background: #1e7e34;
        }

        .modal-btn-danger {
            background: #dc3545;
            color: white;
        }

        /* üÜï BOOKING OVERVIEW STYLES */
        .overview-section {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border-left: 4px solid #007bff;
        }

        .overview-section-title {
            font-size: 18px;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 2px solid #f8f9fa;
        }

        .overview-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #f8f9fa;
        }

        .overview-row:last-child {
            border-bottom: none;
        }

        .overview-label {
            font-weight: 500;
            color: #495057;
            font-size: 14px;
        }

        .overview-value {
            font-weight: 600;
            color: #2c3e50;
            font-size: 14px;
            text-align: right;
        }

        .overview-total {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            border: 2px solid #dee2e6;
        }

        .overview-total-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            font-size: 16px;
        }

        .overview-total-row:last-child {
            font-weight: 700;
            font-size: 20px;
            color: #2c3e50;
            border-top: 2px solid #dee2e6;
            padding-top: 15px;
            margin-top: 10px;
        }

        .modal-btn-danger:hover {
            background: #c82333;
        }

        .modal-btn-secondary {
            background: #6c757d;
            color: white;
        }

        .modal-btn-secondary:hover {
            background: #545b62;
        }

        /* Status Dropdown */
        .status-dropdown {
            position: relative;
            display: inline-block;
        }

        .status-badge {
            background: #ffc107;
            color: #856404;
            padding: 4px 12px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            border: none;
            display: flex;
            align-items: center;
            gap: 4px;
            transition: all 0.3s ease;
        }

        .status-badge:hover {
            background: #e0a800;
            transform: translateY(-1px);
        }

        .status-badge.confirmed {
            background: #28a745;
            color: white;
        }

        .status-badge.confirmed:hover {
            background: #1e7e34;
        }

        .status-badge.cancelled {
            background: #dc3545;
            color: white;
        }

        .status-badge.cancelled:hover {
            background: #c82333;
        }

        .status-dropdown-menu {
            position: fixed;
            min-width: 180px;
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.15);
            z-index: 99999;
            display: none;
            max-height: 300px;
            overflow-y: auto;
        }

        .status-dropdown-menu.show {
            display: block;
        }

        .status-option {
            padding: 8px 12px;
            cursor: pointer;
            font-size: 14px;
            border: none;
            background: none;
            width: 100%;
            text-align: left;
            transition: background-color 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .status-option:hover {
            background: #f8f9fa;
        }

        .status-option:first-child {
            border-radius: 6px 6px 0 0;
        }

        .status-option:last-child {
            border-radius: 0 0 6px 6px;
        }

        .status-option.current {
            background: #e3f2fd;
            color: #1976d2;
            font-weight: 600;
        }

        .status-option .status-icon {
            width: 16px;
            text-align: center;
        }

        /* Driver Dropdown */
        .driver-dropdown {
            position: relative;
            display: inline-block;
        }

        .driver-badge {
            padding: 4px 12px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            border: none;
            transition: all 0.2s ease;
        }

        .driver-badge.unassigned {
            background: #6c757d;
            color: white;
        }

        .driver-badge.unassigned:hover {
            background: #545b62;
        }

        .driver-badge.assigned {
            background: #28a745;
            color: white;
        }

        .driver-badge.assigned:hover {
            background: #218838;
        }

        .driver-dropdown-menu {
            position: fixed;
            min-width: 200px;
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.15);
            z-index: 99999;
            display: none;
            max-height: 300px;
            overflow-y: auto;
        }

        .driver-dropdown-menu.show {
            display: block;
        }

        .driver-option {
            padding: 8px 12px;
            cursor: pointer;
            font-size: 14px;
            border: none;
            background: none;
            width: 100%;
            text-align: left;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .driver-option:hover {
            background: #f8f9fa;
            color: #495057;
        }

        .driver-option.selected {
            background: #28a745;
            color: white;
        }

        .driver-option.unassign {
            border-top: 1px solid #dee2e6;
            color: #dc3545;
        }

        .driver-option.unassign:hover {
            background: #f8d7da;
            color: #721c24;
        }

        /* REUSABLE CLASSES TO REPLACE INLINE STYLES */
        .table-cell { 
            padding: 6px; 
            border-bottom: 1px solid #dee2e6;
            vertical-align: middle;
            font-size: 12px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        .table-header { 
            padding: 12px; 
            text-align: left; 
            font-weight: 600;
            background: #f8f9fa;
            border-bottom: 2px solid #dee2e6;
            color: #495057;
        }
        
        /* IMPROVED TABLE STYLING WITH PROPER COLUMN WIDTHS */
        .drivers-table {
            width: 100%;
            border-collapse: collapse;
            table-layout: fixed; /* Ensures consistent column widths */
        }
        
        .drivers-table th,
        .drivers-table td {
            padding: 15px 12px;
            text-align: left;
            border-bottom: 1px solid #dee2e6;
            vertical-align: middle;
            word-wrap: break-word;
            overflow: hidden;
        }
        
        .drivers-table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #495057;
            border-bottom: 2px solid #dee2e6;
            white-space: nowrap;
        }
        
        /* DRIVERS TABLE SPECIFIC COLUMN WIDTHS */
        .drivers-table .col-status { width: 8%; min-width: 80px; }
        .drivers-table .col-name { width: 18%; min-width: 150px; }
        .drivers-table .col-phone { width: 12%; min-width: 120px; }
        .drivers-table .col-email { width: 20%; min-width: 180px; }
        .drivers-table .col-vehicle { width: 15%; min-width: 120px; }
        .drivers-table .col-documents { width: 12%; min-width: 120px; }
        .drivers-table .col-rating { width: 8%; min-width: 80px; }
        .drivers-table .col-actions { width: 15%; min-width: 140px; text-align: center; }
        
        /* RESPONSIVE TABLE BEHAVIOR */
        @media (max-width: 1200px) {
            .drivers-table .col-email { display: none; }
            .drivers-table .col-vehicle { width: 20%; }
            .drivers-table .col-name { width: 25%; }
        }
        
        @media (max-width: 768px) {
            .drivers-table .col-documents,
            .drivers-table .col-rating { display: none; }
            .drivers-table .col-name { width: 35%; }
            .drivers-table .col-phone { width: 20%; }
            .drivers-table .col-actions { width: 25%; }
        }
        
        /* TABLE ACTION BUTTONS STYLING */
        .drivers-table .col-actions button {
            padding: 6px 12px;
            margin: 2px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 500;
            transition: background-color 0.3s ease;
            display: inline-block;
        }
        
        .drivers-table .col-actions button:hover {
            opacity: 0.8;
            transform: translateY(-1px);
        }
        
        /* GENERAL TABLE IMPROVEMENTS */
        table {
            border-spacing: 0;
        }
        
        table tr:hover {
            background-color: #f8f9fa;
        }
        
        table tr:nth-child(even) {
            background-color: #fafbfc;
        }
        
        table tr:nth-child(even):hover {
            background-color: #f1f3f4;
        }
        .input-field { width: 100%; padding: 10px; border: 2px solid #e1e5e9; border-radius: 6px; }
        .form-label { display: block; font-weight: 600; margin-bottom: 5px; }
        .form-label-alt { display: block; font-weight: 500; margin-bottom: 8px; }
        .section-margin { margin-bottom: 15px; }
        .section-margin-lg { margin-bottom: 20px; }
        .section-padding { padding: 15px; }
        .input-field-alt { width: 100%; padding: 8px; border: 1px solid #dee2e6; border-radius: 4px; }
        .text-color { color: #2c3e50; margin-bottom: 15px; }
        .input-large { width: 100%; padding: 10px; border: 1px solid #dee2e6; border-radius: 6px; font-size: 14px; }
        .form-label-gray { display: block; margin-bottom: 5px; font-weight: 500; color: #495057; }
        .small-text { font-size: 12px; color: #666; }
        .help-text { display: block; margin-bottom: 5px; color: #666; font-size: 13px; }
        .card { background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #dee2e6; }
        .empty-state { text-align: center; padding: 40px; color: #6c757d; }
        .margin-left { margin-left: 5px; }
        .field-label { font-weight: 600; color: #495057; font-size: 14px; }
        .flex-center { display: flex; align-items: center; gap: 10px; }
        .font-medium { font-weight: 500; }
        .form-label-dark { display: block; margin-bottom: 5px; font-weight: 600; color: #2c3e50; }
        .input-xlarge { width: 100%; padding: 12px; border: 2px solid #e1e5e9; border-radius: 6px; }
        .table-cell-alt { padding: 15px; text-align: left; border-bottom: 1px solid #dee2e6; }
        .btn-outline { background: white; border: 1px solid #dee2e6; padding: 8px 16px; border-radius: 6px; cursor: pointer; }
        .field-value { margin-top: 4px; font-size: 16px; color: #2c3e50; }
        .white-card-12 { background: white; border-radius: 12px; }
        .padding-15 { padding: 15px; }
        .margin-bottom-20 { margin-bottom: 20px; }
        
        /* LAYOUT FIXES */
        .page-header {
            background: white;
            padding: 15px 30px;
            border-bottom: 1px solid #e1e8ed;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            width: 100%;
            display: block;
            grid-column: 2;
            grid-row: 1;
        }
        
        .page-header h1 {
            margin: 0 0 10px 0;
            font-size: 28px;
            font-weight: 600;
            color: #2c3e50;
        }
        
        .page-header p {
            margin: 0;
            color: #6c757d;
            font-size: 16px;
        }
        .section-header { margin-bottom: 20px; }
        .section-toolbar { background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 20px 0; display: flex; gap: 15px; align-items: center; flex-wrap: wrap; }
        .btn-group { display: flex; gap: 10px; align-items: center; }
        .ml-auto { margin-left: auto; }
        .text-nowrap { white-space: nowrap; }
        .page-title { font-size: 24px; font-weight: 600; color: #2c3e50; margin: 0 0 5px 0; }
        .page-subtitle { color: #6c757d; font-size: 16px; margin: 0 0 20px 0; }
    </style>
</head>
<body>
    <div class="admin-layout">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                <h2> Marcel's Taxi Pro</h2>
                <p>Professional Admin Panel</p>
            </div>

            <ul class="nav-menu">
                <li class="nav-item">
                    <a class="nav-link" onclick="showSection('dispatch')">
                        üö® Dispatch
                    </a>
                </li>
                
                <li class="nav-item">
                    <a class="nav-link" onclick="toggleMenu('bookings')">
                        üìã Bookings
                    </a>
                    <ul class="nav-submenu" id="bookings-menu">
                        <li><a class="nav-link" onclick="showSection('next-24h')">Next 24h</a></li>
                        <li><a class="nav-link" onclick="showSection('latest')">Latest</a></li>
                        <li><a class="nav-link" onclick="showSection('unconfirmed')">Unconfirmed</a></li>
                        <li><a class="nav-link" onclick="showSection('completed')">Completed</a></li>
                        <li><a class="nav-link" onclick="showSection('cancelled')">Cancelled</a></li>
                        <li><a class="nav-link" onclick="showSection('all-bookings')">All</a></li>
                        <li><a class="nav-link" onclick="showSection('trash')">Trash</a></li>
                        <li><a class="nav-link" onclick="showSection('calendar')">Calendar</a></li>
                        <li><a class="nav-link" onclick="showSection('add-new')">Add New</a></li>
                    </ul>
                </li>
                
                <li class="nav-item">
                    <a class="nav-link" onclick="toggleMenu('reports')">
                        üìà Reports
                    </a>
                    <ul class="nav-submenu" id="reports-menu">
                        <li><a class="nav-link" onclick="showSection('driver-report')">Driver Report</a></li>
                        <li><a class="nav-link" onclick="showSection('payment-report')">Payment Report</a></li>
                    </ul>
                </li>

                <li class="nav-item">
                    <a class="nav-link" onclick="showSection('users')">
                        üë• Users
                    </a>
                </li>

                <li class="nav-item">
                    <a class="nav-link" onclick="showSection('drivers')">
                        üöñ Drivers
                    </a>
                </li>

                <li class="nav-item">
                    <a class="nav-link" onclick="openVehicleManagerFixed()">
                        üöó Vehicle Manager
                    </a>
                </li>

                <li class="nav-item">
                    <a class="nav-link" onclick="showSection('feedback')">
                        üí¨ Feedback
                    </a>
                </li>
                
                <li class="nav-item">
                    <a class="nav-link" onclick="toggleMenu('settings')">
                        ‚öôÔ∏è Settings
                    </a>
                    <ul class="nav-submenu" id="settings-menu">
                        <li><a class="nav-link" onclick="showSection('general')">‚öôÔ∏è General Settings</a></li>
                        <!-- DUPLICATE SECTION - DISABLED: same as Vehicle Manager
                        <li><a class="nav-link" onclick="showSection('types-of-vehicles')"> Types of Vehicles</a></li>
                        -->
                        <li><a class="nav-link" onclick="showSection('payment-methods')">üí≥ Payment Methods</a></li>
                        <li><a class="nav-link" onclick="showSection('notifications')">üîî Notifications</a></li>
                        <li><a class="nav-link" onclick="showSection('mail')">üìß Email Settings</a></li>
                        <li><a class="nav-link" onclick="showSection('email-templates')">üìù Email Templates</a></li>
                        <li><a class="nav-link" onclick="showSection('translation')">üåê Translation</a></li>
                        <li><a class="nav-link" onclick="showSection('booking-settings')">üìã Booking Settings</a></li>
                        <li><a class="nav-link" onclick="showSection('google')">üåê Google</a></li>
                        <li><a class="nav-link" onclick="showSection('services')">üéØ Services</a></li>
                        <li><a class="nav-link" onclick="showSection('users-settings')">üë• User Management</a></li>
                        <li><a class="nav-link" onclick="showSection('backup-export')">üíæ Backup & Export</a></li>
                    </ul>
                </li>
                
                <li class="nav-item">
                    <a class="nav-link" onclick="toggleMenu('pricing')">
                        üí∞ Pricing
                    </a>
                    <ul class="nav-submenu" id="pricing-menu">
                        <li><a class="nav-link" onclick="showSection('deposit-payments')">Deposit Payments</a></li>
                        <li><a class="nav-link" onclick="showSection('distance-time')">Distance & Time</a></li>
                        <li><a class="nav-link" onclick="showSection('distance-modifier')">Distance Modifier</a></li>
                        <li><a class="nav-link" onclick="showSection('driver-income')">Driver Income</a></li>
                        <li><a class="nav-link" onclick="showSection('fixed-prices')">Fixed Prices</a></li>
                        <li><a class="nav-link" onclick="showSection('holiday-surcharge')">Holiday Surcharge</a></li>
                        <li><a class="nav-link" onclick="showSection('item-surcharge')">Item Surcharge</a></li>
                        <li><a class="nav-link" onclick="showSection('location-surcharge')">Location Surcharge</a></li>
                        <li><a class="nav-link" onclick="showSection('meet-and-greet')">Meet and Greet</a></li>
                        <li><a class="nav-link" onclick="showSection('night-surcharge')">Night Surcharge</a></li>
                        <li><a class="nav-link" onclick="showSection('other-discounts')">Other Discounts</a></li>
                        <li><a class="nav-link" onclick="showSection('tax')">Tax</a></li>
                        <li><a class="nav-link" onclick="showSection('voucher-discounts')">Voucher Discounts</a></li>
                    </ul>
                </li>


                <li class="nav-item">
                    <a class="nav-link" onclick="showSection('knowledge-base')">
                        üìö Knowledge Base
                    </a>
                </li>

                <li class="nav-item">
                    <a class="nav-link" onclick="showSection('updates')">
                        üîÑ Updates
                    </a>
                </li>

                <li class="nav-item">
                    <a class="nav-link" onclick="showSection('profile')">
                        üë§ Profile
                    </a>
                </li>

                <li class="nav-item">
                    <a class="nav-link" onclick="logout()">
                        üö™ Sign Out
                    </a>
                </li>
            </ul>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <div class="page-header">
                <h1 id="pageTitle">Dispatch</h1>
                <p id="pageSubtitle">Manual taxi booking and dispatch system</p>
            </div>

            <div class="content-area">


                <!-- Dispatch Section -->
                <div id="dispatch-section" class="content-section active">
                    <!-- Main Dispatch Layout -->
                    <div style="display: grid; grid-template-columns: 500px 1fr; gap: 20px; height: calc(100vh - 100px);">
                        
                        <!-- Left Panel - Professional Booking Form -->
                        <div class="white-card-12" style="box-shadow: 0 4px 20px rgba(0,0,0,0.1); padding: 25px; overflow-y: auto; height: fit-content; max-height: calc(100vh - 120px); background: #fafafa;">
                            
                            <!-- LOCATIONS Section -->
                            <div style="margin-bottom: 25px;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                                    <h3 style="font-size: 16px; font-weight: 600; color: #4A90E2; margin: 0;">LOCATIONS</h3>
                                    <div style="display: flex; align-items: center; gap: 10px;">
                                        <button id="dispatchRetourBtn" onclick="toggleDispatchReturn()" style="background: #f0f0f0; border: 1px solid #ddd; padding: 6px 12px; border-radius: 6px; font-size: 12px; color: #666; cursor: pointer;">Return Journey?</button>
                                        <button style="background: none; border: none; font-size: 18px; cursor: pointer;">‚öôÔ∏è</button>
                                    </div>
                                </div>
                                
                                <!-- Location Inputs Container -->
                                <div style="position: relative;">
                                    <!-- From Location -->
                                    <div style="position: relative; margin-bottom: 10px;">
                                        <input type="text" id="dispatchFromLocation" placeholder="Address or Postcode" 
                                               style="width: 75%; padding: 12px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px; background: white;">
                                    </div>
                                    
                                    <!-- To Location -->
                                    <div style="position: relative; margin-bottom: 15px;">
                                        <input type="text" id="dispatchToLocation" placeholder="Address or Postcode" 
                                               style="width: 75%; padding: 12px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px; background: white;">
                                    </div>
                                    
                                    <!-- Right side controls - away from border -->
                                    <div style="position: absolute; right: -10px; top: 50%; transform: translateY(-50%); display: flex; flex-direction: column; align-items: center; gap: 3px;">
                                        <button onclick="addDispatchStop()" style="background: none; border: none; color: #666; font-size: 18px; cursor: pointer; padding: 2px; line-height: 1; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center;">+</button>
                                        <button onclick="swapLocations()" style="background: none; border: none; color: #666; font-size: 14px; cursor: pointer; padding: 2px; line-height: 1; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center;">‚áÖ</button>
                                    </div>
                                </div>
                                
                                <!-- Date/Time and Vehicle Type -->
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px; position: relative;">
                                    <div style="position: relative;">
                                        <input type="text" id="dispatchDate" placeholder="Select Date" readonly
                                               style="width: 90%; padding: 12px; border: 1px solid #ddd; border-radius: 6px; background: white; cursor: pointer; color: #333;"
                                               onclick="toggleDispatchCalendar()">
                                    </div>
                                    <div style="position: relative;">
                                        <select id="dispatchVehicleSelect" style="width: 80%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; background: white; color: #666; cursor: pointer;">
                                            <option> Unassigned</option>
                                        </select>
                                    </div>
                                    
                                    <!-- Flight Icon - Clickable -->
                                    <div style="position: absolute; right: -15px; top: 50%; transform: translateY(-50%);">
                                        <button onclick="toggleDispatchFlight()" style="background: none; border: none; color: #666; font-size: 20px; cursor: pointer; padding: 4px;" title="Add Flight Information">‚úàÔ∏è</button>
                                    </div>
                                </div>
                                
                                <!-- Flight Information Section (Hidden by default) -->
                                <div id="dispatchFlightSection" style="display: none; margin-top: 10px; padding: 15px; background: #f8f9fa; border-radius: 6px; border: 1px solid #ddd;">
                                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px;">
                                        <input type="text" id="dispatchFlightNumber" placeholder="Flight Number" 
                                               style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px;">
                                        <select id="dispatchFlightType" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px;">
                                            <option value="arrival">Arrival</option>
                                            <option value="departure">Departure</option>
                                        </select>
                                    </div>
                                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                                        <input type="text" id="dispatchFlightTime" placeholder="Flight Time" 
                                               style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px;">
                                        <input type="text" id="dispatchAirport" placeholder="Airport" 
                                               style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px;">
                                    </div>
                                </div>
                                
                                <!-- Return Date Section (Hidden by default) -->
                                <div id="dispatchReturnSection" style="display: none; margin-top: 10px;">
                                    <input type="text" id="dispatchReturnDate" placeholder="Return Date" readonly
                                           style="width: 90%; padding: 12px; border: 1px solid #ddd; border-radius: 6px; background: white; cursor: pointer; color: #333;"
                                           onclick="toggleDispatchReturnCalendar()">
                                </div>
                            </div>
                            
                            <!-- PASSENGERS Section -->
                            <div style="margin-bottom: 25px;">
                                <h3 style="font-size: 16px; font-weight: 600; color: #4A90E2; margin-bottom: 15px;">PASSENGERS</h3>
                                
                                <!-- Account and Passenger Search -->
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px;">
                                    <select style="width: 90%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; background: white; color: #666;">
                                        <option>Account</option>
                                        <option>New Customer</option>
                                        <option>Existing Customer</option>
                                    </select>
                                    <div style="position: relative;">
                                        <input type="text" placeholder="Passenger" style="width: 90%; padding: 10px 35px 10px 10px; border: 1px solid #ddd; border-radius: 6px; background: white;">
                                        <button style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); background: none; border: none; color: #666; cursor: pointer;">üîç</button>
                                    </div>
                                </div>
                                
                                <!-- Passenger Counters -->
                                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-bottom: 15px;">
                                    <!-- Adults -->
                                    <div style="border: 1px solid #ddd; border-radius: 6px; padding: 10px; background: white; text-align: center;">
                                        <div style="color: #666; font-size: 12px; margin-bottom: 5px;">üë§</div>
                                        <select id="dispatchPassengers" style="border: none; background: none; font-size: 14px; width: 100%; text-align: center; color: #333;">
                                            <option value="0">0</option>
                                            <option value="1" selected>1</option>
                                            <option value="2">2</option>
                                            <option value="3">3</option>
                                            <option value="4">4</option>
                                            <option value="5">5</option>
                                            <option value="6">6</option>
                                            <option value="7">7</option>
                                            <option value="8">8</option>
                                            <option value="9">9</option>
                                            <option value="10">10</option>
                                            <option value="11">11</option>
                                            <option value="12">12</option>
                                            <option value="13">13</option>
                                            <option value="14">14</option>
                                            <option value="15">15</option>
                                            <option value="16">16</option>
                                            <option value="17">17</option>
                                            <option value="18">18</option>
                                            <option value="19">19</option>
                                            <option value="20">20</option>
                                            <option value="21">21</option>
                                            <option value="22">22</option>
                                            <option value="23">23</option>
                                            <option value="24">24</option>
                                        </select>
                                    </div>
                                    
                                    <!-- Luggage -->
                                    <div style="border: 1px solid #ddd; border-radius: 6px; padding: 10px; background: white; text-align: center;">
                                        <div style="color: #666; font-size: 12px; margin-bottom: 5px;">üíº</div>
                                        <select id="dispatchLuggage" style="border: none; background: none; font-size: 14px; width: 100%; text-align: center; color: #333;">
                                            <option value="0" selected>0</option>
                                            <option value="1">1</option>
                                            <option value="2">2</option>
                                            <option value="3">3</option>
                                            <option value="4">4</option>
                                            <option value="5">5</option>
                                            <option value="6">6</option>
                                            <option value="7">7</option>
                                            <option value="8">8</option>
                                            <option value="9">9</option>
                                            <option value="10">10</option>
                                            <option value="11">11</option>
                                            <option value="12">12</option>
                                            <option value="13">13</option>
                                            <option value="14">14</option>
                                            <option value="15">15</option>
                                            <option value="16">16</option>
                                            <option value="17">17</option>
                                            <option value="18">18</option>
                                            <option value="19">19</option>
                                            <option value="20">20</option>
                                            <option value="21">21</option>
                                            <option value="22">22</option>
                                            <option value="23">23</option>
                                            <option value="24">24</option>
                                        </select>
                                    </div>
                                    
                                    <!-- Hand Luggage -->
                                    <div style="border: 1px solid #ddd; border-radius: 6px; padding: 10px; background: white; text-align: center;">
                                        <div style="color: #666; font-size: 12px; margin-bottom: 5px;">üëú</div>
                                        <select id="dispatchHandLuggage" style="border: none; background: none; font-size: 14px; width: 100%; text-align: center; color: #333;">
                                            <option value="0" selected>0</option>
                                            <option value="1">1</option>
                                            <option value="2">2</option>
                                            <option value="3">3</option>
                                            <option value="4">4</option>
                                            <option value="5">5</option>
                                            <option value="6">6</option>
                                            <option value="7">7</option>
                                            <option value="8">8</option>
                                            <option value="9">9</option>
                                            <option value="10">10</option>
                                            <option value="11">11</option>
                                            <option value="12">12</option>
                                            <option value="13">13</option>
                                            <option value="14">14</option>
                                            <option value="15">15</option>
                                            <option value="16">16</option>
                                            <option value="17">17</option>
                                            <option value="18">18</option>
                                            <option value="19">19</option>
                                            <option value="20">20</option>
                                            <option value="21">21</option>
                                            <option value="22">22</option>
                                            <option value="23">23</option>
                                            <option value="24">24</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <!-- Add Item Button -->
                                <button onclick="addDispatchItem()" style="background: none; border: none; color: #4A90E2; font-size: 14px; cursor: pointer; padding: 5px 0;">
                                    Add item <span style="color: #4A90E2; font-weight: bold;">+</span>
                                </button>
                            </div>
                            
                            <!-- PAYMENT & DRIVER Section -->
                            <div style="margin-bottom: 25px;">
                                <h3 style="font-size: 16px; font-weight: 600; color: #4A90E2; margin-bottom: 15px;">PAYMENT & DRIVER</h3>
                                
                                <!-- Payment and Price Row -->
                                <div style="display: grid; grid-template-columns: 1fr auto 1fr 80px; gap: 10px; margin-bottom: 15px; align-items: center;">
                                    <select style="width: 90%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; background: white; color: #666;">
                                        <option>Unassigned</option>
                                        <option>Cash</option>
                                        <option>Card</option>
                                        <option>Account</option>
                                    </select>
                                    
                                    <label style="display: flex; align-items: center; gap: 5px; font-size: 12px; color: #666;">
                                        <input type="checkbox" id="paidCheckbox"> Paid
                                    </label>
                                    
                                    <input type="number" placeholder="0.00" step="0.01" style="width: 90%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; background: white; text-align: right;">
                                    
                                    <select style="width: 90%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; background: white; color: #666; font-size: 12px;">
                                        <option>No tax</option>
                                        <option>21% BTW</option>
                                        <option>6% BTW</option>
                                    </select>
                                </div>
                                
                                <!-- Driver Assignment and Quote -->
                                <div style="display: grid; grid-template-columns: 1fr 1fr 120px; gap: 10px; margin-bottom: 15px;">
                                    <div style="position: relative;">
                                        <input type="text" placeholder="Assign fleet" style="width: 90%; padding: 10px 35px 10px 10px; border: 1px solid #ddd; border-radius: 6px; background: white;">
                                        <button style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); background: none; border: none; color: #666; cursor: pointer;">üîç</button>
                                    </div>
                                    
                                    <div style="position: relative;">
                                        <input type="text" placeholder="Assign driver" style="width: 90%; padding: 10px 35px 10px 10px; border: 1px solid #ddd; border-radius: 6px; background: white;">
                                        <button style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); background: none; border: none; color: #666; cursor: pointer;">üîç</button>
                                    </div>
                                    
                                    <button onclick="getDispatchQuote()" style="background: #4CAF50; color: white; border: none; padding: 12px 15px; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 13px;">
                                        Get Quote
                                    </button>
                                </div>
                                
                                <!-- Distance/Time Display -->
                                <div style="text-align: center; margin-bottom: 15px;">
                                    <div style="background: #f0f0f0; padding: 10px; border-radius: 6px; color: #666; font-size: 14px;">
                                        Pickup to Dropoff: <strong>0 km, 0.00 minutes</strong>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Notes Section -->
                            <div style="margin-bottom: 25px;">
                                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px;">
                                    <button onclick="openNoteModal('driver')" style="background: white; border: 1px solid #ddd; padding: 10px; border-radius: 6px; text-align: left; color: #666; cursor: pointer; font-size: 12px;">
                                        Note for Driver <span style="color: #4A90E2;">+</span>
                                    </button>
                                    
                                    <button onclick="openNoteModal('admin')" style="background: white; border: 1px solid #ddd; padding: 10px; border-radius: 6px; text-align: left; color: #666; cursor: pointer; font-size: 12px;">
                                        Admin note <span style="color: #4A90E2;">+</span>
                                    </button>
                                    
                                    <button onclick="openNoteModal('customer')" style="background: white; border: 1px solid #ddd; padding: 10px; border-radius: 6px; text-align: left; color: #666; cursor: pointer; font-size: 12px;">
                                        Customer requirements <span style="color: #4A90E2;">+</span>
                                    </button>
                                </div>
                            </div>
                            
                            <!-- ADVANCE Section -->
                            <div style="margin-bottom: 25px;">
                                <button onclick="toggleAdvanced()" style="background: none; border: none; color: #4A90E2; font-size: 14px; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 5px;">
                                    ADVANCE <span id="advanceArrow">‚ñ≤</span>
                                </button>
                                <div id="advanceSection" style="margin-top: 15px; display: none;">
                                    <!-- Advanced options will go here -->
                                    <div style="padding: 15px; background: white; border: 1px solid #ddd; border-radius: 6px;">
                                        <p style="color: #666; margin: 0; font-size: 12px;">Advanced booking options and settings</p>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Total and Save -->
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 30px;">
                                <div style="display: flex; align-items: center; gap: 10px;">
                                    <span style="font-size: 18px; font-weight: 600; color: #333;">Total: ‚Ç¨<span id="totalPrice">0.00</span></span>
                                    <button style="background: none; border: none; color: #666; cursor: pointer;">‚ÑπÔ∏è</button>
                                </div>
                                
                                <div style="position: relative;">
                                    <button onclick="saveDispatchBooking()" style="background: #4CAF50; color: white; border: none; padding: 12px 20px; border-radius: 6px; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 8px;">
                                        Save <span>‚ñº</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Right Panel - Map -->
                        <div class="white-card-12" style="box-shadow: 0 4px 20px rgba(0,0,0,0.1); overflow: hidden; position: relative;">
                            <div id="dispatchMap" style="width: 100%; height: 100%; background: #e9ecef; display: flex; align-items: center; justify-content: center; color: #6c757d; font-size: 18px; font-weight: 500;">
                                üó∫Ô∏è Map Loading...
                            </div>
                            
                            <!-- Map Controls Overlay -->
                            <div style="position: absolute; top: 15px; right: 15px; display: flex; flex-direction: column; gap: 10px; z-index: 1000;">
                                <button onclick="findDriver()" style="background: #ff6b6b; color: white; border: none; padding: 8px 12px; border-radius: 6px; font-size: 12px; font-weight: 600; cursor: pointer; box-shadow: 0 2px 8px rgba(0,0,0,0.2);">
                                    üìç Find driver
                                </button>
                                <button style="background: white; border: 1px solid #ddd; padding: 8px; border-radius: 6px; cursor: pointer; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                                    üîç
                                </button>
                                <button style="background: white; border: 1px solid #ddd; padding: 8px; border-radius: 6px; cursor: pointer; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                                    üìê
                                </button>
                            </div>
                        </div>
                    </div>
                    

                    <!-- Status Display -->
                    <div id="dispatchStatus" style="display: none; padding: 15px; border-radius: 8px; margin-bottom: 20px; font-weight: 500;"></div>

                    <!-- Dispatch Table View -->
                    <div class="white-card-12" style="box-shadow: 0 4px 20px rgba(0,0,0,0.1); padding: 30px; margin-top: 30px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                            <h2 style="font-size: 24px; font-weight: 600; color: #2c3e50; margin: 0;">Active Bookings</h2>
                            <div style="display: flex; gap: 15px; align-items: center;">
                                <!-- Filter Controls -->
                                <select id="dispatchStatusFilter" style="padding: 8px 12px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px;" onchange="filterDispatchBookings()">
                                    <option value="">All Status</option>
                                    <option value="unquoted">Unquoted</option>
                                    <option value="confirmed">Confirmed</option>
                                    <option value="paid">Paid</option>
                                    <option value="completed">Completed</option>
                                </select>
                                <input type="text" id="dispatchSearch" placeholder="Search bookings..." 
                                       style="padding: 8px 12px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px; width: 200px;" 
                                       onkeyup="searchDispatchBookings()">
                                <button onclick="refreshDispatchTable()" style="background: #007bff; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer;">
                                    üîÑ Refresh
                                </button>
                            </div>
                        </div>

                        <!-- Dispatch Table -->
                        <div style="background: white; border: 1px solid #dee2e6; border-radius: 8px; overflow: hidden;">
                            <table id="dispatchTable" style="width: 100%; border-collapse: collapse; font-size: 14px;">
                                <thead style="background: #f8f9fa; border-bottom: 2px solid #dee2e6;">
                                    <tr>
                                        <th style="padding: 12px 8px; text-align: left; font-weight: 600; border-right: 1px solid #dee2e6; width: 80px;">Actions</th>
                                        <th style="padding: 12px 8px; text-align: left; font-weight: 600; border-right: 1px solid #dee2e6; width: 120px;">Date & Time</th>
                                        <th style="padding: 12px 8px; text-align: left; font-weight: 600; border-right: 1px solid #dee2e6; width: 100px;">Ref ID</th>
                                        <th style="padding: 12px 8px; text-align: left; font-weight: 600; border-right: 1px solid #dee2e6; width: 100px;">Status</th>
                                        <th style="padding: 12px 8px; text-align: left; font-weight: 600; border-right: 1px solid #dee2e6; width: 120px;">Driver</th>
                                        <th style="padding: 12px 8px; text-align: left; font-weight: 600; border-right: 1px solid #dee2e6; width: 100px;">Vehicle</th>
                                        <th style="padding: 12px 8px; text-align: left; font-weight: 600; border-right: 1px solid #dee2e6; width: 120px;">Vehicle type</th>
                                        <th style="padding: 12px 8px; text-align: left; font-weight: 600; width: 80px;">Total</th>
                                    </tr>
                                </thead>
                                <tbody id="dispatchTableBody">
                                    <tr>
                                        <td colspan="8" style="text-align: center; padding: 40px; color: #6c757d; font-style: italic;">
                                            No active bookings found
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <!-- Pagination -->
                        <div style="display: flex; justify-content: between; align-items: center; margin-top: 20px; padding: 0 10px;">
                            <div style="color: #6c757d; font-size: 14px;">
                                <span id="dispatchTableInfo">Showing 0 entries</span>
                            </div>
                            <div id="dispatchPagination" style="display: flex; gap: 5px;">
                                <!-- Pagination buttons will be generated here -->
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Dispatch Calendar Elements -->
                <div id="dispatchCalendar" style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; border: 2px solid #ddd; border-radius: 12px; padding: 20px; z-index: 1000; display: none; box-shadow: 0 10px 30px rgba(0,0,0,0.3); min-width: 350px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; border-bottom: 1px solid #eee; padding-bottom: 10px;">
                        <button onclick="previousDispatchMonth()" style="background: none; border: none; font-size: 20px; cursor: pointer; color: #666;">‚Äπ</button>
                        <h3 id="dispatchCalendarTitle" style="margin: 0; color: #333;">Select Date</h3>
                        <button onclick="nextDispatchMonth()" style="background: none; border: none; font-size: 20px; cursor: pointer; color: #666;">‚Ä∫</button>
                        <button onclick="document.getElementById('dispatchCalendar').style.display = 'none'" 
                                style="background: none; border: none; font-size: 20px; cursor: pointer; color: #666;">&times;</button>
                    </div>
                    <div id="dispatchCalendarGrid" style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px;">
                        <!-- Calendar grid will be populated by JavaScript -->
                    </div>
                </div>
                
                <div id="dispatchReturnCalendar" style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; border: 2px solid #ddd; border-radius: 12px; padding: 20px; z-index: 1000; display: none; box-shadow: 0 10px 30px rgba(0,0,0,0.3); min-width: 350px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; border-bottom: 1px solid #eee; padding-bottom: 10px;">
                        <button onclick="previousDispatchReturnMonth()" style="background: none; border: none; font-size: 20px; cursor: pointer; color: #666;">‚Äπ</button>
                        <h3 id="dispatchReturnCalendarTitle" style="margin: 0; color: #333;">Select Return Date</h3>
                        <button onclick="nextDispatchReturnMonth()" style="background: none; border: none; font-size: 20px; cursor: pointer; color: #666;">‚Ä∫</button>
                        <button onclick="document.getElementById('dispatchReturnCalendar').style.display = 'none'" 
                                style="background: none; border: none; font-size: 20px; cursor: pointer; color: #666;">&times;</button>
                    </div>
                    <div id="dispatchReturnCalendarGrid" style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px;">
                        <!-- Return calendar grid will be populated by JavaScript -->
                    </div>
                </div>

                <!-- Settings Section -->
                <div id="general-section" class="content-section">
                    <p>Configure general system settings</p>
                </div>

                <div id="vehicle-manager-section" class="content-section">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
                        <div>
                            <h2>üöó Vehicle Manager</h2>
                            <p>Manage your vehicle fleet and specifications</p>
                        </div>
                        <button class="btn btn-primary" onclick="openVehicleManagerModal()">
                            ‚ûï Add New Vehicle
                        </button>
                    </div>

                    <div id="vehicleManagerSuccessMessage" style="background: #d4edda; color: #155724; padding: 12px; border-radius: 6px; margin-bottom: 20px; display: none;"></div>
                    <div id="vehicleManagerErrorMessage" style="background: #f8d7da; color: #721c24; padding: 12px; border-radius: 6px; margin-bottom: 20px; display: none;"></div>

                    <div class="white-card-12" style="overflow: hidden; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                        <table style="width: 100%; border-collapse: collapse;">
                            <thead style="background: #f8f9fa;">
                                <tr>
                                    <th class="table-cell-alt">Image</th>
                                    <th class="table-cell-alt">Name</th>
                                    <th class="table-cell-alt">Description</th>
                                    <th class="table-cell-alt">Capacity</th>
                                    <th class="table-cell-alt">Hourly Rate</th>
                                    <th class="table-cell-alt">Status</th>
                                    <th class="table-cell-alt">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="vehicleManagerTableBody">
                                <!-- Vehicles will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Vehicle Manager Modal -->
                <div id="vehicleManagerModal" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: none; z-index: 1000; align-items: center; justify-content: center;">
                    <div style="background: white; border-radius: 12px; max-width: 800px; width: 90%; max-height: 90vh; overflow-y: auto;">
                        <div style="background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%); color: white; padding: 20px; border-radius: 12px 12px 0 0; display: flex; justify-content: space-between; align-items: center;">
                            <h3 id="vehicleManagerModalTitle">Add New Vehicle</h3>
                            <button style="background: none; border: none; color: white; font-size: 24px; cursor: pointer;" onclick="closeVehicleManagerModal()">&times;</button>
                        </div>
                        <div style="padding: 30px;">
                            <form id="vehicleManagerForm">
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                                    <div>
                                        <label class="form-label-dark">Name *</label>
                                        <input type="text" id="vehicleManagerName" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px;" placeholder="Premium Class" required>
                                    </div>
                                    <div>
                                        <label class="form-label-dark">Driver</label>
                                        <select id="vehicleManagerDriver" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px;">
                                            <option value="All">All Drivers</option>
                                            <option value="John Smith">John Smith</option>
                                            <option value="Mike Johnson">Mike Johnson</option>
                                            <option value="Sarah Wilson">Sarah Wilson</option>
                                        </select>
                                    </div>
                                </div>

                                <div class="section-margin-lg">
                                    <label class="form-label-dark">Description</label>
                                    <textarea id="vehicleManagerDescription" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px;" rows="3" placeholder="Professional taxi service with premium comfort"></textarea>
                                </div>

                                <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-bottom: 20px;">
                                    <div>
                                        <label class="form-label-dark">Passengers</label>
                                        <div class="flex-center">
                                            <button type="button" style="width: 30px; height: 30px; border: 1px solid #ddd; background: white; border-radius: 4px; cursor: pointer;" onclick="adjustVehicleManagerValue('passengers', -1)">-</button>
                                            <input type="number" id="vehicleManagerPassengers" style="width: 60px; padding: 8px; border: 1px solid #ddd; border-radius: 6px; text-align: center;" value="4" min="1" max="20">
                                            <button type="button" style="width: 30px; height: 30px; border: 1px solid #ddd; background: white; border-radius: 4px; cursor: pointer;" onclick="adjustVehicleManagerValue('passengers', 1)">+</button>
                                        </div>
                                    </div>
                                    <div>
                                        <label class="form-label-dark">Luggage</label>
                                        <div class="flex-center">
                                            <button type="button" style="width: 30px; height: 30px; border: 1px solid #ddd; background: white; border-radius: 4px; cursor: pointer;" onclick="adjustVehicleManagerValue('luggage', -1)">-</button>
                                            <input type="number" id="vehicleManagerLuggage" style="width: 60px; padding: 8px; border: 1px solid #ddd; border-radius: 6px; text-align: center;" value="2" min="0" max="20">
                                            <button type="button" style="width: 30px; height: 30px; border: 1px solid #ddd; background: white; border-radius: 4px; cursor: pointer;" onclick="adjustVehicleManagerValue('luggage', 1)">+</button>
                                        </div>
                                    </div>
                                    <div>
                                        <label class="form-label-dark">Hand Luggage</label>
                                        <div class="flex-center">
                                            <button type="button" style="width: 30px; height: 30px; border: 1px solid #ddd; background: white; border-radius: 4px; cursor: pointer;" onclick="adjustVehicleManagerValue('handLuggage', -1)">-</button>
                                            <input type="number" id="vehicleManagerHandLuggage" style="width: 60px; padding: 8px; border: 1px solid #ddd; border-radius: 6px; text-align: center;" value="2" min="0" max="20">
                                            <button type="button" style="width: 30px; height: 30px; border: 1px solid #ddd; background: white; border-radius: 4px; cursor: pointer;" onclick="adjustVehicleManagerValue('handLuggage', 1)">+</button>
                                        </div>
                                    </div>
                                    <div>
                                        <label class="form-label-dark">Hourly Rate (‚Ç¨)</label>
                                        <input type="number" id="vehicleManagerHourlyRate" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px;" value="25" min="0" step="5">
                                    </div>
                                </div>

                                <div class="section-margin-lg">
                                    <label class="form-label-dark">Vehicle Image</label>
                                    <div style="border: 2px dashed #ddd; border-radius: 8px; padding: 20px; text-align: center; cursor: pointer;" onclick="document.getElementById('vehicleManagerImageInput').click()">
                                        <img id="vehicleManagerImagePreview" style="max-width: 200px; max-height: 150px; border-radius: 8px; margin: 10px 0; display: none;">
                                        <div id="vehicleManagerUploadText">
                                            <div style="font-size: 48px; margin-bottom: 10px;">üì∑</div>
                                            <div>Click to upload vehicle image</div>
                                            <div style="font-size: 12px; color: #666; margin-top: 5px;">JPG, PNG, WebP (max 5MB)</div>
                                        </div>
                                    </div>
                                    <input type="file" id="vehicleManagerImageInput" accept="image/*" style="display: none;" onchange="handleVehicleManagerImageUpload(this)">
                                </div>

                                <div style="display: flex; gap: 10px; justify-content: flex-end;">
                                    <button type="button" style="background: #95a5a6; color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer;" onclick="closeVehicleManagerModal()">Cancel</button>
                                    <button type="submit" style="background: #3498db; color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer;">Save Vehicle</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- DUPLICATE SECTION - DISABLED: same functionality as Vehicle Manager
                <div id="types-of-vehicles-section" class="content-section">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
                        <div>
                            <h2> Types of Vehicles</h2>
                            <p>Manage your vehicle fleet and specifications</p>
                        </div>
                        <button class="btn btn-primary" onclick="openAddVehicleModal()">
                            ‚ûï Add New Vehicle
                        </button>
                    </div>

                    <div id="vehicleSuccessMessage" style="background: #d4edda; color: #155724; padding: 12px; border-radius: 6px; margin-bottom: 20px; display: none;"></div>
                    <div id="vehicleErrorMessage" style="background: #f8d7da; color: #721c24; padding: 12px; border-radius: 6px; margin-bottom: 20px; display: none;"></div>

                    <div style="background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                        <table style="width: 100%; border-collapse: collapse;">
                            <thead style="background: #f8f9fa;">
                                <tr>
                                    <th class="table-cell-alt">Image</th>
                                    <th class="table-cell-alt">Name</th>
                                    <th class="table-cell-alt">Description</th>
                                    <th class="table-cell-alt">Capacity</th>
                                    <th class="table-cell-alt">Status</th>
                                    <th class="table-cell-alt">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="vehicleTableBody">
                                <!-- Vehicles will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Vehicle Add/Edit Modal -->
                <div id="vehicleModal" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: none; z-index: 1000; align-items: center; justify-content: center;">
                    <div style="background: white; border-radius: 12px; max-width: 600px; width: 90%; max-height: 90vh; overflow-y: auto;">
                        <div style="background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%); color: white; padding: 20px; border-radius: 12px 12px 0 0; display: flex; justify-content: space-between; align-items: center;">
                            <h3 id="vehicleModalTitle">Add New Vehicle</h3>
                            <button style="background: none; border: none; color: white; font-size: 24px; cursor: pointer;" onclick="closeVehicleModal()">&times;</button>
                        </div>
                        <div style="padding: 30px;">
                            <form id="vehicleForm">
                                <div class="section-margin-lg">
                                    <label class="form-label-dark">Name *</label>
                                    <input type="text" id="vehicleName" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px;" placeholder="Premium Class" required>
                                </div>

                                <div class="section-margin-lg">
                                    <label class="form-label-dark">Description</label>
                                    <textarea id="vehicleDescription" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px;" rows="3" placeholder="Professional taxi service"></textarea>
                                </div>

                                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                                    <div>
                                        <label class="form-label-dark">Passengers</label>
                                        <input type="number" id="vehiclePassengers" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px;" value="4" min="1" max="20">
                                    </div>
                                    <div>
                                        <label class="form-label-dark">Luggage</label>
                                        <input type="number" id="vehicleLuggage" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px;" value="2" min="0" max="20">
                                    </div>
                                    <div>
                                        <label class="form-label-dark">Hand Luggage</label>
                                        <input type="number" id="vehicleHandLuggage" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px;" value="2" min="0" max="20">
                                    </div>
                                </div>

                                <div class="section-margin-lg">
                                    <label class="form-label-dark">Vehicle Image</label>
                                    <div style="border: 2px dashed #ddd; border-radius: 8px; padding: 20px; text-align: center; cursor: pointer;" onclick="document.getElementById('vehicleImageInput').click()">
                                        <img id="vehicleImagePreview" style="max-width: 200px; max-height: 150px; border-radius: 8px; margin: 10px 0; display: none;">
                                        <div id="vehicleUploadText">
                                            <div style="font-size: 48px; margin-bottom: 10px;">üì∑</div>
                                            <div>Click to upload image</div>
                                            <div style="font-size: 12px; color: #666; margin-top: 5px;">JPG, PNG, WebP (max 5MB)</div>
                                        </div>
                                    </div>
                                    <input type="file" id="vehicleImageInput" accept="image/*" style="display: none;" onchange="handleVehicleImageUpload(this)">
                                </div>

                                <div style="display: flex; gap: 10px; justify-content: flex-end;">
                                    <button type="button" style="background: #95a5a6; color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer;" onclick="closeVehicleModal()">Cancel</button>
                                    <button type="submit" style="background: #3498db; color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer;">Save Vehicle</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                <!-- END DUPLICATE SECTION -->

                <div id="mail-section" class="content-section">
                    
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #007bff;">
                        <h3>Current Configuration</h3>
                        <div style="margin: 15px 0;">
                            <div><strong>Status:</strong> <span id="configStatus">Not configured</span></div>
                            <div><strong>SMTP Host:</strong> <span id="configHost">smtp.gmail.com</span></div>
                            <div><strong>From Email:</strong> <span id="configEmail">info@airporttransfer.be</span></div>
                        </div>
                    </div>

                    <form id="adminEmailSettingsForm" onsubmit="saveEmailSettings(event)">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                            <div>
                                <label class="form-label-alt">From name</label>
                                <input type="text" style="width: 100%; padding: 12px; border: 2px solid #e1e5e9; border-radius: 6px;" id="adminFromName" value="Airport Transfer" required>
                            </div>
                            <div>
                                <label class="form-label-alt">From email</label>
                                <input type="email" style="width: 100%; padding: 12px; border: 2px solid #e1e5e9; border-radius: 6px;" id="adminFromEmail" value="info@airporttransfer.be" required>
                            </div>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                            <div>
                                <label class="form-label-alt">Reply to email</label>
                                <input type="email" style="width: 100%; padding: 12px; border: 2px solid #e1e5e9; border-radius: 6px;" id="adminReplyToEmail" value="info@airporttransfer.be" required>
                            </div>
                            <div>
                                <label class="form-label-alt">Admin email</label>
                                <input type="email" style="width: 100%; padding: 12px; border: 2px solid #e1e5e9; border-radius: 6px;" id="adminAdminEmail" value="marceltataev@gmail.com" required>
                            </div>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                            <div>
                                <label class="form-label-alt">Connection type</label>
                                <select style="width: 100%; padding: 12px; border: 2px solid #e1e5e9; border-radius: 6px;" id="adminConnectionType">
                                    <option value="smtp">SMTP - Your mail server</option>
                                    <option value="sendmail">Sendmail</option>
                                </select>
                            </div>
                            <div>
                                <label class="form-label-alt">Provider</label>
                                <select style="width: 100%; padding: 12px; border: 2px solid #e1e5e9; border-radius: 6px;" id="adminProvider">
                                    <option value="gmail">Gmail</option>
                                    <option value="outlook">Outlook</option>
                                    <option value="yahoo">Yahoo</option>
                                    <option value="custom">Custom</option>
                                </select>
                            </div>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                            <div>
                                <label class="form-label-alt">SMTP host</label>
                                <input type="text" style="width: 100%; padding: 12px; border: 2px solid #e1e5e9; border-radius: 6px;" id="adminSmtpHost" value="smtp.gmail.com" required>
                            </div>
                            <div>
                                <label class="form-label-alt">SMTP port</label>
                                <select style="width: 100%; padding: 12px; border: 2px solid #e1e5e9; border-radius: 6px;" id="adminSmtpPort">
                                    <option value="587" selected>587</option>
                                    <option value="465">465</option>
                                    <option value="25">25</option>
                                </select>
                            </div>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                            <div>
                                <label class="form-label-alt">SMTP username</label>
                                <input type="text" style="width: 100%; padding: 12px; border: 2px solid #e1e5e9; border-radius: 6px;" id="adminSmtpUsername" value="info@airporttransfer.be" required>
                            </div>
                            <div>
                                <label class="form-label-alt">SMTP password</label>
                                <div style="position: relative;">
                                    <input type="password" style="width: 100%; padding: 12px; padding-right: 50px; border: 2px solid #e1e5e9; border-radius: 6px;" id="adminSmtpPassword" placeholder="Enter your Gmail App Password" required>
                                    <button type="button" style="position: absolute; right: 12px; top: 50%; transform: translateY(-50%); background: none; border: none; cursor: pointer; font-size: 18px;" onclick="toggleAdminPassword()">üëÅ</button>
                                </div>
                            </div>
                        </div>

                        <div class="section-margin-lg">
                            <label class="form-label-alt">SMTP security</label>
                            <div style="display: flex; gap: 20px;">
                                <label style="display: flex; align-items: center; gap: 8px;">
                                    <input type="radio" name="adminSmtpSecurity" value="none"> None
                                </label>
                                <label style="display: flex; align-items: center; gap: 8px;">
                                    <input type="radio" name="adminSmtpSecurity" value="ssl"> SSL
                                </label>
                                <label style="display: flex; align-items: center; gap: 8px;">
                                    <input type="radio" name="adminSmtpSecurity" value="tls" checked> TLS
                                </label>
                            </div>
                        </div>

                        <div style="border-top: 1px solid #e1e5e9; padding-top: 20px; margin-top: 20px;">
                            <div style="display: flex; gap: 15px; align-items: center; margin-bottom: 20px;">
                                <div style="flex: 1;">
                                    <label class="form-label-alt">Send a test email</label>
                                    <input type="email" style="width: 100%; padding: 12px; border: 2px solid #e1e5e9; border-radius: 6px;" id="adminTestEmail" placeholder="Enter your email address">
                                </div>
                                <button type="button" style="background: #007bff; color: white; border: none; padding: 12px 24px; border-radius: 6px; cursor: pointer; margin-top: 32px;" onclick="sendAdminTestEmail()">Send</button>
                            </div>
                        </div>

                        <div style="text-align: center; margin-top: 30px;">
                            <button type="submit" style="background: #28a745; color: white; border: none; padding: 15px 30px; border-radius: 6px; font-size: 16px; cursor: pointer;">
                                üíæ Save Email Settings
                            </button>
                        </div>
                    </form>

                    <div id="adminEmailStatus" style="margin-top: 20px; padding: 15px; border-radius: 6px; display: none;"></div>
                </div>

                <!-- Email Templates Section -->
                <div id="email-templates-section" class="content-section">
                    <div style="border-bottom: 2px solid #e1e8ed; margin: 50px 0 50px 0; padding-bottom: 30px;">
                        <h1 style="color: #2c3e50; font-size: 28px; margin-bottom: 15px;">Marcel's Taxi Pro</h1>
                        <h2 style="color: #007bff; font-size: 24px; margin-bottom: 5px;">Professional Admin Panel - ‚öôÔ∏è Settings</h2>
                        <h3 style="color: #666; font-size: 20px; margin: 0;">üìù Email Templates</h3>
                    </div>
                    
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #007bff;">
                        <h3>üìß Email Template Configuratie</h3>
                        <p style="margin: 10px 0; color: #6c757d;">Beheer de 3 verschillende email templates die naar klanten worden verstuurd tijdens het boekingsproces.</p>
                    </div>

                    <!-- Template Selector -->
                    <div class="card">
                        <label style="display: block; font-weight: 600; margin-bottom: 10px;">Selecteer Email Template:</label>
                        <select id="templateSelector" onchange="loadSelectedTemplate()" style="width: 100%; padding: 12px; border: 2px solid #e1e5e9; border-radius: 6px; font-size: 16px;">
                            <option value="pending">üìã Template 1: Wacht op Bevestiging (Direct na reservering)</option>
                            <option value="confirmed">‚úÖ Template 2: Bevestiging Email (Unconfirmed ‚Üí Confirmed)</option>
                            <option value="cancelled">‚ùå Template 3: Annulering Email (Unconfirmed ‚Üí Cancelled)</option>
                        </select>
                    </div>

                    <form id="emailTemplateForm" onsubmit="saveEmailTemplate(event)">
                        <!-- Template 1: Pending Confirmation -->
                        <div id="pendingTemplate" class="template-content">
                            <div style="background: #fff4e6; padding: 20px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #ffa500;">
                                <h4 style="color: #2c3e50; margin-bottom: 10px;">üìã Template 1: Wacht op Bevestiging</h4>
                                <p style="margin: 0; color: #666;">Deze email wordt direct verstuurd wanneer een klant een nieuwe boeking maakt.</p>
                            </div>

                            <!-- Subject Line -->
                            <div class="card">
                                <h4 class="text-color">üìß Email Onderwerp</h4>
                                <input type="text" id="pendingSubject" style="width: 100%; padding: 12px; border: 2px solid #e1e5e9; border-radius: 6px;" value="Uw booking wacht op bevestiging - [BOOKING_ID]" placeholder="Email onderwerp">
                            </div>

                            <!-- Welcome Message -->
                            <div class="card">
                                <h4 class="text-color">üéâ Welkomstbericht</h4>
                                <textarea id="pendingWelcomeMessage" style="width: 100%; padding: 12px; border: 2px solid #e1e5e9; border-radius: 6px; min-height: 80px; resize: vertical;">Bedankt voor uw boeking bij Marcel's Taxi!

We hebben uw reservering ontvangen. Ons team zal uw boeking zo spoedig mogelijk beoordelen.</textarea>
                            </div>

                            <!-- Status Message -->
                            <div class="card">
                                <h4 class="text-color">‚è≥ Status Bericht</h4>
                                <textarea id="pendingStatusMessage" style="width: 100%; padding: 12px; border: 2px solid #e1e5e9; border-radius: 6px; min-height: 100px; resize: vertical;">üîÑ UW BOEKING WACHT OP BEVESTIGING

Uw boeking wordt binnen 24 uur door ons team beoordeeld. U ontvangt een bevestiging of annulering per email.

Voor urgente boekingen kunt u ons direct bellen.</textarea>
                            </div>
                        </div>

                        <!-- Template 2: Confirmed -->
                        <div id="confirmedTemplate" class="template-content" style="display: none;">
                            <div style="background: #e8f5e9; padding: 20px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #4caf50;">
                                <h4 style="color: #2c3e50; margin-bottom: 10px;">‚úÖ Template 2: Bevestiging Email</h4>
                                <p style="margin: 0; color: #666;">Deze email wordt verstuurd wanneer een boeking van 'unconfirmed' naar 'confirmed' wordt gezet.</p>
                            </div>

                            <!-- Subject Line -->
                            <div class="card">
                                <h4 class="text-color">üìß Email Onderwerp</h4>
                                <input type="text" id="confirmedSubject" style="width: 100%; padding: 12px; border: 2px solid #e1e5e9; border-radius: 6px;" value="‚úÖ Uw rit is bevestigd - [BOOKING_ID]" placeholder="Email onderwerp">
                            </div>

                            <!-- Welcome Message -->
                            <div class="card">
                                <h4 class="text-color">üéâ Bevestigingsbericht</h4>
                                <textarea id="confirmedWelcomeMessage" style="width: 100%; padding: 12px; border: 2px solid #e1e5e9; border-radius: 6px; min-height: 80px; resize: vertical;">Goed nieuws! Uw taxi boeking is bevestigd.

We hebben uw reservering definitief bevestigd. Hieronder vindt u alle details van uw rit.</textarea>
                            </div>

                            <!-- Status Message -->
                            <div class="card">
                                <h4 class="text-color">‚úÖ Bevestiging Details</h4>
                                <textarea id="confirmedStatusMessage" style="width: 100%; padding: 12px; border: 2px solid #e1e5e9; border-radius: 6px; min-height: 100px; resize: vertical;">‚úÖ UW RIT IS DEFINITIEF BEVESTIGD

Een chauffeur is aan uw rit toegewezen. U ontvangt 24 uur voor vertrek de contactgegevens van uw chauffeur.

Zorg ervoor dat u op tijd klaar staat op de afgesproken locatie.</textarea>
                            </div>
                        </div>

                        <!-- Template 3: Cancelled -->
                        <div id="cancelledTemplate" class="template-content" style="display: none;">
                            <div style="background: #ffebee; padding: 20px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #f44336;">
                                <h4 style="color: #2c3e50; margin-bottom: 10px;">‚ùå Template 3: Annulering Email</h4>
                                <p style="margin: 0; color: #666;">Deze email wordt verstuurd wanneer een boeking wordt geannuleerd.</p>
                            </div>

                            <!-- Subject Line -->
                            <div class="card">
                                <h4 class="text-color">üìß Email Onderwerp</h4>
                                <input type="text" id="cancelledSubject" style="width: 100%; padding: 12px; border: 2px solid #e1e5e9; border-radius: 6px;" value="‚ùå Uw rit is geannuleerd - [BOOKING_ID]" placeholder="Email onderwerp">
                            </div>

                            <!-- Cancellation Message -->
                            <div class="card">
                                <h4 class="text-color">‚ùå Annuleringsbericht</h4>
                                <textarea id="cancelledWelcomeMessage" style="width: 100%; padding: 12px; border: 2px solid #e1e5e9; border-radius: 6px; min-height: 80px; resize: vertical;">Helaas moeten wij u mededelen dat uw taxi boeking is geannuleerd.

Hieronder vindt u de details van de geannuleerde rit.</textarea>
                            </div>

                            <!-- Reason Message -->
                            <div class="card">
                                <h4 class="text-color">üìã Annulering Reden</h4>
                                <textarea id="cancelledStatusMessage" style="width: 100%; padding: 12px; border: 2px solid #e1e5e9; border-radius: 6px; min-height: 100px; resize: vertical;">‚ùå UW RIT IS GEANNULEERD

Mogelijke redenen voor annulering:
- Geen beschikbare chauffeurs op het gevraagde tijdstip
- De route valt buiten ons servicegebied
- Technische problemen

Voor vragen kunt u contact met ons opnemen. We helpen u graag met een alternatieve oplossing.</textarea>
                            </div>
                        </div>

                        <!-- Shared Contact Information -->
                        <div class="card">
                            <h4 class="text-color">üìû Contact Informatie</h4>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                                <div>
                                    <label class="form-label-alt">Telefoon:</label>
                                    <input type="text" id="templatePhone" class="input-field" value="+32 xxx xx xx xx" placeholder="+32 xxx xx xx xx">
                                </div>
                                <div>
                                    <label class="form-label-alt">WhatsApp:</label>
                                    <input type="text" id="templateWhatsApp" class="input-field" value="+32 xxx xx xx xx" placeholder="+32 xxx xx xx xx">
                                </div>
                            </div>
                            <div class="section-margin">
                                <label class="form-label-alt">Email:</label>
                                <input type="email" id="templateEmail" class="input-field" value="info@airporttransfer.be" placeholder="info@airporttransfer.be">
                            </div>
                            <div class="section-margin">
                                <label class="form-label-alt">Extra instructies:</label>
                                <textarea id="templateContactInfo" style="width: 100%; padding: 12px; border: 2px solid #e1e5e9; border-radius: 6px; min-height: 60px; resize: vertical;" placeholder="Voor vragen of wijzigingen kunt u contact opnemen...">Voor vragen of wijzigingen kunt u ons bereiken via bovenstaande contactgegevens.

Bij no-show of annulering binnen 2 uur voor vertrek kunnen kosten in rekening worden gebracht.</textarea>
                            </div>
                        </div>

                        <!-- Booking Modification Settings -->
                        <div class="card">
                            <h4 class="text-color">‚úèÔ∏è Boeking Wijzigingen</h4>
                            <div style="background: #e8f5e9; padding: 15px; border-radius: 6px; margin-bottom: 15px; border-left: 4px solid #28a745;">
                                <p style="margin: 0; color: #155724; font-size: 14px;">
                                    <strong>üìã Wijziging Link:</strong> In bevestigde emails wordt automatisch een link toegevoegd waarmee klanten hun boeking kunnen wijzigen.
                                </p>
                            </div>
                            <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 15px; align-items: end;">
                                <div>
                                    <label class="form-label-alt">Deadline (uur voor vertrek):</label>
                                    <div class="flex-center">
                                        <button type="button" style="width: 30px; height: 30px; border: 1px solid #ddd; background: white; border-radius: 4px; cursor: pointer;" onclick="adjustModificationDeadline(-1)">-</button>
                                        <input type="number" id="templateModificationDeadline" style="width: 80px; padding: 10px; border: 2px solid #e1e5e9; border-radius: 6px; text-align: center;" value="24" min="1" max="168" placeholder="24">
                                        <button type="button" style="width: 30px; height: 30px; border: 1px solid #ddd; background: white; border-radius: 4px; cursor: pointer;" onclick="adjustModificationDeadline(1)">+</button>
                                        <span style="color: #6c757d; font-size: 14px;">uur</span>
                                    </div>
                                    <div style="font-size: 12px; color: #6c757d; margin-top: 5px;">
                                        Standaard: 24 uur voor vertrek
                                    </div>
                                </div>
                                <div>
                                    <label class="form-label-alt">Preview tekst:</label>
                                    <div style="background: #f8f9fa; padding: 12px; border-radius: 6px; color: #6c757d; font-size: 14px; border: 1px solid #e9ecef;">
                                        "U kunt uw boeking nog wijzigen tot <strong id="deadlinePreview">24</strong> uur voor uw vertrek."
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Company Information -->
                        <div class="card">
                            <h4 class="text-color">üè¢ Bedrijfsinformatie</h4>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                                <div>
                                    <label class="form-label-alt">Bedrijfsnaam:</label>
                                    <input type="text" id="templateCompanyName" class="input-field" value="Marcel's Taxi Service" placeholder="Marcel's Taxi Service">
                                </div>
                                <div>
                                    <label class="form-label-alt">Website:</label>
                                    <input type="text" id="templateWebsite" class="input-field" value="www.airporttransfer.be" placeholder="www.airporttransfer.be">
                                </div>
                            </div>
                            <div>
                                <label class="form-label-alt">Footer bericht:</label>
                                <textarea id="templateFooter" style="width: 100%; padding: 12px; border: 2px solid #e1e5e9; border-radius: 6px; min-height: 80px; resize: vertical;" placeholder="Marcel's Taxi - Professioneel vervoer sinds...">Marcel's Taxi - Professioneel vervoer
Betrouwbaar ‚Ä¢ Comfortabel ‚Ä¢ Op tijd

Bedankt voor het kiezen van onze service!</textarea>
                            </div>
                        </div>

                        <!-- Save and Preview -->
                        <div style="text-align: center; margin-top: 30px;">
                            <button type="button" style="background: #6c757d; color: white; border: none; padding: 12px 24px; border-radius: 6px; margin-right: 15px; cursor: pointer;" onclick="previewEmailTemplate()">
                                üëÅÔ∏è Preview Email
                            </button>
                            <button type="submit" style="background: #28a745; color: white; border: none; padding: 15px 30px; border-radius: 6px; font-size: 16px; cursor: pointer;">
                                üíæ Save Email Template
                            </button>
                        </div>
                    </form>

                    <div id="emailTemplateStatus" style="margin-top: 20px; padding: 15px; border-radius: 6px; display: none;"></div>
                </div>

                <!-- Translation Section -->
                <div id="translation-section" class="content-section">
                    <div style="border-bottom: 2px solid #e1e8ed; margin: 50px 0 50px 0; padding-bottom: 30px;">
                        <h1 style="color: #2c3e50; font-size: 28px; margin-bottom: 15px;">Marcel's Taxi Pro</h1>
                        <h2 style="color: #007bff; font-size: 24px; margin-bottom: 5px;">Professional Admin Panel - ‚öôÔ∏è Settings</h2>
                        <h3 style="color: #666; font-size: 20px; margin: 0;">üåê Translation - Email Teksten</h3>
                    </div>
                    
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #007bff;">
                        <h3>üìß Professional Email Layout</h3>
                        <p style="margin: 10px 0; color: #6c757d;">Configureer alle teksten die in de booking emails verschijnen. Deze instellingen bepalen hoe klanten jullie emails ontvangen.</p>
                    </div>

                    <form id="translationForm" onsubmit="saveTranslation(event)">
                        <!-- Company Header -->
                        <div class="card">
                            <h4 class="text-color">üè¢ Bedrijf Header</h4>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                                <div>
                                    <label class="form-label-alt">Bedrijfsnaam in Email Header:</label>
                                    <input type="text" id="translationCompanyName" class="input-field" value="Taxi Leuven" placeholder="Taxi Leuven">
                                </div>
                                <div>
                                    <label class="form-label-alt">Logo URL (optioneel):</label>
                                    <input type="text" id="translationLogoUrl" class="input-field" placeholder="https://example.com/logo.png">
                                </div>
                            </div>
                        </div>

                        <!-- Main Message -->
                        <div class="card">
                            <h4 class="text-color">üì® Hoofdbericht</h4>
                            <div class="section-margin">
                                <label class="form-label-alt">Status bericht (eerste regel):</label>
                                <input type="text" id="translationStatusLine" class="input-field" value="Uw booking wacht op bevestiging." placeholder="Uw booking wacht op bevestiging.">
                            </div>
                            <div class="section-margin">
                                <label class="form-label-alt">Bevestigings bericht:</label>
                                <textarea id="translationMainMessage" style="width: 100%; padding: 12px; border: 2px solid #e1e5e9; border-radius: 6px; min-height: 80px; resize: vertical;" placeholder="Bedankt voor uw booking bij Taxi Leuven. Uw reservatienummer is...">Bedankt voor uw booking bij Taxi Leuven. Uw reservatienummer is [BOOKING_ID].

Een bevestigingsmail wordt naar uw e-mailadres verzonden binnen 1 uur. ALS U GEEN EMAIL ONTVANGEN HEBT, GELIEVE MET ONS CONTACT OP TE NEMEN!</textarea>
                            </div>
                        </div>

                        <!-- Section Labels -->
                        <div class="card">
                            <h4 class="text-color">üè∑Ô∏è Sectie Labels</h4>
                            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                                <div>
                                    <label class="form-label-alt">Reis Sectie:</label>
                                    <input type="text" id="translationTripSection" class="input-field" value="Reis" placeholder="Reis">
                                </div>
                                <div>
                                    <label class="form-label-alt">Klant Sectie:</label>
                                    <input type="text" id="translationClientSection" class="input-field" value="Klant" placeholder="Klant">
                                </div>
                                <div>
                                    <label class="form-label-alt">Reservatie Sectie:</label>
                                    <input type="text" id="translationReservationSection" class="input-field" value="Reservatie" placeholder="Reservatie">
                                </div>
                            </div>
                        </div>

                        <!-- Field Labels -->
                        <div class="card">
                            <h4 class="text-color">üìù Veld Labels</h4>
                            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                                <div>
                                    <label class="form-label-alt">Datum & tijd:</label>
                                    <input type="text" id="translationDateTime" class="input-field" value="Datum & tijd:" placeholder="Datum & tijd:">
                                </div>
                                <div>
                                    <label class="form-label-alt">Ophaallocatie:</label>
                                    <input type="text" id="translationPickupLocation" class="input-field" value="Ophaallocatie:" placeholder="Ophaallocatie:">
                                </div>
                                <div>
                                    <label class="form-label-alt">Bestemming:</label>
                                    <input type="text" id="translationDestination" class="input-field" value="Bestemming:" placeholder="Bestemming:">
                                </div>
                            </div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                                <div>
                                    <label class="form-label-alt">Voertuig:</label>
                                    <input type="text" id="translationVehicle" class="input-field" value="Voertuig:" placeholder="Voertuig:">
                                </div>
                                <div>
                                    <label class="form-label-alt">Passagiers:</label>
                                    <input type="text" id="translationPassengers" class="input-field" value="Passagiers:" placeholder="Passagiers:">
                                </div>
                                <div>
                                    <label class="form-label-alt">Naam:</label>
                                    <input type="text" id="translationName" class="input-field" value="Naam:" placeholder="Naam:">
                                </div>
                            </div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                                <div>
                                    <label class="form-label-alt">Telefoonnummer:</label>
                                    <input type="text" id="translationPhone" class="input-field" value="Telefoonnummer:" placeholder="Telefoonnummer:">
                                </div>
                                <div>
                                    <label class="form-label-alt">E-mail:</label>
                                    <input type="text" id="translationEmail" class="input-field" value="E-mail:" placeholder="E-mail:">
                                </div>
                                <div>
                                    <label class="form-label-alt">Referentie-ID:</label>
                                    <input type="text" id="translationReferenceId" class="input-field" value="Referentie-ID:" placeholder="Referentie-ID:">
                                </div>
                            </div>
                        </div>

                        <!-- Pricing Labels -->
                        <div class="card">
                            <h4 class="text-color">üí∞ Prijs Labels</h4>
                            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                                <div>
                                    <label class="form-label-alt">Boekingsdatum:</label>
                                    <input type="text" id="translationBookingDate" class="input-field" value="Boekingsdatum:" placeholder="Boekingsdatum:">
                                </div>
                                <div>
                                    <label class="form-label-alt">Samenvatting:</label>
                                    <input type="text" id="translationSummary" class="input-field" value="Samenvatting:" placeholder="Samenvatting:">
                                </div>
                                <div>
                                    <label class="form-label-alt">Totaal:</label>
                                    <input type="text" id="translationTotal" class="input-field" value="Totaal:" placeholder="Totaal:">
                                </div>
                            </div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                                <div>
                                    <label class="form-label-alt">Betalingen:</label>
                                    <input type="text" id="translationPayments" class="input-field" value="Betalingen:" placeholder="Betalingen:">
                                </div>
                                <div>
                                    <label class="form-label-alt">Verschuldigd bedrag:</label>
                                    <input type="text" id="translationOwedAmount" class="input-field" value="Verschuldigd bedrag:" placeholder="Verschuldigd bedrag:">
                                </div>
                                <div>
                                    <label class="form-label-alt">Status:</label>
                                    <input type="text" id="translationPaymentStatus" class="input-field" value="Pending" placeholder="Pending">
                                </div>
                            </div>
                        </div>

                        <!-- Footer Messages -->
                        <div class="card">
                            <h4 class="text-color">üìÑ Footer Berichten</h4>
                            <div class="section-margin">
                                <label class="form-label-alt">Annulatie regels:</label>
                                <textarea id="translationCancellation" style="width: 100%; padding: 12px; border: 2px solid #e1e5e9; border-radius: 6px; min-height: 60px; resize: vertical;" placeholder="Annulatie binnen 24 uur...">Annulatie binnen 24 uur: Bij annulering binnen 24 uur voor de geplande rit wordt het volledige bedrag van de rit in rekening gebracht.</textarea>
                            </div>
                            <div class="section-margin">
                                <label class="form-label-alt">Wijzigingen regels:</label>
                                <textarea id="translationChanges" style="width: 100%; padding: 12px; border: 2px solid #e1e5e9; border-radius: 6px; min-height: 60px; resize: vertical;" placeholder="Wijzigingen binnen 24 uur...">Wijzigingen binnen 24 uur: Voor aanpassingen aan een bestaande reservering binnen 24 uur (bijvoorbeeld door het missen van een vlucht) wordt een toeslag van ‚Ç¨30 gerekend.</textarea>
                            </div>
                            <div class="section-margin">
                                <label class="form-label-alt">Booking advies:</label>
                                <textarea id="translationBookingAdvice" style="width: 100%; padding: 12px; border: 2px solid #e1e5e9; border-radius: 6px; min-height: 60px; resize: vertical;" placeholder="Het rechtstreeks reserveren van een rit...">Bookingsregels: Het rechtstreeks reserveren van een rit via √©√©n van onze chauffeurs is niet toegestaan. Voor een verzekerde en kwaliteitsvolle dienstverlening verzoeken wij u uw taxi uitsluitend via ons offici√´le systeem te boeken.</textarea>
                            </div>
                            <div>
                                <label class="form-label-alt">Chauffeur informatie:</label>
                                <textarea id="translationDriverInfo" style="width: 100%; padding: 12px; border: 2px solid #e1e5e9; border-radius: 6px; min-height: 60px; resize: vertical;" placeholder="E√©n dag voor uw vertrek...">E√©n dag voor uw vertrek sturen wij u het nummer van de chauffeur, zodra wij onze planning hebben gemaakt.</textarea>
                            </div>
                        </div>

                        <!-- Save and Preview -->
                        <div style="text-align: center; margin-top: 30px;">
                            <button type="button" style="background: #6c757d; color: white; border: none; padding: 12px 24px; border-radius: 6px; margin-right: 15px; cursor: pointer;" onclick="previewTranslationEmail()">
                                üëÅÔ∏è Preview Professional Email
                            </button>
                            <button type="submit" style="background: #28a745; color: white; border: none; padding: 15px 30px; border-radius: 6px; font-size: 16px; cursor: pointer;">
                                üíæ Save Translation Settings
                            </button>
                        </div>
                    </form>

                    <div id="translationStatus" style="margin-top: 20px; padding: 15px; border-radius: 6px; display: none;"></div>
                </div>

                <!-- Google Section -->
                <div id="google-section" class="content-section">
                    <div style="border-bottom: 2px solid #e1e8ed; margin: 50px 0 50px 0; padding-bottom: 30px;">
                        <h1 style="color: #2c3e50; font-size: 28px; margin-bottom: 15px;">Marcel's Taxi Pro</h1>
                        <h2 style="color: #007bff; font-size: 24px; margin-bottom: 5px;">Professional Admin Panel - ‚öôÔ∏è Settings</h2>
                        <h3 style="color: #666; font-size: 20px; margin: 0;">üåê Google API Configuration</h3>
                    </div>
                    
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                        <h3 class="text-color">üó∫Ô∏è Google Maps API</h3>
                        
                        <div class="section-margin-lg">
                            <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #495057;">Google Maps API Key:</label>
                            <input type="text" id="googleMapsApiKey" placeholder="Enter your Google Maps JavaScript API key" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-family: monospace;">
                            <small style="color: #6c757d; display: block; margin-top: 5px;">Required for map display and route calculations</small>
                        </div>
                        
                        <div class="section-margin-lg">
                            <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #495057;">Google Places API Key:</label>
                            <input type="text" id="googlePlacesApiKey" placeholder="Enter your Google Places API key" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-family: monospace;">
                            <small style="color: #6c757d; display: block; margin-top: 5px;">Required for address autocomplete and place search</small>
                        </div>
                        
                        <div class="section-margin-lg">
                            <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #495057;">Google Directions API Key:</label>
                            <input type="text" id="googleDirectionsApiKey" placeholder="Enter your Google Directions API key" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-family: monospace;">
                            <small style="color: #6c757d; display: block; margin-top: 5px;">Required for route calculation and distance/time estimation</small>
                        </div>
                        
                        <div class="section-margin-lg">
                            <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #495057;">Google Geocoding API Key:</label>
                            <input type="text" id="googleGeocodingApiKey" placeholder="Enter your Google Geocoding API key" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-family: monospace;">
                            <small style="color: #6c757d; display: block; margin-top: 5px;">Required for converting addresses to coordinates</small>
                        </div>
                        
                        <div class="section-margin-lg">
                            <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #495057;">Default Location:</label>
                            <input type="text" id="defaultLocation" placeholder="Enter default pickup location (e.g., Brussels, Belgium)" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;">
                            <small style="color: #6c757d; display: block; margin-top: 5px;">Default location for taxi services</small>
                        </div>
                        
                        <div class="section-margin-lg">
                            <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #495057;">Service Area:</label>
                            <input type="text" id="serviceArea" placeholder="Enter service area (e.g., Brussels Metropolitan Area)" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;">
                            <small style="color: #6c757d; display: block; margin-top: 5px;">Geographic area where taxi services are available</small>
                        </div>
                        
                        <div style="display: flex; gap: 10px; margin-top: 20px;">
                            <button onclick="saveGoogleSettings()" style="background: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; font-weight: 600;">üíæ Save Settings</button>
                        </div>
                        
                        <div id="googleStatus" style="margin-top: 15px; padding: 10px; border-radius: 4px; display: none;"></div>
                    </div>
                    
                    <div style="background: #fff3cd; padding: 15px; border-radius: 6px; border: 1px solid #ffeaa7;">
                        <h4 style="color: #856404; margin-bottom: 10px;">‚ÑπÔ∏è Google Maps Setup Instructions</h4>
                        <ol style="color: #856404; margin-bottom: 0;">
                            <li>Go to <a href="https://console.cloud.google.com/" target="_blank" style="color: #007bff;">Google Cloud Console</a></li>
                            <li>Create a new project or select existing one</li>
                            <li>Enable Google Maps JavaScript API</li>
                            <li>Create credentials (API key)</li>
                            <li>Add API key restrictions for security</li>
                            <li>Copy the API key and paste it above</li>
                        </ol>
                    </div>
                </div>

                <!-- Bookings Sections -->
                <div id="next-24h-section" class="content-section">
                    <div class="section-toolbar">
                        <button class="btn btn-success" onclick="window.open('./booking-exact.html', '_blank')">üëÄ View Booking System</button>
                        <div class="btn-group">
                            <button style="background: white; border: 1px solid #dee2e6; padding: 8px 16px; border-radius: 6px; cursor: pointer;" onclick="loadNext24hBookings()">
                                üîÑ <span class="margin-left">Refresh</span>
                            </button>
                            <button style="background: white; border: 1px solid #dee2e6; padding: 8px 16px; border-radius: 6px; cursor: pointer;">
                                üì§ <span class="margin-left">Export</span>
                            </button>
                        </div>
                        <div style="margin-left: auto; display: flex; gap: 10px; align-items: center;">
                            <span id="next24hCount" style="padding: 8px 12px; background: #28a745; color: white; border-radius: 4px; font-weight: 500;">0 confirmed</span>
                        </div>
                    </div>
                    
                    <div id="next24hBookingsContainer" style="background: white; border: 1px solid #dee2e6; border-radius: 8px; overflow: visible;">
                        <table style="width: 100%; border-collapse: collapse; font-size: 12px; table-layout: fixed;">
                            <thead style="background: #f8f9fa; border-bottom: 2px solid #dee2e6;">
                                <tr>
                                    <th style="padding: 6px; text-align: center; width: 6%;">üåç</th>
                                    <th style="padding: 6px; text-align: left; width: 22%;">Info</th>
                                    <th style="padding: 6px; text-align: left; width: 12%;">Date</th>
                                    <th style="padding: 6px; text-align: left; width: 10%;">Status</th>
                                    <th style="padding: 6px; text-align: left; width: 15%;">Driver</th>
                                    <th style="padding: 6px; text-align: left; width: 12%;">Vehicle</th>
                                    <th style="padding: 6px; text-align: left; width: 15%;">Notes</th>
                                    <th style="padding: 6px; text-align: left; width: 8%;">Total</th>
                                </tr>
                            </thead>
                            <tbody id="next24hTableBody">
                                <tr>
                                    <td colspan="8" class="empty-state">
                                        Loading confirmed bookings...
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div id="latest-section" class="content-section">
                    <p style="color: #6c757d; margin: 0 0 20px 0;">Most recent booking requests</p>
                    <!-- Content will be added here -->
                </div>

                <div id="unconfirmed-section" class="content-section">
                    <p style="color: #6c757d; margin: 0 0 20px 0;">New bookings awaiting confirmation</p>
                    <div class="section-toolbar">
                        <button class="btn btn-success" style="display: flex; align-items: center; gap: 8px;" onclick="window.location.href='booking-exact.html'">
                            ‚ûï Add new booking
                        </button>
                        <div class="btn-group">
                            <button id="refreshUnconfirmedBtn" style="background: white; border: 1px solid #dee2e6; padding: 8px 16px; border-radius: 6px; cursor: pointer;" onclick="refreshUnconfirmedBookings()">
                                üîÑ <span class="margin-left">Refresh</span>
                            </button>
                            <button id="deleteAllUnconfirmedBtn" style="background: #dc3545; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer;" onclick="deleteAllUnconfirmedBookings()">
                                üóëÔ∏è <span class="margin-left">Delete All</span>
                            </button>
                            <button style="background: white; border: 1px solid #dee2e6; padding: 8px 16px; border-radius: 6px; cursor: pointer;">
                                üì• <span class="margin-left">Import</span>
                            </button>
                            <button style="background: white; border: 1px solid #dee2e6; padding: 8px 16px; border-radius: 6px; cursor: pointer;">
                                üì§ <span class="margin-left">Export</span>
                            </button>
                        </div>
                        <div class="btn-group ml-auto">
                            <input type="text" placeholder="Filter / Search" class="input-field-alt" style="width: 200px;">
                            <select class="input-field-alt">
                                <option>üîÑ Sync source</option>
                            </select>
                        </div>
                    </div>
                    
                    <div id="unconfirmedBookingsContainer" style="background: white; border: 1px solid #dee2e6; border-radius: 8px; overflow: visible;">
                        <table style="width: 100%; border-collapse: collapse; font-size: 12px; table-layout: fixed;">
                            <thead style="background: #f8f9fa; border-bottom: 2px solid #dee2e6;">
                                <tr>
                                    <th style="padding: 6px; text-align: center; width: 6%;">üåç</th>
                                    <th style="padding: 6px; text-align: left; width: 18%;">
                                        <input type="checkbox" style="margin-right: 4px;">Info
                                    </th>
                                    <th style="padding: 6px; text-align: left; width: 12%;">Date</th>
                                    <th style="padding: 6px; text-align: left; width: 8%;">Status</th>
                                    <th style="padding: 6px; text-align: left; width: 18%;">Driver Assignment</th>
                                    <th style="padding: 6px; text-align: left; width: 12%;">Vehicle</th>
                                    <th style="padding: 6px; text-align: left; width: 12%;">Notes</th>
                                    <th style="padding: 6px; text-align: left; width: 8%;">Total</th>
                                    <th style="padding: 6px; text-align: center; width: 6%;">‚úâÔ∏è</th>
                                </tr>
                            </thead>
                            <tbody id="unconfirmedTableBody">
                                <tr>
                                    <td colspan="9" class="empty-state">
                                        Loading unconfirmed bookings...
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Pricing Sections -->
                <div id="distance-time-section" class="content-section">
                    <p style="color: #6c757d; margin: 0 0 20px 0;">Configure pricing for each vehicle type - prices will be used in the booking system</p>
                    <div class="btn-group" style="margin: 20px 0;">
                        <button class="btn btn-primary" onclick="loadVehiclePricing()">üîÑ Load Vehicle Pricing</button>
                        <button class="btn btn-success" onclick="saveAllPricing()">üíæ Save All Changes</button>
                        <button class="btn" style="background: #6c757d; color: white;" onclick="resetToDefaults()">üîÑ Reset to Defaults</button>
                    </div>
                    
                    <!-- Manual Last-Minute Booking Control -->
                    <div style="background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 8px; padding: 20px; margin: 20px 0; border-left: 4px solid #f39c12;">
                        <h3 style="color: #d68910; margin-bottom: 15px;">‚ö° Manual Last-Minute Booking Control</h3>
                        
                        <!-- Quick Preset Buttons -->
                        <div style="background: #e8f5e9; padding: 15px; border-radius: 8px; margin-bottom: 15px; border-left: 3px solid #28a745;">
                            <h4 style="color: #155724; margin-bottom: 10px;">‚ö° Quick Presets</h4>
                            <div style="display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 15px;">
                                <button onclick="setQuickPreset('percentage', 0)" style="background: #dc3545; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 13px; font-weight: bold;">üö´ Disable</button>
                                <button onclick="setQuickPreset('percentage', 15)" style="background: #17a2b8; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 13px;">15%</button>
                                <button onclick="setQuickPreset('percentage', 20)" style="background: #17a2b8; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 13px;">20%</button>
                                <button onclick="setQuickPreset('percentage', 25)" style="background: #17a2b8; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 13px;">25%</button>
                                <button onclick="setQuickPreset('percentage', 30)" style="background: #17a2b8; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 13px;">30%</button>
                                <button onclick="setQuickPreset('fixed', 10)" style="background: #28a745; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 13px;">‚Ç¨10</button>
                                <button onclick="setQuickPreset('fixed', 15)" style="background: #28a745; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 13px;">‚Ç¨15</button>
                                <button onclick="setQuickPreset('fixed', 20)" style="background: #28a745; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 13px;">‚Ç¨20</button>
                                <button onclick="setQuickPreset('fixed', 25)" style="background: #28a745; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 13px;">‚Ç¨25</button>
                            </div>
                        </div>
                        
                        <!-- Custom Settings -->
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 15px; border-left: 3px solid #6c757d;">
                            <h4 style="color: #2c3e50; margin-bottom: 10px;">‚öôÔ∏è Custom Standaard Instellingen</h4>
                            
                            <!-- First Row: Type and Amount -->
                            <div style="display: flex; gap: 20px; align-items: center; flex-wrap: wrap; margin-bottom: 15px;">
                                <div class="flex-center">
                                    <label style="font-weight: 600; color: #2c3e50;">Type:</label>
                                    <select id="defaultLastMinuteType" onchange="updateLastMinuteSymbol(); updateDefaultLastMinuteSettings();" style="padding: 8px; border-radius: 4px; border: 1px solid #ddd; width: 140px;">
                                        <option value="percentage">Percentage (%)</option>
                                        <option value="fixed">Vast bedrag (‚Ç¨)</option>
                                    </select>
                                </div>
                                
                                <div class="flex-center">
                                    <label style="font-weight: 600; color: #2c3e50;">Bedrag:</label>
                                    <input type="number" id="defaultLastMinuteAmount" step="0.01" min="0" 
                                           placeholder="25.00" onchange="updateDefaultLastMinuteSettings()" value="25.00"
                                           style="padding: 8px; border-radius: 4px; border: 1px solid #ddd; width: 100px;">
                                    <span id="defaultLastMinuteSymbol" style="font-weight: 600; color: #2c3e50;">%</span>
                                </div>
                                
                                <div class="flex-center">
                                    <label style="font-weight: 600; color: #2c3e50;">Tijdslimiet:</label>
                                    <input type="number" id="defaultLastMinuteHours" step="0.5" min="0" max="24" 
                                           placeholder="3" onchange="updateDefaultLastMinuteSettings()" value="3"
                                           style="padding: 8px; border-radius: 4px; border: 1px solid #ddd; width: 80px;">
                                    <span style="font-weight: 600; color: #2c3e50;">uur</span>
                                </div>
                            </div>
                            
                            <!-- Info only - no save button -->
                            <div style="display: flex; gap: 15px; align-items: center; margin-bottom: 15px;">
                                <div style="color: #6c757d; font-size: 13px;">
                                    Toeslag wordt actief als booking binnen <span id="hoursDisplay">3</span> uur voor vertrek wordt gemaakt.
                                    <strong>Gebruik "üíæ Save All Changes" bovenaan om op te slaan.</strong>
                                </div>
                            </div>
                            
                            <div style="padding: 10px; background: #e9ecef; border-radius: 4px; border-left: 3px solid #007bff;">
                                <div style="font-size: 14px; color: #495057;">
                                    <strong>Voorbeeld:</strong> <span id="defaultLastMinuteExample">Bij een boeking van ‚Ç¨100 wordt ‚Ç¨25 extra gerekend (totaal ‚Ç¨125)</span>
                                </div>
                            </div>
                        </div>
                        
                        <div style="padding: 15px; background: #d4edda; border-radius: 8px; border-left: 3px solid #28a745;">
                            <h4 style="color: #155724; margin-bottom: 10px;">‚úÖ Hoe het werkt:</h4>
                            <div style="font-size: 14px; color: #155724; line-height: 1.6;">
                                <div style="margin-bottom: 5px;">‚Ä¢ <strong>Stel hier je standaard toeslag in</strong> (percentage of vast bedrag)</div>
                                <div style="margin-bottom: 5px;">‚Ä¢ <strong>Gebruik Quick Presets</strong> voor veelgebruikte bedragen</div>
                                <div style="margin-bottom: 5px;">‚Ä¢ <strong>Bij elke booking</strong> worden deze instellingen automatisch vooraf ingevuld</div>
                                <div style="margin-bottom: 5px;">‚Ä¢ <strong>Pas per booking aan</strong> als dat nodig is</div>
                                <div>‚Ä¢ <strong>Volledige controle</strong> - jij bepaalt welke bookings een toeslag krijgen</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Advanced Per-Vehicle Distance-Based KM Pricing -->
                    <div style="background: #e8f5e9; border: 1px solid #c3e6cb; border-radius: 8px; padding: 20px; margin: 20px 0; border-left: 4px solid #28a745;">
                        <h3 style="color: #155724; margin-bottom: 15px;">üìè Afstand-Gebaseerde Kilometer Prijzen</h3>
                        <p style="color: #155724; margin-bottom: 20px;">
                            Configureer verschillende km-prijzen per voertuig gebaseerd op afstand. Voor lange ritten kun je lagere km-prijzen instellen.
                        </p>
                        
                        <!-- Global Distance Threshold -->
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #dee2e6;">
                            <h4 class="text-color">üéØ Afstand Grens</h4>
                            <div style="display: flex; align-items: center; gap: 15px; flex-wrap: wrap;">
                                <div class="flex-center">
                                    <label style="font-weight: 600; color: #2c3e50;">Lange rit vanaf:</label>
                                    <input type="number" id="distanceThreshold" value="" min="50" max="500" step="10"
                                           style="padding: 8px 12px; border-radius: 6px; border: 2px solid #007bff; width: 80px; font-size: 16px; font-weight: 600; text-align: center;"
                                           onchange="updateDistanceExamples()">
                                    <span style="font-weight: 600; color: #2c3e50;">km</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Per-Vehicle Pricing Configuration -->
                        <div id="vehicleDistancePricing">
                            <!-- Vehicle pricing cards will be generated here -->
                        </div>
                        
                        <div id="distancePricingStatus" style="margin-top: 10px; padding: 8px; border-radius: 4px; display: none;">
                            <!-- Status message will be shown here after saving -->
                        </div>
                    </div>
                    
                    <div id="vehiclePricingContainer" style="margin-top: 30px;">
                        <div style="text-align: center; padding: 40px; color: #6c757d; border: 2px dashed #dee2e6; border-radius: 8px;">
                            <h3> Loading vehicles from Types of Vehicles...</h3>
                            <p>Vehicle pricing cards will appear here automatically</p>
                        </div>
                    </div>
                </div>

                <!-- Item Surcharge Section -->
                <div id="item-surcharge-section" class="content-section">
                    <h2>üí∞ Item Surcharge</h2>
                    <p>All prices are displayed in EUR (‚Ç¨) currency.</p>
                    
                    <!-- Fixed Items -->
                    <div style="margin: 30px 0;">
                        <div id="fixedItemsContainer">
                            <!-- Fixed items will be rendered here -->
                        </div>
                    </div>
                    
                    <!-- Additional Options -->
                    <div style="margin: 30px 0;">
                        <h3>Additional options (e.g. Newspaper, Bottle of water, etc.)</h3>
                        <div id="additionalOptionsContainer">
                            <!-- Additional options will be rendered here -->
                        </div>
                        <div style="margin: 20px 0;">
                            <button class="btn btn-success" onclick="addNewSurchargeItem()">+ New</button>
                            <button class="btn btn-primary" onclick="saveSurchargeItems()" style="margin-left: 10px;">üíæ Save</button>
                        </div>
                    </div>
                </div>

                <!-- Location Surcharge Section -->
                <div id="location-surcharge-section" class="content-section">
                    <div style="margin-bottom: 25px;">
                        <h2 style="color: #2c3e50; margin: 0 0 8px 0; font-size: 24px;">üìç Location Surcharge</h2>
                        <p style="color: #7f8c8d; margin: 0 0 20px 0;">Configure location-based pricing adjustments with address and postcode targeting</p>
                        
                        <div style="display: flex; gap: 10px;">
                            <button id="addLocationSurchargeBtn" onclick="
                                try {
                                    console.log('üìç Button clicked, opening modal...');
                                    const modal = document.getElementById('locationSurchargeModal');
                                    if (!modal) {
                                        alert('Modal element not found!');
                                        return;
                                    }
                                    
                                    // Reset form fields to match your original screenshot - with null checks
                                    const priceEl = document.getElementById('locationSurchargePrice');
                                    const nameEl = document.getElementById('locationSurchargeName');
                                    const overrideTaxEl = document.getElementById('overrideTaxRate');
                                    const addToJourneyEl = document.getElementById('addToJourneyPrice');
                                    const displaySummaryEl = document.getElementById('displayInSummary');
                                    const limitLocationEl = document.getElementById('limitToLocation');
                                    const activeEl = document.getElementById('locationSurchargeActive');
                                    const limitsContainer = document.getElementById('locationLimitsContainer');
                                    
                                    if (priceEl) priceEl.value = '';
                                    if (nameEl) nameEl.value = 'Parking';
                                    if (overrideTaxEl) overrideTaxEl.checked = false;
                                    if (addToJourneyEl) addToJourneyEl.checked = false;
                                    if (displaySummaryEl) displaySummaryEl.checked = true;
                                    if (limitLocationEl) limitLocationEl.checked = true;
                                    if (activeEl) activeEl.checked = true;
                                    if (limitsContainer) limitsContainer.style.display = 'block';
                                    
                                    // Auto-populate address fields like your screenshot
                                    const addressList = document.getElementById('addressPostcodeList');
                                    if (addressList) {
                                        addressList.innerHTML = `
                                            <div style='margin-bottom: 10px; padding: 12px; border: 1px solid #ddd; border-radius: 6px; background: white;'>
                                                <div style='display: flex; align-items: center; gap: 8px; margin-bottom: 8px;'>
                                                    <span style='background: #f1f1f1; border: 1px solid #ddd; padding: 8px; border-radius: 4px 0 0 0; font-size: 14px; width: 30px; text-align: center;'>üìç</span>
                                                    <input type='text' placeholder='Address' value='' style='flex: 1; padding: 8px; border: 1px solid #ddd; border-left: none; border-radius: 0; font-size: 14px; outline: none;'>
                                                </div>
                                                <input type='text' placeholder='Postcode' value='' style='width: 100%; padding: 8px; border: 1px solid #ddd; border-top: none; border-radius: 0 0 4px 4px; font-size: 14px; outline: none; box-sizing: border-box;'>
                                            </div>
                                        `;
                                    }
                                    
                                    // Show modal
                                    modal.style.display = 'block';
                                    console.log('‚úÖ Modal opened successfully');
                                } catch (error) {
                                    console.error('‚ùå Error opening modal:', error);
                                    alert('Error opening modal: ' + error.message);
                                }
                            " style="
                                background: #28a745; 
                                color: white; 
                                border: none; 
                                padding: 10px 20px; 
                                border-radius: 6px; 
                                cursor: pointer; 
                                font-size: 14px;
                                display: flex;
                                align-items: center;
                                gap: 8px;
                                font-weight: 600;
                            " title="Click to add new location surcharge">‚ûï Add Location Surcharge</button>
                        </div>
                    </div>
                    
                    <!-- Professional Location Surcharges Table -->
                    <div style="background: white; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); overflow: hidden;">
                        <table style="width: 100%; border-collapse: collapse; font-size: 14px;">
                            <thead style="background: #f8f9fa; border-bottom: 1px solid #dee2e6;">
                                <tr>
                                    <th style="padding: 12px 15px; text-align: left; font-weight: 600; color: #495057; border-right: 1px solid #dee2e6; width: 40px;"></th>
                                    <th style="padding: 12px 15px; text-align: left; font-weight: 600; color: #495057; border-right: 1px solid #dee2e6;">Name</th>
                                    <th style="padding: 12px 15px; text-align: left; font-weight: 600; color: #495057; border-right: 1px solid #dee2e6; width: 100px;">Price</th>
                                    <th style="padding: 12px 15px; text-align: left; font-weight: 600; color: #495057; border-right: 1px solid #dee2e6; width: 80px;">Tax</th>
                                    <th style="padding: 12px 15px; text-align: left; font-weight: 600; color: #495057; border-right: 1px solid #dee2e6;">Restrictions</th>
                                    <th style="padding: 12px 15px; text-align: center; font-weight: 600; color: #495057; width: 80px;">Status</th>
                                </tr>
                            </thead>
                            <tbody id="locationSurchargesTableBody">
                                <!-- Professional rows will be rendered here -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Meet and Greet Section -->
                <div id="meet-and-greet-section" class="content-section">
                    <div style="border-bottom: 2px solid #e1e8ed; margin: 50px 0 50px 0; padding-bottom: 30px;">
                        <h1 style="color: #2c3e50; font-size: 28px; margin-bottom: 15px;">Marcel's Taxi Pro</h1>
                        <h2 style="color: #007bff; font-size: 24px; margin-bottom: 5px;">Professional Admin Panel - üí∞ Pricing</h2>
                        <h3 style="color: #666; font-size: 20px; margin: 0;">ü§ù Meet and Greet Locations</h3>
                    </div>

                    <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #007bff;">
                        <h3>ü§ù Meet and Greet Locatie Beheer</h3>
                        <p style="margin: 10px 0; color: #6c757d;">Voeg luchthavens, stations en hotels toe waar Meet & Greet service beschikbaar is. Het systeem past automatisch de Meet & Greet toeslag toe wanneer iemand boekt vanaf deze locaties.</p>
                    </div>

                    <!-- Connection with Item Surcharge -->
                    <div style="background: #e8f5e9; padding: 15px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #28a745;">
                        <h4 style="color: #155724; margin-bottom: 10px;">üîó Verbinding met Item Surcharge</h4>
                        <p style="margin: 5px 0; color: #155724; font-size: 14px;">
                            <strong>Meet & Greet toeslag:</strong> ‚Ç¨<span id="meetGreetSurchargePrice">5.00</span> 
                            <span id="meetGreetSurchargeStatus" style="margin-left: 10px; padding: 2px 8px; border-radius: 4px; font-size: 12px;"></span>
                        </p>
                        <p style="margin: 0; color: #155724; font-size: 13px;">
                            Deze prijs wordt automatisch toegepast wanneer de ophaallocatie een geregistreerde Meet & Greet locatie is.
                        </p>
                    </div>

                    <!-- Location Types Tabs -->
                    <div class="section-margin-lg">
                        <div style="display: flex; border-bottom: 2px solid #e9ecef;">
                            <button class="location-tab" data-type="airports" onclick="switchLocationTab('airports')" 
                                    style="padding: 12px 24px; border: none; background: #007bff; color: white; border-radius: 8px 8px 0 0; cursor: pointer; font-weight: 600;">
                                ‚úàÔ∏è Luchthavens
                            </button>
                            <button class="location-tab" data-type="stations" onclick="switchLocationTab('stations')" 
                                    style="padding: 12px 24px; border: none; background: #6c757d; color: white; border-radius: 8px 8px 0 0; cursor: pointer; margin-left: 2px;">
                                üöâ Stations
                            </button>
                            <button class="location-tab" data-type="hotels" onclick="switchLocationTab('hotels')" 
                                    style="padding: 12px 24px; border: none; background: #6c757d; color: white; border-radius: 8px 8px 0 0; cursor: pointer; margin-left: 2px;">
                                üè® Hotels
                            </button>
                        </div>
                    </div>

                    <!-- Location Management Container -->
                    <div style="background: white; border: 1px solid #dee2e6; border-radius: 8px; padding: 20px; margin-bottom: 20px;">
                        <div id="airportsTab" class="location-tab-content">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                                <h4 style="color: #2c3e50; margin: 0;">‚úàÔ∏è Luchthaven Locaties</h4>
                                <button class="btn btn-success" onclick="addNewLocation('airports')">+ Nieuwe Luchthaven</button>
                            </div>
                            <div id="airportsList" class="locations-list">
                                <!-- Airport locations will be rendered here -->
                            </div>
                        </div>

                        <div id="stationsTab" class="location-tab-content" style="display: none;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                                <h4 style="color: #2c3e50; margin: 0;">üöâ Station Locaties</h4>
                                <button class="btn btn-success" onclick="addNewLocation('stations')">+ Nieuw Station</button>
                            </div>
                            <div id="stationsList" class="locations-list">
                                <!-- Station locations will be rendered here -->
                            </div>
                        </div>

                        <div id="hotelsTab" class="location-tab-content" style="display: none;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                                <h4 style="color: #2c3e50; margin: 0;">üè® Hotel Locaties</h4>
                                <button class="btn btn-success" onclick="addNewLocation('hotels')">+ Nieuw Hotel</button>
                            </div>
                            <div id="hotelsList" class="locations-list">
                                <!-- Hotel locations will be rendered here -->
                            </div>
                        </div>
                    </div>

                    <!-- Save Button -->
                    <div style="text-align: center; margin-top: 30px;">
                        <button class="btn btn-primary" onclick="saveMeetAndGreetSettings()">
                            üíæ Opslaan Meet & Greet Instellingen
                        </button>
                    </div>

                    <div id="meetGreetStatus" style="margin-top: 20px; padding: 15px; border-radius: 6px; display: none;"></div>
                </div>

                <div id="deposit-payments-section" class="content-section">
                    <h2>üí∞ Deposit Payments</h2>
                    <p>Configure security deposit settings</p>
                </div>

                <!-- Other sections -->
                <div id="cancelled-section" class="content-section">
                    <p style="color: #6c757d; margin: 0 0 20px 0;">Cancelled and deleted bookings</p>
                    <div class="section-toolbar">
                        <div class="btn-group">
                            <button style="background: white; border: 1px solid #dee2e6; padding: 8px 16px; border-radius: 6px; cursor: pointer;" onclick="loadCancelledBookings()">
                                üîÑ <span class="margin-left">Refresh</span>
                            </button>
                            <button style="background: white; border: 1px solid #dee2e6; padding: 8px 16px; border-radius: 6px; cursor: pointer;" onclick="clearAllCancelled()">
                                üóëÔ∏è <span class="margin-left">Clear All</span>
                            </button>
                        </div>
                        <div style="margin-left: auto; display: flex; gap: 10px; align-items: center;">
                            <span id="cancelledCount" style="padding: 8px 12px; background: #dc3545; color: white; border-radius: 4px; font-weight: 500;">0 cancelled</span>
                        </div>
                    </div>
                    
                    <div id="cancelledBookingsContainer" style="background: white; border: 1px solid #dee2e6; border-radius: 8px; overflow: hidden;">
                        <table style="width: 100%; border-collapse: collapse; font-size: 14px;">
                            <thead style="background: #f8f9fa; border-bottom: 2px solid #dee2e6;">
                                <tr>
                                    <th class="table-header" style="width: 60px;">üáßüá™</th>
                                    <th class="table-header">Info</th>
                                    <th class="table-header">Date</th>
                                    <th class="table-header">Status</th>
                                    <th class="table-header">Driver Assignment</th>
                                    <th class="table-header">Vehicle</th>
                                    <th class="table-header">Notes</th>
                                    <th class="table-header" style="text-align: left;">Total</th>
                                    <th class="table-header" style="width: 60px;">‚úâÔ∏è</th>
                                </tr>
                            </thead>
                            <tbody id="cancelledTableBody">
                                <tr>
                                    <td colspan="9" class="empty-state">
                                        Loading cancelled bookings...
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Trash Section -->
                <div id="trash-section" class="content-section">
                    <p style="color: #6c757d; margin: 0 0 20px 0;">Deleted bookings (can be restored or permanently deleted)</p>
                    <div class="section-toolbar">
                        <div class="btn-group">
                            <button style="background: white; border: 1px solid #dee2e6; padding: 8px 16px; border-radius: 6px; cursor: pointer;" onclick="loadTrashItems()">
                                üîÑ <span class="margin-left">Refresh</span>
                            </button>
                            <button style="background: white; border: 1px solid #dee2e6; padding: 8px 16px; border-radius: 6px; cursor: pointer;" onclick="clearAllTrash()">
                                üóëÔ∏è <span class="margin-left">Empty Trash</span>
                            </button>
                            <button style="background: white; border: 1px solid #dee2e6; padding: 8px 16px; border-radius: 6px; cursor: pointer;" onclick="restoreAllTrash()">
                                ‚Ü©Ô∏è <span class="margin-left">Restore All</span>
                            </button>
                        </div>
                        <div style="margin-left: auto; display: flex; gap: 10px; align-items: center;">
                            <span id="trashCount" style="padding: 8px 12px; background: #6c757d; color: white; border-radius: 4px; font-weight: 500;">0 items</span>
                        </div>
                    </div>
                    
                    <div id="trashContainer" style="background: white; border: 1px solid #dee2e6; border-radius: 8px; overflow: hidden;">
                        <table style="width: 100%; border-collapse: collapse; font-size: 14px;">
                            <thead style="background: #f8f9fa; border-bottom: 2px solid #dee2e6;">
                                <tr>
                                    <th class="table-header" style="width: 50px;">üåç</th>
                                    <th class="table-header" style="width: 200px;">Info</th>
                                    <th class="table-header" style="width: 120px;">Date</th>
                                    <th class="table-header" style="width: 100px;">Status</th>
                                    <th class="table-header" style="width: 140px;">Driver</th>
                                    <th class="table-header" style="width: 120px;">Vehicle</th>
                                    <th class="table-header" style="width: 100px;">Notes</th>
                                    <th class="table-header" style="width: 80px;">Total</th>
                                    <th class="table-header" style="width: 50px;">‚úâÔ∏è</th>
                                </tr>
                            </thead>
                            <tbody id="trashTableBody">
                                <tr>
                                    <td colspan="9" class="empty-state">
                                        No items in trash
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- All Bookings Section -->
                <div id="all-bookings-section" class="content-section">
                    <p style="color: #6c757d; margin: 0 0 20px 0;">Complete history of all bookings from customer and dispatch systems</p>
                    <div class="section-toolbar">
                        <div class="btn-group">
                            <button style="background: white; border: 1px solid #dee2e6; padding: 8px 16px; border-radius: 6px; cursor: pointer;" onclick="loadAllBookings()">
                                üîÑ <span class="margin-left">Refresh</span>
                            </button>
                            <select id="allBookingsFilter" onchange="filterAllBookings()" style="padding: 8px 12px; border: 1px solid #dee2e6; border-radius: 6px;">
                                <option value="all">All Bookings</option>
                                <option value="customer">Customer Bookings</option>
                                <option value="dispatch">Dispatch Bookings</option>
                                <option value="confirmed">Confirmed Only</option>
                                <option value="unconfirmed">Unconfirmed Only</option>
                                <option value="cancelled">Cancelled Only</option>
                            </select>
                        </div>
                        <div style="margin-left: auto; display: flex; gap: 10px; align-items: center;">
                            <span id="allBookingsCount" style="padding: 8px 12px; background: #007bff; color: white; border-radius: 4px; font-weight: 500;">0 bookings</span>
                        </div>
                    </div>
                    
                    <div id="allBookingsContainer" style="background: white; border: 1px solid #dee2e6; border-radius: 8px; overflow: visible;">
                        <table style="width: 100%; border-collapse: collapse; font-size: 14px; position: relative;">
                            <thead style="background: #f8f9fa; border-bottom: 2px solid #dee2e6;">
                                <tr>
                                    <th class="table-header" style="width: 100px;">üèÅ View</th>
                                    <th class="table-header" style="width: 180px;">Info</th>
                                    <th class="table-header" style="width: 120px;">Date</th>
                                    <th class="table-header" style="width: 100px;">Status</th>
                                    <th class="table-header" style="width: 140px;">Driver Assignment</th>
                                    <th class="table-header" style="width: 120px;">Vehicle</th>
                                    <th class="table-header" style="width: 150px;">Notes</th>
                                    <th class="table-header" style="width: 80px; text-align: left;">Total</th>
                                    <th class="table-header" style="width: 60px;">Email</th>
                                </tr>
                            </thead>
                            <tbody id="allBookingsTableBody">
                                <tr>
                                    <td colspan="9" class="empty-state">
                                        Loading all bookings...
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Completed Bookings Section -->
                <div id="completed-section" class="content-section">
                    <p style="color: #6c757d; margin: 0 0 20px 0;">Successfully completed trips and services</p>
                    <div class="section-toolbar">
                        <div class="btn-group">
                            <button style="background: white; border: 1px solid #dee2e6; padding: 8px 16px; border-radius: 6px; cursor: pointer;" onclick="loadCompletedBookings()">
                                üîÑ <span class="margin-left">Refresh</span>
                            </button>
                            <button style="background: white; border: 1px solid #dee2e6; padding: 8px 16px; border-radius: 6px; cursor: pointer;" onclick="clearAllCompleted()">
                                üóëÔ∏è <span class="margin-left">Clear All</span>
                            </button>
                        </div>
                        <div style="margin-left: auto; display: flex; gap: 10px; align-items: center;">
                            <span id="completedCount" style="padding: 8px 12px; background: #28a745; color: white; border-radius: 4px; font-weight: 500;">0 completed</span>
                        </div>
                    </div>
                    
                    <div id="completedBookingsContainer" style="background: white; border: 1px solid #dee2e6; border-radius: 8px; overflow: visible;">
                        <table style="width: 100%; border-collapse: collapse; font-size: 14px; position: relative;">
                            <thead style="background: #f8f9fa; border-bottom: 2px solid #dee2e6;">
                                <tr>
                                    <th class="table-header" style="width: 50px;">üåç</th>
                                    <th class="table-header" style="width: 200px;">Info</th>
                                    <th class="table-header" style="width: 120px;">Date</th>
                                    <th class="table-header" style="width: 100px;">Status</th>
                                    <th class="table-header" style="width: 140px;">Driver</th>
                                    <th class="table-header" style="width: 120px;">Vehicle</th>
                                    <th class="table-header" style="width: 100px;">Notes</th>
                                    <th class="table-header" style="width: 80px;">Total</th>
                                    <th class="table-header" style="width: 50px;">‚úâÔ∏è</th>
                                </tr>
                            </thead>
                            <tbody id="completedTableBody">
                                <tr>
                                    <td colspan="9" class="empty-state">
                                        Loading completed bookings...
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div id="users-section" class="content-section">
                    <h2>üë• Users</h2>
                    <p>Manage users, drivers, and administrators</p>
                </div>

                <!-- Drivers Section -->
                <div id="drivers-section" class="content-section">
                    <div style="border-bottom: 2px solid #e1e8ed; margin: 100px 0 50px 0; padding-bottom: 30px;">
                        <h1 style="color: #2c3e50; font-size: 28px; margin-bottom: 15px;">Marcel's Taxi Pro</h1>
                        <h2 style="color: #007bff; font-size: 24px; margin-bottom: 10px;">Professional Driver Management</h2>
                        <h3 style="color: #666; font-size: 20px; margin: 0;">üöñ Complete Driver Administration System</h3>
                    </div>

                    <!-- Driver Stats Cards -->
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 50px;">
                        <div style="background: linear-gradient(135deg, #28a745, #20c997); color: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                            <div style="font-size: 14px; opacity: 0.9;">Totaal Chauffeurs</div>
                            <div style="font-size: 36px; font-weight: bold; margin: 10px 0;" id="totalDriversCount">0</div>
                            <div style="font-size: 12px; opacity: 0.8;">Actieve accounts</div>
                        </div>
                        <div style="background: linear-gradient(135deg, #007bff, #0056b3); color: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                            <div style="font-size: 14px; opacity: 0.9;">Online Nu</div>
                            <div style="font-size: 36px; font-weight: bold; margin: 10px 0;" id="onlineDriversCount">0</div>
                            <div style="font-size: 12px; opacity: 0.8;">Beschikbaar voor ritten</div>
                        </div>
                        <div style="background: linear-gradient(135deg, #ffc107, #ff9800); color: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                            <div style="font-size: 14px; opacity: 0.9;">Bezig met Rit</div>
                            <div style="font-size: 36px; font-weight: bold; margin: 10px 0;" id="busyDriversCount">0</div>
                            <div style="font-size: 12px; opacity: 0.8;">Onderweg naar klanten</div>
                        </div>
                        <div style="background: linear-gradient(135deg, #6c757d, #495057); color: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                            <div style="font-size: 14px; opacity: 0.9;">Documenten Check</div>
                            <div style="font-size: 36px; font-weight: bold; margin: 10px 0;" id="pendingDocsCount">0</div>
                            <div style="font-size: 12px; opacity: 0.8;">Wacht op verificatie</div>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div style="display: flex; gap: 15px; margin-bottom: 30px;">
                        <button onclick="addNewDriverWorking()" style="background: #28a745; color: white; border: none; padding: 12px 24px; border-radius: 8px; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 8px;">
                            <span style="font-size: 20px;">‚ûï</span> Nieuwe Chauffeur Toevoegen
                        </button>
                        <button onclick="window.open('driver-app.html', '_blank')" style="background: #007bff; color: white; border: none; padding: 12px 24px; border-radius: 8px; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 8px;">
                            <span style="font-size: 20px;">üì±</span> Chauffeur App
                        </button>
                        <button onclick="loadDriversList()" style="background: #007bff; color: white; border: none; padding: 12px 24px; border-radius: 8px; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 8px;">
                            <span style="font-size: 20px;">üîÑ</span> Vernieuwen
                        </button>
                        <input type="text" id="driverSearchInput" placeholder="Zoek chauffeur..." onkeyup="searchDrivers(this.value)" style="flex: 1; padding: 12px; border: 2px solid #e1e5e9; border-radius: 8px; font-size: 16px;">
                    </div>

                    <!-- Drivers Table -->
                    <div style="background: white; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); overflow: hidden;">
                        <table class="drivers-table">
                            <thead>
                                <tr>
                                    <th class="col-status">Status</th>
                                    <th class="col-name">Naam</th>
                                    <th class="col-phone">Telefoon</th>
                                    <th class="col-email">Email</th>
                                    <th class="col-vehicle">Voertuig</th>
                                    <th class="col-documents">Documenten</th>
                                    <th class="col-rating">Rating</th>
                                    <th class="col-actions">Acties</th>
                                </tr>
                            </thead>
                            <tbody id="driversTableBody">
                                <!-- Drivers will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Driver Modal -->
                <div id="driverModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; overflow-y: auto;">
                    <div style="background: white; margin: 50px auto; max-width: 800px; border-radius: 12px; padding: 0; max-height: 90vh; overflow-y: auto;">
                        <!-- Modal Header -->
                        <div style="background: linear-gradient(135deg, #2c3e50, #34495e); color: white; padding: 20px; border-radius: 12px 12px 0 0;">
                            <h2 style="margin: 0; font-size: 24px;">üöñ Nieuwe Chauffeur Toevoegen</h2>
                            <button onclick="closeDriverModal()" style="position: absolute; top: 15px; right: 20px; background: none; border: none; color: white; font-size: 24px; cursor: pointer;">‚úï</button>
                        </div>
                        
                        <!-- Modal Content -->
                        <div style="padding: 30px;">
                            <form id="driverForm" onsubmit="saveNewDriver(event)">
                                
                                <!-- Persoonlijke Gegevens -->
                                <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                                    <h3 class="text-color">üë§ Persoonlijke Gegevens</h3>
                                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                                        <div>
                                            <label class="form-label">Voornaam *</label>
                                            <input type="text" id="driverFirstName" required class="input-field">
                                        </div>
                                        <div>
                                            <label class="form-label">Achternaam *</label>
                                            <input type="text" id="driverLastName" required class="input-field">
                                        </div>
                                        <div>
                                            <label class="form-label">Email *</label>
                                            <input type="email" id="driverEmail" required class="input-field">
                                        </div>
                                        <div>
                                            <label class="form-label">Telefoon *</label>
                                            <input type="tel" id="driverPhone" required class="input-field" placeholder="06-12345678">
                                        </div>
                                        <div>
                                            <label class="form-label">Geboortedatum</label>
                                            <input type="date" id="driverBirthDate" class="input-field">
                                        </div>
                                        <div>
                                            <label class="form-label">BSN</label>
                                            <input type="text" id="driverBSN" class="input-field" placeholder="123456789">
                                        </div>
                                    </div>
                                </div>

                                <!-- Adres -->
                                <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                                    <h3 class="text-color">üìç Adres</h3>
                                    <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 15px; margin-bottom: 15px;">
                                        <div>
                                            <label class="form-label">Straatnaam</label>
                                            <input type="text" id="driverStreet" class="input-field">
                                        </div>
                                        <div>
                                            <label class="form-label">Huisnummer</label>
                                            <input type="text" id="driverHouseNumber" class="input-field">
                                        </div>
                                    </div>
                                    <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 15px;">
                                        <div>
                                            <label class="form-label">Postcode</label>
                                            <input type="text" id="driverPostalCode" class="input-field" placeholder="1234AB">
                                        </div>
                                        <div>
                                            <label class="form-label">Plaats</label>
                                            <input type="text" id="driverCity" class="input-field">
                                        </div>
                                    </div>
                                </div>

                                <!-- Documenten -->
                                <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                                    <h3 class="text-color">üìÑ Documenten</h3>
                                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                                        <div>
                                            <label class="form-label">Rijbewijs Nummer</label>
                                            <input type="text" id="driverLicenseNumber" class="input-field">
                                        </div>
                                        <div>
                                            <label class="form-label">Rijbewijs Vervaldatum</label>
                                            <input type="date" id="driverLicenseExpiry" class="input-field">
                                        </div>
                                        <div>
                                            <label class="form-label">Chauffeurspas Nummer</label>
                                            <input type="text" id="driverTaxiPass" class="input-field">
                                        </div>
                                        <div>
                                            <label class="form-label">Chauffeurspas Vervaldatum</label>
                                            <input type="date" id="driverTaxiPassExpiry" class="input-field">
                                        </div>
                                    </div>
                                </div>

                                <!-- Voertuig -->
                                <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                                    <h3 class="text-color"> Voertuig</h3>
                                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                                        <div>
                                            <label class="form-label">Merk</label>
                                            <input type="text" id="driverCarBrand" class="input-field" placeholder="Toyota">
                                        </div>
                                        <div>
                                            <label class="form-label">Model</label>
                                            <input type="text" id="driverCarModel" class="input-field" placeholder="Prius">
                                        </div>
                                        <div>
                                            <label class="form-label">Kenteken</label>
                                            <input type="text" id="driverLicensePlate" class="input-field" placeholder="AB-123-CD">
                                        </div>
                                        <div>
                                            <label class="form-label">Kleur</label>
                                            <input type="text" id="driverCarColor" class="input-field" placeholder="Zwart">
                                        </div>
                                        <div>
                                            <label class="form-label">Aantal Zitplaatsen</label>
                                            <select id="driverSeats" class="input-field">
                                                <option value="4">4 personen</option>
                                                <option value="5">5 personen</option>
                                                <option value="6">6 personen</option>
                                                <option value="7">7 personen</option>
                                                <option value="8">8 personen</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label class="form-label">Voertuig Type</label>
                                            <select id="driverVehicleType" class="input-field">
                                                <option value="sedan">Sedan</option>
                                                <option value="estate">Estate</option>
                                                <option value="minivan">Minivan</option>
                                                <option value="minivan_long">Minivan Long</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>

                                <!-- Account -->
                                <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 30px;">
                                    <h3 class="text-color">üîê Account</h3>
                                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                                        <div>
                                            <label class="form-label">Gebruikersnaam</label>
                                            <input type="text" id="driverUsername" class="input-field">
                                        </div>
                                        <div>
                                            <label class="form-label">Tijdelijk Wachtwoord</label>
                                            <input type="password" id="driverPassword" class="input-field" value="password123">
                                        </div>
                                    </div>
                                </div>

                                <!-- Buttons -->
                                <div style="display: flex; gap: 15px; justify-content: flex-end;">
                                    <button type="button" onclick="closeDriverModal()" style="background: #6c757d; color: white; border: none; padding: 12px 24px; border-radius: 6px; cursor: pointer;">
                                        Annuleren
                                    </button>
                                    <button type="submit" style="background: #28a745; color: white; border: none; padding: 12px 24px; border-radius: 6px; cursor: pointer;">
                                        üíæ Chauffeur Opslaan
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- Payment Methods Section -->
                <div id="payment-methods-section" class="content-section">
                    <div style="background: white; border: 1px solid #dee2e6; border-radius: 8px; padding: 20px; margin: 20px 0;">
                        <h3 class="section-margin">Available Payment Methods</h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                            <div style="border: 1px solid #e9ecef; border-radius: 8px; padding: 15px; text-align: center;">
                                <div style="font-size: 32px; margin-bottom: 10px;">üíµ</div>
                                <h4 style="margin: 0 0 5px 0;">Cash</h4>
                                <p style="margin: 0; font-size: 12px; color: #6c757d;">Pay with cash on delivery</p>
                                <label style="display: flex; align-items: center; justify-content: center; margin-top: 10px;">
                                    <input type="checkbox" checked> Enabled
                                </label>
                            </div>
                            <div style="border: 1px solid #e9ecef; border-radius: 8px; padding: 15px; text-align: center;">
                                <div style="font-size: 32px; margin-bottom: 10px;">üí≥</div>
                                <h4 style="margin: 0 0 5px 0;">Credit Card</h4>
                                <p style="margin: 0; font-size: 12px; color: #6c757d;">Pay with credit/debit card</p>
                                <label style="display: flex; align-items: center; justify-content: center; margin-top: 10px;">
                                    <input type="checkbox" id="creditCardEnabled" checked> Enabled
                                </label>
                                <button onclick="configureCreditCard()" style="margin-top: 10px; background: #007bff; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer;">‚öôÔ∏è Configure</button>
                            </div>
                            <div style="border: 1px solid #e9ecef; border-radius: 8px; padding: 15px; text-align: center;">
                                <div style="font-size: 32px; margin-bottom: 10px;">üÖøÔ∏è</div>
                                <h4 style="margin: 0 0 5px 0;">PayPal</h4>
                                <p style="margin: 0; font-size: 12px; color: #6c757d;">Pay with PayPal account</p>
                                <label style="display: flex; align-items: center; justify-content: center; margin-top: 10px;">
                                    <input type="checkbox" id="paypalEnabled" checked> Enabled
                                </label>
                                <button onclick="configurePayPal()" style="margin-top: 10px; background: #007bff; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer;">‚öôÔ∏è Configure</button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- PayPal Configuration Section -->
                    <div id="paypalConfigSection" style="display: none; background: white; border: 1px solid #dee2e6; border-radius: 8px; padding: 20px; margin: 20px 0;">
                        <h3 style="margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center;">
                            <span>üÖøÔ∏è PayPal Configuration</span>
                            <button onclick="closePayPalConfig()" style="background: #6c757d; color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer; font-size: 14px;">‚úï Close</button>
                        </h3>
                        
                        <form id="paypalConfigForm" onsubmit="savePayPalConfig(event)">
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                                <!-- Left Column -->
                                <div>
                                    <div class="section-margin">
                                        <label class="form-label">Name</label>
                                        <input type="text" id="paypalName" value="PayPal" class="input-field-alt">
                                    </div>
                                    
                                    <div class="section-margin">
                                        <label class="form-label">Description</label>
                                        <textarea id="paypalDescription" style="width: 100%; padding: 8px; border: 1px solid #dee2e6; border-radius: 4px; min-height: 80px;">PayPal</textarea>
                                    </div>
                                    
                                    <div class="section-margin">
                                        <label class="form-label">Environment</label>
                                        <select id="paypalEnvironment" class="input-field-alt">
                                            <option value="sandbox">Sandbox (Test)</option>
                                            <option value="live" selected>Live (Production)</option>
                                        </select>
                                    </div>
                                    
                                    <div class="section-margin">
                                        <label class="form-label">PayPal Business Email *</label>
                                        <input type="email" id="paypalBusinessEmail" required placeholder="your_business@email.com" class="input-field-alt">
                                        <small style="color: #6c757d;">Email address associated with your PayPal business account</small>
                                    </div>
                                    
                                    <div class="section-margin">
                                        <label class="form-label">Currency</label>
                                        <select id="paypalCurrency" class="input-field-alt">
                                            <option value="EUR" selected>Euro (EUR)</option>
                                            <option value="USD">US Dollar (USD)</option>
                                            <option value="GBP">British Pound (GBP)</option>
                                            <option value="CHF">Swiss Franc (CHF)</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <!-- Right Column -->
                                <div>
                                    <div class="section-margin">
                                        <label class="form-label">Language Code</label>
                                        <input type="text" id="paypalLanguage" value="auto" placeholder="auto" class="input-field-alt">
                                        <small style="color: #6c757d;">Use 'auto' for automatic detection or specify: nl_BE, fr_BE, en_US</small>
                                    </div>
                                    
                                    <div class="section-margin">
                                        <label class="form-label">Deposit</label>
                                        <select id="paypalDeposit" class="input-field-alt">
                                            <option value="enabled" selected>Enabled</option>
                                            <option value="disabled">Disabled</option>
                                        </select>
                                    </div>
                                    
                                    <div class="section-margin">
                                        <label class="form-label">Payment Charge Type</label>
                                        <select id="paypalChargeType" onchange="updateChargeTypeLabel()" class="input-field-alt">
                                            <option value="percent" selected>Percent (%)</option>
                                            <option value="fixed">Fixed Amount</option>
                                        </select>
                                    </div>
                                    
                                    <div class="section-margin">
                                        <label class="form-label">Payment Charge Value <span id="chargeUnit">(%)</span></label>
                                        <input type="number" id="paypalChargeValue" value="3.6" step="0.1" min="0" class="input-field-alt">
                                        <small style="color: #6c757d;">Transaction fee to add to the total amount</small>
                                    </div>
                                    
                                    <div class="section-margin">
                                        <label class="form-label">Ordering</label>
                                        <input type="number" id="paypalOrdering" value="2" min="0" class="input-field-alt">
                                        <small style="color: #6c757d;">Display order (lower numbers appear first)</small>
                                    </div>
                                </div>
                            </div>
                            
                            <div style="border-top: 1px solid #dee2e6; margin-top: 20px; padding-top: 20px;">
                                <div class="section-margin">
                                    <label class="flex-center">
                                        <input type="checkbox" id="paypalDefault"> 
                                        <span style="font-weight: 600;">Set as Default Payment Method</span>
                                    </label>
                                </div>
                                
                                <div class="section-margin">
                                    <label class="flex-center">
                                        <input type="checkbox" id="paypalActive" checked> 
                                        <span style="font-weight: 600;">Active</span>
                                    </label>
                                </div>
                                
                                <div class="section-margin-lg">
                                    <label class="form-label">Display</label>
                                    <select id="paypalDisplay" class="input-field-alt">
                                        <option value="frontend_backend" selected>Frontend & Backend</option>
                                        <option value="frontend">Frontend Only</option>
                                        <option value="backend">Backend Only</option>
                                    </select>
                                </div>
                                
                                <div style="display: flex; gap: 10px;">
                                    <button type="submit" style="background: #28a745; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; font-weight: 600;">
                                        üíæ Save PayPal Settings
                                    </button>
                                    <button type="button" onclick="testPayPalConnection()" style="background: #17a2b8; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; font-weight: 600;">
                                        üîß Test Connection
                                    </button>
                                </div>
                            </div>
                        </form>
                    </div>
                    
                    <!-- Credit Card Configuration Section -->
                    <div id="creditCardConfigSection" style="display: none; background: white; border: 1px solid #dee2e6; border-radius: 8px; padding: 20px; margin: 20px 0;">
                        <h3 style="margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center;">
                            <span>üí≥ Credit Card Configuration</span>
                            <button onclick="closeCreditCardConfig()" style="background: #6c757d; color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer; font-size: 14px;">‚úï Close</button>
                        </h3>
                        
                        <form id="creditCardConfigForm" onsubmit="saveCreditCardConfig(event)">
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                                <!-- Left Column -->
                                <div>
                                    <div class="section-margin">
                                        <label class="form-label">Name</label>
                                        <input type="text" id="creditCardName" value="Invoice" class="input-field-alt">
                                    </div>
                                    
                                    <div class="section-margin">
                                        <label class="form-label">Description</label>
                                        <textarea id="creditCardDescription" style="width: 100%; padding: 8px; border: 1px solid #dee2e6; border-radius: 4px; min-height: 80px;">Pay Online: ONLY INVOICE</textarea>
                                    </div>
                                    
                                    <div class="section-margin">
                                        <label class="form-label">Environment</label>
                                        <select id="creditCardEnvironment" class="input-field-alt">
                                            <option value="sandbox">Sandbox (Test)</option>
                                            <option value="live" selected>Live (Production)</option>
                                        </select>
                                    </div>
                                    
                                    <div class="section-margin">
                                        <label class="form-label">Live Publishable Key *</label>
                                        <input type="text" id="creditCardLivePublishableKey" required placeholder="pk_live_..." class="input-field-alt">
                                        <small style="color: #6c757d;">Your live publishable key from payment gateway</small>
                                    </div>
                                    
                                    <div class="section-margin">
                                        <label class="form-label">Live Secret Key *</label>
                                        <input type="password" id="creditCardLiveSecretKey" required placeholder="sk_live_..." class="input-field-alt">
                                        <small style="color: #6c757d;">Your live secret key (stored securely)</small>
                                    </div>
                                    
                                    <div class="section-margin">
                                        <label class="form-label">Strong Customer Authentication (SCA)</label>
                                        <select id="creditCardSCA" class="input-field-alt">
                                            <option value="enabled" selected>Enabled</option>
                                            <option value="disabled">Disabled</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <!-- Right Column -->
                                <div>
                                    <div class="section-margin">
                                        <label class="form-label">Future Payment Usage</label>
                                        <select id="creditCardFuturePayment" class="input-field-alt">
                                            <option value="never" selected>Never</option>
                                            <option value="on_session">On Session</option>
                                            <option value="off_session">Off Session</option>
                                        </select>
                                    </div>
                                    
                                    <div class="section-margin">
                                        <label class="form-label">Payment Capture Method</label>
                                        <select id="creditCardCaptureMethod" class="input-field-alt">
                                            <option value="automatic" selected>Automatic</option>
                                            <option value="manual">Manual</option>
                                        </select>
                                    </div>
                                    
                                    <div class="section-margin">
                                        <label class="form-label">Currency</label>
                                        <select id="creditCardCurrency" class="input-field-alt">
                                            <option value="EUR" selected>Euro (EUR)</option>
                                            <option value="USD">US Dollar (USD)</option>
                                            <option value="GBP">British Pound (GBP)</option>
                                            <option value="CHF">Swiss Franc (CHF)</option>
                                        </select>
                                    </div>
                                    
                                    <div class="section-margin">
                                        <label class="form-label">Language Code</label>
                                        <input type="text" id="creditCardLanguage" value="auto" placeholder="auto" class="input-field-alt">
                                        <small style="color: #6c757d;">Use 'auto' for automatic detection</small>
                                    </div>
                                    
                                    <div class="section-margin">
                                        <label class="form-label">Deposit</label>
                                        <select id="creditCardDeposit" class="input-field-alt">
                                            <option value="disabled" selected>Disabled</option>
                                            <option value="enabled">Enabled</option>
                                        </select>
                                    </div>
                                    
                                    <div class="section-margin">
                                        <label class="form-label">Payment Charge Type</label>
                                        <select id="creditCardChargeType" onchange="updateCreditCardChargeTypeLabel()" class="input-field-alt">
                                            <option value="percent" selected>Percent (%)</option>
                                            <option value="fixed">Fixed Amount (‚Ç¨)</option>
                                        </select>
                                    </div>
                                    
                                    <div class="section-margin">
                                        <label class="form-label">Payment Charge Value <span id="creditCardChargeUnit">(%)</span></label>
                                        <input type="number" id="creditCardChargeValue" value="6" min="0" step="0.01" class="input-field-alt">
                                    </div>
                                    
                                    <div class="section-margin">
                                        <label class="form-label">Ordering</label>
                                        <input type="number" id="creditCardOrdering" value="10" min="0" class="input-field-alt">
                                    </div>
                                    
                                    <div class="section-margin">
                                        <label class="flex-center">
                                            <input type="checkbox" id="creditCardDefault">
                                            <span>Default Payment Method</span>
                                        </label>
                                    </div>
                                    
                                    <div class="section-margin">
                                        <label class="flex-center">
                                            <input type="checkbox" id="creditCardActive" checked>
                                            <span>Active</span>
                                        </label>
                                    </div>
                                </div>
                            </div>
                            
                            <div style="grid-column: 1 / -1; margin-top: 20px;">
                                <div class="section-margin-lg">
                                    <label class="form-label">Display</label>
                                    <select id="creditCardDisplay" class="input-field-alt">
                                        <option value="frontend_backend" selected>Frontend & Backend</option>
                                        <option value="frontend">Frontend Only</option>
                                        <option value="backend">Backend Only</option>
                                    </select>
                                </div>
                                
                                <div style="display: flex; gap: 10px;">
                                    <button type="submit" style="background: #28a745; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; font-weight: 600;">
                                        üíæ Save Credit Card Settings
                                    </button>
                                    <button type="button" onclick="testCreditCardConnection()" style="background: #17a2b8; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; font-weight: 600;">
                                        üîß Test Connection
                                    </button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>

                <div id="feedback-section" class="content-section">
                    <h2>üí¨ Customer Feedback</h2>
                    <p>View and manage customer feedback</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Booking Edit Modal -->
    <div class="modal-overlay" id="bookingEditModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üìù Edit Booking - <span id="modalBookingId">BK123456</span></h2>
                <button class="modal-close" onclick="closeBookingModal()">&times;</button>
            </div>
            
            <div class="modal-body">
                <!-- Customer Information -->
                <div class="edit-section">
                    <h3>üë§ Customer Information</h3>
                    <div class="edit-row">
                        <div class="edit-field">
                            <label>First Name</label>
                            <input type="text" id="editFirstName" placeholder="Enter first name">
                        </div>
                        <div class="edit-field">
                            <label>Last Name</label>
                            <input type="text" id="editLastName" placeholder="Enter last name">
                        </div>
                    </div>
                    <div class="edit-row">
                        <div class="edit-field">
                            <label>Email Address</label>
                            <input type="email" id="editEmail" placeholder="customer@email.com">
                        </div>
                        <div class="edit-field">
                            <label>Phone Number</label>
                            <input type="tel" id="editPhone" placeholder="+32 xxx xx xx xx">
                        </div>
                    </div>
                    <div class="edit-row">
                        <div class="edit-field">
                            <label>Number of Passengers</label>
                            <select id="editPassengers">
                                <option value="1">1 Passenger</option>
                                <option value="2">2 Passengers</option>
                                <option value="3">3 Passengers</option>
                                <option value="4">4 Passengers</option>
                                <option value="5">5 Passengers</option>
                                <option value="6">6 Passengers</option>
                                <option value="7">7 Passengers</option>
                                <option value="8">8 Passengers</option>
                            </select>
                        </div>
                        <div class="edit-field">
                            <label>Payment Method</label>
                            <select id="editPaymentMethod">
                                <option value="cash">Cash</option>
                                <option value="card">Credit Card</option>
                                <option value="paypal">PayPal</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Trip Information -->
                <div class="edit-section">
                    <h3> Trip Information</h3>
                    <div class="edit-row">
                        <div class="edit-field">
                            <label>From Location</label>
                            <input type="text" id="editFromLocation" placeholder="Pickup address">
                        </div>
                        <div class="edit-field">
                            <label>To Location</label>
                            <input type="text" id="editToLocation" placeholder="Destination address">
                        </div>
                    </div>
                    <div class="edit-row">
                        <div class="edit-field" style="width: 100%;">
                            <label>Extra Stops</label>
                            <div id="editExtraStopsDisplay" style="padding: 10px; background: #f8f9fa; border-radius: 6px; min-height: 40px; color: #666;">No extra stops</div>
                        </div>
                    </div>
                    <div class="edit-row">
                        <div class="edit-field">
                            <label>Travel Date</label>
                            <input type="date" id="editTravelDate">
                        </div>
                        <div class="edit-field">
                            <label>Travel Time</label>
                            <input type="time" id="editTravelTime">
                        </div>
                    </div>
                    <div class="edit-row">
                        <div class="edit-field">
                            <label>Vehicle Type</label>
                            <select id="editVehicleType">
                                <option value="saloon">Saloon</option>
                                <option value="estate">Estate</option>
                                <option value="minivan">Minivan</option>
                                <option value="minivan_long">Minivan Long</option>
                            </select>
                        </div>
                        <div class="edit-field">
                            <label>Return Trip</label>
                            <select id="editReturnTrip">
                                <option value="false">One Way</option>
                                <option value="true">Return Trip</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Booking Details -->
                <div class="edit-section">
                    <h3>üìã Booking Details</h3>
                    <div class="edit-row">
                        <div class="edit-field">
                            <label>Booking Status</label>
                            <select id="editBookingStatus">
                                <option value="unconfirmed">Unconfirmed</option>
                                <option value="confirmed">Confirmed</option>
                                <option value="completed">Completed</option>
                                <option value="cancelled">Cancelled</option>
                            </select>
                        </div>
                        <div class="edit-field">
                            <label>Price (‚Ç¨)</label>
                            <input type="number" id="editPrice" step="0.01" placeholder="50.00">
                        </div>
                    </div>
                    <div class="edit-row">
                        <div class="edit-field">
                            <label>Driver</label>
                            <input type="text" id="editDriver" placeholder="Assign driver">
                        </div>
                    </div>
                    <div class="edit-field">
                        <label>Special Instructions</label>
                        <textarea id="editSpecialInstructions" rows="3" placeholder="Add any special instructions or notes..."></textarea>
                    </div>
                </div>

                <!-- Surcharges Section -->
                <div class="edit-section">
                    <h3>üí∞ Surcharges</h3>
                    <div id="editSurchargesList" class="section-margin">
                        <!-- Surcharges will be populated here -->
                    </div>
                    <button type="button" class="add-surcharge-btn" onclick="addNewSurcharge()" style="background: #007bff; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 14px;">
                        ‚ûï Add item
                    </button>
                </div>
            </div>

            <div class="modal-actions">
                <button class="modal-btn modal-btn-secondary" onclick="closeBookingModal()">Cancel</button>
                <button class="modal-btn modal-btn-danger" onclick="deleteBooking()">Delete Booking</button>
                <button class="modal-btn modal-btn-success" onclick="confirmBookingFromModal()">‚úÖ Confirm Booking</button>
                <button class="modal-btn modal-btn-primary" onclick="saveBookingChanges()">üíæ Save Changes</button>
            </div>
        </div>
    </div>

    <!-- üÜï BOOKING DETAIL OVERVIEW MODAL -->
    <div id="bookingOverviewModal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 700px; max-height: 90vh; overflow-y: auto;">
            <div class="modal-header" style="background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%); color: white; text-align: center; padding: 20px;">
                <h2 style="margin: 0; font-size: 24px; font-weight: 700;">üìã Booking Overview</h2>
                <div style="font-size: 16px; margin-top: 5px; opacity: 0.9;" id="overviewBookingId">BK123456</div>
                <button class="modal-close" onclick="closeBookingOverview()" style="position: absolute; top: 15px; right: 20px; background: none; border: none; color: white; font-size: 28px; cursor: pointer;">&times;</button>
            </div>
            
            <div class="modal-body" style="padding: 25px;">
                <div id="adminBookingOverviewContent">
                    <!-- Content will be generated here -->
                </div>
            </div>

            <div class="modal-actions" style="padding: 20px; border-top: 1px solid #dee2e6; text-align: center;">
                <button class="modal-btn modal-btn-secondary" onclick="closeBookingOverview()" style="margin-right: 10px;">Close</button>
                <button class="modal-btn modal-btn-primary" onclick="editBookingFromOverview()" style="background: #007bff; color: white; padding: 12px 24px; border: none; border-radius: 6px; cursor: pointer;">‚úèÔ∏è Edit Booking</button>
            </div>
        </div>
    </div>

    <!-- üÜï COMPREHENSIVE DRIVER MODAL -->
    <div id="addDriverModal" class="modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 9999; overflow-y: auto;">
        <div class="modal-content" style="max-width: 900px; max-height: 90vh; overflow-y: auto; margin: 20px auto; background: white; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.3);">
            <div class="modal-header" style="background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%); color: white; text-align: center; padding: 20px;">
                <h2 style="margin: 0; font-size: 24px; font-weight: 700;">üë§ Nieuwe Chauffeur Toevoegen</h2>
                <button class="modal-close" onclick="closeDriverModal()" style="position: absolute; top: 15px; right: 20px; background: none; border: none; color: white; font-size: 28px; cursor: pointer;">&times;</button>
            </div>
            
            <form id="addDriverForm" class="modal-body" style="padding: 25px;">
                <!-- Personal Details Section -->
                <div class="driver-form-section" style="margin-bottom: 25px; background: #f8f9fa; padding: 20px; border-radius: 8px;">
                    <h3 style="margin: 0 0 20px 0; color: #2c3e50; font-size: 18px; font-weight: 600;">üìù Persoonlijke Gegevens</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                        <div>
                            <label class="form-label-gray">Voornaam *</label>
                            <input type="text" id="driverFirstName" required class="input-large">
                        </div>
                        <div>
                            <label class="form-label-gray">Achternaam *</label>
                            <input type="text" id="driverLastName" required class="input-large">
                        </div>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                        <div>
                            <label class="form-label-gray">Email *</label>
                            <input type="email" id="driverEmail" required class="input-large">
                        </div>
                        <div>
                            <label class="form-label-gray">Telefoon *</label>
                            <input type="tel" id="driverPhone" required class="input-large">
                        </div>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div>
                            <label class="form-label-gray">Geboortedatum</label>
                            <input type="date" id="driverBirthDate" class="input-large">
                        </div>
                        <div>
                            <label class="form-label-gray">BSN</label>
                            <input type="text" id="driverBSN" class="input-large">
                        </div>
                    </div>
                </div>

                <!-- Address Section -->
                <div class="driver-form-section" style="margin-bottom: 25px; background: #f8f9fa; padding: 20px; border-radius: 8px;">
                    <h3 style="margin: 0 0 20px 0; color: #2c3e50; font-size: 18px; font-weight: 600;">üè† Adresgegevens</h3>
                    <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 15px; margin-bottom: 15px;">
                        <div>
                            <label class="form-label-gray">Straatnaam *</label>
                            <input type="text" id="driverStreet" required class="input-large">
                        </div>
                        <div>
                            <label class="form-label-gray">Huisnummer *</label>
                            <input type="text" id="driverHouseNumber" required class="input-large">
                        </div>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div>
                            <label class="form-label-gray">Postcode *</label>
                            <input type="text" id="driverPostalCode" required class="input-large">
                        </div>
                        <div>
                            <label class="form-label-gray">Plaats *</label>
                            <input type="text" id="driverCity" required class="input-large">
                        </div>
                    </div>
                </div>

                <!-- Documents Section -->
                <div class="driver-form-section" style="margin-bottom: 25px; background: #f8f9fa; padding: 20px; border-radius: 8px;">
                    <h3 style="margin: 0 0 20px 0; color: #2c3e50; font-size: 18px; font-weight: 600;">üìÑ Documenten</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                        <div>
                            <label class="form-label-gray">Rijbewijs Nummer *</label>
                            <input type="text" id="driverLicenseNumber" required class="input-large">
                        </div>
                        <div>
                            <label class="form-label-gray">Rijbewijs Vervaldatum *</label>
                            <input type="date" id="driverLicenseExpiry" required class="input-large">
                        </div>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div>
                            <label class="form-label-gray">Chauffeurspas Nummer *</label>
                            <input type="text" id="taxiPassNumber" required class="input-large">
                        </div>
                        <div>
                            <label class="form-label-gray">Chauffeurspas Vervaldatum *</label>
                            <input type="date" id="taxiPassExpiry" required class="input-large">
                        </div>
                    </div>
                </div>

                <!-- Vehicle Section -->
                <div class="driver-form-section" style="margin-bottom: 25px; background: #f8f9fa; padding: 20px; border-radius: 8px;">
                    <h3 style="margin: 0 0 20px 0; color: #2c3e50; font-size: 18px; font-weight: 600;"> Voertuiggegevens</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                        <div>
                            <label class="form-label-gray">Merk *</label>
                            <input type="text" id="vehicleBrand" required class="input-large">
                        </div>
                        <div>
                            <label class="form-label-gray">Model *</label>
                            <input type="text" id="vehicleModel" required class="input-large">
                        </div>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                        <div>
                            <label class="form-label-gray">Kenteken *</label>
                            <input type="text" id="vehicleLicensePlate" required class="input-large">
                        </div>
                        <div>
                            <label class="form-label-gray">Kleur</label>
                            <input type="text" id="vehicleColor" class="input-large">
                        </div>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div>
                            <label class="form-label-gray">Aantal zitplaatsen</label>
                            <select id="vehicleSeats" class="input-large">
                                <option value="4">4 zitplaatsen</option>
                                <option value="5">5 zitplaatsen</option>
                                <option value="6">6 zitplaatsen</option>
                                <option value="7">7 zitplaatsen</option>
                                <option value="8">8 zitplaatsen</option>
                            </select>
                        </div>
                        <div>
                            <label class="form-label-gray">Type voertuig</label>
                            <select id="vehicleType" class="input-large">
                                <option value="sedan">Sedan</option>
                                <option value="estate">Estate</option>
                                <option value="minivan">Minivan</option>
                                <option value="minivan_long">Minivan Long</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Account Section -->
                <div class="driver-form-section" style="margin-bottom: 25px; background: #f8f9fa; padding: 20px; border-radius: 8px;">
                    <h3 style="margin: 0 0 20px 0; color: #2c3e50; font-size: 18px; font-weight: 600;">üîê Account Gegevens</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div>
                            <label class="form-label-gray">Gebruikersnaam *</label>
                            <input type="text" id="driverUsername" required class="input-large">
                        </div>
                        <div>
                            <label class="form-label-gray">Wachtwoord *</label>
                            <input type="password" id="driverPassword" required class="input-large">
                        </div>
                    </div>
                </div>
            </form>

            <div class="modal-actions" style="padding: 20px; border-top: 1px solid #dee2e6; text-align: center; background: #f8f9fa;">
                <button type="button" onclick="closeDriverModal()" style="background: #6c757d; color: white; border: none; padding: 12px 24px; border-radius: 6px; cursor: pointer; margin-right: 10px; font-size: 14px;">
                    ‚ùå Annuleren
                </button>
                <button type="button" onclick="saveNewDriver()" style="background: #28a745; color: white; border: none; padding: 12px 24px; border-radius: 6px; cursor: pointer; font-size: 14px;">
                    ‚úÖ Chauffeur Toevoegen
                </button>
            </div>
        </div>
    </div>

    <script>
        console.log('üöÄ Admin panel JavaScript loaded');
        
        // Define critical functions immediately to prevent "not defined" errors
        window.toggleMenu = function(menuName) {
            
            const menu = document.getElementById(menuName + '-menu');
            if (!menu) {
                console.error('‚ùå Menu not found:', menuName + '-menu');
                return;
            }
            
            
            // Close other menus
            const allMenus = document.querySelectorAll('.nav-submenu');
            allMenus.forEach(m => {
                if (m.id !== menuName + '-menu') {
                    m.classList.remove('show');
                }
            });
            
            // Toggle current menu
            const isVisible = menu.classList.contains('show');
            if (isVisible) {
                menu.classList.remove('show');
                console.log('‚ùå Menu hidden:', menuName);
            } else {
                menu.classList.add('show');
                console.log('‚úÖ Menu shown:', menuName);
            }
        };
        
        window.showSection = function(sectionName) {
            
            // Hide all sections
            const sections = document.querySelectorAll('.content-section');
            sections.forEach(section => {
                section.classList.remove('active');
            });
            
            // Show target section
            const targetSection = document.getElementById(sectionName + '-section');
            if (targetSection) {
                targetSection.classList.add('active');
                const pageTitle = document.getElementById('pageTitle');
                if (pageTitle) {
                    // Betere titels voor verschillende secties
                    const titleMap = {
                        'unconfirmed': 'üìã Unconfirmed Bookings',
                        'next-24h': 'üìã Next 24 Hours',
                        'latest': 'üìã Latest Bookings',
                        'completed': '‚úÖ Completed Bookings',
                        'cancelled': '‚ùå Cancelled Bookings',
                        'all-bookings': 'üìã All Bookings',
                        'trash': 'üóëÔ∏è Trash',
                        'distance-time': 'üí∞ Distance & Time Pricing',
                        'dispatch': 'üö® Dispatch Center',
                        'drivers': ' TEST - Driver Management',
                        'vehicle-manager': ' Vehicle Manager',
                        'general': '‚öôÔ∏è General Settings',
                        'mail': 'üìß Email Settings',
                        'item-surcharge': 'üí∞ Item Surcharge',
                        'location-surcharge': 'üìç Location Surcharge',
                        'payment-methods': 'üí≥ Payment Methods'
                    };
                    
                    pageTitle.textContent = titleMap[sectionName] || sectionName.charAt(0).toUpperCase() + sectionName.slice(1);
                    
                    // Set subtitle
                    const pageSubtitle = document.getElementById('pageSubtitle');
                    const subtitleMap = {
                        'next-24h': 'Confirmed bookings for the next 24 hours',
                        'unconfirmed': 'New bookings awaiting confirmation',
                        'latest': 'Most recent booking requests',
                        'completed': 'Successfully completed trips and services',
                        'cancelled': 'Cancelled and deleted bookings',
                        'all-bookings': 'Complete history of all bookings from customer and dispatch systems',
                        'trash': 'Deleted bookings (can be restored or permanently deleted)',
                        'distance-time': 'Configure pricing for each vehicle type - prices will be used in the booking system',
                        'dispatch': 'Manual taxi booking and dispatch system'
                    };
                    
                    if (pageSubtitle) {
                        pageSubtitle.textContent = subtitleMap[sectionName] || '';
                    }
                }
                
                // Special section loading
                if (sectionName === 'distance-time') {
                    setTimeout(() => loadVehiclePricing(), 200);
                }
                if (sectionName === 'unconfirmed') {
                    setTimeout(() => loadUnconfirmedBookingsV2(), 200);
                }
                if (sectionName === 'next-24h') {
                    setTimeout(() => loadNext24hBookings(), 200);
                }
                if (sectionName === 'cancelled') {
                    setTimeout(() => loadCancelledBookings(), 200);
                }
            } else {
                console.error('‚ùå Section not found:', sectionName + '-section');
            }
        };

        // Removed duplicate functions - using window properties above

        function updateTestResults(message) {
            const timestamp = new Date().toLocaleTimeString();
            console.log(`[${timestamp}] ${message}`);
            
            // Try to find test results div, if not found, just log to console
            const results = document.getElementById('testResults');
            if (results) {
                results.innerHTML = `[${timestamp}] ${message}<br>${results.innerHTML}`;
            }
        }

        // Status Dropdown Functions
        
        function changeBookingStatus(bookingId, newStatus) {
            console.log('Changing booking status:', bookingId, 'to', newStatus);
            
            // Find the booking in all possible lists
            let booking = null;
            let sourceList = '';
            
            // Check unconfirmed bookings
            let unconfirmedBookings = JSON.parse(localStorage.getItem('unconfirmedBookings') || '[]');
            let bookingIndex = unconfirmedBookings.findIndex(b => b.bookingId === bookingId);
            if (bookingIndex !== -1) {
                booking = unconfirmedBookings[bookingIndex];
                sourceList = 'unconfirmed';
            }
            
            // Check confirmed bookings
            if (!booking) {
                let confirmedBookings = JSON.parse(localStorage.getItem('confirmedBookings') || '[]');
                bookingIndex = confirmedBookings.findIndex(b => b.bookingId === bookingId);
                if (bookingIndex !== -1) {
                    booking = confirmedBookings[bookingIndex];
                    sourceList = 'confirmed';
                }
            }
            
            if (!booking) {
                console.error('Booking not found:', bookingId);
                return;
            }
            
            // Update booking status
            booking.status = newStatus;
            booking.statusUpdatedAt = new Date().toISOString();
            
            // Move booking to appropriate list based on new status
            if (newStatus === 'confirmed' && sourceList === 'unconfirmed') {
                // Move from unconfirmed to confirmed
                unconfirmedBookings.splice(bookingIndex, 1);
                let confirmedBookings = JSON.parse(localStorage.getItem('confirmedBookings') || '[]');
                confirmedBookings.unshift(booking);
                localStorage.setItem('unconfirmedBookings', JSON.stringify(unconfirmedBookings));
                localStorage.setItem('confirmedBookings', JSON.stringify(confirmedBookings));
            } else if (newStatus === 'unconfirmed' && sourceList === 'confirmed') {
                // Move from confirmed to unconfirmed
                let confirmedBookings = JSON.parse(localStorage.getItem('confirmedBookings') || '[]');
                confirmedBookings.splice(bookingIndex, 1);
                unconfirmedBookings.unshift(booking);
                localStorage.setItem('confirmedBookings', JSON.stringify(confirmedBookings));
                localStorage.setItem('unconfirmedBookings', JSON.stringify(unconfirmedBookings));
            } else if (['cancelled', 'driver_cancelled', 'no_show'].includes(newStatus)) {
                // Move to cancelled
                if (sourceList === 'unconfirmed') {
                    unconfirmedBookings.splice(bookingIndex, 1);
                    localStorage.setItem('unconfirmedBookings', JSON.stringify(unconfirmedBookings));
                } else if (sourceList === 'confirmed') {
                    let confirmedBookings = JSON.parse(localStorage.getItem('confirmedBookings') || '[]');
                    confirmedBookings.splice(bookingIndex, 1);
                    localStorage.setItem('confirmedBookings', JSON.stringify(confirmedBookings));
                }
                let cancelledBookings = JSON.parse(localStorage.getItem('cancelledBookings') || '[]');
                cancelledBookings.unshift(booking);
                localStorage.setItem('cancelledBookings', JSON.stringify(cancelledBookings));
            } else if (newStatus === 'completed') {
                // Move to completed
                if (sourceList === 'unconfirmed') {
                    unconfirmedBookings.splice(bookingIndex, 1);
                    localStorage.setItem('unconfirmedBookings', JSON.stringify(unconfirmedBookings));
                } else if (sourceList === 'confirmed') {
                    let confirmedBookings = JSON.parse(localStorage.getItem('confirmedBookings') || '[]');
                    confirmedBookings.splice(bookingIndex, 1);
                    localStorage.setItem('confirmedBookings', JSON.stringify(confirmedBookings));
                }
                let completedBookings = JSON.parse(localStorage.getItem('completedBookings') || '[]');
                completedBookings.unshift(booking);
                localStorage.setItem('completedBookings', JSON.stringify(completedBookings));
            } else {
                // Update in place
                if (sourceList === 'unconfirmed') {
                    unconfirmedBookings[bookingIndex] = booking;
                    localStorage.setItem('unconfirmedBookings', JSON.stringify(unconfirmedBookings));
                } else if (sourceList === 'confirmed') {
                    let confirmedBookings = JSON.parse(localStorage.getItem('confirmedBookings') || '[]');
                    confirmedBookings[bookingIndex] = booking;
                    localStorage.setItem('confirmedBookings', JSON.stringify(confirmedBookings));
                }
            }
            
            // Close dropdown
            const dropdown = document.getElementById(`statusDropdown_${bookingId}`);
            if (dropdown) {
                dropdown.classList.remove('show');
            }
            
            // Reload the current section
            const currentSection = document.querySelector('.content-section.active');
            if (currentSection) {
                const sectionId = currentSection.id;
                if (sectionId === 'unconfirmed-section') {
                    loadUnconfirmedBookingsV2();
                } else if (sectionId === 'next-24h-section') {
                    loadNext24hBookings();
                }
            }
            
            console.log('‚úÖ Status updated to:', newStatus);
        }
        
        // Close dropdowns when clicking outside
        document.addEventListener('click', function(e) {
            if (!e.target.closest('.status-dropdown') && !e.target.closest('.driver-dropdown')) {
                document.querySelectorAll('.status-dropdown-menu').forEach(menu => {
                    menu.classList.remove('show');
                });
                document.querySelectorAll('.driver-dropdown-menu').forEach(menu => {
                    menu.classList.remove('show');
                });
            }
        });

        // Driver Assignment Functions
        function toggleDriverDropdown(bookingId) {
            console.log('Toggling driver dropdown for booking:', bookingId);
            
            const badge = document.getElementById(`driverBadge_${bookingId}`);
            const dropdown = document.getElementById(`driverDropdown_${bookingId}`);
            
            if (!badge || !dropdown) {
                console.error('Driver dropdown elements not found:', bookingId);
                return;
            }
            
            // Close all other dropdowns first
            document.querySelectorAll('.driver-dropdown-menu').forEach(menu => {
                if (menu.id !== `driverDropdown_${bookingId}`) {
                    menu.classList.remove('show');
                }
            });
            
            // Close status dropdowns too
            document.querySelectorAll('.status-dropdown-menu').forEach(menu => {
                menu.classList.remove('show');
            });
            
            // Calculate position for fixed positioning
            const rect = badge.getBoundingClientRect();
            const isOpen = dropdown.classList.contains('show');
            
            if (!isOpen) {
                // Position dropdown below the badge
                dropdown.style.top = (rect.bottom + window.scrollY + 2) + 'px';
                dropdown.style.left = rect.left + 'px';
                dropdown.classList.add('show');
                console.log('‚úÖ Driver dropdown opened at position:', dropdown.style.left, dropdown.style.top);
            } else {
                dropdown.classList.remove('show');
                console.log('‚úÖ Driver dropdown closed');
            }
        }

        function assignDriverToBooking(bookingId, driverId, driverName) {
            console.log('Assigning driver:', driverId, driverName, 'to booking:', bookingId);
            
            // Find the booking in all possible lists
            let booking = null;
            let sourceList = '';
            
            // Check unconfirmed bookings
            let unconfirmedBookings = JSON.parse(localStorage.getItem('unconfirmedBookings') || '[]');
            let bookingIndex = unconfirmedBookings.findIndex(b => b.bookingId === bookingId);
            if (bookingIndex !== -1) {
                booking = unconfirmedBookings[bookingIndex];
                sourceList = 'unconfirmed';
            }
            
            // Check confirmed bookings
            if (!booking) {
                let confirmedBookings = JSON.parse(localStorage.getItem('confirmedBookings') || '[]');
                bookingIndex = confirmedBookings.findIndex(b => b.bookingId === bookingId);
                if (bookingIndex !== -1) {
                    booking = confirmedBookings[bookingIndex];
                    sourceList = 'confirmed';
                }
            }
            
            if (!booking) {
                console.error('Booking not found:', bookingId);
                return;
            }
            
            // Update booking with driver assignment
            booking.assignedDriver = {
                id: driverId,
                name: driverName,
                assignedAt: new Date().toISOString()
            };
            
            // Save back to appropriate list
            if (sourceList === 'unconfirmed') {
                unconfirmedBookings[bookingIndex] = booking;
                localStorage.setItem('unconfirmedBookings', JSON.stringify(unconfirmedBookings));
            } else if (sourceList === 'confirmed') {
                let confirmedBookings = JSON.parse(localStorage.getItem('confirmedBookings') || '[]');
                confirmedBookings[bookingIndex] = booking;
                localStorage.setItem('confirmedBookings', JSON.stringify(confirmedBookings));
            }
            
            // Update the UI
            const driverBadge = document.getElementById(`driverBadge_${bookingId}`);
            if (driverBadge) {
                driverBadge.textContent = driverName;
                driverBadge.className = 'driver-badge assigned';
            }
            
            // Close the dropdown
            const dropdown = document.getElementById(`driverDropdown_${bookingId}`);
            if (dropdown) {
                dropdown.classList.remove('show');
            }
            
            console.log('‚úÖ Driver assigned successfully');
        }

        function unassignDriver(bookingId) {
            console.log('Unassigning driver from booking:', bookingId);
            
            // Find the booking in all possible lists
            let booking = null;
            let sourceList = '';
            
            // Check unconfirmed bookings
            let unconfirmedBookings = JSON.parse(localStorage.getItem('unconfirmedBookings') || '[]');
            let bookingIndex = unconfirmedBookings.findIndex(b => b.bookingId === bookingId);
            if (bookingIndex !== -1) {
                booking = unconfirmedBookings[bookingIndex];
                sourceList = 'unconfirmed';
            }
            
            // Check confirmed bookings
            if (!booking) {
                let confirmedBookings = JSON.parse(localStorage.getItem('confirmedBookings') || '[]');
                bookingIndex = confirmedBookings.findIndex(b => b.bookingId === bookingId);
                if (bookingIndex !== -1) {
                    booking = confirmedBookings[bookingIndex];
                    sourceList = 'confirmed';
                }
            }
            
            if (!booking) {
                console.error('Booking not found:', bookingId);
                return;
            }
            
            // Remove driver assignment
            delete booking.assignedDriver;
            
            // Save back to appropriate list
            if (sourceList === 'unconfirmed') {
                unconfirmedBookings[bookingIndex] = booking;
                localStorage.setItem('unconfirmedBookings', JSON.stringify(unconfirmedBookings));
            } else if (sourceList === 'confirmed') {
                let confirmedBookings = JSON.parse(localStorage.getItem('confirmedBookings') || '[]');
                confirmedBookings[bookingIndex] = booking;
                localStorage.setItem('confirmedBookings', JSON.stringify(confirmedBookings));
            }
            
            // Update the UI
            const driverBadge = document.getElementById(`driverBadge_${bookingId}`);
            if (driverBadge) {
                driverBadge.textContent = 'Assign Driver';
                driverBadge.className = 'driver-badge unassigned';
            }
            
            // Close the dropdown
            const dropdown = document.getElementById(`driverDropdown_${bookingId}`);
            if (dropdown) {
                dropdown.classList.remove('show');
            }
            
            console.log('‚úÖ Driver unassigned successfully');
        }

        function logout() {
            if (confirm('Are you sure you want to sign out?')) {
                window.location.href = '/';
            }
        }

        // Vehicle Pricing System Functions
        function loadVehiclePricing() {
            console.log('üîÑ Loading vehicle pricing from Types of Vehicles...');
            updateTestResults('üîÑ Loading vehicles from Types of Vehicles...');
            
            // Load distance threshold setting - do this FIRST
            const savedThreshold = localStorage.getItem('distanceThreshold') || '100';
            const thresholdInput = document.getElementById('distanceThreshold');
            if (thresholdInput) {
                thresholdInput.value = savedThreshold;
                console.log('‚úÖ Loaded distance threshold:', savedThreshold + ' km');
                // Also trigger update to refresh all labels
                setTimeout(() => {
                    updateDistanceExamples();
                }, 100);
            }
            
            // Load vehicles from Types of Vehicles admin panel
            const savedVehicles = localStorage.getItem('taxiVehicles');
            let vehicles = [];
            
            if (savedVehicles) {
                try {
                    vehicles = JSON.parse(savedVehicles);
                    console.log('‚úÖ Loaded', vehicles.length, 'vehicles from Types of Vehicles');
                    updateTestResults(`‚úÖ Found ${vehicles.length} vehicles in Types of Vehicles`);
                } catch (e) {
                    console.error('‚ùå Error parsing saved vehicles:', e);
                    updateTestResults('‚ùå Error loading vehicles from Types of Vehicles');
                }
            }
            
            // If no vehicles found, create default vehicles first
            if (vehicles.length === 0) {
                console.log('‚ö†Ô∏è No vehicles found, creating default vehicles...');
                updateTestResults('‚ö†Ô∏è No vehicles found, creating default vehicles...');
                createDefaultVehicles();
                vehicles = JSON.parse(localStorage.getItem('taxiVehicles') || '[]');
            }
            if (vehicles.length === 0) {
                updateTestResults('‚ö†Ô∏è No vehicles found - need to add vehicles first');
                const container = document.getElementById('vehiclePricingContainer');
                if (container) {
                    container.innerHTML = `
                        <div style="text-align: center; padding: 60px 40px; border: 2px dashed #dee2e6; border-radius: 12px; background: #f8f9fa;">
                            <div style="font-size: 48px; margin-bottom: 20px;"></div>
                            <h3 style="color: #495057; margin-bottom: 15px;">Geen voertuigen gevonden</h3>
                            <p style="color: #6c757d; margin-bottom: 25px; font-size: 16px;">
                                Je moet eerst voertuigen toevoegen in <strong>Types of Vehicles</strong><br>
                                voordat je prijzen kunt instellen.
                            </p>
                            <button class="btn btn-primary" onclick="showSection('types-of-vehicles')" style="margin-right: 10px;">
                                 Ga naar Types of Vehicles
                            </button>
                            <button class="btn" style="background: #6c757d; color: white;" onclick="window.open('admin-vehicles.html', '_blank')">
                                üîß Open Vehicle Manager
                            </button>
                        </div>
                    `;
                }
                return;
            }
            
            // Load saved pricing data
            const savedPricing = localStorage.getItem('vehiclePricing');
            const pricingData = savedPricing ? JSON.parse(savedPricing) : {};
            
            const container = document.getElementById('vehiclePricingContainer');
            if (!container) {
                console.error('‚ùå Container not found!');
                return;
            }
            
            // Create dynamic pricing cards based on actual vehicles from Types of Vehicles
            let htmlContent = '<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 20px;">';
            
            vehicles.forEach(vehicle => {
                // Get existing pricing or set defaults
                const pricing = pricingData[vehicle.id] || { minimum: 15.00, pricePerKm: 1.50, longDistancePerKm: 1.20 };
                
                // Determine vehicle image source - NEVER overwrite custom uploads
                let vehicleImage = ''; // fallback emoji
                if (vehicle.image) {
                    if (vehicle.image.startsWith('data:')) {
                        // Base64 image uploaded from laptop - PROTECTED!
                        vehicleImage = `<img src="${vehicle.image}" style="width: 100%; height: 100%; object-fit: contain; border-radius: 8px;" alt="${vehicle.name}">`;
                        updateTestResults(`üì∑ PROTECTED: Using custom uploaded image for ${vehicle.name}`);
                    } else if (vehicle.image.startsWith('http') && !vehicle.image.includes('unsplash')) {
                        // Custom external URL image - not default
                        vehicleImage = `<img src="${vehicle.image}" style="width: 100%; height: 100%; object-fit: contain; border-radius: 8px;" alt="${vehicle.name}">`;
                        updateTestResults(`üåê Using custom external image for ${vehicle.name}`);
                    } else if (vehicle.image.includes('unsplash')) {
                        // Skip default unsplash images - use emoji instead
                        vehicleImage = '';
                        updateTestResults(`‚ö†Ô∏è Skipping default image for ${vehicle.name} - using emoji`);
                    }
                } else {
                    updateTestResults(`üì∑ No image set for ${vehicle.name} - using emoji`);
                }
                
                htmlContent += `
                    <div style="background: white; border: 1px solid #e9ecef; border-radius: 12px; padding: 25px; box-shadow: 0 2px 10px rgba(0,0,0,0.08);">
                        <div style="display: flex; align-items: center; margin-bottom: 20px;">
                            <div style="width: 100px; height: 70px; background: #f8f9fa; border-radius: 12px; display: flex; align-items: center; justify-content: center; margin-right: 15px; overflow: hidden; border: 1px solid #dee2e6;">
                                ${vehicleImage}
                            </div>
                            <div>
                                <h4 style="margin: 0; font-size: 16px; font-weight: 600; color: #2c3e50;">${vehicle.name}</h4>
                                <p style="margin: 0; font-size: 12px; color: #6c757d;">${vehicle.description || 'Professional taxi service'}</p>
                            </div>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                            <div>
                                <label style="display: block; font-size: 13px; font-weight: 500; color: #6c757d; margin-bottom: 8px;">Minimum prijs</label>
                                <div style="display: flex; align-items: center; border: 1px solid #e9ecef; border-radius: 8px; overflow: hidden;">
                                    <button type="button" onclick="adjustDynamicPrice('${vehicle.id}', 'minimum', -0.50)" 
                                            style="background: #f8f9fa; border: none; padding: 8px 12px; cursor: pointer; color: #6c757d;">-</button>
                                    <input type="number" id="minimum_${vehicle.id}" value="${(pricing.minimum || pricing.minimumPrice || 15).toFixed(2)}" 
                                           step="0.50" min="0" 
                                           style="border: none; text-align: center; padding: 8px; width: 100%; outline: none; font-weight: 500;"
                                           onchange="updateDynamicPricing('${vehicle.id}', 'minimum', this.value)">
                                    <button type="button" onclick="adjustDynamicPrice('${vehicle.id}', 'minimum', 0.50)" 
                                            style="background: #f8f9fa; border: none; padding: 8px 12px; cursor: pointer; color: #6c757d;">+</button>
                                </div>
                            </div>
                            
                            <div>
                                <label style="display: block; font-size: 13px; font-weight: 500; color: #6c757d; margin-bottom: 8px;">Prijs per km</label>
                                <div style="display: flex; align-items: center; border: 1px solid #e9ecef; border-radius: 8px; overflow: hidden;">
                                    <button type="button" onclick="adjustDynamicPrice('${vehicle.id}', 'perKm', -0.10)" 
                                            style="background: #f8f9fa; border: none; padding: 8px 12px; cursor: pointer; color: #6c757d;">-</button>
                                    <input type="number" id="perKm_${vehicle.id}" value="${pricing.pricePerKm.toFixed(2)}" 
                                           step="0.10" min="0" 
                                           style="border: none; text-align: center; padding: 8px; width: 100%; outline: none; font-weight: 500;"
                                           onchange="updateDynamicPricing('${vehicle.id}', 'perKm', this.value)">
                                    <button type="button" onclick="adjustDynamicPrice('${vehicle.id}', 'perKm', 0.10)" 
                                            style="background: #f8f9fa; border: none; padding: 8px 12px; cursor: pointer; color: #6c757d;">+</button>
                                </div>
                            </div>
                        </div>
                        
                        <div style="margin-top: 20px; padding-top: 15px; border-top: 1px solid #f1f3f4; display: flex; justify-content: space-between; align-items: center;">
                            <span style="font-size: 12px; color: #6c757d;">
                                Capaciteit: ${vehicle.capacity?.passengers || 4} personen
                            </span>
                            <span style="font-size: 12px; color: ${vehicle.active ? '#28a745' : '#dc3545'}; font-weight: 500;">
                                ${vehicle.active ? '‚úÖ Actief' : '‚ùå Inactief'}
                            </span>
                        </div>
                    </div>
                `;
            });
            
            htmlContent += '</div>';
            container.innerHTML = htmlContent;
            
            console.log(`‚úÖ Created pricing cards for ${vehicles.length} vehicles from Types of Vehicles`);
            updateTestResults(`‚úÖ Pricing loaded for ${vehicles.length} vehicles from Types of Vehicles`);
            
            // Also generate distance pricing cards
            generateVehicleDistancePricing({});
        }
        
        function adjustDynamicPrice(vehicleId, type, amount) {
            let inputId;
            if (type === 'minimum') {
                inputId = `minimum_${vehicleId}`;
            } else if (type === 'perKm') {
                inputId = `perKm_${vehicleId}`;
            } else if (type === 'longDistancePerKm') {
                inputId = `long_${vehicleId}`;
            }
            
            const input = document.getElementById(inputId);
            if (input) {
                const currentValue = parseFloat(input.value) || 0;
                const newValue = Math.max(0, currentValue + amount);
                input.value = newValue.toFixed(2);
                updateDynamicPricing(vehicleId, type, newValue);
                
                // Get vehicle name for display
                const vehicles = JSON.parse(localStorage.getItem('taxiVehicles') || '[]');
                const vehicle = vehicles.find(v => v.id === vehicleId);
                const vehicleName = vehicle ? vehicle.name : vehicleId;
                
                updateTestResults(`üí∞ ${vehicleName} ${type} price: ‚Ç¨${newValue.toFixed(2)}`);
            }
        }
        
        function updateDynamicPricing(vehicleId, type, value) {
            // Load current pricing data
            const savedPricing = localStorage.getItem('vehiclePricing');
            let pricingData = savedPricing ? JSON.parse(savedPricing) : {};
            
            // Initialize vehicle pricing if not exists
            if (!pricingData[vehicleId]) {
                pricingData[vehicleId] = { minimumPrice: 15.00, pricePerKm: 1.50, longDistancePerKm: 1.20 };
            }
            
            // Update the specific price
            if (type === 'minimum') {
                pricingData[vehicleId].minimumPrice = parseFloat(value) || 0;
            } else if (type === 'perKm') {
                pricingData[vehicleId].pricePerKm = parseFloat(value) || 0;
            } else if (type === 'longDistancePerKm') {
                pricingData[vehicleId].longDistancePerKm = parseFloat(value) || 0;
            }
            
            // Save back to localStorage
            localStorage.setItem('vehiclePricing', JSON.stringify(pricingData));
            
            // Trigger sync to booking system
            syncDynamicPricingToBookingSystem();
            
            console.log(`Updated ${type} pricing for vehicle ${vehicleId}: ‚Ç¨${value}`);
        }
        
        function syncDynamicPricingToBookingSystem() {
            const pricingData = JSON.parse(localStorage.getItem('vehiclePricing') || '{}');
            const vehicles = JSON.parse(localStorage.getItem('taxiVehicles') || '[]');
            
            // Create booking system compatible data using real vehicle data
            const bookingSystemPricing = {};
            
            vehicles.forEach(vehicle => {
                if (vehicle.active) {
                    const pricing = pricingData[vehicle.id] || { minimumPrice: 15.00, pricePerKm: 1.50 };
                    bookingSystemPricing[vehicle.id] = {
                        vehicleId: vehicle.id,
                        vehicleName: vehicle.name,
                        minimumPrice: pricing.minimumPrice,
                        pricePerKm: pricing.pricePerKm,
                        capacity: vehicle.capacity,
                        image: vehicle.image,
                        description: vehicle.description,
                        active: vehicle.active,
                        lastUpdated: new Date().toISOString()
                    };
                }
            });
            
            // Save for booking system
            localStorage.setItem('bookingSystemPricing', JSON.stringify(bookingSystemPricing));
            localStorage.setItem('pricingLastUpdate', Date.now().toString());
            
            // Also create vehicle data for booking system - PROTECT custom images
            const bookingSystemVehicles = vehicles
                .filter(v => v.active && (v.display === 'Frontend & Backend' || v.display === 'Frontend only'))
                .map(v => {
                    const pricing = pricingData[v.id] || { minimumPrice: 25.00, pricePerKm: 2.50 };
                    
                    // Protect custom uploaded images - never overwrite them
                    let protectedImage = v.image;
                    if (v.image && v.image.includes('unsplash')) {
                        // Remove default unsplash images - let booking system handle fallback
                        protectedImage = null;
                    }
                    
                    return {
                        id: v.id,
                        name: v.name,
                        price: pricing.minimumPrice, // Use minimum price as base price
                        passengers: `1-${v.capacity?.passengers || 4} passengers`,
                        luggage: `1-${v.capacity?.luggage || 2} large bags`,
                        handLuggage: `1-${v.capacity?.handLuggage || 2} small bags`,
                        image: protectedImage, // Protected from overwrites
                        capacity: {
                            passengers: v.capacity?.passengers || 4,
                            luggage: v.capacity?.luggage || 2,
                            handLuggage: v.capacity?.handLuggage || 2,
                            wheelchairs: v.capacity?.wheelchairs || 0,
                            childSeats: v.capacity?.childSeats || 0
                        },
                        description: v.description || '',
                        active: v.active,
                        lastUpdated: new Date().toISOString()
                    };
                });
            
            localStorage.setItem('bookingSystemVehicles', JSON.stringify(bookingSystemVehicles));
            
            console.log('üí∞ Dynamic pricing synced to booking system:', bookingSystemPricing);
            console.log(' Vehicle data synced to booking system:', bookingSystemVehicles.length, 'vehicles');
            updateTestResults(`üîÑ Synced ${Object.keys(bookingSystemPricing).length} vehicles with pricing + ${bookingSystemVehicles.length} vehicles to booking system`);
            
            // Update timestamp to trigger booking system refresh
            localStorage.setItem('pricingLastUpdate', Date.now().toString());
            
            // Trigger immediate refresh in booking system if it's open
            try {
                window.postMessage({ 
                    type: 'PRICING_UPDATED', 
                    vehicles: bookingSystemVehicles,
                    pricing: bookingSystemPricing,
                    timestamp: Date.now()
                }, '*');
                console.log('üì° Sent pricing update message to booking system');
            } catch (e) {
                console.log('‚ö†Ô∏è Could not send refresh message:', e.message);
            }
        }
        
        function saveAllPricing() {
            const vehicles = JSON.parse(localStorage.getItem('taxiVehicles') || '[]');
            let savedCount = 0;
            
            // Save distance threshold setting
            const distanceThresholdInput = document.getElementById('distanceThreshold');
            if (distanceThresholdInput) {
                const threshold = parseInt(distanceThresholdInput.value) || 100;
                localStorage.setItem('distanceThreshold', threshold);
                console.log('‚úÖ Distance threshold saved:', threshold + ' km');
            }
            
            vehicles.forEach(vehicle => {
                const minimumInput = document.getElementById(`minimum_${vehicle.id}`);
                const perKmInput = document.getElementById(`perKm_${vehicle.id}`);
                const longDistanceInput = document.getElementById(`long_${vehicle.id}`);
                
                if (minimumInput && perKmInput) {
                    updateDynamicPricing(vehicle.id, 'minimum', minimumInput.value);
                    updateDynamicPricing(vehicle.id, 'perKm', perKmInput.value);
                    
                    // Save long distance price if it exists
                    if (longDistanceInput) {
                        updateDynamicPricing(vehicle.id, 'longDistancePerKm', longDistanceInput.value);
                    }
                    
                    savedCount++;
                }
            });
            
            // Save last-minute settings (new system)
            console.log('üíæ Saving last-minute settings from Save All Changes...');
            try {
                // Get values directly to ensure they're saved
                const typeElement = document.getElementById('defaultLastMinuteType');
                const amountElement = document.getElementById('defaultLastMinuteAmount');
                const hoursElement = document.getElementById('defaultLastMinuteHours');
                
                if (typeElement && amountElement && hoursElement) {
                    const lastMinuteSettings = {
                        type: typeElement.value,
                        amount: parseFloat(amountElement.value) || 25,
                        hours: parseFloat(hoursElement.value !== '' ? hoursElement.value : 3)
                    };
                    
                    localStorage.setItem('defaultLastMinuteSettings', JSON.stringify(lastMinuteSettings));
                    console.log('‚úÖ Last-minute settings saved directly:', lastMinuteSettings);
                    
                    // Also update display
                    updateDefaultLastMinuteSettings();
                } else {
                    console.log('‚ö†Ô∏è Last-minute form elements not found - skipping');
                }
            } catch (error) {
                console.log('‚ö†Ô∏è Could not save last-minute settings:', error);
            }
            
            alert(`‚úÖ Alle prijzen en instellingen opgeslagen!\n\n${savedCount} voertuigen bijgewerkt\nLast-minute instellingen opgeslagen\nPrijzen zijn gesynchroniseerd met het boekingssysteem.`);
            updateTestResults(`‚úÖ Saved pricing for ${savedCount} vehicles from Types of Vehicles`);
        }
        
        // Last-Minute Booking Management Functions
        function loadLastMinuteSurcharge() {
            console.log('‚ö° Loading last-minute booking settings...');
            
            const settings = JSON.parse(localStorage.getItem('lastMinuteSurchargeSettings') || '{}');
            
            // Set default values
            const defaults = {
                enabled: false,
                mode: 'block',
                type: 'percentage',
                amount: 25,
                hours: 6
            };
            
            const finalSettings = { ...defaults, ...settings };
            
            // Update UI
            document.getElementById('lastMinuteSurchargeEnabled').checked = finalSettings.enabled;
            document.getElementById('lastMinuteMode').value = finalSettings.mode;
            document.getElementById('lastMinuteSurchargeType').value = finalSettings.type;
            document.getElementById('lastMinuteSurchargeAmount').value = finalSettings.amount;
            document.getElementById('lastMinuteSurchargeHours').value = finalSettings.hours;
            
            // Update display
            updateLastMinuteSurchargeDisplay();
            
        }
        
        function saveLastMinuteSurcharge() {
            const settings = {
                enabled: document.getElementById('lastMinuteSurchargeEnabled').checked,
                mode: document.getElementById('lastMinuteMode').value,
                type: document.getElementById('lastMinuteSurchargeType').value,
                amount: parseFloat(document.getElementById('lastMinuteSurchargeAmount').value) || 0,
                hours: parseFloat(document.getElementById('lastMinuteSurchargeHours').value) || 6
            };
            
            localStorage.setItem('lastMinuteSurchargeSettings', JSON.stringify(settings));
            
            console.log('‚úÖ Last-minute booking settings saved:', settings);
        }
        
        function toggleLastMinuteSurcharge() {
            updateLastMinuteSurchargeDisplay();
            saveLastMinuteSurcharge();
        }
        
        function updateLastMinuteSurcharge() {
            updateLastMinuteSurchargeDisplay();
            saveLastMinuteSurcharge();
        }
        
        function updateLastMinuteSurchargeDisplay() {
            const enabled = document.getElementById('lastMinuteSurchargeEnabled').checked;
            const mode = document.getElementById('lastMinuteMode').value;
            const type = document.getElementById('lastMinuteSurchargeType').value;
            const amount = parseFloat(document.getElementById('lastMinuteSurchargeAmount').value) || 0;
            const hours = parseFloat(document.getElementById('lastMinuteSurchargeHours').value) || 6;
            const symbol = document.getElementById('lastMinuteSurchargeSymbol');
            const example = document.getElementById('lastMinuteSurchargeExample');
            const surchargeOptions = document.getElementById('surchargeOptions');
            
            // Show/hide surcharge options based on mode
            if (mode === 'surcharge') {
                surchargeOptions.style.display = 'block';
                
                // Update symbol
                symbol.textContent = type === 'percentage' ? '%' : '‚Ç¨';
                
                // Update example for surcharge mode
                const basePrice = 100;
                let finalPrice, surcharge;
                
                if (type === 'percentage') {
                    surcharge = (basePrice * amount) / 100;
                    finalPrice = basePrice + surcharge;
                    example.textContent = `Bij een boeking van ‚Ç¨${basePrice} wordt ${amount}% extra gerekend: ‚Ç¨${surcharge.toFixed(2)} (totaal ‚Ç¨${finalPrice.toFixed(2)})`;
                } else {
                    surcharge = amount;
                    finalPrice = basePrice + surcharge;
                    example.textContent = `Bij een boeking van ‚Ç¨${basePrice} wordt ‚Ç¨${amount} extra gerekend (totaal ‚Ç¨${finalPrice.toFixed(2)})`;
                }
            } else {
                surchargeOptions.style.display = 'none';
                
                // Update example for block mode
                example.textContent = `Klanten kunnen NIET boeken binnen ${hours} uur voor vertrek. Na ${hours} uur zijn normale tarieven van toepassing.`;
            }
        }
        
        // Function to check if booking is within last-minute time window
        function isLastMinuteBooking(travelDate, travelHour, travelMinute) {
            const settings = JSON.parse(localStorage.getItem('lastMinuteSurchargeSettings') || '{}');
            
            if (!settings.enabled) {
                return { isLastMinute: false, mode: null };
            }
            
            const now = new Date();
            const bookingTime = new Date();
            
            // Parse travel date (DD/MM/YYYY format)
            const dateParts = travelDate.split('/');
            if (dateParts.length !== 3) {
                return { isLastMinute: false, mode: null };
            }
            
            bookingTime.setDate(parseInt(dateParts[0]));
            bookingTime.setMonth(parseInt(dateParts[1]) - 1); // Month is 0-indexed
            bookingTime.setFullYear(parseInt(dateParts[2]));
            bookingTime.setHours(parseInt(travelHour));
            bookingTime.setMinutes(parseInt(travelMinute));
            bookingTime.setSeconds(0);
            
            const hoursUntilTravel = (bookingTime - now) / (1000 * 60 * 60);
            const isLastMinute = hoursUntilTravel <= settings.hours;
            
            console.log('‚ö° Last-minute booking check:', {
                now: now.toISOString(),
                travelTime: bookingTime.toISOString(),
                hoursUntilTravel: hoursUntilTravel.toFixed(2),
                surchargeHours: settings.hours,
                isLastMinute: isLastMinute,
                mode: settings.mode
            });
            
            return { 
                isLastMinute: isLastMinute, 
                mode: settings.mode,
                hoursUntilTravel: hoursUntilTravel,
                settings: settings 
            };
        }
        
        // Function to calculate last-minute surcharge
        function calculateLastMinuteSurcharge(basePrice) {
            const settings = JSON.parse(localStorage.getItem('lastMinuteSurchargeSettings') || '{}');
            
            if (!settings.enabled || settings.mode !== 'surcharge') {
                return 0;
            }
            
            let surcharge = 0;
            
            if (settings.type === 'percentage') {
                surcharge = (basePrice * settings.amount) / 100;
            } else {
                surcharge = settings.amount;
            }
            
            console.log('‚ö° Last-minute surcharge calculation:', {
                basePrice: basePrice,
                type: settings.type,
                amount: settings.amount,
                surcharge: surcharge
            });
            
            return surcharge;
        }
        
        // Function to check if booking should be blocked
        function shouldBlockBooking(travelDate, travelHour, travelMinute) {
            const lastMinuteCheck = isLastMinuteBooking(travelDate, travelHour, travelMinute);
            return lastMinuteCheck.isLastMinute && lastMinuteCheck.mode === 'block';
        }
        
        function createDefaultVehicles() {
            console.log(' Creating default vehicles and pricing...');
            
            const defaultVehicles = [
                {
                    id: 'saloon',
                    name: 'Saloon',
                    description: 'Comfortable sedan for city rides',
                    active: true,
                    image: '',
                    passengers: 4,
                    luggage: 2,
                    handBags: 4
                },
                {
                    id: 'estate',
                    name: 'Estate',
                    description: 'Spacious estate car for extra luggage',
                    active: true,
                    image: '',
                    passengers: 4,
                    luggage: 4,
                    handBags: 4
                },
                {
                    id: 'minivan',
                    name: 'Minivan',
                    description: 'Large vehicle for groups',
                    active: true,
                    image: '',
                    passengers: 6,
                    luggage: 4,
                    handBags: 6
                },
                {
                    id: 'minivan_long',
                    name: 'Minivan Long',
                    description: 'Extra large vehicle for big groups',
                    active: true,
                    image: '',
                    passengers: 8,
                    luggage: 6,
                    handBags: 8
                }
            ];
            
            // Save vehicles to localStorage
            localStorage.setItem('taxiVehicles', JSON.stringify(defaultVehicles));
            
            // Create default pricing (whole euros)
            const defaultPricing = {
                saloon: { minimumPrice: 45, pricePerKm: 1.50 },
                estate: { minimumPrice: 55, pricePerKm: 1.80 },
                minivan: { minimumPrice: 65, pricePerKm: 2.00 },
                minivan_long: { minimumPrice: 85, pricePerKm: 2.50 }
            };
            
            // Save pricing to localStorage
            localStorage.setItem('vehiclePricing', JSON.stringify(defaultPricing));
            
            console.log('‚úÖ Default vehicles and pricing created');
            updateTestResults('‚úÖ Created 4 default vehicles with pricing');
        }

        function resetToDefaults() {
            if (confirm('Weet je zeker dat je alle prijzen wilt resetten naar de standaardwaarden?')) {
                const vehicles = JSON.parse(localStorage.getItem('taxiVehicles') || '[]');
                
                vehicles.forEach(vehicle => {
                    const minimumInput = document.getElementById(`minimum_${vehicle.id}`);
                    const perKmInput = document.getElementById(`perKm_${vehicle.id}`);
                    
                    if (minimumInput && perKmInput) {
                        minimumInput.value = '15.00';
                        perKmInput.value = '1.50';
                        updateDynamicPricing(vehicle.id, 'minimum', 15.00);
                        updateDynamicPricing(vehicle.id, 'perKm', 1.50);
                    }
                });
                
                alert('‚úÖ Prijzen gereset naar standaardwaarden (‚Ç¨15 min, ‚Ç¨1.50/km)');
                updateTestResults('üîÑ All vehicles reset to default pricing');
            }
        }
        
        function syncPricingToBookingSystem() {
            const pricingData = JSON.parse(localStorage.getItem('vehiclePricing') || '{}');
            const vehicles = JSON.parse(localStorage.getItem('taxiVehicles') || '[]');
            
            // Create booking system compatible data
            const bookingSystemPricing = {};
            
            vehicles.forEach(vehicle => {
                if (vehicle.active) {
                    const pricing = pricingData[vehicle.id] || { minimumPrice: 15.00, pricePerKm: 1.50 };
                    bookingSystemPricing[vehicle.id] = {
                        vehicleId: vehicle.id,
                        vehicleName: vehicle.name,
                        minimumPrice: pricing.minimumPrice,
                        pricePerKm: pricing.pricePerKm,
                        capacity: vehicle.capacity,
                        image: vehicle.image,
                        description: vehicle.description,
                        active: vehicle.active,
                        lastUpdated: new Date().toISOString()
                    };
                }
            });
            
            // Save for booking system
            localStorage.setItem('bookingSystemPricing', JSON.stringify(bookingSystemPricing));
            localStorage.setItem('pricingLastUpdate', Date.now().toString());
            
            console.log('Pricing synced to booking system:', bookingSystemPricing);
        }
        
        

        // Unconfirmed Bookings Functions
        function loadUnconfirmedBookingsV2() {
            console.log('üìã Loading unconfirmed bookings...');
            
            const tableBody = document.getElementById('unconfirmedTableBody');
            
            if (!tableBody) {
                console.error('‚ùå Unconfirmed table body not found');
                return;
            }
            
            // Get unconfirmed bookings from localStorage
            const unconfirmedBookings = JSON.parse(localStorage.getItem('unconfirmedBookings') || '[]');
            
            // Sort bookings: HEEN EERST, dan TERUG per booking groep
            unconfirmedBookings.sort((a, b) => {
                // Parse dates for comparison
                const parseDate = (dateStr) => {
                    if (dateStr) {
                        const parts = dateStr.split('/');
                        if (parts.length === 3) {
                            return new Date(parts[2], parts[1] - 1, parts[0]); // YYYY, MM-1, DD
                        }
                    }
                    return new Date();
                };
                
                const dateA = parseDate(a.trip?.travelDate);
                const dateB = parseDate(b.trip?.travelDate);
                
                // First: Sort by date (vroegste datum eerst)
                const dateDiff = dateA - dateB;
                if (dateDiff !== 0) {
                    return dateDiff;
                }
                
                // Second: Op zelfde datum, sorteer heen voor terug
                const tripTypeA = a.trip?.tripType || 'heen';
                const tripTypeB = b.trip?.tripType || 'heen';
                
                // HEEN ritten komen ALTIJD eerst
                if (tripTypeA === 'heen' && tripTypeB === 'terug') return -1;
                if (tripTypeA === 'terug' && tripTypeB === 'heen') return 1;
                
                // Als beide hetzelfde type, sorteer op tijd
                if (tripTypeA === tripTypeB) {
                    const timeA = `${a.trip?.travelHour || '00'}:${a.trip?.travelMinute || '00'}`;
                    const timeB = `${b.trip?.travelHour || '00'}:${b.trip?.travelMinute || '00'}`;
                    return timeA.localeCompare(timeB);
                }
                
                return 0;
            });
            
            console.log('üìã Bookings sorted: heen trips first, then terug trips');
            
            if (unconfirmedBookings.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="9" class="empty-state">
                            <h3>üìã No Unconfirmed Bookings</h3>
                            <p>New bookings will appear here when customers make reservations</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            // Generate table rows
            let tableHTML = '';
            
            unconfirmedBookings.forEach((booking, index) => {
                const createdDate = new Date(booking.createdAt || booking.bookingDate);
                const formattedDate = createdDate.toLocaleDateString('nl-BE');
                const formattedTime = createdDate.toLocaleTimeString('nl-BE', { hour: '2-digit', minute: '2-digit' });
                const travelDateTime = `${booking.trip.travelDate} ${booking.trip.travelHour}:${booking.trip.travelMinute}`;
                
                // üö® MARCEL FIX: Use EXACT same pricing logic as Next 24h
                let finalTotalPrice = 0;
                
                // Try different sources in priority order (same as Next 24h)
                const step2Price = localStorage.getItem('step2FinalTotalPrice');
                if (step2Price && parseFloat(step2Price) > 0) {
                    finalTotalPrice = parseFloat(step2Price);
                } else if (booking.finalPrice) {
                    finalTotalPrice = parseFloat(booking.finalPrice);
                } else if (booking.totalPrice) {
                    finalTotalPrice = parseFloat(booking.totalPrice);
                } else {
                    // Fallback to vehicle pricing
                    finalTotalPrice = parseFloat(booking.vehicle?.pricing?.totalPrice || booking.vehicle?.pricing?.minimumPrice || booking.vehicle?.price || 50.00);
                }
                
                // Check if it's a single trip (no suffix) or return trip (has 'a' or 'b' suffix)
                const bookingId = booking.bookingId || '';
                const hasReturnSuffix = bookingId.endsWith('a') || bookingId.endsWith('b');
                const hasIndividualTrips = (booking.trip?.tripType === 'heen' || booking.trip?.tripType === 'terug') && hasReturnSuffix;
                
                let total;
                
                // Debug: Log the entire booking to see if tripPrice exists
                console.log(`üîç DEBUG Booking ${booking.bookingId}:`, {
                    tripType: booking.trip?.tripType,
                    hasReturnSuffix: hasReturnSuffix,
                    hasIndividualTrips: hasReturnSuffix,
                    tripPrice: booking.tripPrice,
                    hasTripPrice: booking.tripPrice !== undefined,
                    bookingKeys: Object.keys(booking)
                });
                
                if (hasReturnSuffix) {
                    // EXACT STAP 3 PRICING LOGIC - MARCEL APPROVED
                    const step2FinalPrice = parseFloat(localStorage.getItem('step2FinalTotalPrice') || '0');
                    let heenTotaal, terugTotaal;
                    
                    if (step2FinalPrice > 0) {
                        finalTotalPrice = step2FinalPrice;
                        
                        // Find Meet & Greet price for correct distribution (EXACT STAP 3 logic)
                        let meetGreetPrice = 0;
                        const surchargeData = booking.surcharges;
                        if (surchargeData && surchargeData.selectedSurcharges) {
                            for (const [key, value] of Object.entries(surchargeData.selectedSurcharges)) {
                                if (key.toLowerCase().includes('meet') || key.toLowerCase().includes('greet')) {
                                    if (typeof value === 'object' && value.price) {
                                        meetGreetPrice = parseFloat(value.price) || 0;
                                    } else if (typeof value === 'number') {
                                        meetGreetPrice = value;
                                    }
                                    break;
                                }
                            }
                        }
                        
                        // Calculate exactly like STAP 3
                        if (meetGreetPrice > 0) {
                            const basePricePerTrip = (step2FinalPrice - meetGreetPrice) / 2;
                            heenTotaal = basePricePerTrip;
                            terugTotaal = basePricePerTrip + meetGreetPrice;
                        } else {
                            heenTotaal = step2FinalPrice / 2;
                            terugTotaal = step2FinalPrice / 2;
                        }
                    } else {
                        // Fallback if no step2 price
                        heenTotaal = finalTotalPrice / 2;
                        terugTotaal = finalTotalPrice / 2;
                    }
                    
                    if (booking.trip.tripType === 'heen') {
                        total = heenTotaal.toFixed(2);
                    } else {
                        total = terugTotaal.toFixed(2);
                    }
                } else {
                    total = finalTotalPrice.toFixed(2);
                }
                
                console.log(`üí∞ Unconfirmed price (SAME as Next 24h): ‚Ç¨${total} for booking ${booking.bookingId}`);
                
                tableHTML += `
                    <tr style="border-bottom: 1px solid #dee2e6;">
                        <td class="table-cell" style="text-align: center;">
                            ${(() => {
                                const country = detectCountryFromAddress(booking.trip.fromLocation);
                                const countryInfo = getCountryInfo(country);
                                const isCrossBorder = detectCountryFromAddress(booking.trip.fromLocation) !== detectCountryFromAddress(booking.trip.toLocation);
                                return `
                                    <div style="display: flex; flex-direction: column; align-items: center; gap: 2px;">
                                        <span style="font-size: 20px;" title="${countryInfo.name}">${countryInfo.flag}</span>
                                        ${isCrossBorder ? '<div style="font-size: 9px; color: #dc3545;">Cross</div>' : ''}
                                        <button style="background: transparent; border: 1px solid #dee2e6; padding: 2px 6px; border-radius: 4px; cursor: pointer; font-size: 12px;" onclick="showBookingOverview('${booking.bookingId}', '${booking.trip.tripType || 'heen'}')" title="View Details">
                                            üëÅ
                                        </button>
                                    </div>
                                `;
                            })()}
                        </td>
                        <td class="table-cell">
                            <input type="checkbox" style="margin-right: 8px;">
                            <div class="font-medium">${booking.customer.firstName} ${booking.customer.lastName}</div>
                            <div class="small-text">üìû ${booking.customer.phone}</div>
                            ${booking.trip.tripType ? `<div style="font-size: 11px; color: #007bff; font-weight: 500;">${booking.trip.tripType === 'heen' ? 'üîÑ HEEN' : 'üîÑ TERUG'}</div>` : ''}
                        </td>
                        <td class="table-cell">
                            <div class="font-medium">${booking.trip.travelDate}</div>
                            <div style="color: #666; font-size: 12px;">${booking.trip.travelHour}:${booking.trip.travelMinute}</div>
                        </td>
                        <td class="table-cell">
                            <div class="status-dropdown">
                                <span class="status-badge unconfirmed" onclick="toggleStatusDropdown('${booking.bookingId}')" id="statusBadge_${booking.bookingId}" style="font-size: 11px; padding: 4px 8px;">
                                    Unconfirmed
                                </span>
                                <div class="status-dropdown-menu" id="statusDropdown_${booking.bookingId}">
                                    <div class="status-option selected" onclick="changeBookingStatus('${booking.bookingId}', 'unconfirmed')">
                                        ‚úì Unconfirmed
                                    </div>
                                    <div class="status-option" onclick="changeBookingStatus('${booking.bookingId}', 'confirmed')">
                                        Confirmed
                                    </div>
                                    <div class="status-option" onclick="changeBookingStatus('${booking.bookingId}', 'request_quote')">
                                        Request Quote
                                    </div>
                                    <div class="status-option" onclick="changeBookingStatus('${booking.bookingId}', 'assigned')">
                                        Assigned
                                    </div>
                                    <div class="status-option" onclick="changeBookingStatus('${booking.bookingId}', 'job_accepted')">
                                        Job Accepted
                                    </div>
                                    <div class="status-option" onclick="changeBookingStatus('${booking.bookingId}', 'job_rejected')">
                                        Job Rejected
                                    </div>
                                    <div class="status-option" onclick="changeBookingStatus('${booking.bookingId}', 'on_route')">
                                        On Route
                                    </div>
                                    <div class="status-option" onclick="changeBookingStatus('${booking.bookingId}', 'arrived')">
                                        Arrived
                                    </div>
                                    <div class="status-option" onclick="changeBookingStatus('${booking.bookingId}', 'on_board')">
                                        On Board
                                    </div>
                                    <div class="status-option" onclick="changeBookingStatus('${booking.bookingId}', 'no_show')">
                                        No Show
                                    </div>
                                    <div class="status-option" onclick="changeBookingStatus('${booking.bookingId}', 'completed')">
                                        Completed
                                    </div>
                                    <div class="status-option" onclick="changeBookingStatus('${booking.bookingId}', 'cancelled')">
                                        Cancelled
                                    </div>
                                    <div class="status-option" onclick="changeBookingStatus('${booking.bookingId}', 'driver_cancelled')">
                                        Driver Cancelled
                                    </div>
                                    <div class="status-option" onclick="changeBookingStatus('${booking.bookingId}', 'incomplete')">
                                        Incomplete
                                    </div>
                                </div>
                            </div>
                        </td>
                        <td class="table-cell">
                            <select style="padding: 4px 8px; border: 1px solid #dee2e6; border-radius: 4px; font-size: 14px; width: auto; min-width: 120px; max-width: 180px;" onchange="assignDriverToBooking('${booking.bookingId}', this.value)">
                                <option value="">-- Select --</option>
                                <optgroup label="Auto">
                                    <option value="auto-all" ${booking.driver === 'auto-all' ? 'selected' : ''}>All Drivers</option>
                                    <option value="auto-nearby" ${booking.driver === 'auto-nearby' ? 'selected' : ''}>Nearby</option>
                                    <option value="auto-lastminute" ${booking.driver === 'auto-lastminute' ? 'selected' : ''}>Last-Minute</option>
                                </optgroup>
                                <optgroup label="Drivers">
                                    ${getDriverOptionsHTML(booking.driver)}
                                </optgroup>
                            </select>
                        </td>
                        <td class="table-cell">
                            <div>${booking.vehicle?.vehicle?.name || 'Saloon'}</div>
                        </td>
                        <td class="table-cell">
                            <div style="font-size: 12px;">${booking.specialInstructions || '-'}</div>
                        </td>
                        <td class="table-cell" style="text-align: left;">
                            <div style="font-weight: 500; color: #28a745;">‚Ç¨${total}</div>
                        </td>
                        <td class="table-cell" style="text-align: center;">
                            <button onclick="sendEmail('${booking.bookingId}', 'normal')" 
                                    style="background: #007bff; color: white; border: none; padding: 4px 8px; border-radius: 4px; font-size: 12px; cursor: pointer;"
                                    title="Send Email">
                                ‚úâÔ∏è
                            </button>
                        </td>
                    </tr>
                `;
            });
            
            tableBody.innerHTML = tableHTML;
            
        }
        
        function confirmBooking(bookingId) {
            if (!confirm(`Confirm booking ${bookingId}? The customer will be notified.`)) {
                return;
            }
            
            // Move from unconfirmed to confirmed
            let unconfirmedBookings = JSON.parse(localStorage.getItem('unconfirmedBookings') || '[]');
            let confirmedBookings = JSON.parse(localStorage.getItem('confirmedBookings') || '[]');
            
            const bookingIndex = unconfirmedBookings.findIndex(b => b.bookingId === bookingId);
            if (bookingIndex !== -1) {
                const booking = unconfirmedBookings[bookingIndex];
                booking.status = 'confirmed';
                booking.confirmedAt = new Date().toISOString();
                
                // Move to confirmed
                confirmedBookings.unshift(booking);
                unconfirmedBookings.splice(bookingIndex, 1);
                
                // Save back to localStorage
                localStorage.setItem('unconfirmedBookings', JSON.stringify(unconfirmedBookings));
                localStorage.setItem('confirmedBookings', JSON.stringify(confirmedBookings));
                
                // Reload the display
                loadUnconfirmedBookingsV2();
                
                alert(`‚úÖ Booking ${bookingId} confirmed successfully!`);
                console.log('‚úÖ Booking confirmed:', bookingId);
            }
        }
        
        function cancelBooking(bookingId) {
            if (!confirm(`Cancel booking ${bookingId}? The customer will be notified.`)) {
                return;
            }
            
            // Move from unconfirmed to cancelled
            let unconfirmedBookings = JSON.parse(localStorage.getItem('unconfirmedBookings') || '[]');
            let cancelledBookings = JSON.parse(localStorage.getItem('cancelledBookings') || '[]');
            
            const bookingIndex = unconfirmedBookings.findIndex(b => b.bookingId === bookingId);
            if (bookingIndex !== -1) {
                const booking = unconfirmedBookings[bookingIndex];
                booking.status = 'cancelled';
                booking.cancelledAt = new Date().toISOString();
                
                // Move to cancelled
                cancelledBookings.unshift(booking);
                unconfirmedBookings.splice(bookingIndex, 1);
                
                // Save back to localStorage
                localStorage.setItem('unconfirmedBookings', JSON.stringify(unconfirmedBookings));
                localStorage.setItem('cancelledBookings', JSON.stringify(cancelledBookings));
                
                // Reload the display
                loadUnconfirmedBookingsV2();
                
                alert(`‚ùå Booking ${bookingId} cancelled successfully!`);
                console.log('‚ùå Booking cancelled:', bookingId);
            }
        }
        
        function confirmAllBookings() {
            const unconfirmedBookings = JSON.parse(localStorage.getItem('unconfirmedBookings') || '[]');
            
            if (unconfirmedBookings.length === 0) {
                alert('No unconfirmed bookings to confirm.');
                return;
            }
            
            if (!confirm(`Confirm all ${unconfirmedBookings.length} unconfirmed bookings?`)) {
                return;
            }
            
            let confirmedBookings = JSON.parse(localStorage.getItem('confirmedBookings') || '[]');
            
            // Move all unconfirmed to confirmed
            unconfirmedBookings.forEach(booking => {
                booking.status = 'confirmed';
                booking.confirmedAt = new Date().toISOString();
                confirmedBookings.unshift(booking);
            });
            
            // Clear unconfirmed and save confirmed
            localStorage.setItem('unconfirmedBookings', JSON.stringify([]));
            localStorage.setItem('confirmedBookings', JSON.stringify(confirmedBookings));
            
            // Reload the display
            loadUnconfirmedBookingsV2();
            
            alert(`‚úÖ All ${unconfirmedBookings.length} bookings confirmed successfully!`);
            console.log('‚úÖ All bookings confirmed');
        }
        
        // Delete Functions for Unconfirmed Bookings - ENHANCED WITH DEBUGGING
        function deleteUnconfirmedBooking(bookingId) {
            console.log('üóëÔ∏è deleteUnconfirmedBooking called with:', bookingId);
            
            try {
                if (!bookingId) {
                    console.error('‚ùå No booking ID provided');
                    alert('‚ùå Error: No booking ID provided');
                    return;
                }
                
                // Temporarily bypass confirmation for testing
                const shouldDelete = confirm(`‚ö†Ô∏è Delete booking ${bookingId}?\n\nThis action cannot be undone.`);
                console.log('üîç Confirmation result:', shouldDelete);
                if (!shouldDelete) {
                    console.log('‚ùå User cancelled delete operation');
                    return;
                }
                
                console.log('üóëÔ∏è User confirmed deletion, proceeding...');
                
                // Get current unconfirmed bookings
                let unconfirmedBookings = JSON.parse(localStorage.getItem('unconfirmedBookings') || '[]');
                console.log('üìã Current unconfirmed bookings count:', unconfirmedBookings.length);
                
                // Find and remove the booking
                const bookingIndex = unconfirmedBookings.findIndex(b => b.bookingId === bookingId);
                console.log('üîç Booking index found:', bookingIndex);
                
                if (bookingIndex !== -1) {
                    console.log('üìã Removing booking at index:', bookingIndex);
                    unconfirmedBookings.splice(bookingIndex, 1);
                    
                    // Save back to localStorage
                    localStorage.setItem('unconfirmedBookings', JSON.stringify(unconfirmedBookings));
                    console.log('üíæ Updated localStorage with', unconfirmedBookings.length, 'bookings');
                    
                    // Reload the display
                    console.log('üîÑ Reloading unconfirmed bookings display...');
                    loadUnconfirmedBookingsV2();
                    
                    alert(`‚úÖ Booking ${bookingId} deleted successfully!`);
                    console.log('‚úÖ Booking deleted successfully:', bookingId);
                } else {
                    alert(`‚ùå Booking ${bookingId} not found`);
                    console.error('‚ùå Booking not found in list:', bookingId);
                    console.log('üìã Available booking IDs:', unconfirmedBookings.map(b => b.bookingId));
                }
            } catch (error) {
                console.error('‚ùå Error in deleteUnconfirmedBooking:', error);
                alert('‚ùå Error deleting booking: ' + error.message);
            }
        }
        
        // Make deleteUnconfirmedBooking globally accessible
        window.deleteUnconfirmedBooking = deleteUnconfirmedBooking;
        
        
        function deleteAllUnconfirmedBookings() {
            console.log('üóëÔ∏è deleteAllUnconfirmedBookings function called');
            
            try {
                const unconfirmedBookings = JSON.parse(localStorage.getItem('unconfirmedBookings') || '[]');
                
                if (unconfirmedBookings.length === 0) {
                    alert('No unconfirmed bookings to delete.');
                    return;
                }
                
                if (!confirm(`‚ö†Ô∏è Delete ALL ${unconfirmedBookings.length} unconfirmed bookings?\n\nThis action cannot be undone.`)) {
                    console.log('‚ùå User cancelled delete all operation');
                    return;
                }
                
                console.log('üóëÔ∏è Deleting all unconfirmed bookings:', unconfirmedBookings.length);
                
                // Clear unconfirmed bookings
                localStorage.setItem('unconfirmedBookings', JSON.stringify([]));
                console.log('üíæ Cleared unconfirmedBookings in localStorage');
                
                // Reload the display
                loadUnconfirmedBookingsV2();
                console.log('üîÑ Reloaded unconfirmed bookings display');
                
                alert(`‚úÖ All ${unconfirmedBookings.length} unconfirmed bookings deleted!`);
                console.log('üóëÔ∏è All unconfirmed bookings cleared successfully');
            } catch (error) {
                console.error('‚ùå Error in deleteAllUnconfirmedBookings:', error);
                alert('‚ùå Error deleting bookings: ' + error.message);
            }
        }
        
        function refreshUnconfirmedBookings() {
            console.log('üîÑ refreshUnconfirmedBookings function called');
            
            try {
                // Show loading state
                const tableBody = document.getElementById('unconfirmedTableBody');
                if (tableBody) {
                    console.log('üìã Setting loading state in table body');
                    tableBody.innerHTML = `
                        <tr>
                            <td colspan="9" class="empty-state">
                                <div style="display: flex; align-items: center; justify-content: center; gap: 10px;">
                                    <div style="animation: spin 1s linear infinite;">üîÑ</div>
                                    <span>Refreshing...</span>
                                </div>
                            </td>
                        </tr>
                    `;
                } else {
                    console.warn('‚ö†Ô∏è Table body with id "unconfirmedTableBody" not found');
                }
                
                // Add CSS for spin animation if not exists
                if (!document.getElementById('spinAnimation')) {
                    console.log('üé® Adding spin animation CSS');
                    const style = document.createElement('style');
                    style.id = 'spinAnimation';
                    style.textContent = `
                        @keyframes spin {
                            0% { transform: rotate(0deg); }
                            100% { transform: rotate(360deg); }
                        }
                    `;
                    document.head.appendChild(style);
                }
                
                // Simulate refresh delay and reload
                setTimeout(() => {
                    console.log('üîÑ Starting refresh reload...');
                    loadUnconfirmedBookingsV2();
                    console.log('‚úÖ Refresh completed');
                }, 500);
            } catch (error) {
                console.error('‚ùå Error in refreshUnconfirmedBookings:', error);
                alert('‚ùå Error refreshing bookings: ' + error.message);
            }
        }
        
        // Global variable to store current booking being edited
        let currentEditingBooking = null;
        
        
        
        
        
        // üÜï Debug function for vehicle images
        window.checkVehicleImages = function() {
            console.log('üîç Checking vehicle images in localStorage...');
            
            const taxiVehicles = JSON.parse(localStorage.getItem('taxiVehicles') || '[]');
            console.log('üìã Found', taxiVehicles.length, 'vehicles in taxiVehicles:');
            
            taxiVehicles.forEach((vehicle, index) => {
                console.log(`${index + 1}. ${vehicle.name}:`);
                console.log('   - ID:', vehicle.id);
                console.log('   - Active:', vehicle.active);
                console.log('   - Has Image:', !!vehicle.image);
                if (vehicle.image) {
                    console.log('   - Image type:', vehicle.image.startsWith('data:') ? 'Base64 upload' : 'URL');
                    console.log('   - Image size:', vehicle.image.length, 'characters');
                }
            });
            
            const bookingVehicles = JSON.parse(localStorage.getItem('bookingSystemVehicles') || '[]');
            console.log('üìã Found', bookingVehicles.length, 'vehicles in bookingSystemVehicles');
            
            return { taxiVehicles, bookingVehicles };
        };

        function showBookingActions(bookingId) {
            console.log('üìù Opening edit modal for booking:', bookingId);
            
            // üÜï DEBUG: Show localStorage data for STAP 2 debugging
            console.log('üîç LOCALSTORAGE DEBUG:');
            console.log('   üìã selectedSurcharges:', localStorage.getItem('selectedSurcharges'));
            console.log('   üìã selectedVehicleStep2:', localStorage.getItem('selectedVehicleStep2'));
            console.log('   üìã surchargeItems:', localStorage.getItem('surchargeItems'));
            
            // Debug: Check if modal exists
            const modal = document.getElementById('bookingEditModal');
            if (!modal) {
                console.error('‚ùå Modal element not found!');
                alert('‚ùå Modal element not found! Please refresh the page.');
                return;
            }
            
            // Find the booking in all localStorage sections
            const unconfirmedBookings = JSON.parse(localStorage.getItem('unconfirmedBookings') || '[]');
            const confirmedBookings = JSON.parse(localStorage.getItem('confirmedBookings') || '[]');
            const completedBookings = JSON.parse(localStorage.getItem('completedBookings') || '[]');
            const cancelledBookings = JSON.parse(localStorage.getItem('cancelledBookings') || '[]');
            
            console.log('üîç Searching in sections:');
            console.log('- Unconfirmed:', unconfirmedBookings.length);
            console.log('- Confirmed:', confirmedBookings.length);
            console.log('- Completed:', completedBookings.length);
            console.log('- Cancelled:', cancelledBookings.length);
            
            // Search in all sections
            let booking = unconfirmedBookings.find(b => b.bookingId === bookingId) ||
                         confirmedBookings.find(b => b.bookingId === bookingId) ||
                         completedBookings.find(b => b.bookingId === bookingId) ||
                         cancelledBookings.find(b => b.bookingId === bookingId);
            
            if (!booking) {
                alert('‚ùå Booking not found in any section\n\nBooking ID: ' + bookingId);
                console.error('‚ùå Booking not found:', bookingId);
                console.log('Available booking IDs:');
                console.log('- Unconfirmed:', unconfirmedBookings.map(b => b.bookingId));
                console.log('- Confirmed:', confirmedBookings.map(b => b.bookingId));
                console.log('- Completed:', completedBookings.map(b => b.bookingId));
                console.log('- Cancelled:', cancelledBookings.map(b => b.bookingId));
                return;
            }
            
            console.log('‚úÖ Found booking:', booking);
            console.log('‚úÖ Booking status:', booking.status || 'unconfirmed');
            
            // Store current booking for editing
            currentEditingBooking = booking;
            
            // Open the modal
            try {
                openBookingEditModal(booking);
                console.log('‚úÖ Modal should be open now');
            } catch (error) {
                console.error('‚ùå Error opening modal:', error);
                alert('‚ùå Error opening modal. Check console for details.');
            }
        }

        function openBookingEditModal(booking) {
            console.log('üìù Loading booking data into modal:', booking.bookingId);
            
            try {
                // Helper function to safely set element value
                const setElementValue = (elementId, value) => {
                    const element = document.getElementById(elementId);
                    if (element) {
                        element.value = value || '';
                    } else {
                        console.warn(`‚ö†Ô∏è Element not found: ${elementId}`);
                    }
                };
                
                const setElementText = (elementId, text) => {
                    const element = document.getElementById(elementId);
                    if (element) {
                        element.textContent = text || '';
                    } else {
                        console.warn(`‚ö†Ô∏è Element not found: ${elementId}`);
                    }
                };
                
                // Set booking ID in modal header
                setElementText('modalBookingId', booking.bookingId);
                
                // Fill customer information
                setElementValue('editFirstName', booking.customer?.firstName);
                setElementValue('editLastName', booking.customer?.lastName);
                setElementValue('editEmail', booking.customer?.email);
                setElementValue('editPhone', booking.customer?.phone);
                setElementValue('editPassengers', booking.customer?.passengers || '1');
                setElementValue('editPaymentMethod', booking.customer?.paymentMethod || 'cash');
                
                // Fill trip information
                setElementValue('editFromLocation', booking.trip?.fromLocation);
                setElementValue('editToLocation', booking.trip?.toLocation);
                
                // Display extra stops - improved with debug
                console.log('üîç Booking trip data:', booking.trip);
                console.log('üîç Extra stops:', booking.trip?.extraStops);
                
                const extraStopsDisplay = document.getElementById('editExtraStopsDisplay');
                if (extraStopsDisplay) {
                    // Check multiple possible locations for extra stops
                    const extraStops = booking.trip?.extraStops || 
                                     (booking.trip?.extraStopCount > 0 ? [] : null);
                    
                    if (extraStops && extraStops.length > 0) {
                        extraStopsDisplay.innerHTML = extraStops.map((stop, index) => 
                            `<div style="margin: 5px 0; padding: 8px; background: #f0f8ff; border-left: 3px solid #007bff; border-radius: 4px;">Stop ${index + 1}: ${stop}</div>`
                        ).join('');
                    } else if (booking.trip?.extraStopCount && booking.trip.extraStopCount > 0) {
                        // Fallback: show that there are stops but no details stored
                        extraStopsDisplay.innerHTML = `<div style="color: #ff9800; font-style: italic;">${booking.trip.extraStopCount} extra stop(s) - details not stored</div>`;
                    } else {
                        extraStopsDisplay.innerHTML = '<span style="color: #999;">No extra stops</span>';
                    }
                }
                
                // Convert date format from DD/MM/YYYY to YYYY-MM-DD for date input
                const travelDate = booking.trip?.travelDate || '';
                if (travelDate && travelDate.includes('/')) {
                    const dateParts = travelDate.split('/');
                    if (dateParts.length === 3) {
                        const formattedDate = `${dateParts[2]}-${dateParts[1].padStart(2, '0')}-${dateParts[0].padStart(2, '0')}`;
                        setElementValue('editTravelDate', formattedDate);
                    }
                } else {
                    setElementValue('editTravelDate', travelDate);
                }
                
                // Set travel time
                const travelTime = `${booking.trip?.travelHour || '00'}:${booking.trip?.travelMinute || '00'}`;
                setElementValue('editTravelTime', travelTime);
                
                // Set vehicle type
                const vehicleType = booking.vehicle?.vehicle?.id || booking.vehicle?.vehicleId || 'saloon';
                setElementValue('editVehicleType', vehicleType);
                
                // Set return trip
                setElementValue('editReturnTrip', booking.trip?.returnActive || 'false');
                
                // Fill booking details
                setElementValue('editBookingStatus', booking.status || 'unconfirmed');
                
                // Set price from vehicle pricing including surcharges
                console.log('üí∞ Vehicle pricing data:', booking.vehicle?.pricing);
                console.log('üí∞ Surcharges data:', booking.surcharges);
                
                const vehiclePrice = booking.vehicle?.pricing?.totalPrice || booking.vehicle?.pricing?.minimumPrice || booking.vehicle?.price || 50.00;
                const surchargesTotal = booking.surcharges?.totalSurcharge || 0;
                
                // Recalculate airport surcharge if needed
                let airportSurcharge = 0;
                const isFromAirport = isAirportLocation(booking.trip?.fromLocation || '');
                if (isFromAirport) {
                    airportSurcharge = 5.00;
                }
                
                const totalPrice = parseFloat(vehiclePrice) + parseFloat(surchargesTotal) + airportSurcharge;
                console.log('üí∞ Price calculation: Vehicle: ‚Ç¨' + vehiclePrice + ' + Surcharges: ‚Ç¨' + surchargesTotal + ' + Airport: ‚Ç¨' + airportSurcharge + ' = ‚Ç¨' + totalPrice.toFixed(2));
                
                setElementValue('editPrice', totalPrice.toFixed(2));
                
                // Set optional fields
                setElementValue('editDriver', booking.driver);
                
                // Set special instructions (textarea)
                const specialInstructionsElement = document.getElementById('editSpecialInstructions');
                if (specialInstructionsElement) {
                    specialInstructionsElement.value = booking.specialInstructions || '';
                }
                
                // Load and display surcharges
                loadBookingSurcharges(booking);
                
                // Show the modal
                const modal = document.getElementById('bookingEditModal');
                if (modal) {
                    modal.classList.add('show');
                } else {
                    throw new Error('Modal element not found');
                }
                
            } catch (error) {
                console.error('‚ùå Error in openBookingEditModal:', error);
                alert('‚ùå Error opening booking details. Some fields may be missing.');
            }
        }

        function closeBookingModal() {
            console.log('‚ùå Closing booking edit modal');
            document.getElementById('bookingEditModal').classList.remove('show');
            currentEditingBooking = null;
        }

        // Surcharge Management Functions
        function loadBookingSurcharges(booking) {
            console.log('üí∞ Loading surcharges for booking:', booking.bookingId);
            console.log('üí∞ COMPLETE booking object:', JSON.stringify(booking, null, 2));
            
            // üÜï ENHANCED DEBUGGING for STAP 2 surcharge data
            console.log('üîç DEBUGGING SURCHARGE DATA:');
            console.log('   üìã booking.surcharges:', booking.surcharges);
            console.log('   üìã typeof surcharges:', typeof booking.surcharges);
            if (booking.surcharges) {
                console.log('   üìã surcharges keys:', Object.keys(booking.surcharges));
                console.log('   üìã surcharges values:', Object.values(booking.surcharges));
            }
            console.log('   üìã booking.vehicle:', booking.vehicle);
            console.log('   üìã booking.vehicle?.surcharges:', booking.vehicle?.surcharges);
            console.log('   üìã booking.selectedSurcharges:', booking.selectedSurcharges);
            console.log('   üìã booking.step2Data:', booking.step2Data);
            
            const surchargesList = document.getElementById('editSurchargesList');
            if (!surchargesList) {
                console.warn('‚ö†Ô∏è Surcharges list container not found');
                return;
            }
            
            let surcharges = [];
            
            // Check if this is a return trip
            const isReturnTrip = booking.trip?.returnActive === 'true' || booking.trip?.returnActive === true;
            console.log('üîç ADMIN - Return trip detected:', isReturnTrip);
            
            // DON'T add automatic airport surcharge - it's included in Meet & Greet
            // Meet & Greet already contains the airport service (‚Ç¨6 total: ‚Ç¨5 airport + ‚Ç¨1 service)
            console.log('üîç ADMIN - Skipping automatic airport surcharge (included in Meet & Greet)');
            
            // üÜï FIXED - Use SAME data structure as STEP 3 overview
            console.log('üîç ADMIN - Raw booking.surcharges:', booking.surcharges);
            
            if (booking.surcharges && typeof booking.surcharges === 'object') {
                // SAME logic as STEP 3: Get actual surcharges from nested structure  
                const actualSurcharges = booking.surcharges.selectedSurcharges || booking.surcharges;
                console.log('üîç ADMIN - Actual surcharges to process:', actualSurcharges);
                
                // Process SAME way as STEP 3 overview
                Object.entries(actualSurcharges).forEach(([key, value]) => {
                    // Skip all technical/internal fields - ONLY show real user selections
                    const skipKeys = [
                        'totalSurcharge', 'surchargeTotal', 'extraStopCount', 
                        'automaticCharges', 'stopoverCharges', 'airportSurcharge'
                    ];
                    
                    const skipPatterns = [
                        'stopcount', 'extrastop', 'total', 'automatic', 'airport'
                    ];
                    
                    // Skip if exact key match
                    if (skipKeys.includes(key)) {
                        console.log(`‚è≠Ô∏è ADMIN - Skipping technical key: ${key}`);
                        return; 
                    }
                    
                    // Skip if pattern match
                    if (skipPatterns.some(pattern => key.toLowerCase().includes(pattern))) {
                        console.log(`‚è≠Ô∏è ADMIN - Skipping pattern match: ${key}`);
                        return; 
                    }
                    
                    // Skip if it's a technical field with name containing these terms
                    if (typeof value === 'object' && value?.name) {
                        const nameLower = value.name.toLowerCase();
                        if (nameLower.includes('airport') || 
                            nameLower.includes('surcharge') || 
                            nameLower.includes('total') ||
                            nameLower.includes('stopcount')) {
                            console.log(`‚è≠Ô∏è ADMIN - Skipping technical item by name: ${value.name}`);
                            return;
                        }
                    }
                    
                    console.log(`üîç ADMIN - Processing surcharge: ${key}`, value);
                    
                    if (typeof value === 'object' && value !== null && value.name) {
                        const quantity = parseInt(value.quantity) || 1;
                        let price = parseFloat(value.price) || 0;
                        
                        // Check if Meet & Greet is disabled in admin settings
                        if (value.name.toLowerCase().includes('meet') || value.name.toLowerCase().includes('greet')) {
                            const surchargeItems = JSON.parse(localStorage.getItem('surchargeItems') || '{}');
                            const meetGreetItem = surchargeItems.fixed?.find(item => item.id === 'meet-greet');
                            const isMeetGreetEnabled = meetGreetItem ? meetGreetItem.enabled : false;
                            
                            if (!isMeetGreetEnabled) {
                                console.log(`‚è≠Ô∏è ADMIN - Meet & Greet disabled in admin settings - skipping: ${value.name}`);
                                return;
                            }
                        }
                        
                        // For return trips, double the surcharge prices EXCEPT Meet & Greet
                        // Meet & Greet is only for pickup FROM airport, not drop-off
                        if (isReturnTrip && !value.name.toLowerCase().includes('meet') && !value.name.toLowerCase().includes('greet')) {
                            price = price * 2;
                        }
                        
                        console.log(`üí∞ ADMIN - Item: ${value.name}, original price: ${parseFloat(value.price)}, final price: ${price}, quantity: ${quantity}${isReturnTrip ? ' (doubled for return)' : ''}`);
                        
                        if (parseFloat(value.price) > 0) { // Check original price > 0
                            const showReturnLabel = isReturnTrip && !value.name.toLowerCase().includes('meet') && !value.name.toLowerCase().includes('greet');
                            surcharges.push({
                                id: key,
                                name: value.name + (showReturnLabel ? ' (heen + terug)' : ''),
                                price: price, // Doubled price for return trips except Meet & Greet
                                quantity: quantity,
                                type: value.type || 'manual',
                                removable: !value.automatic,
                                automatic: value.automatic || false
                            });
                        }
                    } else if (typeof value === 'number' && value > 0) {
                        // Handle simple number values
                        const displayName = key.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
                        let simplePrice = parseFloat(value);
                        
                        // For return trips, double the surcharge prices
                        if (isReturnTrip) {
                            simplePrice = simplePrice * 2;
                        }
                        
                        surcharges.push({
                            id: key,
                            name: displayName + (isReturnTrip ? ' (heen + terug)' : ''),
                            price: simplePrice,
                            quantity: 1,
                            type: 'manual',
                            removable: true
                        });
                    }
                });
                
                // IMPORTANT: Skip the old fallback code below since we found the data
                if (surcharges.length > 0) {
                    console.log('üí∞ ADMIN - Found surcharges, skipping fallback search');
                    renderSurcharges(surcharges);
                    return;
                }
            }
            
            // Search for surcharges in additional possible locations (fallback)
            const searchLocations = [
                booking.vehicle?.surcharges,
                booking.additionalItems,
                booking.items,
                booking.extras
            ];
            
            searchLocations.forEach((location, index) => {
                if (!location) return;
                
                console.log(`üîç Searching location ${index + 1}:`, location);
                
                // Check for .items structure
                if (location.items) {
                    console.log('üí∞ Found items structure:', location.items);
                    Object.entries(location.items).forEach(([key, item]) => {
                        if (item && (item.quantity > 0 || item.selected || item.active)) {
                            const quantity = item.quantity || 1;
                            const price = parseFloat(item.price || 0);
                            if (price > 0) {
                                surcharges.push({
                                    id: key,
                                    name: item.name || key.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase()),
                                    price: price * quantity,
                                    quantity: quantity,
                                    type: 'manual',
                                    removable: true
                                });
                            }
                        }
                    });
                }
                
                // Check for direct properties (key-value pairs)
                Object.entries(location).forEach(([key, value]) => {
                    if (key === 'items' || key === 'totalSurcharge') return; // Skip these
                    
                    if (typeof value === 'number' && value > 0) {
                        console.log(`üí∞ Found direct surcharge: ${key} = ${value}`);
                        surcharges.push({
                            id: key,
                            name: key.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase()),
                            price: value,
                            quantity: 1,
                            type: 'manual',
                            removable: true
                        });
                    } else if (typeof value === 'object' && value !== null) {
                        // Check nested objects
                        if (value.price && value.price > 0 && (value.quantity > 0 || value.selected)) {
                            console.log(`üí∞ Found nested surcharge: ${key}`, value);
                            surcharges.push({
                                id: key,
                                name: value.name || key.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase()),
                                price: parseFloat(value.price) * (value.quantity || 1),
                                quantity: value.quantity || 1,
                                type: 'manual',
                                removable: true
                            });
                        }
                    }
                });
            });
            
            // Remove duplicates based on id
            const uniqueSurcharges = [];
            const seenIds = new Set();
            surcharges.forEach(surcharge => {
                if (!seenIds.has(surcharge.id)) {
                    seenIds.add(surcharge.id);
                    uniqueSurcharges.push(surcharge);
                }
            });
            
            console.log('üí∞ Total unique surcharges found:', uniqueSurcharges.length);
            console.log('üí∞ Surcharges list:', uniqueSurcharges);
            
            // Render surcharges
            renderSurcharges(uniqueSurcharges);
        }
        
        function isAirportLocation(location) {
            if (!location) return false;
            const airportKeywords = [
                'Brussels Airport', 'Brussels South Charleroi Airport', 'Antwerp Airport',
                'Li√®ge Airport', 'Ostend-Bruges Airport', 'airport', 'luchthaven'
            ];
            return airportKeywords.some(keyword => 
                location.toLowerCase().includes(keyword.toLowerCase())
            );
        }
        
        function renderSurcharges(surcharges) {
            const surchargesList = document.getElementById('editSurchargesList');
            
            if (surcharges.length === 0) {
                surchargesList.innerHTML = '<div style="color: #999; font-style: italic;">No surcharges</div>';
                return;
            }
            
            let html = '';
            surcharges.forEach(surcharge => {
                html += `
                    <div class="surcharge-item" style="display: flex; justify-content: space-between; align-items: center; padding: 10px; background: #f8f9fa; border-radius: 6px; margin-bottom: 8px;">
                        <div>
                            <span class="font-medium">${surcharge.name}</span>
                            ${surcharge.quantity ? `<span style="color: #666; font-size: 12px;"> (${surcharge.quantity}x)</span>` : ''}
                        </div>
                        <div class="flex-center">
                            <span style="font-weight: 600;">‚Ç¨${surcharge.price.toFixed(2)}</span>
                            ${surcharge.removable ? `<button onclick="removeSurcharge('${surcharge.id}')" style="background: #dc3545; color: white; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer; font-size: 12px;">üóë</button>` : ''}
                        </div>
                    </div>
                `;
            });
            
            surchargesList.innerHTML = html;
        }
        
        function addNewSurcharge() {
            // Get available surcharge items from NEW Item Surcharge configuration
            const surchargeItems = JSON.parse(localStorage.getItem('surchargeItems') || '{}');
            
            console.log('üìã Loading surcharge items for admin selection:', surchargeItems);
            
            if (!surchargeItems.fixed && !surchargeItems.additional) {
                alert('‚ùå Geen Item Surcharge geconfigureerd.\n\nGa naar Settings ‚Üí Item Surcharge om items te configureren.');
                return;
            }
            
            // Create options list with better structure
            let availableItems = [];
            
            // Add fixed items (Meet & Greet, Child seat, Dog, etc.)
            if (surchargeItems.fixed) {
                surchargeItems.fixed.forEach(item => {
                    if (item.enabled && item.price > 0) {
                        availableItems.push({
                            id: item.id,
                            name: item.name,
                            price: item.price,
                            type: 'fixed',
                            hasDropdown: item.hasDropdown,
                            dropdownOptions: item.dropdownOptions
                        });
                    }
                });
            }
            
            // Add additional items (Golf material, Ski material, etc.)
            if (surchargeItems.additional) {
                surchargeItems.additional.forEach(item => {
                    if (item.enabled !== false && item.price > 0) {
                        availableItems.push({
                            id: item.id,
                            name: item.name,
                            price: item.price,
                            type: 'additional',
                            hasDropdown: item.hasDropdown,
                            dropdownOptions: item.dropdownOptions
                        });
                    }
                });
            }
            
            if (availableItems.length === 0) {
                alert('‚ùå Geen actieve surcharge items gevonden met prijs > ‚Ç¨0.');
                return;
            }
            
            // Show selection dialog
            showSurchargeSelectionDialog(availableItems);
        }
        
        function showSurchargeSelectionDialog(availableItems) {
            // Create modal dialog for surcharge selection
            const dialogHTML = `
                <div id="surchargeSelectionModal" style="
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0,0,0,0.7);
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    z-index: 2000;
                ">
                    <div style="
                        background: white;
                        border-radius: 12px;
                        padding: 25px;
                        max-width: 600px;
                        width: 90%;
                        max-height: 80vh;
                        overflow-y: auto;
                        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
                    ">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <h3 style="margin: 0; color: #2c3e50;">üéüÔ∏è Item Surcharge Toevoegen</h3>
                            <button onclick="closeSurchargeSelectionDialog()" style="
                                background: #e74c3c;
                                color: white;
                                border: none;
                                border-radius: 6px;
                                padding: 8px 12px;
                                cursor: pointer;
                                font-size: 14px;
                            ">‚úï Sluiten</button>
                        </div>
                        
                        <div class="section-margin-lg">
                            <p style="color: #666; margin: 0;">Selecteer een item om toe te voegen aan de boeking:</p>
                        </div>
                        
                        <div id="surchargeItemsList" style="max-height: 400px; overflow-y: auto;">
                            ${availableItems.map(item => `
                                <div class="surcharge-selection-item" style="
                                    border: 2px solid #e9ecef;
                                    border-radius: 8px;
                                    padding: 15px;
                                    margin-bottom: 10px;
                                    cursor: pointer;
                                    transition: all 0.3s ease;
                                    background: white;
                                " onclick="selectSurchargeItem('${item.id}', '${item.type}')" 
                                   onmouseover="this.style.borderColor='#007bff'; this.style.background='#f8f9ff';"
                                   onmouseout="this.style.borderColor='#e9ecef'; this.style.background='white';">
                                    
                                    <div style="display: flex; justify-content: space-between; align-items: center;">
                                        <div>
                                            <div style="font-weight: 600; font-size: 16px; color: #2c3e50;">
                                                ${item.name}
                                            </div>
                                            <div style="font-size: 12px; color: #666; margin-top: 2px;">
                                                Type: ${item.type === 'fixed' ? 'Fixed Item' : 'Additional Item'}
                                                ${item.hasDropdown ? ' ‚Ä¢ Heeft opties' : ''}
                                            </div>
                                        </div>
                                        <div style="
                                            background: #28a745;
                                            color: white;
                                            padding: 6px 12px;
                                            border-radius: 6px;
                                            font-weight: 600;
                                        ">
                                            ‚Ç¨${item.price.toFixed(2)}
                                        </div>
                                    </div>
                                    
                                    ${item.hasDropdown && item.dropdownOptions ? `
                                        <div style="margin-top: 10px; padding-top: 10px; border-top: 1px solid #e9ecef;">
                                            <div style="font-size: 12px; color: #666; margin-bottom: 5px;">Beschikbare opties:</div>
                                            ${item.dropdownOptions.map(option => `
                                                <span style="
                                                    display: inline-block;
                                                    background: #f8f9fa;
                                                    border: 1px solid #dee2e6;
                                                    padding: 2px 6px;
                                                    margin: 2px;
                                                    border-radius: 4px;
                                                    font-size: 11px;
                                                    color: #495057;
                                                ">
                                                    ${option.name || option.id} (‚Ç¨${option.price || item.price})
                                                </span>
                                            `).join('')}
                                        </div>
                                    ` : ''}
                                </div>
                            `).join('')}
                        </div>
                        
                        <div style="text-align: center; margin-top: 20px;">
                            <button onclick="closeSurchargeSelectionDialog()" style="
                                background: #6c757d;
                                color: white;
                                border: none;
                                border-radius: 6px;
                                padding: 10px 20px;
                                cursor: pointer;
                                font-size: 14px;
                            ">Annuleren</button>
                        </div>
                    </div>
                </div>
            `;
            
            // Add to page
            document.body.insertAdjacentHTML('beforeend', dialogHTML);
        }
        
        function closeSurchargeSelectionDialog() {
            const modal = document.getElementById('surchargeSelectionModal');
            if (modal) {
                modal.remove();
            }
        }
        
        function selectSurchargeItem(itemId, itemType) {
            console.log('üéüÔ∏è Selecting surcharge item:', itemId, itemType);
            
            // Get the full item configuration
            const surchargeItems = JSON.parse(localStorage.getItem('surchargeItems') || '{}');
            let selectedItem = null;
            
            // Find the item in the appropriate category
            if (itemType === 'fixed' && surchargeItems.fixed) {
                selectedItem = surchargeItems.fixed.find(item => item.id === itemId);
            } else if (itemType === 'additional' && surchargeItems.additional) {
                selectedItem = surchargeItems.additional.find(item => item.id === itemId);
            }
            
            if (!selectedItem) {
                alert('‚ùå Item niet gevonden in configuratie.');
                return;
            }
            
            console.log('üìã Found item:', selectedItem);
            
            // Close the selection dialog
            closeSurchargeSelectionDialog();
            
            // Handle items with dropdown options (like Child seat, Dog)
            if (selectedItem.hasDropdown && selectedItem.dropdownOptions && selectedItem.dropdownOptions.length > 0) {
                showDropdownOptionsDialog(selectedItem);
            } else {
                // Simple item - just ask for quantity
                showQuantityDialog(selectedItem);
            }
        }
        
        function showDropdownOptionsDialog(item) {
            const dialogHTML = `
                <div id="dropdownOptionsModal" style="
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0,0,0,0.7);
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    z-index: 2001;
                ">
                    <div style="
                        background: white;
                        border-radius: 12px;
                        padding: 25px;
                        max-width: 500px;
                        width: 90%;
                        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
                    ">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <h3 style="margin: 0; color: #2c3e50;">üîΩ ${item.name} - Selecteer Optie</h3>
                            <button onclick="closeDropdownOptionsDialog()" style="
                                background: #e74c3c;
                                color: white;
                                border: none;
                                border-radius: 6px;
                                padding: 8px 12px;
                                cursor: pointer;
                                font-size: 14px;
                            ">‚úï</button>
                        </div>
                        
                        <div class="section-margin-lg">
                            <p style="color: #666; margin: 0;">Kies een specifieke optie:</p>
                        </div>
                        
                        <div>
                            ${item.dropdownOptions.map(option => `
                                <div class="dropdown-option-item" style="
                                    border: 2px solid #e9ecef;
                                    border-radius: 8px;
                                    padding: 12px;
                                    margin-bottom: 8px;
                                    cursor: pointer;
                                    transition: all 0.3s ease;
                                    background: white;
                                " onclick="selectDropdownOption('${item.id}', '${option.id || option.name}', ${option.price || item.price})"
                                   onmouseover="this.style.borderColor='#007bff'; this.style.background='#f8f9ff';"
                                   onmouseout="this.style.borderColor='#e9ecef'; this.style.background='white';">
                                    
                                    <div style="display: flex; justify-content: space-between; align-items: center;">
                                        <div style="font-weight: 500; color: #2c3e50;">
                                            ${option.name || option.id}
                                        </div>
                                        <div style="
                                            background: #28a745;
                                            color: white;
                                            padding: 4px 8px;
                                            border-radius: 4px;
                                            font-weight: 600;
                                            font-size: 14px;
                                        ">
                                            ‚Ç¨${(option.price || item.price).toFixed(2)}
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                        
                        <div style="text-align: center; margin-top: 20px;">
                            <button onclick="closeDropdownOptionsDialog()" style="
                                background: #6c757d;
                                color: white;
                                border: none;
                                border-radius: 6px;
                                padding: 10px 20px;
                                cursor: pointer;
                                font-size: 14px;
                            ">Annuleren</button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', dialogHTML);
        }
        
        function closeDropdownOptionsDialog() {
            const modal = document.getElementById('dropdownOptionsModal');
            if (modal) {
                modal.remove();
            }
        }
        
        function selectDropdownOption(itemId, optionId, price) {
            console.log('üéØ Selected dropdown option:', { itemId, optionId, price });
            
            // Close dropdown dialog
            closeDropdownOptionsDialog();
            
            // Create a modified item for quantity selection
            const itemWithOption = {
                id: `${itemId}_${optionId}`,
                name: `${optionId}`, // Will be the option name like "Maxi Cosi" or "Kleine hond"
                price: price,
                type: 'selected_option',
                parentId: itemId,
                optionId: optionId
            };
            
            // Show quantity dialog
            showQuantityDialog(itemWithOption);
        }
        
        function showQuantityDialog(item) {
            const maxQuantity = item.type === 'additional' ? 10 : 5; // Different max for different types
            
            const dialogHTML = `
                <div id="quantityModal" style="
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0,0,0,0.7);
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    z-index: 2002;
                ">
                    <div style="
                        background: white;
                        border-radius: 12px;
                        padding: 25px;
                        max-width: 400px;
                        width: 90%;
                        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
                    ">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <h3 style="margin: 0; color: #2c3e50;">üî¢ Aantal: ${item.name}</h3>
                            <button onclick="closeQuantityDialog()" style="
                                background: #e74c3c;
                                color: white;
                                border: none;
                                border-radius: 6px;
                                padding: 8px 12px;
                                cursor: pointer;
                                font-size: 14px;
                            ">‚úï</button>
                        </div>
                        
                        <div style="text-align: center; margin-bottom: 25px;">
                            <div style="color: #666; margin-bottom: 15px;">Hoeveel ${item.name} wilt u toevoegen?</div>
                            
                            <div style="
                                background: #f8f9fa;
                                border: 2px solid #e9ecef;
                                border-radius: 8px;
                                padding: 15px;
                                margin-bottom: 15px;
                            ">
                                <div style="font-size: 18px; font-weight: 600; color: #2c3e50; margin-bottom: 8px;">
                                    ‚Ç¨${item.price.toFixed(2)} per stuk
                                </div>
                                <div style="font-size: 14px; color: #666;">
                                    Totaal: ‚Ç¨<span id="totalPrice">${item.price.toFixed(2)}</span>
                                </div>
                            </div>
                            
                            <div style="display: flex; align-items: center; justify-content: center; gap: 15px;">
                                <button onclick="adjustQuantity(-1)" style="
                                    background: #dc3545;
                                    color: white;
                                    border: none;
                                    border-radius: 50%;
                                    width: 40px;
                                    height: 40px;
                                    cursor: pointer;
                                    font-size: 18px;
                                    font-weight: 600;
                                ">‚àí</button>
                                
                                <input type="number" id="quantityInput" value="1" min="1" max="${maxQuantity}" 
                                       onchange="updateTotalPrice()" style="
                                    width: 80px;
                                    padding: 10px;
                                    text-align: center;
                                    border: 2px solid #007bff;
                                    border-radius: 6px;
                                    font-size: 18px;
                                    font-weight: 600;
                                ">
                                
                                <button onclick="adjustQuantity(1)" style="
                                    background: #28a745;
                                    color: white;
                                    border: none;
                                    border-radius: 50%;
                                    width: 40px;
                                    height: 40px;
                                    cursor: pointer;
                                    font-size: 18px;
                                    font-weight: 600;
                                ">+</button>
                            </div>
                        </div>
                        
                        <div style="text-align: center; display: flex; gap: 10px; justify-content: center;">
                            <button onclick="closeQuantityDialog()" style="
                                background: #6c757d;
                                color: white;
                                border: none;
                                border-radius: 6px;
                                padding: 12px 20px;
                                cursor: pointer;
                                font-size: 14px;
                            ">Annuleren</button>
                            
                            <button onclick="confirmAddSurcharge()" style="
                                background: #007bff;
                                color: white;
                                border: none;
                                border-radius: 6px;
                                padding: 12px 20px;
                                cursor: pointer;
                                font-size: 14px;
                                font-weight: 600;
                            ">‚úÖ Toevoegen</button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', dialogHTML);
            
            // Store item data for later use
            window.currentSurchargeItem = item;
        }
        
        function closeQuantityDialog() {
            const modal = document.getElementById('quantityModal');
            if (modal) {
                modal.remove();
            }
            window.currentSurchargeItem = null;
        }
        
        function adjustQuantity(delta) {
            const input = document.getElementById('quantityInput');
            if (input) {
                const currentValue = parseInt(input.value) || 1;
                const newValue = Math.max(1, Math.min(parseInt(input.max), currentValue + delta));
                input.value = newValue;
                updateTotalPrice();
            }
        }
        
        function updateTotalPrice() {
            const input = document.getElementById('quantityInput');
            const totalPriceSpan = document.getElementById('totalPrice');
            
            if (input && totalPriceSpan && window.currentSurchargeItem) {
                const quantity = parseInt(input.value) || 1;
                const total = window.currentSurchargeItem.price * quantity;
                totalPriceSpan.textContent = total.toFixed(2);
            }
        }
        
        function confirmAddSurcharge() {
            if (!window.currentSurchargeItem || !currentEditingBooking) {
                alert('‚ùå Fout: Item of booking niet gevonden.');
                return;
            }
            
            const input = document.getElementById('quantityInput');
            const quantity = parseInt(input.value) || 1;
            
            console.log('‚úÖ Adding surcharge to booking:', {
                item: window.currentSurchargeItem,
                quantity: quantity,
                booking: currentEditingBooking.bookingId
            });
            
            // Add to booking surcharges
            if (!currentEditingBooking.surcharges) {
                currentEditingBooking.surcharges = {};
            }
            
            // Create unique key for this surcharge
            const surchargeKey = window.currentSurchargeItem.id;
            const totalPrice = window.currentSurchargeItem.price * quantity;
            
            // Add the surcharge
            currentEditingBooking.surcharges[surchargeKey] = {
                name: window.currentSurchargeItem.name,
                price: window.currentSurchargeItem.price,
                quantity: quantity,
                type: window.currentSurchargeItem.type || 'manual',
                removable: true
            };
            
            // Update the booking in localStorage
            updateBookingInStorage(currentEditingBooking);
            
            // Recalculate and reload display
            recalculateSurchargeTotal();
            loadBookingSurcharges(currentEditingBooking);
            
            // Close dialog
            closeQuantityDialog();
            
            // Show success message
            alert(`‚úÖ ${window.currentSurchargeItem.name} (${quantity}x) toegevoegd voor ‚Ç¨${totalPrice.toFixed(2)}`);
            
            console.log('‚úÖ Surcharge added successfully');
        }
        
        function updateBookingInStorage(booking) {
            // Update in all possible locations where the booking might be stored
            const storageKeys = ['unconfirmedBookings', 'confirmedBookings', 'completedBookings', 'cancelledBookings'];
            
            storageKeys.forEach(key => {
                const bookings = JSON.parse(localStorage.getItem(key) || '[]');
                const index = bookings.findIndex(b => b.bookingId === booking.bookingId);
                
                if (index !== -1) {
                    bookings[index] = booking;
                    localStorage.setItem(key, JSON.stringify(bookings));
                    console.log(`üìã Updated booking in ${key}`);
                }
            });
        }
        
        function addSurchargeToBooking(itemKey, item, quantity) {
            if (!currentEditingBooking) return;
            
            // Initialize surcharges if not exists
            if (!currentEditingBooking.surcharges) {
                currentEditingBooking.surcharges = { items: {}, totalSurcharge: 0 };
            }
            
            // Add or update the surcharge
            currentEditingBooking.surcharges.items[itemKey] = {
                name: item.name,
                price: item.price,
                quantity: quantity
            };
            
            // Recalculate total
            recalculateSurchargeTotal();
            
            // Reload the display
            loadBookingSurcharges(currentEditingBooking);
        }
        
        function removeSurcharge(surchargeId) {
            if (!currentEditingBooking || !currentEditingBooking.surcharges) return;
            
            if (surchargeId === 'airport_surcharge') {
                alert('Airport surcharge cannot be removed as this trip originates from an airport.');
                return;
            }
            
            delete currentEditingBooking.surcharges.items[surchargeId];
            recalculateSurchargeTotal();
            loadBookingSurcharges(currentEditingBooking);
        }
        
        function recalculateSurchargeTotal() {
            if (!currentEditingBooking || !currentEditingBooking.surcharges) return;
            
            let total = 0;
            
            // Add airport surcharge if applicable
            const isFromAirport = isAirportLocation(currentEditingBooking.trip?.fromLocation || '');
            if (isFromAirport) {
                total += 5.00;
            }
            
            // Add manual surcharges
            Object.values(currentEditingBooking.surcharges.items || {}).forEach(item => {
                total += parseFloat(item.price) * parseInt(item.quantity || 1);
            });
            
            currentEditingBooking.surcharges.totalSurcharge = total;
            
            // Update the price field
            const vehiclePrice = currentEditingBooking.vehicle?.pricing?.minimumPrice || currentEditingBooking.vehicle?.price || 50.00;
            const totalPrice = parseFloat(vehiclePrice) + total;
            
            const priceField = document.getElementById('editPrice');
            if (priceField) {
                priceField.value = totalPrice.toFixed(2);
            }
        }

        function saveBookingChanges() {
            if (!currentEditingBooking) {
                alert('‚ùå No booking data to save');
                return;
            }
            
            console.log('üíæ Saving booking changes for:', currentEditingBooking.bookingId);
            
            // Validate required fields
            const firstName = document.getElementById('editFirstName').value.trim();
            const lastName = document.getElementById('editLastName').value.trim();
            const email = document.getElementById('editEmail').value.trim();
            const phone = document.getElementById('editPhone').value.trim();
            const fromLocation = document.getElementById('editFromLocation').value.trim();
            const toLocation = document.getElementById('editToLocation').value.trim();
            
            if (!firstName || !lastName || !email || !phone || !fromLocation || !toLocation) {
                alert('‚ùå Please fill in all required fields');
                return;
            }
            
            // Email validation
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                alert('‚ùå Please enter a valid email address');
                return;
            }
            
            // Update booking data
            const updatedBooking = {
                ...currentEditingBooking,
                customer: {
                    ...currentEditingBooking.customer,
                    firstName: firstName,
                    lastName: lastName,
                    email: email,
                    phone: phone,
                    passengers: document.getElementById('editPassengers').value,
                    paymentMethod: document.getElementById('editPaymentMethod').value
                },
                trip: {
                    ...currentEditingBooking.trip,
                    fromLocation: fromLocation,
                    toLocation: toLocation,
                    travelDate: convertDateToDisplayFormat(document.getElementById('editTravelDate').value),
                    travelHour: document.getElementById('editTravelTime').value.split(':')[0],
                    travelMinute: document.getElementById('editTravelTime').value.split(':')[1],
                    returnActive: document.getElementById('editReturnTrip').value
                },
                vehicle: {
                    ...currentEditingBooking.vehicle,
                    vehicle: {
                        ...currentEditingBooking.vehicle?.vehicle,
                        id: document.getElementById('editVehicleType').value,
                        name: getVehicleName(document.getElementById('editVehicleType').value)
                    },
                    pricing: {
                        ...currentEditingBooking.vehicle?.pricing,
                        minimumPrice: parseFloat(document.getElementById('editPrice').value)
                    }
                },
                status: document.getElementById('editBookingStatus').value,
                driver: document.getElementById('editDriver').value,
                specialInstructions: document.getElementById('editSpecialInstructions').value,
                surcharges: currentEditingBooking.surcharges || { items: {}, totalSurcharge: 0 },
                lastUpdated: new Date().toISOString()
            };
            
            // Update in localStorage
            updateBookingInStorage(updatedBooking);
            
            // Close modal and refresh display
            closeBookingModal();
            loadUnconfirmedBookingsV2();
            
            alert('‚úÖ Booking updated successfully!');
            console.log('‚úÖ Booking saved:', updatedBooking);
        }

        function convertDateToDisplayFormat(dateString) {
            // Convert from YYYY-MM-DD to DD/MM/YYYY
            if (!dateString) return '';
            const dateParts = dateString.split('-');
            if (dateParts.length === 3) {
                return `${dateParts[2]}/${dateParts[1]}/${dateParts[0]}`;
            }
            return dateString;
        }

        function getVehicleName(vehicleId) {
            const vehicleNames = {
                'saloon': 'Saloon',
                'estate': 'Estate',
                'minivan': 'Minivan',
                'minivan_long': 'Minivan Long'
            };
            return vehicleNames[vehicleId] || 'Unknown';
        }

        function confirmBookingFromModal() {
            if (!currentEditingBooking) {
                alert('‚ùå No booking to confirm');
                return;
            }
            
            // Update status to confirmed
            document.getElementById('editBookingStatus').value = 'confirmed';
            
            // Save changes
            saveBookingChanges();
            
            console.log('‚úÖ Booking confirmed from modal');
        }

        function deleteBooking() {
            console.log('üóëÔ∏è deleteBooking function called');
            console.log('üìã currentEditingBooking:', currentEditingBooking);
            
            if (!currentEditingBooking) {
                alert('‚ùå No booking to delete');
                console.error('‚ùå currentEditingBooking is null or undefined');
                return;
            }
            
            if (!confirm(`üóëÔ∏è Move booking ${currentEditingBooking.bookingId} to Trash?\n\nYou can restore it later from the Trash section.`)) {
                console.log('‚ùå User cancelled delete operation');
                return;
            }
            
            try {
                console.log('üóëÔ∏è Moving booking to trash...');
                
                // Add deleted timestamp
                const bookingForTrash = {
                    ...currentEditingBooking,
                    deletedDate: new Date().toISOString(),
                    originalStatus: currentEditingBooking.status || 'unconfirmed'
                };
                
                // Add to trash
                let trashItems = JSON.parse(localStorage.getItem('trashItems') || '[]');
                trashItems.unshift(bookingForTrash);
                localStorage.setItem('trashItems', JSON.stringify(trashItems));
                console.log('üóëÔ∏è Added to trash:', bookingForTrash.bookingId);
                
                // Remove from all active lists
                let unconfirmedBookings = JSON.parse(localStorage.getItem('unconfirmedBookings') || '[]');
                const beforeCount = unconfirmedBookings.length;
                unconfirmedBookings = unconfirmedBookings.filter(b => b.bookingId !== currentEditingBooking.bookingId);
                localStorage.setItem('unconfirmedBookings', JSON.stringify(unconfirmedBookings));
                console.log(`üìã Unconfirmed: ${beforeCount} ‚Üí ${unconfirmedBookings.length}`);
                
                let confirmedBookings = JSON.parse(localStorage.getItem('confirmedBookings') || '[]');
                const beforeConfirmed = confirmedBookings.length;
                confirmedBookings = confirmedBookings.filter(b => b.bookingId !== currentEditingBooking.bookingId);
                localStorage.setItem('confirmedBookings', JSON.stringify(confirmedBookings));
                console.log(`üìã Confirmed: ${beforeConfirmed} ‚Üí ${confirmedBookings.length}`);
                
                let completedBookings = JSON.parse(localStorage.getItem('completedBookings') || '[]');
                const beforeCompleted = completedBookings.length;
                completedBookings = completedBookings.filter(b => b.bookingId !== currentEditingBooking.bookingId);
                localStorage.setItem('completedBookings', JSON.stringify(completedBookings));
                console.log(`üìã Completed: ${beforeCompleted} ‚Üí ${completedBookings.length}`);
                
                let cancelledBookings = JSON.parse(localStorage.getItem('cancelledBookings') || '[]');
                const beforeCancelled = cancelledBookings.length;
                cancelledBookings = cancelledBookings.filter(b => b.bookingId !== currentEditingBooking.bookingId);
                localStorage.setItem('cancelledBookings', JSON.stringify(cancelledBookings));
                console.log(`üìã Cancelled: ${beforeCancelled} ‚Üí ${cancelledBookings.length}`);
                
                // Close modal and refresh
                closeBookingModal();
                
                // Reload the active section
                console.log('üîÑ Reloading active section...');
                if (document.getElementById('unconfirmed-section').classList.contains('active')) {
                    loadUnconfirmedBookingsV2();
                } else if (document.getElementById('next-24h-section').classList.contains('active')) {
                    loadNext24hBookings();
                } else if (document.getElementById('completed-section').classList.contains('active')) {
                    loadCompletedBookings();
                } else if (document.getElementById('cancelled-section').classList.contains('active')) {
                    loadCancelledBookings();
                } else if (document.getElementById('all-section').classList.contains('active')) {
                    loadAllBookings();
                } else if (document.getElementById('trash-section').classList.contains('active')) {
                    loadTrashItems();
                }
                
                alert('‚úÖ Booking moved to Trash successfully');
                console.log('üóëÔ∏è Booking moved to trash successfully:', currentEditingBooking.bookingId);
            } catch (error) {
                console.error('‚ùå Error in deleteBooking:', error);
                alert('‚ùå Error moving booking to trash: ' + error.message);
            }
        }

        // Trash Functions
        function loadTrashItems() {
            console.log('üóëÔ∏è Loading trash items...');
            
            const tableBody = document.getElementById('trashTableBody');
            const countDisplay = document.getElementById('trashCount');
            
            if (!tableBody) {
                console.error('‚ùå Trash table body not found');
                return;
            }
            
            const trashItems = JSON.parse(localStorage.getItem('trashItems') || '[]');
            console.log(`üóëÔ∏è Found ${trashItems.length} items in trash`);
            
            if (countDisplay) {
                countDisplay.textContent = `${trashItems.length} items`;
            }
            
            if (trashItems.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="7" class="empty-state">
                            üóëÔ∏è No items in trash
                        </td>
                    </tr>
                `;
                return;
            }
            
            let html = '';
            trashItems.forEach(booking => {
                const deletedDate = new Date(booking.deletedDate).toLocaleDateString('nl-NL');
                const vehicleName = getVehicleName(booking.vehicle?.id || booking.selectedVehicle);
                const totalPrice = booking.pricing?.totalPrice || booking.vehicle?.pricing?.totalPrice || '0.00';
                const fromCountry = detectCountryFromAddress(booking.trip?.fromLocation);
                const toCountry = detectCountryFromAddress(booking.trip?.toLocation);
                const isCrossBorder = fromCountry !== toCountry;
                const countryInfo = getCountryInfo(fromCountry);
                const originalStatus = booking.originalStatus || 'Unknown';
                
                html += `
                    <tr style="border-bottom: 1px solid #f1f3f4;">
                        <td class="table-cell" style="text-align: center; padding: 8px 4px;">
                            <div style="position: relative; display: inline-block;">
                                ${countryInfo.flag}
                                ${isCrossBorder ? '<div style="font-size: 10px; color: #ff6b6b;">üåê</div>' : ''}
                                <button onclick="viewBookingDetails('${booking.bookingId}')" style="display: block; background: transparent; border: none; cursor: pointer; margin-top: 2px; font-size: 12px;">üëÅ</button>
                            </div>
                        </td>
                        <td class="table-cell" style="padding: 8px;">
                            <div class="font-medium" style="font-size: 13px;">${booking.customer?.firstName || ''} ${booking.customer?.lastName || ''}</div>
                            <div class="small-text" style="font-size: 11px; color: #666;">üìû ${booking.customer?.phone || ''}</div>
                            <div class="small-text" style="font-size: 11px; color: #666;">${booking.trip?.fromLocation || ''} ‚Üí ${booking.trip?.toLocation || ''}</div>
                            <div style="font-weight: 600; color: #2c3e50; font-size: 11px;">${booking.bookingId}</div>
                        </td>
                        <td class="table-cell" style="padding: 8px; font-size: 12px;">
                            <div>${convertDateToDisplayFormat(booking.trip?.travelDate)}</div>
                            <div style="font-size: 11px; color: #666;">${booking.trip?.travelHour}:${booking.trip?.travelMinute}</div>
                        </td>
                        <td class="table-cell" style="padding: 8px;">
                            <span class="status-badge" style="font-size: 11px; padding: 4px 8px; background: #6c757d; color: white; border-radius: 4px;">
                                üóëÔ∏è Deleted
                            </span>
                            <div style="font-size: 10px; color: #666; margin-top: 2px;">was ${originalStatus}</div>
                        </td>
                        <td class="table-cell" style="padding: 8px;">
                            <div style="display: flex; gap: 4px; flex-direction: column;">
                                <button onclick="restoreFromTrash('${booking.bookingId}')" 
                                        style="background: #28a745; color: white; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer; font-size: 11px;">
                                    ‚Ü©Ô∏è Restore
                                </button>
                                <button onclick="permanentDeleteFromTrash('${booking.bookingId}')" 
                                        style="background: #dc3545; color: white; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer; font-size: 11px;">
                                    üóëÔ∏è Delete
                                </button>
                            </div>
                        </td>
                        <td class="table-cell" style="padding: 8px; font-size: 12px;">
                            <span style="background: #e9ecef; padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: 500;">
                                ${vehicleName}
                            </span>
                        </td>
                        <td class="table-cell" style="padding: 8px; font-size: 12px;">
                            <div>Deleted ${deletedDate}</div>
                        </td>
                        <td class="table-cell" style="padding: 8px; text-align: left;">
                            <span style="font-weight: 600; color: #28a745;">‚Ç¨${parseFloat(totalPrice).toFixed(2)}</span>
                        </td>
                        <td class="table-cell" style="text-align: center; padding: 8px 4px;">
                            <button onclick="openEmailModal('${booking.bookingId}')" style="background: transparent; border: none; cursor: pointer; font-size: 16px;">‚úâÔ∏è</button>
                        </td>
                    </tr>
                `;
            });
            
            tableBody.innerHTML = html;
        }
        
        function restoreFromTrash(bookingId) {
            console.log('‚Ü©Ô∏è Restoring booking from trash:', bookingId);
            
            if (!confirm(`‚Ü©Ô∏è Restore booking ${bookingId} from trash?`)) {
                return;
            }
            
            try {
                // Get trash items
                let trashItems = JSON.parse(localStorage.getItem('trashItems') || '[]');
                const bookingIndex = trashItems.findIndex(b => b.bookingId === bookingId);
                
                if (bookingIndex === -1) {
                    alert('‚ùå Booking not found in trash');
                    return;
                }
                
                const booking = trashItems[bookingIndex];
                const originalStatus = booking.originalStatus || 'unconfirmed';
                
                // Remove from trash
                trashItems.splice(bookingIndex, 1);
                localStorage.setItem('trashItems', JSON.stringify(trashItems));
                
                // Clean up the booking object
                delete booking.deletedDate;
                delete booking.originalStatus;
                
                // Restore to original list
                if (originalStatus === 'confirmed') {
                    let confirmedBookings = JSON.parse(localStorage.getItem('confirmedBookings') || '[]');
                    confirmedBookings.unshift(booking);
                    localStorage.setItem('confirmedBookings', JSON.stringify(confirmedBookings));
                } else if (originalStatus === 'completed') {
                    let completedBookings = JSON.parse(localStorage.getItem('completedBookings') || '[]');
                    completedBookings.unshift(booking);
                    localStorage.setItem('completedBookings', JSON.stringify(completedBookings));
                } else if (originalStatus === 'cancelled') {
                    let cancelledBookings = JSON.parse(localStorage.getItem('cancelledBookings') || '[]');
                    cancelledBookings.unshift(booking);
                    localStorage.setItem('cancelledBookings', JSON.stringify(cancelledBookings));
                } else {
                    // Default to unconfirmed
                    let unconfirmedBookings = JSON.parse(localStorage.getItem('unconfirmedBookings') || '[]');
                    unconfirmedBookings.unshift(booking);
                    localStorage.setItem('unconfirmedBookings', JSON.stringify(unconfirmedBookings));
                }
                
                // Refresh trash view
                loadTrashItems();
                
                alert(`‚úÖ Booking ${bookingId} restored to ${originalStatus} list`);
                console.log('‚Ü©Ô∏è Booking restored successfully:', bookingId);
                
            } catch (error) {
                console.error('‚ùå Error restoring booking:', error);
                alert('‚ùå Error restoring booking: ' + error.message);
            }
        }
        
        function permanentDeleteFromTrash(bookingId) {
            console.log('üóëÔ∏è Permanent delete from trash:', bookingId);
            
            if (!confirm(`‚ö†Ô∏è PERMANENTLY DELETE booking ${bookingId}?\n\nThis action CANNOT be undone!`)) {
                return;
            }
            
            try {
                // Get trash items
                let trashItems = JSON.parse(localStorage.getItem('trashItems') || '[]');
                const bookingIndex = trashItems.findIndex(b => b.bookingId === bookingId);
                
                if (bookingIndex === -1) {
                    alert('‚ùå Booking not found in trash');
                    return;
                }
                
                // Remove from trash permanently
                trashItems.splice(bookingIndex, 1);
                localStorage.setItem('trashItems', JSON.stringify(trashItems));
                
                // Refresh trash view
                loadTrashItems();
                
                alert(`‚úÖ Booking ${bookingId} permanently deleted`);
                console.log('üóëÔ∏è Booking permanently deleted:', bookingId);
                
            } catch (error) {
                console.error('‚ùå Error permanently deleting booking:', error);
                alert('‚ùå Error permanently deleting booking: ' + error.message);
            }
        }
        
        function clearAllTrash() {
            const trashItems = JSON.parse(localStorage.getItem('trashItems') || '[]');
            
            if (trashItems.length === 0) {
                alert('üóëÔ∏è Trash is already empty');
                return;
            }
            
            if (!confirm(`‚ö†Ô∏è PERMANENTLY DELETE all ${trashItems.length} items from trash?\n\nThis action CANNOT be undone!`)) {
                return;
            }
            
            localStorage.setItem('trashItems', JSON.stringify([]));
            loadTrashItems();
            
            alert(`‚úÖ All ${trashItems.length} items permanently deleted from trash`);
            console.log('üóëÔ∏è All trash items cleared');
        }
        
        function restoreAllTrash() {
            const trashItems = JSON.parse(localStorage.getItem('trashItems') || '[]');
            
            if (trashItems.length === 0) {
                alert('üóëÔ∏è Trash is empty - nothing to restore');
                return;
            }
            
            if (!confirm(`‚Ü©Ô∏è Restore all ${trashItems.length} items from trash?`)) {
                return;
            }
            
            try {
                // Get all storage lists
                let unconfirmedBookings = JSON.parse(localStorage.getItem('unconfirmedBookings') || '[]');
                let confirmedBookings = JSON.parse(localStorage.getItem('confirmedBookings') || '[]');
                let completedBookings = JSON.parse(localStorage.getItem('completedBookings') || '[]');
                let cancelledBookings = JSON.parse(localStorage.getItem('cancelledBookings') || '[]');
                
                // Restore each item to its original list
                trashItems.forEach(booking => {
                    const originalStatus = booking.originalStatus || 'unconfirmed';
                    
                    // Clean up the booking object
                    delete booking.deletedDate;
                    delete booking.originalStatus;
                    
                    // Add to appropriate list
                    if (originalStatus === 'confirmed') {
                        confirmedBookings.unshift(booking);
                    } else if (originalStatus === 'completed') {
                        completedBookings.unshift(booking);
                    } else if (originalStatus === 'cancelled') {
                        cancelledBookings.unshift(booking);
                    } else {
                        unconfirmedBookings.unshift(booking);
                    }
                });
                
                // Save all lists
                localStorage.setItem('unconfirmedBookings', JSON.stringify(unconfirmedBookings));
                localStorage.setItem('confirmedBookings', JSON.stringify(confirmedBookings));
                localStorage.setItem('completedBookings', JSON.stringify(completedBookings));
                localStorage.setItem('cancelledBookings', JSON.stringify(cancelledBookings));
                
                // Clear trash
                localStorage.setItem('trashItems', JSON.stringify([]));
                
                // Refresh trash view
                loadTrashItems();
                
                alert(`‚úÖ All ${trashItems.length} items restored from trash`);
                console.log('‚Ü©Ô∏è All trash items restored');
                
            } catch (error) {
                console.error('‚ùå Error restoring all items:', error);
                alert('‚ùå Error restoring items: ' + error.message);
            }
        }

        // Close modal when clicking outside
        document.addEventListener('click', function(event) {
            const modal = document.getElementById('bookingEditModal');
            if (event.target === modal) {
                closeBookingModal();
            }
        });

        // üö® OUDE FUNCTIE VOLLEDIG VERWIJDERD - ALLEEN regel ~7755 ACTIEF
        /*  COMMENTED OUT - LOOSE CODE CAUSING ERRORS
            
            // Get confirmed bookings from localStorage
            const confirmedBookings = JSON.parse(localStorage.getItem('confirmedBookings') || '[]');
            console.log('üìÖ Found confirmed bookings:', confirmedBookings.length);
            
            // Filter for next 24 hours
            const now = new Date();
            const next24h = new Date(now.getTime() + (24 * 60 * 60 * 1000));
            
            const upcomingBookings = confirmedBookings.filter(booking => {
                const travelDate = parseTravelDate(booking.trip.travelDate, booking.trip.travelHour, booking.trip.travelMinute);
                return travelDate >= now && travelDate <= next24h;
            });
            
            countDisplay.textContent = `${upcomingBookings.length} confirmed`;
            
            if (upcomingBookings.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="8" class="empty-state">
                            <h3>üìÖ No Bookings in Next 24 Hours</h3>
                            <p>Confirmed bookings for the next 24 hours will appear here</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            // Sort by travel date/time
            upcomingBookings.sort((a, b) => {
                const dateA = parseTravelDate(a.trip.travelDate, a.trip.travelHour, a.trip.travelMinute);
                const dateB = parseTravelDate(b.trip.travelDate, b.trip.travelHour, b.trip.travelMinute);
                return dateA - dateB;
            });
            
            // Generate table rows
            let tableHTML = '';
            
            upcomingBookings.forEach(booking => {
                const travelDate = parseTravelDate(booking.trip.travelDate, booking.trip.travelHour, booking.trip.travelMinute);
                const formattedDate = travelDate.toLocaleDateString('nl-BE');
                const formattedTime = `${booking.trip.travelHour}:${booking.trip.travelMinute}`;
                
                // Check if it's a single trip (no suffix) or return trip (has 'a' or 'b' suffix)
                const bookingId = booking.bookingId || '';
                const hasReturnSuffix = bookingId.endsWith('a') || bookingId.endsWith('b');
                const hasIndividualTrips = (booking.trip?.tripType === 'heen' || booking.trip?.tripType === 'terug') && hasReturnSuffix;
                let total;
                
                if (hasIndividualTrips) {
                    // EXACT STAP 3 PRICING LOGIC - MARCEL APPROVED
                    const step2FinalPrice = parseFloat(localStorage.getItem('step2FinalTotalPrice') || '0');
                    let heenTotaal, terugTotaal;
                    
                    if (step2FinalPrice > 0) {
                        finalTotalPrice = step2FinalPrice;
                        
                        // Find Meet & Greet price for correct distribution (EXACT STAP 3 logic)
                        let meetGreetPrice = 0;
                        const surchargeData = booking.surcharges;
                        if (surchargeData && surchargeData.selectedSurcharges) {
                            for (const [key, value] of Object.entries(surchargeData.selectedSurcharges)) {
                                if (key.toLowerCase().includes('meet') || key.toLowerCase().includes('greet')) {
                                    if (typeof value === 'object' && value.price) {
                                        meetGreetPrice = parseFloat(value.price) || 0;
                                    } else if (typeof value === 'number') {
                                        meetGreetPrice = value;
                                    }
                                    break;
                                }
                            }
                        }
                        
                        // Calculate exactly like STAP 3
                        if (meetGreetPrice > 0) {
                            const basePricePerTrip = (step2FinalPrice - meetGreetPrice) / 2;
                            heenTotaal = basePricePerTrip;
                            terugTotaal = basePricePerTrip + meetGreetPrice;
                        } else {
                            heenTotaal = step2FinalPrice / 2;
                            terugTotaal = step2FinalPrice / 2;
                        }
                    } else {
                        // Fallback if no step2 price
                        heenTotaal = finalTotalPrice / 2;
                        terugTotaal = finalTotalPrice / 2;
                    }
                    
                    if (booking.trip.tripType === 'heen') {
                        total = heenTotaal.toFixed(2);
                    } else {
                        total = terugTotaal.toFixed(2);
                    }
                } else {
                    total = parseFloat(booking.totalPrice || 50).toFixed(2);
                }
                
                console.log(`üí∞ Next 24h price (1st function): ‚Ç¨${total} for booking ${booking.bookingId}`);
                
                tableHTML += `
                    <tr style="border-bottom: 1px solid #dee2e6;">
                        <td class="table-cell">
                            <div style="display: flex; gap: 5px;">
                                <button style="background: transparent; border: 1px solid #dee2e6; padding: 4px 8px; border-radius: 4px; cursor: pointer;" onclick="showBookingOverview('${booking.bookingId}', '${booking.trip.tripType || 'heen'}')" title="View Details">
                                    üëÅ
                                </button>
                                <button style="background: #dc3545; color: white; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer; font-size: 12px;" onclick="deleteConfirmedBooking('${booking.bookingId}')" title="Delete">
                                    üóëÔ∏è
                                </button>
                            </div>
                        </td>
                        <td class="table-cell">
                            <div class="font-medium">${booking.customer.firstName} ${booking.customer.lastName}</div>
                            <div class="small-text">${booking.trip.fromLocation} ‚Üí ${booking.trip.toLocation}</div>
                            <div class="small-text">üìû ${booking.customer.phone}</div>
                            ${booking.trip.tripType ? `<div style="font-size: 11px; color: #007bff; font-weight: 500;">${booking.trip.tripType === 'heen' ? 'üîÑ HEEN' : 'üîÑ TERUG'}</div>` : ''}
                        </td>
                        <td class="table-cell">
                            <div class="font-medium">${formattedDate}</div>
                            <div style="color: #666; font-size: 12px;">${formattedTime}</div>
                        </td>
                        <td class="table-cell">
                            <select style="padding: 4px 8px; border: 1px solid #dee2e6; border-radius: 4px; font-size: 12px; background: #28a745; color: white; font-weight: 500;" onchange="updateBookingStatus('${booking.bookingId}', this.value)">
                                <option value="Confirmed" selected>Confirmed</option>
                                <option value="Completed">Completed</option>
                                <option value="Cancelled">Cancelled</option>
                                <option value="No Show">No Show</option>
                            </select>
                        </td>
                        <td class="table-cell">
                            <div>${booking.driver || 'Not assigned'}</div>
                        </td>
                        <td class="table-cell">
                            <div>${booking.vehicle?.vehicle?.name || 'Saloon'}</div>
                        </td>
                        <td class="table-cell">
                            <div class="small-text">${booking.specialInstructions || '-'}</div>
                        </td>
                        <td class="table-cell">
                            <div style="font-weight: 500; color: #28a745;">‚Ç¨${total}</div>
                        </td>
                        <td class="table-cell" style="text-align: center; padding: 8px;">
                            ${(() => {
                                // Detect country from pickup and destination addresses
                                const fromCountry = detectCountryFromAddress(booking.trip.fromLocation);
                                const toCountry = detectCountryFromAddress(booking.trip.toLocation);
                                const country = fromCountry;
                                const countryInfo = getCountryInfo(country);
                                
                                // Check if cross-border
                                const isCrossBorder = fromCountry !== toCountry;
                                const crossBorderText = isCrossBorder ? '<br><small style="color: #dc3545;">Cross-border</small>' : '';
                                
                                return `<div style="text-align: center;">
                                    <span style="font-size: 16px;">${countryInfo.flag}</span>
                                    <div style="font-weight: bold; color: ${countryInfo.color};">${countryInfo.name}</div>
                                    ${crossBorderText}
                                </div>`;
                            })()}
                        </td>
                        <td class="table-cell" style="text-align: center; padding: 8px;">
                            <div style="display: flex; gap: 4px; justify-content: center;">
                                <button onclick="dispatchAssignDriver('${booking.bookingId}')" 
                                        style="background: #28a745; color: white; border: none; padding: 4px 8px; border-radius: 4px; font-size: 11px; cursor: pointer;"
                                        title="Assign to specific driver">
                                    Assign
                                </button>
                                <button onclick="dispatchBroadcastRide('${booking.bookingId}')" 
                                        style="background: #007bff; color: white; border: none; padding: 4px 8px; border-radius: 4px; font-size: 11px; cursor: pointer;"
                                        title="Broadcast to all drivers">
                                    Broadcast
                                </button>
                                <button onclick="dispatchAutoAssign('${booking.bookingId}')" 
                                        style="background: #ffc107; color: black; border: none; padding: 4px 8px; border-radius: 4px; font-size: 11px; cursor: pointer;"
                                        title="Auto-assign within 24h">
                                    Auto
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            });
            
            tableBody.innerHTML = tableHTML;
        // }
        */

        // Cancelled Bookings Functions
        function loadCancelledBookings() {
            console.log('‚ùå Loading cancelled bookings...');
            
            const tableBody = document.getElementById('cancelledTableBody');
            const countDisplay = document.getElementById('cancelledCount');
            
            if (!tableBody) {
                console.error('‚ùå Cancelled table body not found');
                return;
            }
            
            // Get cancelled bookings from localStorage
            const cancelledBookings = JSON.parse(localStorage.getItem('cancelledBookings') || '[]');
            console.log('‚ùå Found cancelled bookings:', cancelledBookings.length);
            
            countDisplay.textContent = `${cancelledBookings.length} cancelled`;
            
            if (cancelledBookings.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="9" class="empty-state">
                            <h3>‚ùå No Cancelled Bookings</h3>
                            <p>Cancelled and deleted bookings will appear here</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            // Sort by cancelled date (most recent first)
            cancelledBookings.sort((a, b) => {
                const dateA = new Date(a.cancelledAt || a.lastUpdated);
                const dateB = new Date(b.cancelledAt || b.lastUpdated);
                return dateB - dateA;
            });
            
            // Generate table rows
            let tableHTML = '';
            
            cancelledBookings.forEach(booking => {
                const travelDate = parseTravelDate(booking.trip.travelDate, booking.trip.travelHour, booking.trip.travelMinute);
                const formattedDate = travelDate.toLocaleDateString('nl-BE');
                const formattedTime = travelDate.toLocaleTimeString('nl-BE', { hour: '2-digit', minute: '2-digit' });
                
                const cancelledDate = new Date(booking.cancelledAt || booking.lastUpdated);
                const formattedCancelledDate = cancelledDate.toLocaleDateString('nl-BE');
                
                // NIEUWE SPLIT PRICING VOOR CANCELLED - zelfde logica als Unconfirmed
                const vehiclePrice = booking.vehicle?.pricing?.totalPrice || booking.vehicle?.pricing?.minimumPrice || booking.vehicle?.price || 50.00;
                const isReturnTrip = booking.trip.returnActive === 'true' || booking.trip.returnActive === true;
                
                let total, priceDisplayHTML;
                
                if (isReturnTrip) {
                    // Voor heen en terug: ‚Ç¨100 wordt ‚Ç¨50 heen + ‚Ç¨50 terug
                    // MARCEL FIX: Bepaal finale prijs (zoals andere secties)
                    const step2FinalPrice = parseFloat(booking.finalPrice || booking.totalPrice || 0);
                    const originalBasePrice = step2FinalPrice || vehiclePrice;
                    const heenBasePrice = originalBasePrice / 2;
                    const terugBasePrice = originalBasePrice / 2;
                    
                    // Bepaal luchthaven pickup voor Meet & Greet
                    const fromAirport = booking.trip.fromLocation?.toLowerCase().includes('airport') || 
                                      booking.trip.fromLocation?.toLowerCase().includes('luchthaven') ||
                                      booking.trip.fromLocation?.toLowerCase().includes('zaventem');
                    const toAirport = booking.trip.toLocation?.toLowerCase().includes('airport') || 
                                    booking.trip.toLocation?.toLowerCase().includes('luchthaven') ||
                                    booking.trip.toLocation?.toLowerCase().includes('zaventem');
                    
                    // Bereken toeslagen per rit
                    let heenSurcharges = 0;
                    let terugSurcharges = 0;
                    
                    if (booking.surcharges && typeof booking.surcharges === 'object') {
                        Object.entries(booking.surcharges).forEach(([key, value]) => {
                            if (key === 'totalSurcharge') return;
                            
                            let itemPrice = 0;
                            if (typeof value === 'object' && value !== null && value.price) {
                                itemPrice = parseFloat(value.price) || 0;
                                const itemQuantity = parseInt(value.quantity) || 1;
                                itemPrice = itemPrice * itemQuantity;
                            } else if (typeof value === 'number' && value > 0) {
                                itemPrice = value;
                            }
                            
                            // Meet & Greet: alleen bij rit die VANAF luchthaven vertrekt
                            if (key.toLowerCase().includes('meet') || key.toLowerCase().includes('greet')) {
                                if (fromAirport) {
                                    heenSurcharges += itemPrice; // HEEN: vanaf luchthaven
                                } else if (toAirport) {
                                    terugSurcharges += itemPrice; // TERUG: vanaf luchthaven
                                }
                            }
                        });
                    }
                    
                    const heenTotal = heenBasePrice + heenSurcharges;
                    const terugTotal = terugBasePrice + terugSurcharges;
                    total = (heenTotal + terugTotal).toFixed(2);
                    
                    priceDisplayHTML = `
                        <div style="font-weight: 500; text-decoration: line-through; color: #6c757d;">‚Ç¨${(parseFloat(total)/2).toFixed(2)}</div>
                        <div style="font-size: 10px; color: #999; margin-top: 1px; text-decoration: line-through;">
                            üîÑ H: ‚Ç¨${heenTotal.toFixed(2)}<br>
                            üîÑ T: ‚Ç¨${terugTotal.toFixed(2)}
                        </div>
                    `;
                } else {
                    // Enkele rit: normale berekening
                    const surchargesTotal = booking.surcharges?.totalSurcharge || 0;
                    // MARCEL FIX: Gebruik finalTotalPrice (al inclusief surcharges)
                    total = finalTotalPrice.toFixed(2);
                    priceDisplayHTML = `<div style="font-weight: 500; text-decoration: line-through; color: #6c757d;">‚Ç¨${total}</div>`;
                }
                
                const reason = booking.cancellationReason || 'Manual cancellation';
                
                tableHTML += `
                    <tr style="border-bottom: 1px solid #dee2e6; background: #fef5e7;">
                        <td class="table-cell" style="text-align: center;">
                            <button style="background: transparent; border: 1px solid #dee2e6; padding: 4px 8px; border-radius: 4px; cursor: pointer; font-size: 12px;" onclick="viewBookingDetails('${booking.bookingId}')">
                                üëÅÔ∏è View
                            </button>
                        </td>
                        <td class="table-cell">
                            <div class="font-medium">${booking.customer.firstName} ${booking.customer.lastName}</div>
                            <div class="small-text">${booking.trip.fromLocation} ‚Üí ${booking.trip.toLocation}</div>
                            <div class="small-text">üìû ${booking.customer.phone}</div>
                            ${booking.trip.tripType ? `<div style="font-size: 11px; color: #007bff; font-weight: 500;">${booking.trip.tripType === 'heen' ? 'üîÑ HEEN' : 'üîÑ TERUG'}</div>` : ''}
                        </td>
                        <td class="table-cell">
                            <div>${formattedDate}</div>
                            <div style="color: #666; font-size: 12px;">${formattedTime}</div>
                        </td>
                        <td class="table-cell">
                            <div class="status-badge cancelled">‚ùå Cancelled</div>
                            <div class="small-text">${formattedCancelledDate}</div>
                        </td>
                        <td class="table-cell">
                            <div style="color: #dc3545; font-size: 12px;">No driver assigned</div>
                            <button style="background: transparent; border: 1px solid #dee2e6; padding: 2px 6px; border-radius: 3px; cursor: pointer; font-size: 11px; margin-top: 2px;" onclick="restoreBooking('${booking.bookingId}')">
                                ‚Ü©Ô∏è Restore
                            </button>
                        </td>
                        <td class="table-cell">
                            <div>${booking.vehicle?.vehicle?.name || 'Saloon'}</div>
                        </td>
                        <td class="table-cell">
                            <div class="small-text">${reason}</div>
                        </td>
                        <td class="table-cell" style="text-align: left;">
                            ${priceDisplayHTML}
                        </td>
                        <td class="table-cell" style="text-align: center;">
                            <button style="background: #007bff; color: white; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer; font-size: 12px;" onclick="sendEmail('${booking.bookingId}')">
                                ‚úâÔ∏è
                            </button>
                        </td>
                    </tr>
                `;
            });
            
            tableBody.innerHTML = tableHTML;
        }

        // Helper Functions
        function parseTravelDate(dateString, hour, minute) {
            // Parse DD/MM/YYYY format
            const dateParts = dateString.split('/');
            if (dateParts.length === 3) {
                const day = parseInt(dateParts[0]);
                const month = parseInt(dateParts[1]) - 1; // Month is 0-indexed
                const year = parseInt(dateParts[2]);
                const hourInt = parseInt(hour || 0);
                const minuteInt = parseInt(minute || 0);
                
                return new Date(year, month, day, hourInt, minuteInt);
            }
            return new Date();
        }

        function editConfirmedBooking(bookingId) {
            console.log('üìù Editing confirmed booking:', bookingId);
            
            // Find booking in confirmed list
            const confirmedBookings = JSON.parse(localStorage.getItem('confirmedBookings') || '[]');
            const booking = confirmedBookings.find(b => b.bookingId === bookingId);
            
            if (booking) {
                currentEditingBooking = booking;
                openBookingEditModal(booking);
            } else {
                alert('‚ùå Booking not found');
            }
        }

        function restoreBooking(bookingId) {
            if (!confirm(`Restore booking ${bookingId} to unconfirmed status?`)) {
                return;
            }
            
            // Move from cancelled back to unconfirmed
            let cancelledBookings = JSON.parse(localStorage.getItem('cancelledBookings') || '[]');
            let unconfirmedBookings = JSON.parse(localStorage.getItem('unconfirmedBookings') || '[]');
            
            const bookingIndex = cancelledBookings.findIndex(b => b.bookingId === bookingId);
            if (bookingIndex !== -1) {
                const booking = cancelledBookings[bookingIndex];
                booking.status = 'unconfirmed';
                booking.restoredAt = new Date().toISOString();
                delete booking.cancelledAt;
                delete booking.cancellationReason;
                
                // Move to unconfirmed
                unconfirmedBookings.unshift(booking);
                cancelledBookings.splice(bookingIndex, 1);
                
                // Save back to localStorage
                localStorage.setItem('cancelledBookings', JSON.stringify(cancelledBookings));
                localStorage.setItem('unconfirmedBookings', JSON.stringify(unconfirmedBookings));
                
                // Reload the display
                loadCancelledBookings();
                
                alert(`‚úÖ Booking ${bookingId} restored to unconfirmed status!`);
                console.log('‚Ü©Ô∏è Booking restored:', bookingId);
            }
        }

        function clearAllCancelled() {
            const cancelledBookings = JSON.parse(localStorage.getItem('cancelledBookings') || '[]');
            
            if (cancelledBookings.length === 0) {
                alert('No cancelled bookings to clear.');
                return;
            }
            
            if (!confirm(`‚ö†Ô∏è Permanently delete all ${cancelledBookings.length} cancelled bookings?\n\nThis action cannot be undone.`)) {
                return;
            }
            
            localStorage.setItem('cancelledBookings', JSON.stringify([]));
            loadCancelledBookings();
            
            alert(`‚úÖ All ${cancelledBookings.length} cancelled bookings cleared!`);
            console.log('üóëÔ∏è All cancelled bookings cleared');
        }

        // Email Settings Functions
        function toggleAdminPassword() {
            const passwordInput = document.getElementById('adminSmtpPassword');
            const toggleBtn = event.target;
            
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                toggleBtn.textContent = 'üôà';
            } else {
                passwordInput.type = 'password';
                toggleBtn.textContent = 'üëÅ';
            }
        }

        async function sendAdminTestEmail() {
            const testEmail = document.getElementById('adminTestEmail').value;
            if (!testEmail) {
                showAdminEmailStatus('Please enter an email address', 'error');
                return;
            }

            const btn = event.target;
            const originalText = btn.textContent;
            btn.disabled = true;
            btn.textContent = 'Sending...';

            try {
                const config = getAdminEmailConfig();
                const response = await fetch('/api/test-email', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ testEmail: testEmail, config: config })
                });

                const result = await response.json();
                
                if (result.success) {
                    showAdminEmailStatus('‚úÖ Test email sent successfully!', 'success');
                } else {
                    showAdminEmailStatus('‚ùå Failed to send test email: ' + result.error, 'error');
                }
            } catch (error) {
                showAdminEmailStatus('‚ùå Error: ' + error.message, 'error');
            } finally {
                btn.disabled = false;
                btn.textContent = originalText;
            }
        }

        function getAdminEmailConfig() {
            const securityValue = document.querySelector('input[name="adminSmtpSecurity"]:checked').value;
            
            return {
                fromName: document.getElementById('adminFromName').value,
                fromEmail: document.getElementById('adminFromEmail').value,
                replyToEmail: document.getElementById('adminReplyToEmail').value,
                adminEmail: document.getElementById('adminAdminEmail').value,
                connectionType: document.getElementById('adminConnectionType').value,
                provider: document.getElementById('adminProvider').value,
                smtpHost: document.getElementById('adminSmtpHost').value,
                smtpPort: document.getElementById('adminSmtpPort').value,
                smtpUsername: document.getElementById('adminSmtpUsername').value,
                smtpPassword: document.getElementById('adminSmtpPassword').value,
                smtpSecurity: securityValue
            };
        }

        function showAdminEmailStatus(message, type) {
            const indicator = document.getElementById('adminEmailStatus');
            indicator.textContent = message;
            
            // Set colors based on type
            if (type === 'success') {
                indicator.style.background = '#d4edda';
                indicator.style.color = '#155724';
                indicator.style.border = '1px solid #c3e6cb';
            } else if (type === 'error') {
                indicator.style.background = '#f8d7da';
                indicator.style.color = '#721c24';
                indicator.style.border = '1px solid #f5c6cb';
            } else {
                indicator.style.background = '#d1ecf1';
                indicator.style.color = '#0c5460';
                indicator.style.border = '1px solid #bee5eb';
            }
            
            indicator.style.display = 'block';
            
            // Hide after 5 seconds
            setTimeout(() => {
                indicator.style.display = 'none';
            }, 5000);
        }

        // Email form submission
        document.addEventListener('DOMContentLoaded', function() {
            const emailForm = document.getElementById('adminEmailSettingsForm');
            if (emailForm) {
                emailForm.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    
                    const config = getAdminEmailConfig();
                    
                    if (!config.smtpPassword) {
                        showAdminEmailStatus('‚ùå SMTP password is required', 'error');
                        return;
                    }

                    const btn = document.querySelector('#adminEmailSettingsForm button[type="submit"]');
                    const originalText = btn.textContent;
                    btn.disabled = true;
                    btn.textContent = 'Saving...';

                    try {
                        // Save configuration to localStorage
                        localStorage.setItem('emailConfig', JSON.stringify(config));
                        
                        // Update status display
                        document.getElementById('configStatus').textContent = 'Configured ‚úÖ';
                        document.getElementById('configHost').textContent = config.smtpHost;
                        document.getElementById('configEmail').textContent = config.fromEmail;
                        
                        showAdminEmailStatus('‚úÖ Email configuration saved successfully!', 'success');
                    } catch (error) {
                        showAdminEmailStatus('‚ùå Error saving configuration: ' + error.message, 'error');
                    } finally {
                        btn.disabled = false;
                        btn.textContent = originalText;
                    }
                });
            }
        });

        // Status Dropdown Functions
        function toggleStatusDropdown(bookingId) {
            console.log('üîç Toggling dropdown for booking:', bookingId);
            const dropdown = document.getElementById(`statusDropdown_${bookingId}`);
            const badge = document.getElementById(`statusBadge_${bookingId}`);
            
            if (!dropdown || !badge) {
                console.error('‚ùå Dropdown or badge not found for booking:', bookingId);
                return;
            }
            
            console.log('üìã Dropdown element found:', dropdown);
            
            // Close all other dropdowns first
            document.querySelectorAll('.status-dropdown-menu').forEach(menu => {
                if (menu.id !== `statusDropdown_${bookingId}`) {
                    menu.classList.remove('show');
                }
            });
            
            // Calculate position for fixed positioning
            const rect = badge.getBoundingClientRect();
            const isOpen = dropdown.classList.contains('show');
            
            if (!isOpen) {
                // Position dropdown below the badge
                dropdown.style.top = (rect.bottom + 4) + 'px';
                dropdown.style.left = rect.left + 'px';
                dropdown.classList.add('show');
                console.log('‚úÖ Dropdown opened at position:', rect.left, rect.bottom + 4);
            } else {
                dropdown.classList.remove('show');
                console.log('‚úÖ Dropdown closed');
            }
        }

        // Delete confirmed booking function
        function deleteConfirmedBooking(bookingId) {
            if (!confirm('‚ö†Ô∏è Are you sure you want to delete this booking?\n\nThis action cannot be undone.')) {
                return;
            }
            
            console.log('üóëÔ∏è Deleting confirmed booking:', bookingId);
            
            // Get confirmed bookings
            let confirmedBookings = JSON.parse(localStorage.getItem('confirmedBookings') || '[]');
            
            // Find booking to delete
            const bookingIndex = confirmedBookings.findIndex(b => b.bookingId === bookingId);
            
            if (bookingIndex === -1) {
                alert('‚ùå Booking not found');
                return;
            }
            
            // Remove booking from confirmed list
            const deletedBooking = confirmedBookings.splice(bookingIndex, 1)[0];
            
            // Save updated confirmed bookings
            localStorage.setItem('confirmedBookings', JSON.stringify(confirmedBookings));
            
            // Add to cancelled bookings for record keeping
            let cancelledBookings = JSON.parse(localStorage.getItem('cancelledBookings') || '[]');
            deletedBooking.cancelledAt = new Date().toISOString();
            deletedBooking.cancelledBy = 'admin';
            deletedBooking.status = 'Cancelled';
            cancelledBookings.unshift(deletedBooking);
            localStorage.setItem('cancelledBookings', JSON.stringify(cancelledBookings));
            
            console.log('‚úÖ Booking deleted and moved to cancelled list');
            
            // Refresh Next 24h view
            if (typeof loadNext24hBookings === 'function') {
                loadNext24hBookings();
            }
            
            alert('‚úÖ Booking deleted successfully');
        }

        function getStatusDisplayName(status) {
            const statusNames = {
                'unconfirmed': 'Unconfirmed',
                'confirmed': 'Confirmed',
                'request_quote': 'Request Quote',
                'assigned': 'Assigned',
                'job_accepted': 'Job Accepted',
                'job_rejected': 'Job Rejected',
                'on_route': 'On Route',
                'arrived': 'Arrived',
                'on_board': 'On Board',
                'no_show': 'No Show',
                'completed': 'Completed',
                'cancelled': 'Cancelled',
                'driver_cancelled': 'Driver Cancelled',
                'incomplete': 'Incomplete'
            };
            return statusNames[status] || status;
        }

        function getStatusClass(status) {
            if (['confirmed', 'job_accepted', 'completed'].includes(status)) {
                return 'confirmed';
            } else if (['cancelled', 'driver_cancelled', 'job_rejected', 'no_show'].includes(status)) {
                return 'cancelled';
            }
            return ''; // Default (unconfirmed) styling
        }

        function updateDropdownSelection(bookingId, currentStatus) {
            const dropdown = document.getElementById(`statusDropdown_${bookingId}`);
            if (!dropdown) return;
            
            // Update all options
            const options = dropdown.querySelectorAll('.status-option');
            options.forEach(option => {
                option.classList.remove('selected');
                if (option.textContent.trim().replace('‚úì ', '') === getStatusDisplayName(currentStatus)) {
                    option.classList.add('selected');
                    option.innerHTML = `‚úì ${getStatusDisplayName(currentStatus)}`;
                } else {
                    option.innerHTML = option.textContent.replace('‚úì ', '');
                }
            });
        }

        // Close dropdowns when clicking outside
        document.addEventListener('click', function(event) {
            if (!event.target.closest('.status-dropdown')) {
                document.querySelectorAll('.status-dropdown-menu').forEach(menu => {
                    menu.classList.remove('show');
                });
            }
        });

        // Dispatch Calendar Variables - Global scope
        window.dispatchCurrentDate = new Date();
        window.dispatchSelectedDate = null;
        window.dispatchReturnCurrentDate = new Date();
        window.dispatchReturnSelectedDate = null;
        window.dispatchExtraStopCount = 0;
        window.dispatchRetourActive = false;

        // Initialize Dispatch Calendar and Time
        window.initDispatchDateTime = function() {
            console.log('üîß initDispatchDateTime called');
            // Set today's date as default
            const today = new Date();
            const formattedDate = `${today.getDate().toString().padStart(2, '0')}/${(today.getMonth() + 1).toString().padStart(2, '0')}/${today.getFullYear()}`;
            const dateInput = document.getElementById('dispatchDate');
            if (dateInput) {
                dateInput.value = formattedDate;
            }
            
            // Initialize calendar
            generateDispatchCalendar();
            
            // Initialize return time selectors
            initDispatchReturnTime();
        }

        function initDispatchReturnTime() {
            // Populate return hour options (00-23)
            const returnHourSelect = document.getElementById('dispatchReturnHour');
            for (let i = 0; i < 24; i++) {
                const hour = i.toString().padStart(2, '0');
                const option = document.createElement('option');
                option.value = hour;
                option.textContent = hour;
                returnHourSelect.appendChild(option);
            }
            
            // Populate return minute options (00, 15, 30, 45)
            const returnMinuteSelect = document.getElementById('dispatchReturnMinute');
            ['00', '15', '30', '45'].forEach(minute => {
                const option = document.createElement('option');
                option.value = minute;
                option.textContent = minute;
                returnMinuteSelect.appendChild(option);
            });
        }

        // Extra Stops Functions
        function addDispatchExtraStop() {
            if (dispatchExtraStopCount >= 7) {
                alert('Maximum 7 extra stops allowed');
                return;
            }
            
            dispatchExtraStopCount++;
            const container = document.getElementById('dispatchExtraStopsContainer');
            
            const stopDiv = document.createElement('div');
            stopDiv.id = `dispatchExtraStop${dispatchExtraStopCount}`;
            stopDiv.style.cssText = 'display: flex; gap: 15px; align-items: center;';
            
            stopDiv.innerHTML = `
                <input type="text" id="dispatchExtraStopAddress${dispatchExtraStopCount}" placeholder="üìç Extra stop ${dispatchExtraStopCount}..." 
                       style="flex: 1; padding: 18px; border: 2px solid #e9ecef; border-radius: 10px; font-size: 16px; 
                              transition: all 0.3s; background: white; box-shadow: 0 2px 8px rgba(0,0,0,0.05);"
                       onfocus="this.style.borderColor='#007bff'; this.style.boxShadow='0 4px 15px rgba(0,123,255,0.15)'"
                       onblur="this.style.borderColor='#e9ecef'; this.style.boxShadow='0 2px 8px rgba(0,0,0,0.05)'">
                <button type="button" onclick="removeDispatchExtraStop(${dispatchExtraStopCount})" 
                        style="background: #dc3545; color: white; border: none; padding: 18px; border-radius: 10px; 
                               cursor: pointer; transition: all 0.3s; font-size: 16px; font-weight: 600;"
                        onmouseover="this.style.background='#c82333'"
                        onmouseout="this.style.background='#dc3545'">
                    ‚ùå
                </button>
            `;
            
            container.appendChild(stopDiv);
            
            console.log('Added extra stop:', dispatchExtraStopCount);
        }

        function removeDispatchExtraStop(stopNumber) {
            const stopDiv = document.getElementById(`dispatchExtraStop${stopNumber}`);
            if (stopDiv) {
                stopDiv.remove();
                dispatchExtraStopCount--;
                
                // Renumber remaining stops
                const container = document.getElementById('dispatchExtraStopsContainer');
                const remainingStops = container.children;
                
                for (let i = 0; i < remainingStops.length; i++) {
                    const stop = remainingStops[i];
                    const newNumber = i + 1;
                    stop.id = `dispatchExtraStop${newNumber}`;
                    
                    const input = stop.querySelector('input');
                    input.id = `dispatchExtraStopAddress${newNumber}`;
                    input.placeholder = `üìç Extra stop ${newNumber}...`;
                    
                    const button = stop.querySelector('button');
                    button.setAttribute('onclick', `removeDispatchExtraStop(${newNumber})`);
                }
                
                dispatchExtraStopCount = remainingStops.length;
                console.log('Removed extra stop, remaining:', dispatchExtraStopCount);
            }
        }

        // Retour Functions
        window.toggleDispatchRetour = function() {
            dispatchRetourActive = !dispatchRetourActive;
            const details = document.getElementById('dispatchRetourDetails');
            const status = document.getElementById('dispatchRetourStatus');
            const btn = document.getElementById('dispatchRetourBtn');
            
            if (dispatchRetourActive) {
                details.style.display = 'block';
                status.textContent = 'Activated ‚úÖ';
                status.style.color = '#28a745';
                btn.style.background = 'linear-gradient(135deg, #28a745, #20c997)';
            } else {
                details.style.display = 'none';
                status.textContent = 'Not activated';
                status.style.color = '#666';
                btn.style.background = 'linear-gradient(135deg, #2196f3, #1976d2)';
                
                // Clear return values
                document.getElementById('dispatchReturnDate').value = '';
                document.getElementById('dispatchReturnHour').value = '';
                document.getElementById('dispatchReturnMinute').value = '';
                dispatchReturnSelectedDate = null;
            }
            
            console.log('Retour toggled:', dispatchRetourActive);
        }

        window.toggleDispatchCalendar = function() {
            const calendar = document.getElementById('dispatchCalendar');
            const isVisible = calendar.style.display === 'block';
            
            // Close all other calendars/dropdowns
            document.querySelectorAll('[id*="Calendar"]').forEach(cal => {
                if (cal.id !== 'dispatchCalendar') cal.style.display = 'none';
            });
            
            calendar.style.display = isVisible ? 'none' : 'block';
            
            if (!isVisible) {
                generateDispatchCalendar();
            }
        };

        window.generateDispatchCalendar = function() {
            const monthNames = ['Januari', 'Februari', 'Maart', 'April', 'Mei', 'Juni',
                               'Juli', 'Augustus', 'September', 'Oktober', 'November', 'December'];
            const dayNames = ['Ma', 'Di', 'Wo', 'Do', 'Vr', 'Za', 'Zo'];
            
            const title = document.getElementById('dispatchCalendarTitle');
            const grid = document.getElementById('dispatchCalendarGrid');
            
            if (!title || !grid) {
                console.error('‚ùå Calendar elements not found');
                return;
            }
            
            title.textContent = `${monthNames[dispatchCurrentDate.getMonth()]} ${dispatchCurrentDate.getFullYear()}`;
            
            // Clear grid
            grid.innerHTML = '';
            
            // Add day headers
            dayNames.forEach(day => {
                const dayHeader = document.createElement('div');
                dayHeader.textContent = day;
                dayHeader.style.cssText = 'font-weight: 600; padding: 8px; color: #666; font-size: 12px;';
                grid.appendChild(dayHeader);
            });
            
            // Get first day of month and number of days
            const firstDay = new Date(dispatchCurrentDate.getFullYear(), dispatchCurrentDate.getMonth(), 1);
            const lastDay = new Date(dispatchCurrentDate.getFullYear(), dispatchCurrentDate.getMonth() + 1, 0);
            const startDay = (firstDay.getDay() + 6) % 7; // Convert Sunday=0 to Monday=0
            
            // Add empty cells for days before first day
            for (let i = 0; i < startDay; i++) {
                const emptyCell = document.createElement('div');
                emptyCell.style.cssText = 'padding: 8px;';
                grid.appendChild(emptyCell);
            }
            
            // Add days
            const today = new Date();
            for (let day = 1; day <= lastDay.getDate(); day++) {
                const dayCell = document.createElement('div');
                const cellDate = new Date(dispatchCurrentDate.getFullYear(), dispatchCurrentDate.getMonth(), day);
                
                dayCell.textContent = day;
                dayCell.style.cssText = 'padding: 8px; cursor: pointer; border-radius: 6px; transition: all 0.3s; text-align: center; font-size: 14px;';
                
                // Style for today
                if (cellDate.toDateString() === today.toDateString()) {
                    dayCell.style.background = '#007bff';
                    dayCell.style.color = 'white';
                    dayCell.style.fontWeight = '600';
                }
                
                // Style for selected date
                if (dispatchSelectedDate && cellDate.toDateString() === dispatchSelectedDate.toDateString()) {
                    dayCell.style.background = '#28a745';
                    dayCell.style.color = 'white';
                    dayCell.style.fontWeight = '600';
                }
                
                // Disable past dates
                if (cellDate < today.setHours(0,0,0,0)) {
                    dayCell.style.color = '#ccc';
                    dayCell.style.cursor = 'not-allowed';
                } else {
                    dayCell.addEventListener('click', () => selectDispatchDate(cellDate));
                    dayCell.addEventListener('mouseenter', () => {
                        if (cellDate >= today.setHours(0,0,0,0)) {
                            dayCell.style.background = '#f8f9fa';
                        }
                    });
                    dayCell.addEventListener('mouseleave', () => {
                        if (!dispatchSelectedDate || cellDate.toDateString() !== dispatchSelectedDate.toDateString()) {
                            if (cellDate.toDateString() !== today.toDateString()) {
                                dayCell.style.background = 'transparent';
                            }
                        }
                    });
                }
                
                grid.appendChild(dayCell);
            }
        }

        window.changeDispatchMonth = function(direction) {
            dispatchCurrentDate.setMonth(dispatchCurrentDate.getMonth() + direction);
            generateDispatchCalendar();
        }

        window.selectDispatchDate = function(date) {
            dispatchSelectedDate = new Date(date);
            const formattedDate = `${date.getDate().toString().padStart(2, '0')}/${(date.getMonth() + 1).toString().padStart(2, '0')}/${date.getFullYear()}`;
            
            document.getElementById('dispatchDate').value = formattedDate;
            document.getElementById('dispatchCalendar').style.display = 'none';
            
            generateDispatchCalendar(); // Refresh to show selection
        }

        // Return Journey Functions
        window.toggleDispatchReturn = function() {
            const returnSection = document.getElementById('dispatchReturnSection');
            const isVisible = returnSection.style.display === 'block';
            
            returnSection.style.display = isVisible ? 'none' : 'block';
            
            // Update button appearance
            const btn = document.getElementById('dispatchRetourBtn');
            if (isVisible) {
                btn.style.background = '#f0f0f0';
                btn.style.color = '#666';
            } else {
                btn.style.background = '#4CAF50';
                btn.style.color = 'white';
            }
        }
        
        // Flight Information Functions
        window.toggleDispatchFlight = function() {
            const flightSection = document.getElementById('dispatchFlightSection');
            const isVisible = flightSection.style.display === 'block';
            
            flightSection.style.display = isVisible ? 'none' : 'block';
        }
        
        // Calendar Navigation Functions
        window.previousDispatchMonth = function() {
            dispatchCurrentDate.setMonth(dispatchCurrentDate.getMonth() - 1);
            generateDispatchCalendar();
        }
        
        window.nextDispatchMonth = function() {
            dispatchCurrentDate.setMonth(dispatchCurrentDate.getMonth() + 1);
            generateDispatchCalendar();
        }
        
        window.previousDispatchReturnMonth = function() {
            dispatchReturnCurrentDate.setMonth(dispatchReturnCurrentDate.getMonth() - 1);
            generateDispatchReturnCalendar();
        }
        
        window.nextDispatchReturnMonth = function() {
            dispatchReturnCurrentDate.setMonth(dispatchReturnCurrentDate.getMonth() + 1);
            generateDispatchReturnCalendar();
        }
        
        // Additional Dispatch Functions
        window.addDispatchStop = function() {
            const fromLocation = document.getElementById('dispatchFromLocation');
            const toLocation = document.getElementById('dispatchToLocation');
            
            if (!fromLocation.value.trim()) {
                alert('Please enter "From" location first');
                fromLocation.focus();
                return;
            }
            
            // Create new stop input
            const stopContainer = document.createElement('div');
            stopContainer.style.cssText = 'position: relative; margin-bottom: 10px;';
            
            const stopInput = document.createElement('input');
            stopInput.type = 'text';
            stopInput.placeholder = 'Extra Stop Address';
            stopInput.style.cssText = 'width: 75%; padding: 12px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px; background: white;';
            
            const removeBtn = document.createElement('button');
            removeBtn.innerHTML = '√ó';
            removeBtn.style.cssText = 'position: absolute; right: 45px; top: 50%; transform: translateY(-50%); background: #ff4444; color: white; border: none; width: 25px; height: 25px; border-radius: 50%; cursor: pointer; font-size: 16px;';
            removeBtn.onclick = function() {
                stopContainer.remove();
            };
            
            stopContainer.appendChild(stopInput);
            stopContainer.appendChild(removeBtn);
            
            // Insert before "To" location
            const toLocationContainer = toLocation.parentElement;
            toLocationContainer.parentElement.insertBefore(stopContainer, toLocationContainer);
            
            stopInput.focus();
        }
        
        window.swapLocations = function() {
            const fromLocation = document.getElementById('dispatchFromLocation');
            const toLocation = document.getElementById('dispatchToLocation');
            
            if (!fromLocation || !toLocation) {
                console.error('Location inputs not found');
                return;
            }
            
            const temp = fromLocation.value;
            fromLocation.value = toLocation.value;
            toLocation.value = temp;
            
            // Visual feedback
            fromLocation.style.background = '#e8f5e8';
            toLocation.style.background = '#e8f5e8';
            
            setTimeout(() => {
                fromLocation.style.background = 'white';
                toLocation.style.background = 'white';
            }, 300);
        }
        
        window.addDispatchItem = function() {
            // Add item functionality
            console.log('Adding item...');
        }
        
        window.getDispatchQuote = function() {
            // Get quote functionality
            console.log('Getting quote...');
            // Here you would normally calculate pricing based on locations and settings
            document.getElementById('totalPrice').textContent = '45.00';
        }
        
        // Return Calendar Functions
        window.toggleDispatchReturnCalendar = function() {
            console.log('üîÑ toggleDispatchReturnCalendar called');
            const calendar = document.getElementById('dispatchReturnCalendar');
            const isVisible = calendar.style.display === 'block';
            
            calendar.style.display = isVisible ? 'none' : 'block';
            
            if (!isVisible) {
                generateDispatchReturnCalendar();
            }
        }

        window.generateDispatchReturnCalendar = function() {
            const monthNames = ['Januari', 'Februari', 'Maart', 'April', 'Mei', 'Juni',
                               'Juli', 'Augustus', 'September', 'Oktober', 'November', 'December'];
            const dayNames = ['Ma', 'Di', 'Wo', 'Do', 'Vr', 'Za', 'Zo'];
            
            const title = document.getElementById('dispatchReturnCalendarTitle');
            const grid = document.getElementById('dispatchReturnCalendarGrid');
            
            title.textContent = `${monthNames[dispatchReturnCurrentDate.getMonth()]} ${dispatchReturnCurrentDate.getFullYear()}`;
            
            // Clear grid
            grid.innerHTML = '';
            
            // Add day headers
            dayNames.forEach(day => {
                const dayHeader = document.createElement('div');
                dayHeader.textContent = day;
                dayHeader.style.cssText = 'font-weight: 600; padding: 8px; color: #666; font-size: 12px;';
                grid.appendChild(dayHeader);
            });
            
            // Get first day of month and number of days
            const firstDay = new Date(dispatchReturnCurrentDate.getFullYear(), dispatchReturnCurrentDate.getMonth(), 1);
            const lastDay = new Date(dispatchReturnCurrentDate.getFullYear(), dispatchReturnCurrentDate.getMonth() + 1, 0);
            const startDay = (firstDay.getDay() + 6) % 7;
            
            // Add empty cells
            for (let i = 0; i < startDay; i++) {
                const emptyCell = document.createElement('div');
                emptyCell.style.cssText = 'padding: 8px;';
                grid.appendChild(emptyCell);
            }
            
            // Add days
            const today = new Date();
            for (let day = 1; day <= lastDay.getDate(); day++) {
                const dayCell = document.createElement('div');
                const cellDate = new Date(dispatchReturnCurrentDate.getFullYear(), dispatchReturnCurrentDate.getMonth(), day);
                
                dayCell.textContent = day;
                dayCell.style.cssText = 'padding: 8px; cursor: pointer; border-radius: 6px; transition: all 0.3s; text-align: center; font-size: 14px;';
                
                // Style for today
                if (cellDate.toDateString() === today.toDateString()) {
                    dayCell.style.background = '#2196f3';
                    dayCell.style.color = 'white';
                    dayCell.style.fontWeight = '600';
                }
                
                // Style for selected date
                if (dispatchReturnSelectedDate && cellDate.toDateString() === dispatchReturnSelectedDate.toDateString()) {
                    dayCell.style.background = '#28a745';
                    dayCell.style.color = 'white';
                    dayCell.style.fontWeight = '600';
                }
                
                // Disable past dates
                if (cellDate < today.setHours(0,0,0,0)) {
                    dayCell.style.color = '#ccc';
                    dayCell.style.cursor = 'not-allowed';
                } else {
                    dayCell.addEventListener('click', () => selectDispatchReturnDate(cellDate));
                    dayCell.addEventListener('mouseenter', () => {
                        if (cellDate >= today.setHours(0,0,0,0)) {
                            dayCell.style.background = '#f8f9fa';
                        }
                    });
                    dayCell.addEventListener('mouseleave', () => {
                        if (!dispatchReturnSelectedDate || cellDate.toDateString() !== dispatchReturnSelectedDate.toDateString()) {
                            if (cellDate.toDateString() !== today.toDateString()) {
                                dayCell.style.background = 'transparent';
                            }
                        }
                    });
                }
                
                grid.appendChild(dayCell);
            }
        }

        window.changeDispatchReturnMonth = function(direction) {
            dispatchReturnCurrentDate.setMonth(dispatchReturnCurrentDate.getMonth() + direction);
            generateDispatchReturnCalendar();
        }

        window.selectDispatchReturnDate = function(date) {
            dispatchReturnSelectedDate = new Date(date);
            const formattedDate = `${date.getDate().toString().padStart(2, '0')}/${(date.getMonth() + 1).toString().padStart(2, '0')}/${date.getFullYear()}`;
            
            document.getElementById('dispatchReturnDate').value = formattedDate;
            document.getElementById('dispatchReturnCalendar').style.display = 'none';
            
            generateDispatchReturnCalendar();
        }

        // Close calendars when clicking outside
        document.addEventListener('click', function(event) {
            if (!event.target.closest('#dispatchCalendar') && !event.target.closest('#dispatchDate')) {
                document.getElementById('dispatchCalendar').style.display = 'none';
            }
            if (!event.target.closest('#dispatchReturnCalendar') && !event.target.closest('#dispatchReturnDate')) {
                document.getElementById('dispatchReturnCalendar').style.display = 'none';
            }
        });

        // Dispatch Booking Functions
        async function createDispatchBooking(event) {
            event.preventDefault();
            
            const btn = event.target;
            const originalText = btn.innerHTML;
            btn.disabled = true;
            btn.innerHTML = '‚è≥ Creating Booking...';
            
            try {
                // Get form data
                const dispatchData = {
                    pickup: document.getElementById('dispatchPickup').value.trim(),
                    destination: document.getElementById('dispatchDestination').value.trim(),
                    date: document.getElementById('dispatchDate').value.trim(),
                    hour: document.getElementById('dispatchHour').value,
                    minute: document.getElementById('dispatchMinute').value,
                    firstName: document.getElementById('dispatchFirstName').value.trim(),
                    lastName: document.getElementById('dispatchLastName').value.trim(),
                    email: document.getElementById('dispatchEmail').value.trim(),
                    phone: document.getElementById('dispatchPhone').value.trim(),
                    passengers: document.getElementById('dispatchPassengers').value,
                    vehicleType: document.getElementById('dispatchVehicleType').value,
                    paymentMethod: document.getElementById('dispatchPaymentMethod').value,
                    extraStopCount: dispatchExtraStopCount,
                    returnActive: dispatchRetourActive,
                    returnDate: dispatchRetourActive ? document.getElementById('dispatchReturnDate').value.trim() : '',
                    returnHour: dispatchRetourActive ? document.getElementById('dispatchReturnHour').value : '',
                    returnMinute: dispatchRetourActive ? document.getElementById('dispatchReturnMinute').value : ''
                };
                
                // Get extra stops
                const extraStops = [];
                for (let i = 1; i <= dispatchExtraStopCount; i++) {
                    const stopInput = document.getElementById(`dispatchExtraStopAddress${i}`);
                    if (stopInput && stopInput.value.trim()) {
                        extraStops.push(stopInput.value.trim());
                    }
                }
                
                // Validate required fields
                if (!dispatchData.pickup || !dispatchData.destination || !dispatchData.date || 
                    !dispatchData.hour || !dispatchData.minute || !dispatchData.firstName || 
                    !dispatchData.lastName || !dispatchData.email || !dispatchData.phone) {
                    showDispatchStatus('‚ùå Please fill in all required fields', 'error');
                    return;
                }
                
                // Get vehicle data from localStorage
                const vehicles = JSON.parse(localStorage.getItem('taxiVehicles') || '[]');
                const selectedVehicle = vehicles.find(v => v.id === dispatchData.vehicleType) || 
                                      { id: dispatchData.vehicleType, name: dispatchData.vehicleType, price: 50.00 };
                
                // Get pricing data
                const pricingData = JSON.parse(localStorage.getItem('vehiclePricing') || '{}');
                const pricing = pricingData[dispatchData.vehicleType] || { minimumPrice: 50.00, pricePerKm: 2.50 };
                
                // Generate booking ID
                const bookingId = 'BK' + Date.now();
                
                // Create main booking object (heen trip)
                const mainBooking = {
                    bookingId: bookingId,
                    customer: {
                        firstName: dispatchData.firstName,
                        lastName: dispatchData.lastName,
                        email: dispatchData.email,
                        phone: dispatchData.phone,
                        passengers: dispatchData.passengers,
                        paymentMethod: dispatchData.paymentMethod,
                        koffers: 1, // Default
                        handbagage: 1 // Default
                    },
                    trip: {
                        fromLocation: dispatchData.pickup,
                        toLocation: dispatchData.destination,
                        travelDate: dispatchData.date,
                        travelHour: dispatchData.hour,
                        travelMinute: dispatchData.minute,
                        extraStopCount: dispatchData.extraStopCount,
                        extraStops: extraStops,
                        returnActive: 'false', // Main trip doesn't have return status
                        tripType: 'heen',
                        direction: 'outbound'
                    },
                    vehicle: {
                        vehicle: selectedVehicle,
                        pricing: pricing
                    },
                    status: 'confirmed', // Admin bookings are pre-confirmed
                    source: 'dispatch', // Mark as dispatch booking
                    createdAt: new Date().toISOString(),
                    confirmedAt: new Date().toISOString(),
                    bookingDate: new Date().toISOString(),
                    lastUpdated: new Date().toISOString()
                };
                
                // Save main booking to confirmed bookings
                let confirmedBookings = JSON.parse(localStorage.getItem('confirmedBookings') || '[]');
                confirmedBookings.unshift(mainBooking);
                
                // Create return booking if return trip is active
                let returnBooking = null;
                if (dispatchData.returnActive && dispatchData.returnDate && dispatchData.returnHour && dispatchData.returnMinute) {
                    const returnBookingId = 'BK' + (Date.now() + 1); // Slightly different timestamp
                    
                    returnBooking = {
                        bookingId: returnBookingId,
                        customer: {
                            firstName: dispatchData.firstName,
                            lastName: dispatchData.lastName,
                            email: dispatchData.email,
                            phone: dispatchData.phone,
                            passengers: dispatchData.passengers,
                            paymentMethod: dispatchData.paymentMethod,
                            koffers: 1, // Default
                            handbagage: 1 // Default
                        },
                        trip: {
                            fromLocation: dispatchData.destination, // Reversed: from destination back to origin
                            toLocation: dispatchData.pickup, // Reversed: to origin from destination
                            travelDate: dispatchData.returnDate,
                            travelHour: dispatchData.returnHour,
                            travelMinute: dispatchData.returnMinute,
                            extraStopCount: 0, // No extra stops for return trip
                            extraStops: [],
                            returnActive: 'false', // Return trip doesn't have another return
                            tripType: 'terug',
                            direction: 'inbound',
                            relatedBookingId: bookingId // Link to main booking
                        },
                        vehicle: {
                            vehicle: selectedVehicle,
                            pricing: pricing
                        },
                        status: 'confirmed', // Admin bookings are pre-confirmed
                        source: 'dispatch', // Mark as dispatch booking
                        createdAt: new Date().toISOString(),
                        confirmedAt: new Date().toISOString(),
                        bookingDate: new Date().toISOString(),
                        lastUpdated: new Date().toISOString()
                    };
                    
                    // Add return booking to confirmed bookings
                    confirmedBookings.unshift(returnBooking);
                }
                localStorage.setItem('confirmedBookings', JSON.stringify(confirmedBookings));
                
                // Send email notification for main booking
                try {
                    const emailResponse = await fetch('http://localhost:3001/api/send-booking-email', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(mainBooking)
                    });
                    
                    // Send email for return booking if exists
                    if (returnBooking) {
                        const returnEmailResponse = await fetch('http://localhost:3001/api/send-booking-email', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(returnBooking)
                        });
                    }
                    
                    if (emailResponse.ok) {
                        console.log('‚úÖ Email notifications sent successfully');
                    } else {
                        console.log('‚ö†Ô∏è Email sending failed, but booking created');
                    }
                } catch (emailError) {
                    console.log('‚ö†Ô∏è Email server not available, but booking created');
                }
                
                // Show success message
                let successMessage = `‚úÖ Dispatch Booking${returnBooking ? 's' : ''} Created Successfully!

HEEN REIS: ${bookingId}
Van: ${dispatchData.pickup}
Naar: ${dispatchData.destination}
Datum: ${dispatchData.date} om ${dispatchData.hour}:${dispatchData.minute}`;

                if (returnBooking) {
                    successMessage += `

TERUG REIS: ${returnBooking.bookingId}
Van: ${dispatchData.destination}
Naar: ${dispatchData.pickup}
Datum: ${dispatchData.returnDate} om ${dispatchData.returnHour}:${dispatchData.returnMinute}`;
                }

                successMessage += `

Both bookings added to confirmed bookings list!`;
                
                showDispatchStatus(successMessage, 'success');
                
                // Clear form
                document.getElementById('dispatchBookingForm').reset();
                
                // Reset extra stops
                document.getElementById('dispatchExtraStopsContainer').innerHTML = '';
                dispatchExtraStopCount = 0;
                
                // Reset retour
                if (dispatchRetourActive) {
                    toggleDispatchRetour(); // Turn off retour
                }
                
                // Reset selected dates
                dispatchSelectedDate = null;
                dispatchReturnSelectedDate = null;
                
                console.log('‚úÖ Dispatch booking(s) created:', mainBooking.bookingId, returnBooking ? `& ${returnBooking.bookingId}` : '');
                
            } catch (error) {
                console.error('‚ùå Error creating dispatch booking:', error);
                showDispatchStatus('‚ùå Error creating booking: ' + error.message, 'error');
            } finally {
                btn.disabled = false;
                btn.innerHTML = originalText;
            }
        }

        function showDispatchStatus(message, type) {
            const statusDiv = document.getElementById('dispatchStatus');
            statusDiv.textContent = message;
            statusDiv.style.display = 'block';
            
            // Set colors based on type
            if (type === 'success') {
                statusDiv.style.background = '#d4edda';
                statusDiv.style.color = '#155724';
                statusDiv.style.border = '1px solid #c3e6cb';
            } else if (type === 'error') {
                statusDiv.style.background = '#f8d7da';
                statusDiv.style.color = '#721c24';
                statusDiv.style.border = '1px solid #f5c6cb';
            } else {
                statusDiv.style.background = '#d1ecf1';
                statusDiv.style.color = '#0c5460';
                statusDiv.style.border = '1px solid #bee5eb';
            }
            
            // Hide after 5 seconds
            setTimeout(() => {
                statusDiv.style.display = 'none';
            }, 5000);
        }

        // Load functions for all sections
        // Helper function to generate driver dropdown HTML
        function generateDriverDropdown(booking) {
            const drivers = JSON.parse(localStorage.getItem('taxiDrivers') || '[]');
            const assignedDriver = booking.assignedDriver;
            
            let driverOptions = '';
            
            // Add available drivers
            drivers.forEach(driver => {
                const isSelected = assignedDriver && assignedDriver.id === driver.id;
                driverOptions += `
                    <div class="driver-option ${isSelected ? 'selected' : ''}" onclick="assignDriverToBooking('${booking.bookingId}', '${driver.id}', '${driver.name}')">
                        ${isSelected ? '‚úì ' : ''}${driver.name}
                    </div>
                `;
            });
            
            // Add unassign option if driver is assigned
            if (assignedDriver) {
                driverOptions += `
                    <div class="driver-option unassign" onclick="unassignDriver('${booking.bookingId}')">
                        ‚úó Unassign Driver
                    </div>
                `;
            }
            
            const badgeText = assignedDriver ? assignedDriver.name : 'Assign Driver';
            const badgeClass = assignedDriver ? 'assigned' : 'unassigned';
            
            return `
                <div class="driver-dropdown">
                    <span class="driver-badge ${badgeClass}" onclick="toggleDriverDropdown('${booking.bookingId}')" id="driverBadge_${booking.bookingId}">
                        ${badgeText}
                    </span>
                    <div class="driver-dropdown-menu" id="driverDropdown_${booking.bookingId}">
                        ${driverOptions || '<div class="driver-option" style="color: #6c757d; font-style: italic;">No drivers available</div>'}
                    </div>
                </div>
            `;
        }

        function loadNext24hBookings() {
            console.log('üö® NIEUWE VERSIE GELADEN - TEST 123');
            
            const tableBody = document.getElementById('next24hTableBody');
            if (!tableBody) {
                console.error('‚ùå Next 24h table body not found');
                return;
            }
            
            const confirmedBookings = JSON.parse(localStorage.getItem('confirmedBookings') || '[]');
            console.log(`üîç DEBUG: Found ${confirmedBookings.length} confirmed bookings:`, confirmedBookings);
            document.getElementById('next24hCount').textContent = `${confirmedBookings.length} confirmed`;
            
            if (confirmedBookings.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="8" class="empty-state">
                            <h3>üìã No Confirmed Bookings</h3>
                            <p>Confirmed bookings will appear here</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            let tableHTML = '';
            confirmedBookings.forEach((booking, index) => {
                // üö® KOPIEER EXACT DEZELFDE LOGICA ALS UNCONFIRMED
                let finalTotalPrice = 0;
                
                // Try different sources in priority order (EXACT same as Unconfirmed)
                const step2Price = localStorage.getItem('step2FinalTotalPrice');
                if (step2Price && parseFloat(step2Price) > 0) {
                    finalTotalPrice = parseFloat(step2Price);
                } else if (booking.finalPrice) {
                    finalTotalPrice = parseFloat(booking.finalPrice);
                } else if (booking.totalPrice) {
                    finalTotalPrice = parseFloat(booking.totalPrice);
                } else {
                    // Fallback to vehicle pricing
                    finalTotalPrice = parseFloat(booking.vehicle?.pricing?.totalPrice || booking.vehicle?.pricing?.minimumPrice || booking.vehicle?.price || 50.00);
                }
                
                // Check if it's a single trip (no suffix) or return trip (has 'a' or 'b' suffix)
                const bookingId = booking.bookingId || '';
                const hasReturnSuffix = bookingId.endsWith('a') || bookingId.endsWith('b');
                const hasIndividualTrips = (booking.trip?.tripType === 'heen' || booking.trip?.tripType === 'terug') && hasReturnSuffix;
                
                let total;
                
                if (hasIndividualTrips) {
                    // EXACT STAP 3 PRICING LOGIC - MARCEL APPROVED
                    const step2FinalPrice = parseFloat(localStorage.getItem('step2FinalTotalPrice') || '0');
                    let heenTotaal, terugTotaal;
                    
                    if (step2FinalPrice > 0) {
                        finalTotalPrice = step2FinalPrice;
                        
                        // Find Meet & Greet price for correct distribution (EXACT STAP 3 logic)
                        let meetGreetPrice = 0;
                        const surchargeData = booking.surcharges;
                        if (surchargeData && surchargeData.selectedSurcharges) {
                            for (const [key, value] of Object.entries(surchargeData.selectedSurcharges)) {
                                if (key.toLowerCase().includes('meet') || key.toLowerCase().includes('greet')) {
                                    if (typeof value === 'object' && value.price) {
                                        meetGreetPrice = parseFloat(value.price) || 0;
                                    } else if (typeof value === 'number') {
                                        meetGreetPrice = value;
                                    }
                                    break;
                                }
                            }
                        }
                        
                        // Calculate exactly like STAP 3
                        if (meetGreetPrice > 0) {
                            const basePricePerTrip = (step2FinalPrice - meetGreetPrice) / 2;
                            heenTotaal = basePricePerTrip;
                            terugTotaal = basePricePerTrip + meetGreetPrice;
                        } else {
                            heenTotaal = step2FinalPrice / 2;
                            terugTotaal = step2FinalPrice / 2;
                        }
                    } else {
                        // Fallback if no step2 price
                        heenTotaal = finalTotalPrice / 2;
                        terugTotaal = finalTotalPrice / 2;
                    }
                    
                    if (booking.trip.tripType === 'heen') {
                        total = heenTotaal.toFixed(2);
                    } else {
                        total = terugTotaal.toFixed(2);
                    }
                } else {
                    total = finalTotalPrice.toFixed(2);
                }
                
                console.log(`üîç COMPLETE DEBUG for booking ${booking.bookingId}:`);
                console.log(`   step2Price: "${step2Price}"`);
                console.log(`   booking.finalPrice: "${booking.finalPrice}"`);
                console.log(`   booking.totalPrice: "${booking.totalPrice}"`);
                console.log(`   booking.surcharges:`, booking.surcharges);
                console.log(`   finalTotalPrice chosen: ‚Ç¨${finalTotalPrice}`);
                console.log(`   final total displayed: ‚Ç¨${total}`);
                
                const travelDateTime = `${booking.trip.travelDate} ${booking.trip.travelHour}:${booking.trip.travelMinute}`;
                
                tableHTML += `
                    <tr style="border-bottom: 1px solid #dee2e6;">
                        <td class="table-cell" style="text-align: center;">
                            ${(() => {
                                const country = detectCountryFromAddress(booking.trip.fromLocation);
                                const countryInfo = getCountryInfo(country);
                                const isCrossBorder = detectCountryFromAddress(booking.trip.fromLocation) !== detectCountryFromAddress(booking.trip.toLocation);
                                return `
                                    <div style="display: flex; flex-direction: column; align-items: center; gap: 2px;">
                                        <span style="font-size: 20px;" title="${countryInfo.name}">${countryInfo.flag}</span>
                                        ${isCrossBorder ? '<div style="font-size: 9px; color: #dc3545;">Cross</div>' : ''}
                                        <button style="background: transparent; border: 1px solid #dee2e6; padding: 2px 6px; border-radius: 4px; cursor: pointer; font-size: 12px;" onclick="openProfessionalBookingEdit('${booking.bookingId}')" title="View Details">
                                            üëÅ
                                        </button>
                                    </div>
                                `;
                            })()}
                        </td>
                        <td class="table-cell">
                            <div class="font-medium">${booking.customer.firstName} ${booking.customer.lastName}</div>
                            <div class="small-text">üìû ${booking.customer.phone}</div>
                            ${booking.trip.tripType ? `<div style="font-size: 11px; color: #007bff; font-weight: 500;">${booking.trip.tripType === 'heen' ? 'üîÑ HEEN' : 'üîÑ TERUG'}</div>` : ''}
                        </td>
                        <td class="table-cell">
                            <div class="font-medium">${travelDateTime}</div>
                        </td>
                        <td class="table-cell">
                            <div class="status-dropdown">
                                <span class="status-badge ${booking.status === 'confirmed' || !booking.status ? 'confirmed' : ''}" onclick="toggleStatusDropdown('${booking.bookingId}')" id="statusBadge_${booking.bookingId}" style="font-size: 11px; padding: 4px 8px;">
                                    ${booking.status === 'confirmed' || !booking.status ? 'Confirmed' : getStatusDisplayName(booking.status)}
                                </span>
                                <div class="status-dropdown-menu" id="statusDropdown_${booking.bookingId}">
                                    <div class="status-option ${booking.status === 'unconfirmed' ? 'selected' : ''}" onclick="changeBookingStatus('${booking.bookingId}', 'unconfirmed')">
                                        ${booking.status === 'unconfirmed' ? '‚úì ' : ''}Unconfirmed
                                    </div>
                                    <div class="status-option ${booking.status === 'confirmed' || !booking.status ? 'selected' : ''}" onclick="changeBookingStatus('${booking.bookingId}', 'confirmed')">
                                        ${booking.status === 'confirmed' || !booking.status ? '‚úì ' : ''}Confirmed
                                    </div>
                                    <div class="status-option ${booking.status === 'request_quote' ? 'selected' : ''}" onclick="changeBookingStatus('${booking.bookingId}', 'request_quote')">
                                        ${booking.status === 'request_quote' ? '‚úì ' : ''}Request Quote
                                    </div>
                                    <div class="status-option ${booking.status === 'assigned' ? 'selected' : ''}" onclick="changeBookingStatus('${booking.bookingId}', 'assigned')">
                                        ${booking.status === 'assigned' ? '‚úì ' : ''}Assigned
                                    </div>
                                    <div class="status-option ${booking.status === 'job_accepted' ? 'selected' : ''}" onclick="changeBookingStatus('${booking.bookingId}', 'job_accepted')">
                                        ${booking.status === 'job_accepted' ? '‚úì ' : ''}Job Accepted
                                    </div>
                                    <div class="status-option ${booking.status === 'job_rejected' ? 'selected' : ''}" onclick="changeBookingStatus('${booking.bookingId}', 'job_rejected')">
                                        ${booking.status === 'job_rejected' ? '‚úì ' : ''}Job Rejected
                                    </div>
                                    <div class="status-option ${booking.status === 'on_route' ? 'selected' : ''}" onclick="changeBookingStatus('${booking.bookingId}', 'on_route')">
                                        ${booking.status === 'on_route' ? '‚úì ' : ''}On Route
                                    </div>
                                    <div class="status-option ${booking.status === 'arrived' ? 'selected' : ''}" onclick="changeBookingStatus('${booking.bookingId}', 'arrived')">
                                        ${booking.status === 'arrived' ? '‚úì ' : ''}Arrived
                                    </div>
                                    <div class="status-option ${booking.status === 'on_board' ? 'selected' : ''}" onclick="changeBookingStatus('${booking.bookingId}', 'on_board')">
                                        ${booking.status === 'on_board' ? '‚úì ' : ''}On Board
                                    </div>
                                    <div class="status-option ${booking.status === 'no_show' ? 'selected' : ''}" onclick="changeBookingStatus('${booking.bookingId}', 'no_show')">
                                        ${booking.status === 'no_show' ? '‚úì ' : ''}No Show
                                    </div>
                                    <div class="status-option ${booking.status === 'completed' ? 'selected' : ''}" onclick="changeBookingStatus('${booking.bookingId}', 'completed')">
                                        ${booking.status === 'completed' ? '‚úì ' : ''}Completed
                                    </div>
                                    <div class="status-option ${booking.status === 'cancelled' ? 'selected' : ''}" onclick="changeBookingStatus('${booking.bookingId}', 'cancelled')">
                                        ${booking.status === 'cancelled' ? '‚úì ' : ''}Cancelled
                                    </div>
                                    <div class="status-option ${booking.status === 'driver_cancelled' ? 'selected' : ''}" onclick="changeBookingStatus('${booking.bookingId}', 'driver_cancelled')">
                                        ${booking.status === 'driver_cancelled' ? '‚úì ' : ''}Driver Cancelled
                                    </div>
                                    <div class="status-option ${booking.status === 'incomplete' ? 'selected' : ''}" onclick="changeBookingStatus('${booking.bookingId}', 'incomplete')">
                                        ${booking.status === 'incomplete' ? '‚úì ' : ''}Incomplete
                                    </div>
                                </div>
                            </div>
                        </td>
                        <td class="table-cell">
                            <select style="padding: 4px 8px; border: 1px solid #dee2e6; border-radius: 4px; font-size: 14px; width: auto; min-width: 120px; max-width: 180px;" onchange="assignDriverToBooking('${booking.bookingId}', this.value)">
                                <option value="">-- Select --</option>
                                <optgroup label="Auto">
                                    <option value="auto-all" ${booking.driver === 'auto-all' ? 'selected' : ''}>All Drivers</option>
                                    <option value="auto-nearby" ${booking.driver === 'auto-nearby' ? 'selected' : ''}>Nearby</option>
                                    <option value="auto-lastminute" ${booking.driver === 'auto-lastminute' ? 'selected' : ''}>Last-Minute</option>
                                </optgroup>
                                <optgroup label="Drivers">
                                    ${getDriverOptionsHTML(booking.driver)}
                                </optgroup>
                            </select>
                        </td>
                        <td class="table-cell">
                            <div>${booking.vehicle?.vehicle?.name || 'Saloon'}</div>
                        </td>
                        <td class="table-cell">
                            <div style="font-size: 12px;">${booking.specialInstructions || '-'}</div>
                        </td>
                        <td class="table-cell" style="text-align: left;">
                            <div style="font-weight: 500; color: #28a745;">‚Ç¨${total}</div>
                        </td>
                    </tr>
                `;
            });
            
            tableBody.innerHTML = tableHTML;
        }

        function loadCompletedBookings() {
            console.log('üìã Loading completed bookings...');
            
            const tableBody = document.getElementById('completedTableBody');
            if (!tableBody) {
                console.error('‚ùå Completed table body not found');
                return;
            }
            
            const completedBookings = JSON.parse(localStorage.getItem('completedBookings') || '[]');
            document.getElementById('completedCount').textContent = `${completedBookings.length} completed`;
            
            if (completedBookings.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="9" class="empty-state">
                            <h3>‚úÖ No Completed Bookings</h3>
                            <p>Completed trips will appear here</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            let tableHTML = '';
            completedBookings.forEach((booking, index) => {
                const vehiclePrice = booking.vehicle?.pricing?.minimumPrice || booking.vehicle?.price || 50.00;
                const total = parseFloat(vehiclePrice).toFixed(2);
                const travelDateTime = `${booking.trip.travelDate} ${booking.trip.travelHour}:${booking.trip.travelMinute}`;
                const completedDate = new Date(booking.completedAt || booking.lastUpdated);
                const formattedCompletedDate = completedDate.toLocaleDateString('nl-BE');
                
                const fromCountry = detectCountryFromAddress(booking.trip.fromLocation);
                const toCountry = detectCountryFromAddress(booking.trip.toLocation);
                const isCrossBorder = fromCountry !== toCountry;
                const countryInfo = getCountryInfo(fromCountry);
                
                tableHTML += `
                    <tr style="border-bottom: 1px solid #dee2e6;">
                        <td class="table-cell" style="text-align: center; padding: 8px 4px;">
                            <div style="position: relative; display: inline-block;">
                                ${countryInfo.flag}
                                ${isCrossBorder ? '<div style="font-size: 10px; color: #ff6b6b;">üåê</div>' : ''}
                                <button onclick="viewBookingDetails('${booking.bookingId}')" style="display: block; background: transparent; border: none; cursor: pointer; margin-top: 2px; font-size: 12px;">üëÅ</button>
                            </div>
                        </td>
                        <td class="table-cell" style="padding: 8px;">
                            <div class="font-medium" style="font-size: 13px;">${booking.customer.firstName} ${booking.customer.lastName}</div>
                            <div class="small-text" style="font-size: 11px; color: #666;">üìû ${booking.customer.phone}</div>
                            <div class="small-text" style="font-size: 11px; color: #666;">${booking.trip.fromLocation} ‚Üí ${booking.trip.toLocation}</div>
                            ${booking.trip.tripType ? `<div style="font-size: 10px; color: #007bff; font-weight: 500;">${booking.trip.tripType === 'heen' ? 'üîÑ HEEN' : 'üîÑ TERUG'}</div>` : ''}
                        </td>
                        <td class="table-cell" style="padding: 8px; font-size: 12px;">
                            <div>${travelDateTime.split(' ')[0]}</div>
                            <div style="font-size: 11px; color: #666;">${travelDateTime.split(' ')[1]}</div>
                        </td>
                        <td class="table-cell" style="padding: 8px;">
                            <span class="status-badge confirmed" style="font-size: 11px; padding: 4px 8px; background: #28a745; color: white; border-radius: 4px;">
                                Completed
                            </span>
                        </td>
                        <td class="table-cell" style="padding: 8px;">
                            <select style="width: 120px; padding: 4px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px;" onchange="assignDriverToBooking('${booking.bookingId}', this.value)">
                                <option value="">Assigned</option>
                                ${getDriverOptionsHTML()}
                            </select>
                        </td>
                        <td class="table-cell" style="padding: 8px; font-size: 12px;">
                            <div>${booking.vehicle?.vehicle?.name || 'Saloon'}</div>
                        </td>
                        <td class="table-cell" style="padding: 8px; font-size: 12px;">
                            <div>Completed ${formattedCompletedDate}</div>
                        </td>
                        <td class="table-cell" style="padding: 8px; text-align: left;">
                            <div style="font-weight: 500; color: #28a745;">‚Ç¨${total}</div>
                        </td>
                        <td class="table-cell" style="text-align: center; padding: 8px 4px;">
                            <button onclick="openEmailModal('${booking.bookingId}')" style="background: transparent; border: none; cursor: pointer; font-size: 16px;">‚úâÔ∏è</button>
                        </td>
                    </tr>
                `;
            });
            
            tableBody.innerHTML = tableHTML;
        }

        function clearAllCompleted() {
            if (confirm('Are you sure you want to clear all completed bookings?')) {
                localStorage.setItem('completedBookings', JSON.stringify([]));
                loadCompletedBookings();
                alert('‚úÖ All completed bookings cleared');
            }
        }

        // All Bookings Functions
        function loadAllBookings() {
            console.log('üìã Loading all bookings...');
            
            const tableBody = document.getElementById('allBookingsTableBody');
            if (!tableBody) {
                console.error('‚ùå All bookings table body not found');
                return;
            }
            
            // Collect all bookings from different sources
            const unconfirmedBookings = JSON.parse(localStorage.getItem('unconfirmedBookings') || '[]');
            const confirmedBookings = JSON.parse(localStorage.getItem('confirmedBookings') || '[]');
            const completedBookings = JSON.parse(localStorage.getItem('completedBookings') || '[]');
            const cancelledBookings = JSON.parse(localStorage.getItem('cancelledBookings') || '[]');
            
            // Combine all bookings and sort by creation date (newest first)
            const allBookings = [
                ...unconfirmedBookings.map(b => ({...b, section: 'unconfirmed'})),
                ...confirmedBookings.map(b => ({...b, section: 'confirmed'})),
                ...completedBookings.map(b => ({...b, section: 'completed'})),
                ...cancelledBookings.map(b => ({...b, section: 'cancelled'}))
            ].sort((a, b) => new Date(b.createdAt || b.bookingDate) - new Date(a.createdAt || a.bookingDate));
            
            // Update counter
            document.getElementById('allBookingsCount').textContent = `${allBookings.length} bookings`;
            
            if (allBookings.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="9" class="empty-state">
                            <h3>üìã No Bookings Found</h3>
                            <p>All customer and dispatch bookings will appear here</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            // Generate table rows
            let tableHTML = '';
            
            allBookings.forEach((booking, index) => {
                const createdDate = new Date(booking.createdAt || booking.bookingDate);
                const formattedDate = createdDate.toLocaleDateString('nl-BE');
                const formattedTime = createdDate.toLocaleTimeString('nl-BE', { hour: '2-digit', minute: '2-digit' });
                const travelDateTime = `${booking.trip.travelDate} ${booking.trip.travelHour}:${booking.trip.travelMinute}`;
                
                // Get actual price
                const vehiclePrice = booking.vehicle?.pricing?.minimumPrice || booking.vehicle?.price || 50.00;
                const total = parseFloat(vehiclePrice).toFixed(2);
                
                // Determine source
                const source = booking.source === 'dispatch' ? 
                    '<span style="background: #dc3545; color: white; padding: 2px 8px; border-radius: 12px; font-size: 11px; font-weight: 500;">DISPATCH</span>' :
                    '<span style="background: #28a745; color: white; padding: 2px 8px; border-radius: 12px; font-size: 11px; font-weight: 500;">CUSTOMER</span>';
                
                // Status styling
                let statusClass = '';
                let statusText = booking.status || 'unconfirmed';
                if (['confirmed', 'job_accepted', 'completed'].includes(statusText)) {
                    statusClass = 'confirmed';
                } else if (['cancelled', 'driver_cancelled', 'job_rejected', 'no_show'].includes(statusText)) {
                    statusClass = 'cancelled';
                }
                
                // Determine country flag (default to Belgian flag for now)
                const countryFlag = 'üáßüá™';
                
                // Get assigned driver info
                const assignedDriver = booking.assignedDriver || 'Not assigned';
                const driverInfo = typeof assignedDriver === 'object' ? 
                    `${assignedDriver.name} (${assignedDriver.id})` : assignedDriver;
                
                // Get notes from booking
                const notes = booking.customer?.specialRequests || booking.notes || '';
                const notesDisplay = notes ? 
                    `<span style="color: #666; font-size: 12px;" title="${notes}">${notes.length > 30 ? notes.substring(0, 30) + '...' : notes}</span>` : 
                    '<span style="color: #ccc;">-</span>';
                
                tableHTML += `
                    <tr style="border-bottom: 1px solid #dee2e6;">
                        <td class="table-cell" style="text-align: center;">
                            <div style="display: flex; align-items: center; gap: 5px;">
                                <span style="font-size: 16px;">${countryFlag}</span>
                                <button style="background: transparent; border: 1px solid #dee2e6; padding: 2px 6px; border-radius: 3px; cursor: pointer; font-size: 12px;" onclick="showBookingActions('${booking.bookingId}')">
                                    üëÅ
                                </button>
                            </div>
                        </td>
                        <td class="table-cell">
                            <div class="font-medium" style="font-size: 13px;">${booking.customer.firstName} ${booking.customer.lastName}</div>
                            <div class="small-text" style="font-size: 11px; color: #666;">üìû ${booking.customer.phone}</div>
                            <div class="small-text" style="font-size: 11px; color: #007bff;">${booking.trip.fromLocation} ‚Üí ${booking.trip.toLocation}</div>
                        </td>
                        <td class="table-cell">
                            <div class="font-medium" style="font-size: 13px;">${booking.trip.travelDate}</div>
                            <div class="small-text" style="font-size: 11px; color: #666;">${booking.trip.travelHour}:${booking.trip.travelMinute}</div>
                        </td>
                        <td class="table-cell">
                            <span class="status-badge ${statusClass}" style="font-size: 10px; padding: 3px 6px; border-radius: 3px;">
                                ${getStatusDisplayName(statusText)}
                            </span>
                        </td>
                        <td class="table-cell">
                            <div style="font-size: 12px; color: ${assignedDriver === 'Not assigned' ? '#dc3545' : '#28a745'};">
                                ${driverInfo}
                            </div>
                        </td>
                        <td class="table-cell">
                            <div class="font-medium" style="font-size: 12px;">${booking.vehicle.vehicle?.name || 'Saloon'}</div>
                            <div class="small-text" style="font-size: 11px; color: #666;">${booking.customer.passengers}p</div>
                        </td>
                        <td class="table-cell">
                            ${notesDisplay}
                        </td>
                        <td class="table-cell" style="text-align: left;">
                            <div style="font-weight: 500; color: #28a745; font-size: 13px;">‚Ç¨${total}</div>
                            <div class="small-text" style="font-size: 10px; color: #666;">${booking.customer.paymentMethod}</div>
                        </td>
                        <td class="table-cell" style="text-align: center;">
                            <button style="background: #007bff; color: white; border: none; padding: 4px 8px; border-radius: 3px; cursor: pointer; font-size: 11px;" onclick="sendEmail('${booking.customer.email}', '${booking.bookingId}')" title="Send email to ${booking.customer.email}">
                                ‚úâÔ∏è
                            </button>
                        </td>
                    </tr>
                `;
            });
            
            tableBody.innerHTML = tableHTML;
        }

        // Send email function
        function sendEmail(customerEmail, bookingId) {
            const subject = `Booking Confirmation - ${bookingId}`;
            const mailtoLink = `mailto:${customerEmail}?subject=${encodeURIComponent(subject)}`;
            
            // Open default email client
            window.open(mailtoLink);
            
            console.log('üìß Opening email client for:', customerEmail, 'Booking:', bookingId);
        }

        function filterAllBookings() {
            const filter = document.getElementById('allBookingsFilter').value;
            console.log('üîç Filtering all bookings by:', filter);
            
            // Get all bookings
            const unconfirmedBookings = JSON.parse(localStorage.getItem('unconfirmedBookings') || '[]');
            const confirmedBookings = JSON.parse(localStorage.getItem('confirmedBookings') || '[]');
            const completedBookings = JSON.parse(localStorage.getItem('completedBookings') || '[]');
            const cancelledBookings = JSON.parse(localStorage.getItem('cancelledBookings') || '[]');
            
            let filteredBookings = [];
            
            switch(filter) {
                case 'customer':
                    filteredBookings = [
                        ...unconfirmedBookings.filter(b => !b.source || b.source !== 'dispatch'),
                        ...confirmedBookings.filter(b => !b.source || b.source !== 'dispatch'),
                        ...completedBookings.filter(b => !b.source || b.source !== 'dispatch'),
                        ...cancelledBookings.filter(b => !b.source || b.source !== 'dispatch')
                    ];
                    break;
                case 'dispatch':
                    filteredBookings = [
                        ...unconfirmedBookings.filter(b => b.source === 'dispatch'),
                        ...confirmedBookings.filter(b => b.source === 'dispatch'),
                        ...completedBookings.filter(b => b.source === 'dispatch'),
                        ...cancelledBookings.filter(b => b.source === 'dispatch')
                    ];
                    break;
                case 'confirmed':
                    filteredBookings = confirmedBookings;
                    break;
                case 'unconfirmed':
                    filteredBookings = unconfirmedBookings;
                    break;
                case 'completed':
                    filteredBookings = completedBookings;
                    break;
                case 'cancelled':
                    filteredBookings = cancelledBookings;
                    break;
                default: // 'all'
                    filteredBookings = [...unconfirmedBookings, ...confirmedBookings, ...completedBookings, ...cancelledBookings];
                    break;
            }
            
            // Update counter
            document.getElementById('allBookingsCount').textContent = `${filteredBookings.length} bookings`;
            
            // Force reload with filtered data
            // For simplicity, we'll just reload all and then apply client-side filtering
            loadAllBookings();
        }

        // Vehicle Management Functions
        let vehicles = [];
        let editingVehicleIndex = -1;

        function loadVehiclesForTypesSection() {
            const savedVehicles = localStorage.getItem('taxiVehicles');
            if (savedVehicles) {
                vehicles = JSON.parse(savedVehicles);
            } else {
                // Create default vehicles if none exist
                vehicles = [
                    {
                        id: 'saloon',
                        name: 'Saloon',
                        description: 'Comfort sedan voor dagelijks gebruik',
                        active: true,
                        capacity: { passengers: 4, luggage: 2 },
                        image: null
                    },
                    {
                        id: 'estate',
                        name: 'Estate',
                        description: 'Ruime stationwagen met extra bagageruimte',
                        active: true,
                        capacity: { passengers: 4, luggage: 4 },
                        image: null
                    },
                    {
                        id: 'minivan',
                        name: 'Minivan',
                        description: 'Ideaal voor kleine groepen',
                        active: true,
                        capacity: { passengers: 6, luggage: 4 },
                        image: null
                    },
                    {
                        id: 'minivan_long',
                        name: 'Minivan Long',
                        description: 'Grote groepsvervoer met maximum comfort',
                        active: true,
                        capacity: { passengers: 8, luggage: 6 },
                        image: null
                    }
                ];
                localStorage.setItem('taxiVehicles', JSON.stringify(vehicles));
            }
            renderVehicleTable();
        }

        function renderVehicleTable() {
            const tableBody = document.getElementById('vehicleTableBody');
            if (!tableBody) return;

            if (vehicles.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="6" class="empty-state">
                            <h3> No Vehicles Found</h3>
                            <p>Click "Add New Vehicle" to start adding vehicles</p>
                        </td>
                    </tr>
                `;
                return;
            }

            let tableHTML = '';
            vehicles.forEach((vehicle, index) => {
                const statusColor = vehicle.active ? '#28a745' : '#dc3545';
                const statusText = vehicle.active ? 'Active' : 'Inactive';
                
                const imageDisplay = vehicle.image ? 
                    `<img src="${vehicle.image}" style="width: 50px; height: 30px; object-fit: cover; border-radius: 4px;">` :
                    '<span style="font-size: 24px;"></span>';

                tableHTML += `
                    <tr style="border-bottom: 1px solid #dee2e6;">
                        <td class="section-padding">${imageDisplay}</td>
                        <td style="padding: 15px; font-weight: 500;">${vehicle.name}</td>
                        <td style="padding: 15px; color: #666;">${vehicle.description || 'No description'}</td>
                        <td class="section-padding">
                            <div>üë• ${vehicle.capacity?.passengers || 4} passengers</div>
                            <div class="small-text">üß≥ ${vehicle.capacity?.luggage || 2} luggage</div>
                            <div class="small-text">üëú ${vehicle.capacity?.handLuggage || 2} hand luggage</div>
                        </td>
                        <td class="section-padding">
                            <span style="color: ${statusColor}; font-weight: 500;">
                                ${vehicle.active ? '‚úÖ' : '‚ùå'} ${statusText}
                            </span>
                        </td>
                        <td class="section-padding">
                            <button style="background: #3498db; color: white; border: none; padding: 6px 12px; border-radius: 4px; margin-right: 5px; cursor: pointer;" onclick="editVehicle(${index})">‚úèÔ∏è Edit</button>
                            <button style="background: ${vehicle.active ? '#e74c3c' : '#27ae60'}; color: white; border: none; padding: 6px 12px; border-radius: 4px; margin-right: 5px; cursor: pointer;" onclick="toggleVehicleStatus(${index})">${vehicle.active ? '‚ùå Disable' : '‚úÖ Enable'}</button>
                            <button style="background: #dc3545; color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer;" onclick="deleteVehicle(${index})">üóëÔ∏è Delete</button>
                        </td>
                    </tr>
                `;
            });

            tableBody.innerHTML = tableHTML;
        }

        function openAddVehicleModal() {
            editingVehicleIndex = -1;
            document.getElementById('vehicleModalTitle').textContent = 'Add New Vehicle';
            document.getElementById('vehicleForm').reset();
            document.getElementById('vehicleImagePreview').style.display = 'none';
            document.getElementById('vehicleUploadText').style.display = 'block';
            document.getElementById('vehicleModal').style.display = 'flex';
        }

        function editVehicle(index) {
            editingVehicleIndex = index;
            const vehicle = vehicles[index];
            
            document.getElementById('vehicleModalTitle').textContent = 'Edit Vehicle';
            document.getElementById('vehicleName').value = vehicle.name;
            document.getElementById('vehicleDescription').value = vehicle.description || '';
            document.getElementById('vehiclePassengers').value = vehicle.capacity?.passengers || 4;
            document.getElementById('vehicleLuggage').value = vehicle.capacity?.luggage || 2;
            document.getElementById('vehicleHandLuggage').value = vehicle.capacity?.handLuggage || 2;
            
            if (vehicle.image) {
                document.getElementById('vehicleImagePreview').src = vehicle.image;
                document.getElementById('vehicleImagePreview').style.display = 'block';
                document.getElementById('vehicleUploadText').style.display = 'none';
            }
            
            document.getElementById('vehicleModal').style.display = 'flex';
        }

        function closeVehicleModal() {
            document.getElementById('vehicleModal').style.display = 'none';
        }

        function handleVehicleImageUpload(input) {
            const file = input.files[0];
            if (file) {
                if (file.size > 5 * 1024 * 1024) {
                    showVehicleError('Image size must be less than 5MB');
                    return;
                }

                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('vehicleImagePreview').src = e.target.result;
                    document.getElementById('vehicleImagePreview').style.display = 'block';
                    document.getElementById('vehicleUploadText').style.display = 'none';
                };
                reader.readAsDataURL(file);
            }
        }

        function deleteVehicle(index) {
            if (confirm(`Are you sure you want to delete "${vehicles[index].name}"?`)) {
                vehicles.splice(index, 1);
                saveVehicles();
                renderVehicleTable();
                showVehicleSuccess('Vehicle deleted successfully');
            }
        }

        function toggleVehicleStatus(index) {
            vehicles[index].active = !vehicles[index].active;
            saveVehicles();
            renderVehicleTable();
            showVehicleSuccess(`Vehicle ${vehicles[index].active ? 'enabled' : 'disabled'} successfully`);
        }

        function saveVehicles() {
            localStorage.setItem('taxiVehicles', JSON.stringify(vehicles));
            
            // Set timestamp for booking system to detect updates
            localStorage.setItem('vehicleUpdateTimestamp', Date.now().toString());
            
            // Also sync to booking system
            const bookingVehicles = vehicles.filter(v => v.active).map(v => ({
                id: v.id,
                name: v.name,
                description: v.description,
                active: v.active,
                capacity: v.capacity,
                image: v.image
            }));
            
            localStorage.setItem('bookingSystemVehicles', JSON.stringify(bookingVehicles));
            console.log('‚úÖ Vehicles saved and synced to booking system');
        }

        function showVehicleSuccess(message) {
            const el = document.getElementById('vehicleSuccessMessage');
            el.textContent = message;
            el.style.display = 'block';
            setTimeout(() => el.style.display = 'none', 5000);
        }

        function showVehicleError(message) {
            const el = document.getElementById('vehicleErrorMessage');
            el.textContent = message;
            el.style.display = 'block';
            setTimeout(() => el.style.display = 'none', 5000);
        }

        // Handle vehicle form submission
        document.addEventListener('DOMContentLoaded', function() {
            const vehicleForm = document.getElementById('vehicleForm');
            if (vehicleForm) {
                vehicleForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const name = document.getElementById('vehicleName').value;
                    const description = document.getElementById('vehicleDescription').value;
                    const passengers = parseInt(document.getElementById('vehiclePassengers').value);
                    const luggage = parseInt(document.getElementById('vehicleLuggage').value);
                    const handLuggage = parseInt(document.getElementById('vehicleHandLuggage').value);
                    const imagePreview = document.getElementById('vehicleImagePreview');
                    
                    if (!name.trim()) {
                        showVehicleError('Vehicle name is required');
                        return;
                    }
                    
                    const vehicleData = {
                        id: editingVehicleIndex === -1 ? name.toLowerCase().replace(/[^a-z0-9]/g, '_') : vehicles[editingVehicleIndex].id,
                        name: name,
                        description: description,
                        active: true,
                        capacity: { passengers: passengers, luggage: luggage, handLuggage: handLuggage },
                        image: imagePreview.style.display === 'block' ? imagePreview.src : null
                    };
                    
                    if (editingVehicleIndex === -1) {
                        vehicles.push(vehicleData);
                        showVehicleSuccess('Vehicle added successfully');
                    } else {
                        vehicles[editingVehicleIndex] = { ...vehicles[editingVehicleIndex], ...vehicleData };
                        showVehicleSuccess('Vehicle updated successfully');
                    }
                    
                    saveVehicles();
                    renderVehicleTable();
                    closeVehicleModal();
                });
            }
        });

        // Update the section show function to load vehicles when Types of Vehicles is opened
        const originalShowSection = window.showSection;
        window.showSection = function(sectionName) {
            if (originalShowSection) {
                originalShowSection(sectionName);
            }
            
            if (sectionName === 'types-of-vehicles') {
                setTimeout(() => {
                    loadVehiclesForTypesSection();
                }, 100);
            }
        };

        // üöó VEHICLE MANAGER FUNCTIONS (from admin-simple.html)
        let vehicleManagerData = [];
        let editingVehicleManagerIndex = -1;

        function openVehicleManagerFixed() {
            console.log('üîß openVehicleManagerFixed called');
            
            // Hide all sections
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
                section.style.display = 'none';
            });
            
            // Create content in the main content area
            const contentArea = document.querySelector('.content-area');
            contentArea.innerHTML = `
                <div style="padding: 30px; background: white; margin: 20px; border-radius: 10px; max-width: 1200px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
                        <div>
                            <h2>üöó Vehicle Manager</h2>
                            <p>Manage your vehicle fleet and specifications</p>
                        </div>
                        <button onclick="openVehicleManagerModal()" style="background: #007bff; color: white; padding: 12px 24px; border: none; border-radius: 6px; cursor: pointer;">
                            ‚ûï Add New Vehicle
                        </button>
                    </div>

                    <div id="vehicleManagerSuccessMessage" style="background: #d4edda; color: #155724; padding: 12px; border-radius: 6px; margin-bottom: 20px; display: none;"></div>
                    <div id="vehicleManagerErrorMessage" style="background: #f8d7da; color: #721c24; padding: 12px; border-radius: 6px; margin-bottom: 20px; display: none;"></div>

                    <div style="overflow: hidden; box-shadow: 0 2px 10px rgba(0,0,0,0.1); background: white; border-radius: 12px;">
                        <table style="width: 100%; border-collapse: collapse;">
                            <thead style="background: #f8f9fa;">
                                <tr>
                                    <th style="padding: 12px 8px; text-align: left; font-weight: 600; color: #495057; border-bottom: 2px solid #dee2e6;">Image</th>
                                    <th style="padding: 12px 8px; text-align: left; font-weight: 600; color: #495057; border-bottom: 2px solid #dee2e6;">Name</th>
                                    <th style="padding: 12px 8px; text-align: left; font-weight: 600; color: #495057; border-bottom: 2px solid #dee2e6;">Description</th>
                                    <th style="padding: 12px 8px; text-align: left; font-weight: 600; color: #495057; border-bottom: 2px solid #dee2e6;">Capacity</th>
                                    <th style="padding: 12px 8px; text-align: left; font-weight: 600; color: #495057; border-bottom: 2px solid #dee2e6;">Hourly Rate</th>
                                    <th style="padding: 12px 8px; text-align: left; font-weight: 600; color: #495057; border-bottom: 2px solid #dee2e6;">Status</th>
                                    <th style="padding: 12px 8px; text-align: left; font-weight: 600; color: #495057; border-bottom: 2px solid #dee2e6;">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="vehicleManagerTableBody">
                                <!-- Vehicles will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
            
            // Load the data after creating the HTML
            loadVehicleManagerData();
        }

        function loadVehicleManagerData() {
            console.log('üöó Loading Vehicle Manager data...');
            
            // Always reload from localStorage to ensure we have the latest data
            const savedVehicles = localStorage.getItem('taxiVehicles');
            if (savedVehicles) {
                try {
                    vehicleManagerData = JSON.parse(savedVehicles);
                    console.log('‚úÖ Loaded vehicles from localStorage:', vehicleManagerData.length);
                } catch (e) {
                    console.error('‚ùå Error parsing saved vehicles:', e);
                    vehicleManagerData = [];
                }
            } else {
                // Create default vehicles if none exist
                vehicleManagerData = [
                    {
                        id: 'saloon',
                        name: 'Saloon',
                        description: 'Comfort sedan voor dagelijks gebruik',
                        driver: 'All',
                        active: true,
                        capacity: { passengers: 4, luggage: 2, handLuggage: 2 },
                        hourlyRate: 25,
                        image: null
                    },
                    {
                        id: 'estate',
                        name: 'Estate',
                        description: 'Ruime stationwagen met extra bagageruimte',
                        driver: 'All',
                        active: true,
                        capacity: { passengers: 4, luggage: 4, handLuggage: 2 },
                        hourlyRate: 30,
                        image: null
                    },
                    {
                        id: 'minivan',
                        name: 'Minivan',
                        description: 'Ideaal voor kleine groepen',
                        driver: 'All',
                        active: true,
                        capacity: { passengers: 6, luggage: 4, handLuggage: 3 },
                        hourlyRate: 35,
                        image: null
                    },
                    {
                        id: 'minivan_long',
                        name: 'Minivan Long',
                        description: 'Grote groepsvervoer met maximum comfort',
                        driver: 'All',
                        active: true,
                        capacity: { passengers: 8, luggage: 6, handLuggage: 4 },
                        hourlyRate: 45,
                        image: null
                    }
                ];
                saveVehicleManagerData();
            }
            renderVehicleManagerTable();
        }

        function renderVehicleManagerTable() {
            const tableBody = document.getElementById('vehicleManagerTableBody');
            if (!tableBody) return;

            if (vehicleManagerData.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="7" style="text-align: center; padding: 20px;">
                            <h3>üöó No Vehicles Found</h3>
                            <p>Click "Add New Vehicle" to start adding vehicles</p>
                        </td>
                    </tr>
                `;
                return;
            }

            let tableHTML = '';
            vehicleManagerData.forEach((vehicle, index) => {
                const statusColor = vehicle.active ? '#28a745' : '#dc3545';
                const statusText = vehicle.active ? 'Active' : 'Inactive';
                
                const imageDisplay = vehicle.image ? 
                    `<img src="${vehicle.image}" style="width: 50px; height: 30px; object-fit: cover; border-radius: 4px;">` :
                    '<span style="font-size: 24px;">üöó</span>';

                tableHTML += `
                    <tr>
                        <td style="padding: 10px 8px; border-bottom: 1px solid #f0f0f0;">${imageDisplay}</td>
                        <td style="padding: 10px 8px; border-bottom: 1px solid #f0f0f0;"><strong>${vehicle.name}</strong></td>
                        <td style="padding: 10px 8px; border-bottom: 1px solid #f0f0f0;">${vehicle.description || 'No description'}</td>
                        <td style="padding: 10px 8px; border-bottom: 1px solid #f0f0f0;">
                            <div>üë• ${vehicle.capacity?.passengers || 4} passengers</div>
                            <div>üß≥ ${vehicle.capacity?.luggage || 2} luggage</div>
                            <div>üëú ${vehicle.capacity?.handLuggage || 2} hand luggage</div>
                        </td>
                        <td style="padding: 10px 8px; border-bottom: 1px solid #f0f0f0;"><strong>‚Ç¨${vehicle.hourlyRate || 25}/hour</strong></td>
                        <td style="padding: 10px 8px; border-bottom: 1px solid #f0f0f0;">
                            <span style="color: ${statusColor}; font-weight: bold;">
                                ${vehicle.active ? '‚úÖ' : '‚ùå'} ${statusText}
                            </span>
                        </td>
                        <td style="padding: 10px 8px; border-bottom: 1px solid #f0f0f0;">
                            <button style="background: #3498db; color: white; border: none; padding: 6px 12px; border-radius: 4px; margin: 2px; cursor: pointer;" onclick="editVehicleManager(${index})">‚úèÔ∏è Edit</button>
                            <button style="background: ${vehicle.active ? '#e74c3c' : '#27ae60'}; color: white; border: none; padding: 6px 12px; border-radius: 4px; margin: 2px; cursor: pointer;" onclick="toggleVehicleManagerStatus(${index})">${vehicle.active ? '‚ùå Disable' : '‚úÖ Enable'}</button>
                            <button style="background: #dc3545; color: white; border: none; padding: 6px 12px; border-radius: 4px; margin: 2px; cursor: pointer;" onclick="deleteVehicleManager(${index})">üóëÔ∏è Delete</button>
                        </td>
                    </tr>
                `;
            });

            tableBody.innerHTML = tableHTML;
        }

        function openVehicleManagerModal() {
            editingVehicleManagerIndex = -1;
            document.getElementById('vehicleManagerModalTitle').textContent = 'Add New Vehicle';
            document.getElementById('vehicleManagerForm').reset();
            document.getElementById('vehicleManagerImagePreview').style.display = 'none';
            document.getElementById('vehicleManagerUploadText').style.display = 'block';
            document.getElementById('vehicleManagerModal').style.display = 'flex';
        }

        function editVehicleManager(index) {
            editingVehicleManagerIndex = index;
            const vehicle = vehicleManagerData[index];
            
            document.getElementById('vehicleManagerModalTitle').textContent = 'Edit Vehicle';
            document.getElementById('vehicleManagerName').value = vehicle.name;
            document.getElementById('vehicleManagerDriver').value = vehicle.driver || 'All';
            document.getElementById('vehicleManagerDescription').value = vehicle.description || '';
            document.getElementById('vehicleManagerPassengers').value = vehicle.capacity?.passengers || 4;
            document.getElementById('vehicleManagerLuggage').value = vehicle.capacity?.luggage || 2;
            document.getElementById('vehicleManagerHandLuggage').value = vehicle.capacity?.handLuggage || 2;
            document.getElementById('vehicleManagerHourlyRate').value = vehicle.hourlyRate || 25;
            
            // Clear previous image preview first
            document.getElementById('vehicleManagerImagePreview').style.display = 'none';
            document.getElementById('vehicleManagerUploadText').style.display = 'block';
            
            // Then show current vehicle image if it exists
            if (vehicle.image) {
                document.getElementById('vehicleManagerImagePreview').src = vehicle.image;
                document.getElementById('vehicleManagerImagePreview').style.display = 'block';
                document.getElementById('vehicleManagerUploadText').style.display = 'none';
            }
            
            document.getElementById('vehicleManagerModal').style.display = 'flex';
        }

        function closeVehicleManagerModal() {
            document.getElementById('vehicleManagerModal').style.display = 'none';
        }

        function deleteVehicleManager(index) {
            if (confirm(`Are you sure you want to delete "${vehicleManagerData[index].name}"?`)) {
                vehicleManagerData.splice(index, 1);
                saveVehicleManagerData();
                renderVehicleManagerTable();
                showVehicleManagerSuccess('Vehicle deleted successfully');
            }
        }

        function toggleVehicleManagerStatus(index) {
            vehicleManagerData[index].active = !vehicleManagerData[index].active;
            saveVehicleManagerData();
            renderVehicleManagerTable();
            showVehicleManagerSuccess(`Vehicle ${vehicleManagerData[index].active ? 'enabled' : 'disabled'} successfully`);
        }

        function saveVehicleManagerData() {
            console.log('üíæ Saving vehicle manager data...', vehicleManagerData.length, 'vehicles');
            
            try {
                // Save the complete vehicle data
                localStorage.setItem('taxiVehicles', JSON.stringify(vehicleManagerData));
                console.log('‚úÖ Saved to localStorage:', vehicleManagerData);
                
                // Also sync to booking system
                const bookingVehicles = vehicleManagerData.filter(v => v.active).map(v => ({
                    id: v.id,
                    name: v.name,
                    description: v.description,
                    active: v.active,
                    capacity: v.capacity,
                    hourlyRate: v.hourlyRate,
                    image: v.image
                }));
                
                localStorage.setItem('bookingSystemVehicles', JSON.stringify(bookingVehicles));
                console.log('‚úÖ Vehicle Manager data saved and synced to booking system');
                
                // Verify the save worked
                const savedData = localStorage.getItem('taxiVehicles');
                if (savedData) {
                    console.log('‚úÖ Verified save - data in localStorage');
                } else {
                    console.error('‚ùå Save failed - no data in localStorage');
                }
            } catch (e) {
                console.error('‚ùå Error saving vehicle data:', e);
                showVehicleManagerError('Failed to save vehicle data');
            }
        }

        function showVehicleManagerSuccess(message) {
            const el = document.getElementById('vehicleManagerSuccessMessage');
            if (el) {
                el.textContent = message;
                el.style.display = 'block';
                setTimeout(() => el.style.display = 'none', 5000);
            }
        }

        function showVehicleManagerError(message) {
            const el = document.getElementById('vehicleManagerErrorMessage');
            if (el) {
                el.textContent = message;
                el.style.display = 'block';
                setTimeout(() => el.style.display = 'none', 5000);
            }
        }

        function adjustVehicleManagerValue(field, change) {
            const input = document.getElementById(`vehicleManager${field.charAt(0).toUpperCase() + field.slice(1)}`);
            if (input) {
                const currentValue = parseInt(input.value) || 0;
                const newValue = Math.max(0, currentValue + change);
                input.value = newValue;
            }
        }

        function saveVehicleManagerForm() {
            console.log('üîß saveVehicleManagerForm called');
            
            const name = document.getElementById('vehicleManagerName').value;
            const driver = document.getElementById('vehicleManagerDriver').value;
            const description = document.getElementById('vehicleManagerDescription').value;
            const passengers = parseInt(document.getElementById('vehicleManagerPassengers').value);
            const luggage = parseInt(document.getElementById('vehicleManagerLuggage').value);
            const handLuggage = parseInt(document.getElementById('vehicleManagerHandLuggage').value);
            const hourlyRate = parseInt(document.getElementById('vehicleManagerHourlyRate').value);
            const imagePreview = document.getElementById('vehicleManagerImagePreview');
            
            if (!name.trim()) {
                showVehicleManagerError('Vehicle name is required');
                return;
            }
            
            const vehicleData = {
                id: editingVehicleManagerIndex === -1 ? name.toLowerCase().replace(/[^a-z0-9]/g, '_') : vehicleManagerData[editingVehicleManagerIndex].id,
                name: name,
                driver: driver,
                description: description,
                active: editingVehicleManagerIndex === -1 ? true : vehicleManagerData[editingVehicleManagerIndex].active,
                capacity: { 
                    passengers: passengers, 
                    luggage: luggage,
                    handLuggage: handLuggage 
                },
                hourlyRate: hourlyRate,
                image: imagePreview.style.display === 'block' ? imagePreview.src : (editingVehicleManagerIndex >= 0 ? vehicleManagerData[editingVehicleManagerIndex].image : null)
            };
            
            if (editingVehicleManagerIndex === -1) {
                vehicleManagerData.push(vehicleData);
                showVehicleManagerSuccess('Vehicle added successfully');
            } else {
                vehicleManagerData[editingVehicleManagerIndex] = vehicleData;
                showVehicleManagerSuccess('Vehicle updated successfully');
            }
            
            saveVehicleManagerData();
            renderVehicleManagerTable();
            closeVehicleManagerModal();
        }

        function handleVehicleManagerImageUpload(input) {
            const file = input.files[0];
            if (file) {
                if (file.size > 5 * 1024 * 1024) {
                    showVehicleManagerError('Image size must be less than 5MB');
                    return;
                }

                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('vehicleManagerImagePreview').src = e.target.result;
                    document.getElementById('vehicleManagerImagePreview').style.display = 'block';
                    document.getElementById('vehicleManagerUploadText').style.display = 'none';
                };
                reader.readAsDataURL(file);
            }
        }

        // Handle Vehicle Manager form submission
        document.addEventListener('DOMContentLoaded', function() {
            const vehicleManagerForm = document.getElementById('vehicleManagerForm');
            if (vehicleManagerForm) {
                vehicleManagerForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const name = document.getElementById('vehicleManagerName').value;
                    const driver = document.getElementById('vehicleManagerDriver').value;
                    const description = document.getElementById('vehicleManagerDescription').value;
                    const passengers = parseInt(document.getElementById('vehicleManagerPassengers').value);
                    const luggage = parseInt(document.getElementById('vehicleManagerLuggage').value);
                    const handLuggage = parseInt(document.getElementById('vehicleManagerHandLuggage').value);
                    const hourlyRate = parseInt(document.getElementById('vehicleManagerHourlyRate').value);
                    const imagePreview = document.getElementById('vehicleManagerImagePreview');
                    
                    if (!name.trim()) {
                        showVehicleManagerError('Vehicle name is required');
                        return;
                    }
                    
                    const vehicleData = {
                        id: editingVehicleManagerIndex === -1 ? name.toLowerCase().replace(/[^a-z0-9]/g, '_') : vehicleManagerData[editingVehicleManagerIndex].id,
                        name: name,
                        driver: driver,
                        description: description,
                        active: true,
                        capacity: { 
                            passengers: passengers, 
                            luggage: luggage,
                            handLuggage: handLuggage 
                        },
                        hourlyRate: hourlyRate,
                        image: imagePreview.style.display === 'block' ? imagePreview.src : null
                    };
                    
                    if (editingVehicleManagerIndex === -1) {
                        // Add new vehicle
                        vehicleManagerData.push(vehicleData);
                        showVehicleManagerSuccess('Vehicle added successfully');
                    } else {
                        // Update existing vehicle - preserve existing data and only update changed fields
                        const existingVehicle = vehicleManagerData[editingVehicleManagerIndex];
                        vehicleManagerData[editingVehicleManagerIndex] = {
                            ...existingVehicle,
                            name: name,
                            driver: driver,
                            description: description,
                            capacity: { 
                                passengers: passengers, 
                                luggage: luggage,
                                handLuggage: handLuggage 
                            },
                            hourlyRate: hourlyRate,
                            image: imagePreview.style.display === 'block' ? imagePreview.src : existingVehicle.image,
                            active: existingVehicle.active // Preserve active status
                        };
                        showVehicleManagerSuccess('Vehicle updated successfully');
                    }
                    
                    saveVehicleManagerData();
                    renderVehicleManagerTable();
                    closeVehicleManagerModal();
                });
            }
        });

        // üö® DISPATCH FUNCTIONS FOR ONCLICK HANDLERS
        window.addDispatchExtraStop = function() {
            console.log('‚ûï Adding extra stop');
            if (dispatchExtraStopCount < 7) {
                dispatchExtraStopCount++;
                const container = document.getElementById('dispatchExtraStopsContainer');
                if (container) {
                    const stopDiv = document.createElement('div');
                    stopDiv.id = `dispatchExtraStop${dispatchExtraStopCount}`;
                    stopDiv.style.cssText = 'position: relative; display: flex; align-items: center; gap: 10px;';
                    stopDiv.innerHTML = `
                        <span style="position: absolute; left: -20px; top: 50%; transform: translateY(-50%); color: #666; font-size: 12px;">${dispatchExtraStopCount}</span>
                        <input type="text" placeholder="üìç Extra stop ${dispatchExtraStopCount}..." 
                               style="flex: 1; padding: 18px; border: 2px solid #e9ecef; border-radius: 10px; font-size: 16px;">
                        <button onclick="removeDispatchExtraStop(${dispatchExtraStopCount})" 
                                style="background: #dc3545; color: white; border: none; padding: 8px 12px; border-radius: 6px;">‚úï</button>
                    `;
                    container.appendChild(stopDiv);
                }
            }
        };

        window.removeDispatchExtraStop = function(stopNum) {
            console.log('‚ûñ Removing extra stop', stopNum);
            const stopDiv = document.getElementById(`dispatchExtraStop${stopNum}`);
            if (stopDiv) {
                stopDiv.remove();
                // Renumber remaining stops
                const stops = document.querySelectorAll('[id^="dispatchExtraStop"]');
                stops.forEach((stop, index) => {
                    stop.id = `dispatchExtraStop${index + 1}`;
                    const span = stop.querySelector('span');
                    if (span) span.textContent = index + 1;
                });
                dispatchExtraStopCount = stops.length;
            }
        };

        window.toggleAdvanced = function() {
            console.log('üîÑ Toggle advanced');
            const section = document.getElementById('advanceSection');
            const arrow = document.getElementById('advanceArrow');
            if (section && arrow) {
                if (section.style.display === 'none') {
                    section.style.display = 'block';
                    arrow.textContent = '‚ñº';
                } else {
                    section.style.display = 'none';
                    arrow.textContent = '‚ñ≤';
                }
            }
        };

        window.saveDispatchBooking = function() {
            console.log('üíæ Saving dispatch booking');
            alert('Save dispatch booking - TODO: implement this');
        };

        window.findDriver = function() {
            console.log('üìç Find driver clicked');
            alert('Find driver - TODO: implement this');
        };

        window.createDispatchBooking = function(event) {
            console.log('üìù Create dispatch booking');
            if (event) event.preventDefault();
            alert('Create dispatch booking - TODO: implement this');
        };

        window.openNoteModal = function(type) {
            console.log('üìù Open note modal:', type);
            alert(`Open ${type} note modal - TODO: implement this`);
        };
    </script>
            <!-- Vehicle Manager Modal (copied from admin-simple.html) -->
            <div id="vehicleManagerModal" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: none; z-index: 1000; align-items: center; justify-content: center;">
                <div style="background: white; border-radius: 12px; max-width: 800px; width: 90%; max-height: 90vh; overflow-y: auto;">
                    <div style="background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%); color: white; padding: 20px; border-radius: 12px 12px 0 0; display: flex; justify-content: space-between; align-items: center;">
                        <h3 id="vehicleManagerModalTitle">Add New Vehicle</h3>
                        <button style="background: none; border: none; color: white; font-size: 24px; cursor: pointer;" onclick="closeVehicleManagerModal()">&times;</button>
                    </div>
                    <div style="padding: 30px;">
                        <form id="vehicleManagerForm">
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                                <div>
                                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">Name *</label>
                                    <input type="text" id="vehicleManagerName" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px;" placeholder="Premium Class" required>
                                </div>
                                <div>
                                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">Driver</label>
                                    <select id="vehicleManagerDriver" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px;">
                                        <option value="All">All Drivers</option>
                                    </select>
                                </div>
                            </div>

                            <div style="margin: 20px 0;">
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Description</label>
                                <textarea id="vehicleManagerDescription" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px;" rows="3" placeholder="Professional taxi service with premium comfort"></textarea>
                            </div>

                            <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-bottom: 20px;">
                                <div>
                                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">Passengers</label>
                                    <div style="display: flex; align-items: center; gap: 5px; justify-content: center;">
                                        <button type="button" style="width: 30px; height: 30px; border: 1px solid #ddd; background: white; border-radius: 4px; cursor: pointer; flex-shrink: 0;" onclick="adjustVehicleManagerValue('passengers', -1)">-</button>
                                        <input type="number" id="vehicleManagerPassengers" style="width: 50px; padding: 8px 4px; border: 1px solid #ddd; border-radius: 6px; text-align: center;" value="4" min="1" max="20" readonly>
                                        <button type="button" style="width: 30px; height: 30px; border: 1px solid #ddd; background: white; border-radius: 4px; cursor: pointer; flex-shrink: 0;" onclick="adjustVehicleManagerValue('passengers', 1)">+</button>
                                    </div>
                                </div>
                                <div>
                                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">Luggage</label>
                                    <div style="display: flex; align-items: center; gap: 5px; justify-content: center;">
                                        <button type="button" style="width: 30px; height: 30px; border: 1px solid #ddd; background: white; border-radius: 4px; cursor: pointer; flex-shrink: 0;" onclick="adjustVehicleManagerValue('luggage', -1)">-</button>
                                        <input type="number" id="vehicleManagerLuggage" style="width: 50px; padding: 8px 4px; border: 1px solid #ddd; border-radius: 6px; text-align: center;" value="2" min="0" max="20" readonly>
                                        <button type="button" style="width: 30px; height: 30px; border: 1px solid #ddd; background: white; border-radius: 4px; cursor: pointer; flex-shrink: 0;" onclick="adjustVehicleManagerValue('luggage', 1)">+</button>
                                    </div>
                                </div>
                                <div>
                                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">Hand Luggage</label>
                                    <div style="display: flex; align-items: center; gap: 5px; justify-content: center;">
                                        <button type="button" style="width: 30px; height: 30px; border: 1px solid #ddd; background: white; border-radius: 4px; cursor: pointer; flex-shrink: 0;" onclick="adjustVehicleManagerValue('handLuggage', -1)">-</button>
                                        <input type="number" id="vehicleManagerHandLuggage" style="width: 50px; padding: 8px 4px; border: 1px solid #ddd; border-radius: 6px; text-align: center;" value="2" min="0" max="20" readonly>
                                        <button type="button" style="width: 30px; height: 30px; border: 1px solid #ddd; background: white; border-radius: 4px; cursor: pointer; flex-shrink: 0;" onclick="adjustVehicleManagerValue('handLuggage', 1)">+</button>
                                    </div>
                                </div>
                                <div>
                                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">Hourly Rate (‚Ç¨)</label>
                                    <input type="number" id="vehicleManagerHourlyRate" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px;" value="25" min="0" step="5">
                                </div>
                            </div>

                            <div style="margin: 20px 0;">
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Vehicle Image</label>
                                <div style="border: 2px dashed #ddd; border-radius: 8px; padding: 20px; text-align: center; cursor: pointer;" onclick="document.getElementById('vehicleManagerImageInput').click()">
                                    <img id="vehicleManagerImagePreview" style="max-width: 200px; max-height: 150px; border-radius: 8px; margin: 10px 0; display: none;">
                                    <div id="vehicleManagerUploadText">
                                        <div style="font-size: 48px; margin-bottom: 10px;">üì∑</div>
                                        <div>Click to upload vehicle image</div>
                                        <div style="font-size: 12px; color: #666; margin-top: 5px;">JPG, PNG, WebP (max 5MB)</div>
                                    </div>
                                </div>
                                <input type="file" id="vehicleManagerImageInput" accept="image/*" style="display: none;" onchange="handleVehicleManagerImageUpload(this)">
                            </div>

                            <div style="display: flex; gap: 10px; justify-content: flex-end;">
                                <button type="button" style="background: #95a5a6; color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer;" onclick="closeVehicleManagerModal()">Cancel</button>
                                <button type="button" onclick="saveVehicleManagerForm()" style="background: #3498db; color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer;">Save Vehicle</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

</body>
</html>
